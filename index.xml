<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>è¡—ä¸Šçš„åŠ¨ç‰©å›­</title><link>https://heeexy.com/</link><description>Recent content on è¡—ä¸Šçš„åŠ¨ç‰©å›­</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>Heeexy</copyright><lastBuildDate>Sat, 13 Apr 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://heeexy.com/index.xml" rel="self" type="application/rss+xml"/><item><title>èŠèŠå¼‚å¸¸å¤„ç†--å…³äºçˆ†ç‚¸çš„è‰ºæœ¯ ğŸ¨</title><link>https://heeexy.com/p/exception-handling/</link><pubDate>Sat, 13 Apr 2024 00:00:00 +0000</pubDate><guid>https://heeexy.com/p/exception-handling/</guid><description>&lt;h2 id="å¼•å­">
&lt;a href="#%e5%bc%95%e5%ad%90">#&lt;/a>
å¼•å­
&lt;/h2>&lt;p>è¯´åˆ°å¼‚å¸¸å¤„ç†ï¼Œæ— éå°±æ˜¯ &lt;code>try-catch / throws&lt;/code> ï¼ŒGolang ä¸­å°±æ˜¯ &lt;code>if err != nil&lt;/code> ï¼Œç„¶åè®°ä¸‹é”™è¯¯ä¿¡æ¯ &lt;code>log.error(...)&lt;/code> ï¼Œä¸‹é¢æ˜¯ä¸ªå¾ˆå¸¸è§çš„å¼‚å¸¸å¤„ç†çš„ç¤ºä¾‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Scheduled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fixedDelay&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timeUnit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MINUTES&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">scheduledTask&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentTimeMillis&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å¼€å§‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">performTask&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡æ‰§è¡Œå¤±è´¥&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å®šæ—¶ä»»åŠ¡å®Œæˆï¼Œè€—æ—¶ {}ms&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentTimeMillis&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>ä½†æ˜¯ï¼Œè¿™æ ·å¤„ç†å°±å¤Ÿäº†å—ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>åœ¨èŠä¸‹é¢çš„è¯é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;p>Qï¼š&lt;strong>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œé«˜æ€§èƒ½ä¸é«˜å¯ç”¨å“ªä¸ªæ›´éš¾åšåˆ°ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>Aï¼šæ¯«æ— ç–‘é—®æ˜¯&lt;strong>é«˜å¯ç”¨&lt;/strong>ã€‚è¶Šæ˜¯åºå¤§çš„ç³»ç»Ÿï¼Œèƒ½å‘ç”Ÿå¼‚å¸¸çš„ç‚¹å°±è¶Šå¤šï¼Œæƒ³è®©å®ƒä¿æŒå…¨å¹´ 100%å¯ç”¨ï¼Œå‡ ä¹å°±æ˜¯ä¸å¯èƒ½çš„äº‹æƒ…ï¼Œå“ªæ€•æ˜¯ SLA çš„ 4 ä¸ª 9ã€3 ä¸ª 9ï¼Œå¯¹å¾ˆå¤šä¸šåŠ¡æ¥è¯´éƒ½æ˜¯éå¸¸å‹‰å¼ºçš„ã€‚&lt;/p>
&lt;h2 id="è®©æˆ‘ä»¬å†è®¤è¯†ä¸€ä¸‹å¼‚å¸¸å¤„ç†">
&lt;a href="#%e8%ae%a9%e6%88%91%e4%bb%ac%e5%86%8d%e8%ae%a4%e8%af%86%e4%b8%80%e4%b8%8b%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86">#&lt;/a>
&lt;strong>è®©æˆ‘ä»¬å†è®¤è¯†ä¸€ä¸‹å¼‚å¸¸å¤„ç†&lt;/strong>
&lt;/h2>&lt;h3 id="è¯­è¨€å±‚é¢">
&lt;a href="#%e8%af%ad%e8%a8%80%e5%b1%82%e9%9d%a2">#&lt;/a>
è¯­è¨€å±‚é¢
&lt;/h3>&lt;p>ä¸åŒçš„è¯­è¨€é‡‡ç”¨äº†ä¸åŒçš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚&lt;/p>
&lt;p>C++ã€Pythonã€JavaScript æ”¯æŒäº†æŠ›å‡ºå¼‚å¸¸ï¼Œä½†ä¸å¼ºåˆ¶æ•è·ï¼Œæ”¾åœ¨ Java çš„æ¦‚å¿µä¸­ï¼Œå°±éƒ½å±äº Unchecked Exceptionsã€‚&lt;/p>
&lt;p>Java åŒºåˆ†äº† Checked Exception å’Œ Unchecked Exceptionï¼Œç¨‹åºå‘˜éœ€è¦å¯¹ä¸åŒåˆ†ç±»çš„å¼‚å¸¸è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚&lt;/p>
&lt;p>Golang å°†å¼‚å¸¸å¤„ç†ç›´æ¥çº³å…¥åˆ°äº†å‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œæ²¡æœ‰ &lt;code>try-catch&lt;/code> æœºåˆ¶ï¼ŒæœŸæœ›ä½ è¿›è¡Œæ˜¾å¼çš„åˆ¤æ–­å¤„ç†ã€‚&lt;/p>
&lt;p>&lt;img src="https://img.heeexy.com/m1/exception-handling-in-different-language.png"
loading="lazy"
alt="exception-handling-in-different-language.png"
>&lt;/p>
&lt;p>Qï¼š&lt;strong>ä¸åŒçš„å¼‚å¸¸å¤„ç†æœºåˆ¶æ˜¯å¦ä¸€å®šå¸¦æ¥æ›´å¼ºçš„å¥å£®æ€§ï¼Ÿ&lt;/strong>&lt;/p>
&lt;p>Aï¼šä¸ä¼šã€‚ä¸åŒçš„å¼‚å¸¸å¤„ç†æœºåˆ¶åªèƒ½ä½“ç°è®¾è®¡è€…&lt;strong>ä¸åŒçš„è®¾è®¡å“²å­¦&lt;/strong>ã€‚å®é™…é¡¹ç›®æ˜¯å¦å¥å£®ï¼Œæ›´å¤šçš„è¿˜æ˜¯ä¾èµ–ä½ å¦‚ä½•ä½¿ç”¨è¿™äº›æœºåˆ¶æ¥æ„å»ºå’Œç»´æŠ¤åº”ç”¨ç¨‹åºã€‚&lt;/p>
&lt;h3 id="ç¼–ç å±‚é¢">
&lt;a href="#%e7%bc%96%e7%a0%81%e5%b1%82%e9%9d%a2">#&lt;/a>
ç¼–ç å±‚é¢
&lt;/h3>&lt;p>ä¸ºäº†è®©æ¦‚å¿µæ›´åŠ æ¸…æ™°ï¼Œæˆ‘è¿™è¾¹å°†ä¸åŒçš„å¼‚å¸¸å¤„ç†çš„ç¼–ç èƒ½åŠ›åˆ†æˆäº† 7 ä¸ªç­‰çº§ï¼Œå¯èƒ½ä¸å¤ªä¸¥è°¨ï¼Œä¸å¿…ä¸¥æ ¼æ¯”è¾ƒã€‚&lt;/p>
&lt;h4 id="åŸºç¡€çš„å¼‚å¸¸æ•è·">
&lt;a href="#%e5%9f%ba%e7%a1%80%e7%9a%84%e5%bc%82%e5%b8%b8%e6%8d%95%e8%8e%b7">#&lt;/a>
åŸºç¡€çš„å¼‚å¸¸æ•è·
&lt;/h4>&lt;p>æœ€åŸºç¡€çš„ç­‰çº§ï¼Œäººäººéƒ½çŸ¥é“æœ‰æ½œåœ¨çš„å¼‚å¸¸å°±è¦ &lt;code>try-catch&lt;/code>ï¼Œæˆ‘ä»¬ç®€å•çœ‹ 2 ä¸ªç¤ºä¾‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">loadData&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å°è¯•åŠ è½½æ•°æ®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">loadFromFile&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¼‚å¸¸å¤„ç†ï¼Œè¿™é‡Œä»…åšæ‰“å°å¤„ç†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;åŠ è½½æ•°æ®å¤±è´¥&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸Šé¢æ˜¯ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼Œè¢«è¿™æ ·çš„ä»£ç å‘è¿‡çš„äººå¯èƒ½å¾ˆå¿«å°±çœ‹å‡ºæ¥ï¼Œ&lt;code>catch&lt;/code>ä¸­çš„å¤„ç†&lt;strong>çº¯å±å®³äºº&lt;/strong>ï¼Œæˆ‘è¿™é‡Œå°±ä¸è¿‡å¤šåæ§½äº†ï¼Œæˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">updateUserStats&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ­¥éª¤ 1: ä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">UserInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">database&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getUserInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ­¥éª¤ 2: å¯¹ç”¨æˆ·ä¿¡æ¯è®¡ç®—ä¸€ç³»åˆ—ç»Ÿè®¡æ•°æ®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">UserStats&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">calculateStats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">userInfo&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ­¥éª¤ 3: æ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ®åˆ°æ•°æ®åº“&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">database&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">updateUserStats&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">stats&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ­¥éª¤ 4: è®°å½•æ“ä½œæˆåŠŸæ—¥å¿—&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;User stats updated successfully for userId: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¯¹æ‰€æœ‰å¯èƒ½çš„å¼‚å¸¸æƒ…å†µè¿›è¡Œä¸€ä¸ª catch æ“ä½œä¸å¤„ç†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to update user stats for userId: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userId&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™åœ¨ä¸šåŠ¡ä»£ç ä¸­ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œå› ä¸ºå®³æ€•å‡ºå¼‚å¸¸ï¼Œç›´æ¥ try ä¸€ä¸ªå¤§æ‹¬å·ä»å¤´åŒ…åˆ°ä½ï¼Œæ»¡æ»¡çš„å®‰å…¨æ„Ÿã€‚&lt;/p>
&lt;p>æˆ‘ç”šè‡³è§è¿‡æœ‰å›¢é˜ŸæŒ‰è¿™ç§æ–¹å¼ä½œä¸ºè§„èŒƒã€‚
&lt;img src="https://img.heeexy.com/m1/excuse-me.png"
loading="lazy"
alt="???"
>&lt;/p>
&lt;h4 id="ç±»å‹åŒºåˆ†">
&lt;a href="#%e7%b1%bb%e5%9e%8b%e5%8c%ba%e5%88%86">#&lt;/a>
ç±»å‹åŒºåˆ†
&lt;/h4>&lt;p>å¯ä»¥æ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹è¿›è¡Œæ•è·å’Œå¤„ç†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Python" data-lang="Python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">read_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">FileNotFoundError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;The file was not found.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">IOError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;There was an IO error.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">read_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;nonexistent.txt&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ä¸Šä¸‹æ–‡ç›¸å…³å¤„ç†å’Œå¼‚å¸¸ä¼ é€’">
&lt;a href="#%e4%b8%8a%e4%b8%8b%e6%96%87%e7%9b%b8%e5%85%b3%e5%a4%84%e7%90%86%e5%92%8c%e5%bc%82%e5%b8%b8%e4%bc%a0%e9%80%92">#&lt;/a>
ä¸Šä¸‹æ–‡ç›¸å…³å¤„ç†å’Œå¼‚å¸¸ä¼ é€’
&lt;/h4>&lt;p>Qï¼š&lt;strong>ä½œä¸ºå¼‚å¸¸å¤„ç†è€…ï¼Œä½•æ—¶è¯¥ try-catch ï¼Œä½•æ—¶è¯¥å‘ä¸ŠæŠ›?&lt;/strong>&lt;/p>
&lt;p>Aï¼šå–å†³äº&lt;strong>ä¸Šä¸‹æ–‡&lt;/strong>ã€‚&lt;/p>
&lt;p>åˆ°äº†è¿™ä¸€çº§ï¼Œæœ€å…³é”®çš„æ˜¯å¼„æ¸…æ¥šè‡ªå·±ä»£ç æ‰€å¤„çš„ä¸Šä¸‹æ–‡ï¼Œè‡ªå·±åº”è¯¥æ‰®æ¼”çš„è§’è‰²ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Golang" data-lang="Golang">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span> &lt;span class="nx">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;errors&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// æ˜¯ä¸€ä¸ªè·å–æ•°æ®çš„å‡½æ•°ï¼Œå®ƒè¿”å›æ•°æ®å’Œå¯èƒ½å‘ç”Ÿçš„é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">fetchData&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å‡è£…æ•°æ®è·å–è¿‡ç¨‹å¤±è´¥äº†ï¼Œè¿”å›é”™è¯¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">// å› ä¸ºfetchDataæš‚æ—¶ä¸ä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥è¿”å›é”™è¯¯ä¿¡æ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">errors&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;data source is unavailable&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ä¸»å¤„ç†å‡½æ•°ï¼Œå°è¯•è·å–æ•°æ®å¹¶å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">processData&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nf">fetchData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// é”™è¯¯å¤„ç†é€»è¾‘ï¼Œè¿›è¡Œé”™è¯¯å¤„ç†
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to fetch data:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨è¿™é‡Œå¯ä»¥å†³å®šå¦‚ä½•å¤„ç†è¿™ä¸ªé”™è¯¯ï¼Œä¾‹å¦‚é‡è¯•æˆ–åœç”¨æœåŠ¡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œç»§ç»­å¤„ç†æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Processing data:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">processData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œ&lt;code>fetchData&lt;/code>å‡½æ•°æ¸…æ¥šçŸ¥é“è‡ªå·±æ˜¯ä¸åº”è¯¥åä¸‹ã€Œè·å–æ•°æ®å¤±è´¥ã€è¿™ä¸ªå¼‚å¸¸çš„ï¼Œæ‰€ä»¥å‘ä¸ŠæŠ›å‡ºã€‚è€Œ &lt;code>processData&lt;/code> å‡½æ•°æ˜ç™½è‡ªå·±æœ‰æƒåŠ›ä¹Ÿæœ‰èƒ½åŠ›å¯¹ã€Œè·å–æ•°æ®å¤±è´¥ã€ è¿™ä¸ªå¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥å®ƒä¸å†å‘ä¸ŠæŠ›ã€‚&lt;/p>
&lt;h4 id="ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸å’Œç²¾ç»†åŒ–å¤„ç†">
&lt;a href="#%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89%e5%bc%82%e5%b8%b8%e5%92%8c%e7%b2%be%e7%bb%86%e5%8c%96%e5%a4%84%e7%90%86">#&lt;/a>
ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸å’Œç²¾ç»†åŒ–å¤„ç†
&lt;/h4>&lt;h4 id="é¢„é˜²æ—¥å¿—è®°å½•å’Œæ¢å¤ç­–ç•¥">
&lt;a href="#%e9%a2%84%e9%98%b2%e6%97%a5%e5%bf%97%e8%ae%b0%e5%bd%95%e5%92%8c%e6%81%a2%e5%a4%8d%e7%ad%96%e7%95%a5">#&lt;/a>
é¢„é˜²ã€æ—¥å¿—è®°å½•å’Œæ¢å¤ç­–ç•¥
&lt;/h4>&lt;h4 id="ç›‘æ§å‘Šè­¦">
&lt;a href="#%e7%9b%91%e6%8e%a7%e5%91%8a%e8%ad%a6">#&lt;/a>
ç›‘æ§ã€å‘Šè­¦
&lt;/h4>&lt;h4 id="ä¼˜é›…çš„å¼‚å¸¸å¤„ç†ç­–ç•¥">
&lt;a href="#%e4%bc%98%e9%9b%85%e7%9a%84%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e7%ad%96%e7%95%a5">#&lt;/a>
ä¼˜é›…çš„å¼‚å¸¸å¤„ç†ç­–ç•¥
&lt;/h4>&lt;h3 id="ä¸šåŠ¡æ¶æ„å±‚é¢">
&lt;a href="#%e4%b8%9a%e5%8a%a1%e6%9e%b6%e6%9e%84%e5%b1%82%e9%9d%a2">#&lt;/a>
ä¸šåŠ¡/æ¶æ„å±‚é¢
&lt;/h3>&lt;p>æœ€åå†æä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡/æ¶æ„å±‚é¢ä¹Ÿæœ‰å¾ˆå¤šçš„æœºåˆ¶éƒ½æ˜¯ä¸ºäº†åšå¼‚å¸¸å¤„ç†ï¼Œä¾‹å¦‚é‡è¯•ã€é™æµã€ç†”æ–­ã€åŠŸèƒ½é™çº§ã€å¼‚åœ°å¤šæ´»ï¼Œç”šè‡³æ•°æ®æ‰‹åŠ¨ä¿®å¤ã€å¥å£®çš„å‘å¸ƒæœºåˆ¶éƒ½æ˜¯ä¸ºäº†åº”å¯¹å„ç§å¼‚å¸¸æƒ…å†µã€‚&lt;/p>
&lt;p>ç¼–ç å±‚é¢å¦‚æœèƒ½åšå¥½ï¼Œç›¸ä¿¡åˆ°äº†è¿™ä¸ªå±‚é¢ä½ ä¹Ÿä¸€å®šèƒ½åšå¾—å¾ˆä¸é”™ã€‚&lt;/p>
&lt;h2 id="ä¸ºä»€ä¹ˆå¼‚å¸¸å¤„ç†æ˜¯å…³äºçˆ†ç‚¸çš„è‰ºæœ¯">
&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e6%98%af%e5%85%b3%e4%ba%8e%e7%88%86%e7%82%b8%e7%9a%84%e8%89%ba%e6%9c%af">#&lt;/a>
ä¸ºä»€ä¹ˆå¼‚å¸¸å¤„ç†æ˜¯å…³äºçˆ†ç‚¸çš„è‰ºæœ¯ï¼Ÿ
&lt;/h2>&lt;p>æˆ‘è®¤ä¸ºå·²ç»ä¸éœ€è¦ä¸“é—¨å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿˜æ˜¯æƒ³åœ¨æ–‡ç« æœ€ååæ§½ä¸‹ï¼š&lt;/p>
&lt;p>å¼‚å¸¸å¤„ç†äººäººéƒ½èƒ½åšï¼Œä½†å¾ˆå¤šäººåšå‡ºæ¥çš„å°±æ˜¯ ğŸ’©ï¼ŒæŒ–å‘ï¼Œè¾£çœ¼ç›ï¼&lt;/p>
&lt;p>å¸Œæœ›å¤§å®¶é‡è§†èµ·è¿™ä»¶å°äº‹ã€‚&lt;/p></description></item><item><title>------------------------------âœ‚ï¸ åˆ†å‰²çº¿ âœ‚ï¸------------------------------</title><link>https://heeexy.com/p/dividing-line/</link><pubDate>Mon, 08 Apr 2024 22:04:33 +0800</pubDate><guid>https://heeexy.com/p/dividing-line/</guid><description>&lt;h2 id="ä¹‹å‰">
&lt;a href="#%e4%b9%8b%e5%89%8d">#&lt;/a>
ä¹‹å‰
&lt;/h2>&lt;p>ä¹‹å‰çš„åšå®¢å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š&lt;/p>
&lt;h3 id="å›¾ç‰‡å…¨éƒ¨ä¸¢å¤±">
&lt;a href="#%e5%9b%be%e7%89%87%e5%85%a8%e9%83%a8%e4%b8%a2%e5%a4%b1">#&lt;/a>
å›¾ç‰‡å…¨éƒ¨ä¸¢å¤±
&lt;/h3>&lt;p>ç”±äºæˆ‘å¤‡ä»½æ„è¯†ä¸å¼ºï¼ŒVPS è¢«å°ä¹‹åï¼Œå›¾ç‰‡å°½æ•°ä¸¢å¤±ã€‚
è¿™å·²ç»æ˜¯ç¬¬äºŒæ¬¡å‡ºç°è¿™ç§é—®é¢˜ï¼Œä¸Šæ¬¡æ˜¯è¢«ä¸ƒç‰›äº‘èƒŒåˆºã€‚&lt;/p>
&lt;h3 id="åšæ–‡é•¿æœŸä¸æ›´æ–°">
&lt;a href="#%e5%8d%9a%e6%96%87%e9%95%bf%e6%9c%9f%e4%b8%8d%e6%9b%b4%e6%96%b0">#&lt;/a>
åšæ–‡é•¿æœŸä¸æ›´æ–°
&lt;/h3>&lt;p>çºµç„¶å¯ä»¥æ‰¾å¾ˆå¤šç†ç”±ï¼Œä½†æ€»å½’åªæœ‰ä¸€ä¸ªå­—ï¼šæ‡’ã€‚&lt;/p>
&lt;h2 id="ä¹‹å">
&lt;a href="#%e4%b9%8b%e5%90%8e">#&lt;/a>
ä¹‹å
&lt;/h2>&lt;h3 id="å›¾ç‰‡">
&lt;a href="#%e5%9b%be%e7%89%87">#&lt;/a>
å›¾ç‰‡
&lt;/h3>&lt;p>ä½¿ç”¨ Local+iCloud+VPS ä¸‰é‡ä¿é™©æœºåˆ¶
&lt;img src="https://img.heeexy.com/m1/blog-image-sync.png"
loading="lazy"
>&lt;/p>
&lt;h3 id="åšæ–‡">
&lt;a href="#%e5%8d%9a%e6%96%87">#&lt;/a>
åšæ–‡
&lt;/h3>&lt;p>ä¾ç„¶æ²¡æœ‰æ›´æ–°é¢‘ç‡çš„ä¿è¯ã€‚&lt;/p>
&lt;p>åšå®¢è¿™ä¸œè¥¿ï¼Œå¯ä»¥ä¸å†™ï¼Œä½†ä¸å¯ä»¥æ²¡æœ‰ï¼Œè¿™æ˜¯ä¸“å±è‡ªå·±çš„ä¸€ç‰‡å¤©åœ°ã€‚&lt;/p>
&lt;p>è¿‘æœŸå·²ç»æŠŠ ChatGPT èå…¥äº†è‡ªå·±çš„å·¥ä½œä¸­ï¼Œå¯ä»¥åªéœ€å†™ä¸ªæçº²ï¼Œè®© GPT å¸®æˆ‘ç”Ÿæˆä¸€ç¯‡é«˜è´¨é‡æ–‡ç« ï¼Œä¹Ÿå¯ä»¥æŠŠè‡ªå·±å†™å¥½çš„å†…å®¹ä¸¢ç»™ GPT å¸®æˆ‘ä¿®æ­£æ¶¦è‰²ã€‚è®©äººä¸å…æ€€ç–‘è‡ªå·±ï¼Œè¿˜è´¹åŠ²å†™äº›ç”µå­åƒåœ¾æ˜¯ä½•å¿…?&lt;/p>
&lt;p>ä»”ç»†ä¸€æƒ³ä¹Ÿå¤§å¯ä¸å¿…ï¼Œæ—¢ç„¶åšå®¢ä¸»è¦ä¸ºè‡ªå·±æœåŠ¡ï¼Œé‚£è¿˜æ˜¯è¦å…³æ³¨åšå®¢å¯¹è‡ªå·±çš„æå‡ï¼Œæ˜¯å¦å¸®åŠ©åˆ°äº†è‡ªå·±æ€»ç»“å­¦ä¹ ã€å·¥ä½œçš„ç»éªŒã€‚&lt;/p></description></item><item><title>About</title><link>https://heeexy.com/about/about/</link><pubDate>Sun, 07 Apr 2024 18:29:00 +0800</pubDate><guid>https://heeexy.com/about/about/</guid><description>&lt;h1 id="å…³äº">
&lt;a href="#%e5%85%b3%e4%ba%8e">#&lt;/a>
å…³äº
&lt;/h1></description></item><item><title>æ•°æ®åº“å¦‚æœæ–­ç”µï¼Œæˆ‘ä»¬éœ€ä¸éœ€è¦æ…Œï¼Ÿ</title><link>https://heeexy.com/p/database-crash-safe/</link><pubDate>Sun, 13 Nov 2022 11:19:33 +0800</pubDate><guid>https://heeexy.com/p/database-crash-safe/</guid><description>&lt;h1 id="åº">
&lt;a href="#%e5%ba%8f">#&lt;/a>
åº
&lt;/h1>&lt;p>ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬æ—¶æ—¶åˆ»åˆ»åœ¨å‘æ•°æ®åº“å‘é€ç€å†™å…¥ã€æ–°å¢ã€åˆ é™¤æ•°æ®çš„è¯·æ±‚ï¼Œä¸çŸ¥é“å„ä½æœ‰æ²¡æœ‰å’Œæˆ‘ä¸€æ ·çš„é¡¾è™‘ï¼Œå¦‚æœæœåŠ¡å™¨çªç„¶æ–­ç”µæˆ–è€…æ­»æœºï¼Œæ•°æ®ä¼šä¸ä¼šä¸¢å¤±ï¼Œç”šè‡³æ•°æ®åº“ä¼šä¸ä¼šæŒ‚äº†å†ä¹Ÿæ— æ³•æ¢å¤ï¼Ÿ&lt;/p>
&lt;p>å¿ƒå¤§çš„åŒå­¦å¯èƒ½ä¼šè¯´ï¼Œæˆ‘ä»¬ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®æœ‰å‰¯æœ¬ï¼Œä¸ç”¨æ…Œï¼&lt;/p>
&lt;p>é‚£ä¹ˆæ­£åœ¨å†™å…¥ä¸­çš„æ•°æ®å‘¢ï¼Ÿå†™å…¥è¯·æ±‚å‘ç»™äº†æ•°æ®åº“ï¼Œè¿˜æ²¡æ”¶åˆ°æˆåŠŸ/å¤±è´¥çš„å“åº”ï¼Œè¿™æ—¶å€™æ•°æ®åº“æ–­ç”µï¼Œä½ æ…Œä¸æ…Œï¼Ÿ&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-1.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å½“ç„¶ï¼Œä½œä¸ºæ•°æ®åº“ï¼Œè‡ªæœ‰å®ƒä¿éšœæ•°æ®å®‰å…¨çš„æ–¹å¼ï¼Œåªè¦åšå¥½äº†åˆé€‚çš„é…ç½®ï¼Œå°±å¯ä»¥åº”å¯¹æ–­ç”µçš„æƒ…å†µã€‚&lt;/p>
&lt;p>ä»Šå¤©æˆ‘ä»¬å°±ä»¥ Elasticsearch å’Œ MySQL ä¸ºä¾‹æ¥äº†è§£ä¸‹æ•°æ®åº“æ˜¯å¦‚ä½•ä¿éšœæ•°æ®å®‰å…¨çš„ã€‚&lt;/p>
&lt;h1 id="åŸç†">
&lt;a href="#%e5%8e%9f%e7%90%86">#&lt;/a>
åŸç†
&lt;/h1>&lt;h2 id="elasticsearch">
&lt;a href="#elasticsearch">#&lt;/a>
Elasticsearch
&lt;/h2>&lt;p>æ•°æ®åœ¨ lucene ä¸­çš„ä¸»è¦å†™å…¥æµç¨‹ä¸Šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-2.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåªæœ‰ segment è½ç›˜äº†ï¼Œæ•°æ®æ‰æ˜¯çœŸæ­£å®‰å…¨çš„ã€‚ä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼šåœ¨ refresh ä¹‹åï¼Œcommit ä¹‹å‰ï¼Œæ•°æ®å·²ç»å¯ä»¥è¢«ç”¨æˆ·æŸ¥åˆ°ï¼Œç„¶è€Œæ–­ç”µåæ•°æ®ä¸¢å¤±ï¼Œé‡å¯åè¿™ä¸ªæ•°æ®æ— æ³•è¢«æœåˆ°ã€‚&lt;/p>
&lt;p>å› æ­¤ es è®¾è®¡äº†translogï¼Œæ¯æ¬¡æ•°æ®çš„å†™å…¥ï¼Œä¼šåœ¨åˆ†è¯ã€åŠ å…¥å€’æ’ç´¢å¼•ç­‰é‡é€»è¾‘çš„ lucene æ“ä½œä¹‹å‰ï¼Œæ•°æ®çš„åŸå§‹ä¿¡æ¯ç‡å…ˆå†™å…¥ translogã€‚è¿™å°±æ˜¯ WAL (write-ahead-logging) æœºåˆ¶ã€‚&lt;/p>
&lt;p>æœ‰äº† translog åï¼Œå³ä½¿æ˜¯æ²¡æœ‰è½ç›˜åˆ° segment çš„æ•°æ®ï¼Œå´©æºƒæƒ³è¦æ¢å¤ä¹Ÿæœ‰äº†ä¾æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‰2ä¸ªé˜¶æ®µä¾é  translog æ¢å¤ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-3.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å½“ç„¶ translog æ–‡ä»¶æœ¬èº«ä¹Ÿä¼šæœ‰ fsync çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡é…ç½®é€‰æ‹© translog æ–‡ä»¶ fsync çš„æ—¶æœºï¼Œè€Œè¿™ä¸ªæ—¶æœºæœ€ç»ˆå†³å®šäº†æ•°æ®çš„å¯æ¢å¤æ€§ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-4.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>Elasticsearch æ¯”è¾ƒå¸¸è§çš„è®¾ç½®æ˜¯ï¼š&lt;/p>
&lt;p>&lt;code>index.translog.durability=async&lt;/code>&lt;/p>
&lt;p>&lt;strong>&lt;code>index.translog.sync_interval=5s&lt;/code>&lt;/strong>&lt;/p>
&lt;p>è¿™æ ·é…ç½®ä¸‹ï¼Œæœ€å¤šå¯èƒ½ä¸¢å¤± 5s çš„æ•°æ®ã€‚è€Œ Elasticsearch è¦ä¿éšœæ•°æ®æ”¯æŒå´©æºƒæ¢å¤ï¼Œæ¯”è¾ƒæç«¯çš„è¿½æ±‚å´©æºƒæ¢å¤çš„è®¾ç½®ä¸ºï¼š&lt;/p>
&lt;p>&lt;code>index.translog.durability=request&lt;/code>&lt;/p>
&lt;p>æ¯ä¸ª request éƒ½ä¼šè¿›è¡Œæ•°æ®è½ç›˜ã€‚&lt;/p>
&lt;h2 id="mysql">
&lt;a href="#mysql">#&lt;/a>
MySQL
&lt;/h2>&lt;p>æ•°æ®æ›´æ–°æ“ä½œåœ¨ MySQLä¸­çš„æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-5.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;p>å…¶ä¸­å´©æºƒæ¢å¤çš„æ ¸å¿ƒæ˜¯ redo logï¼Œinnodb_flush_log_at_trx_commit å‚æ•°è®¾ç½®ä¸º 1 æ—¶ï¼Œå¯ä»¥ä¿éšœæ¯æ¬¡äº‹åŠ¡ commit çš„æ—¶å€™ redo log åˆ·åˆ°ç£ç›˜ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-6.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h2 id="å¯¹æ¯”">
&lt;a href="#%e5%af%b9%e6%af%94">#&lt;/a>
å¯¹æ¯”
&lt;/h2>&lt;h3 id="åŒ">
&lt;a href="#%e5%90%8c">#&lt;/a>
åŒ
&lt;/h3>&lt;ol>
&lt;li>ä¸ºäº†æå‡æ€§èƒ½ï¼Œéƒ½å……åˆ†åˆ©ç”¨äº†å†…å­˜ã€‚ç”±æ­¤ä¹Ÿæå‡äº†æ•°æ®å®‰å…¨é—®é¢˜çš„å¤æ‚åº¦ï¼Œéœ€è¦ä¿éšœå†…å­˜ä¸­çš„æ•°æ®åœ¨æ–­ç”µä¸¢å¤±åï¼Œæœ‰åŠæ³•è¿›è¡Œæ¢å¤ã€‚&lt;/li>
&lt;li>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œéƒ½åˆ©ç”¨äº† WAL (write-ahead-logging) æœºåˆ¶ã€‚&lt;/li>
&lt;li>éƒ½éœ€è¦å…³æ³¨ log ä½•æ—¶ fsync åˆ°ç£ç›˜ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="å¼‚">
&lt;a href="#%e5%bc%82">#&lt;/a>
å¼‚
&lt;/h3>&lt;ol>
&lt;li>log ä½œç”¨ä¸åŒï¼š
&lt;ul>
&lt;li>Elasticsearch çš„ translog ç”¨äºå´©æºƒæ¢å¤&lt;/li>
&lt;li>MySQL çš„ redo log ç”¨äºå´©æºƒæ¢å¤&lt;/li>
&lt;li>MySQL çš„ binlog ä¸æ”¯æŒå´©æºƒæ¢å¤ï¼Œä¸»è¦ç”¨äºæ•°æ®çš„å¢é‡å¤‡ä»½ã€‚å¯ä»¥æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œå¯ä»¥æ”¯æŒæ•°æ®å›æº¯ï¼Œé…åˆå…¨é‡çš„å¿«ç…§ï¼Œå¯ä»¥å›åˆ°ä¹‹å‰æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>log å†…å®¹ä¸åŒï¼š
&lt;ul>
&lt;li>translog è®°å½•è¯·æ±‚åŸå§‹ä¿¡æ¯ã€‚&lt;/li>
&lt;li>redo log è®°å½•ç»“æ„åŒ–ä¹‹åçš„ï¼Œå…·ä½“ page ä¸­çš„ä¿®æ”¹ä¿¡æ¯ï¼Œè¯¦æƒ…å¯ä»¥å‚è§&lt;a class="link" href="http://catkang.github.io/2020/02/27/mysql-redo.html" target="_blank" rel="noopener"
>åº–ä¸è§£InnoDBä¹‹REDO LOG&lt;/a>ã€‚&lt;/li>
&lt;li>binlog è®°å½•çš„å†…å®¹å’Œ translog æ›´ä¸ºç±»ä¼¼ï¼Œå®ƒçš„ statement æ ¼å¼è®°å½•çš„æ˜¯åŸå§‹è¯­å¥ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>log ä¿å­˜æ—¶é•¿ä¸åŒï¼š
&lt;ul>
&lt;li>translog åœ¨æ¯æ¬¡ flush å®Œåéƒ½ä¼šæ¸…ç©ºï¼Œä½“ç§¯å¾ˆå°ã€‚&lt;/li>
&lt;li>redo log å¾ªç¯ä½¿ç”¨ib_logfile0ã€ib_logfile1â€¦ ä½“ç§¯ä¹Ÿä¸ä¼šç‰¹åˆ«å¤§ã€‚ï¼ˆä»…è®¨è®º crash-safe é—®é¢˜çš„è¯ï¼Œè¿™ä¸€ç‚¹åº”è¯¥å±äºç›¸åŒç‚¹ï¼‰&lt;/li>
&lt;li>binlog å¯ä»¥ä¿å­˜å¾ˆä¹…ï¼Œæ—¶é•¿å®Œå…¨å–å†³äºç”¨æˆ·æƒ³è¦æ•°æ®å¯è¿½æº¯å¤šä¹…ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>æˆ‘ä»¬å†é‡ç‚¹å…³æ³¨ä¸‹ä¸ºä»€ä¹ˆ translog å’Œ redo log åŒæ ·ç”¨äº crash-safeï¼Œä½†è®°å½•çš„ä¿¡æ¯ä¸åŒã€‚&lt;/p>
&lt;p>æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œè‹¦å¯»æ— æœåç¿»é˜… lucene æ–‡æ¡£ä¸­æŸ¥æ‰¾ translog ä¿¡æ¯æ—¶çªç„¶æƒ³èµ·æ¥ï¼Œå…¶å®è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ã€‚&lt;/p>
&lt;p>å› ä¸ºä»–ä»¬æ‰€å¤„çš„å±‚çº§ä¸åŒã€‚&lt;/p>
&lt;p>Elasticsearch ä»¥ lucene ä¸ºå¼•æ“ï¼Œä½† lucene æœ¬èº«æ²¡æœ‰ translogï¼Œå› æ­¤ Elasticsearch è¦åœ¨è¾ƒé«˜å±‚çº§è®°å½•è¯·æ±‚ä¿¡æ¯ã€‚è€Œ InnoDB ä½œä¸º MySQL çš„å¼•æ“ï¼Œè‡ªèº«å°±å¯ä»¥æ‹¿åˆ°æœ¬æ¬¡è¯·æ±‚çš„æ•°æ®ç»“æ„åŒ–ä¹‹åçš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-7.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;h1 id="review">
&lt;a href="#review">#&lt;/a>
Review
&lt;/h1>&lt;ol>
&lt;li>
&lt;p>é¢å¯¹ä¸šç•Œå…±åŒçš„é—®é¢˜ï¼Œæ€»æ˜¯æœ‰ç›¸ä¼¼çš„è§£å†³æ–¹æ¡ˆå¯ä¾›å‚è€ƒã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¼„æ¸…æ¥šè‡ªå·±çš„éœ€æ±‚å’Œå®é™…çš„æ•°æ®åº“é…ç½®ä¹‹åï¼Œæ•°æ®åº“çš„æœåŠ¡å™¨æ–­ç”µä¸ç”¨æ…Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„ä¸€å¼ å›¾ï¼Œæ•°æ®åº“è™½å¯ä»¥åšåˆ° crash-safe ï¼Œä½†ä¸ä»£è¡¨æˆ‘ä»¬å¯¹é‡è¦ä¸šåŠ¡å¯ä»¥æŠŠå¿ƒæ”¾åˆ°è‚šå­é‡Œã€‚å› ä¸ºï¼š&lt;/p>
&lt;ol>
&lt;li>MySQL å¯¹åœ¨ crash åå¯¹äº‹åŠ¡æ˜¯å¦éœ€è¦æ•°æ®æ¢å¤çš„ä¾æ®æ˜¯ binlog æ˜¯å¦å®Œæ•´ï¼Œæ— è®º redo log æ˜¯å¦è¾¾åˆ°äº† commit çŠ¶æ€ï¼Œå³æ— è®ºè¿™ä¸ªäº‹åŠ¡æ˜¯å¦æœ€ç»ˆæäº¤å®Œæˆï¼Œå“åº”æ˜¯å¦åˆ°è¾¾å®¢æˆ·ç«¯ã€‚&lt;/li>
&lt;li>å›¾ä¸Šçš„ request / response å…¶å®æœ¬èº«å°±å¹¶ä¸å¯é ã€‚&lt;/li>
&lt;/ol>
&lt;p>å› æ­¤å¯¹äºæå…¶é‡è¦çš„ä¸šåŠ¡æ¥è¯´ï¼Œæç«¯åœºæ™¯çš„ä¸šåŠ¡å®Œæ•´æ€§ä»ç„¶éœ€è¦ä¿æŒå…³æ³¨ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/database-crash-safe-8.png"
loading="lazy"
alt="Untitled"
>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Redissonåˆ†å¸ƒå¼é”æŠ¥é”™é—®é¢˜æ’æŸ¥</title><link>https://heeexy.com/p/redisson-illegalmonitorstateexception/</link><pubDate>Thu, 16 Jul 2020 23:47:00 +0800</pubDate><guid>https://heeexy.com/p/redisson-illegalmonitorstateexception/</guid><description>&lt;h2 id="æ•…éšœ">
&lt;a href="#%e6%95%85%e9%9a%9c">#&lt;/a>
æ•…éšœ
&lt;/h2>&lt;p>ä¸šåŠ¡çº¿æµ‹è¯•åŒå­¦åé¦ˆå‹æµ‹æ—¶ï¼Œæœ‰ä»¥ä¸‹æŠ¥é”™æ—¥å¿—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">java&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">lang&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">IllegalMonitorStateException&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attempt&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unlock&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">locked&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">current&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">def1bd2c&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">1f49&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">4802&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">b635&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">5ea78543c033&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">thread&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">109&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">redisson&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">RedissonLock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RedissonLock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">java&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">366&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å…ˆæŠ›ç»“è®º">
&lt;a href="#%e5%85%88%e6%8a%9b%e7%bb%93%e8%ae%ba">#&lt;/a>
å…ˆæŠ›ç»“è®º
&lt;/h2>&lt;p>å»ºè®®é‡åˆ°ç±»ä¼¼é—®é¢˜çš„äººå…ˆæ£€æŸ¥é¡¹ç›®ä¸­æ˜¯å¦ç¡®ä¿äº† &lt;strong>redissonClient çš„å•ä¾‹&lt;/strong>ã€‚ï¼ˆå•çº¿ç¨‹å½“ç„¶ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œä¸è¿‡æ’æŸ¥èµ·æ¥å¾ˆç®€å•ï¼Œä¼°è®¡çœ‹åˆ°æ–‡ç« çš„äººé¦–å…ˆå·²ç»æ’æŸ¥è¿‡å•çº¿ç¨‹çš„é—®é¢˜äº†ï¼‰&lt;/p>
&lt;p>æœ¬æ¬¡æŠ¥é”™æ˜¯å› ä¸º:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>redissonClient è™½ç„¶æ˜¯å•ä¾‹çš„é™æ€æˆå‘˜å˜é‡ï¼Œä½†åˆå§‹åŒ–æ—¶æœªåŠ é”ï¼Œè€Œæ˜¯ç®€å•ä½¿ç”¨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RedissonClient&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">redisson&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RedissonClient&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getRedisson&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">redisson&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RedissonManager&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">init&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆå§‹åŒ–&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">redisson&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åŠ é”è§£é”æ²¡æœ‰åŒä¸€ä¸ª lockï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½ä½¿ç”¨&lt;code>getRedisson().getLock(key)&lt;/code> ã€‚å¯¼è‡´è§£é”æ—¶ä»å¦ä¸€ä¸ª redissonClient å¹¶æ²¡æœ‰è·å–åˆ°é”ã€‚
æ¢è¨€ä¹‹ï¼ŒæŠ¥é”™é‡Œçš„&lt;code>not locked by current thread by node id: def1bd2c-1f49-4802-b635-5ea78543c033 thread-id: 109&lt;/code> å…¶å®å…³é”®é—®é¢˜åœ¨äº&lt;code>by node id&lt;/code> ï¼Œè€Œä¸æ˜¯çº¿ç¨‹idã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="å®šä½é—®é¢˜ä¾æ®">
&lt;a href="#%e5%ae%9a%e4%bd%8d%e9%97%ae%e9%a2%98%e4%be%9d%e6%8d%ae">#&lt;/a>
å®šä½é—®é¢˜ä¾æ®
&lt;/h2>&lt;p>ä¸éœ€è¦æ”¹ä»£ç ã€åŠ æ—¥å¿—ç”šè‡³debugï¼Œåªéœ€è¦æœç´¢æ—¥å¿—é‡Œæ˜¯å¦æœ‰ä¸¤è¡Œ&lt;/p>
&lt;p>&lt;code>13:58:07.972 [main] INFO org.redisson.Version - Redisson 2.8.2&lt;/code>&lt;/p>
&lt;p>æ‰“å°ä¸¤æ¬¡ç‰ˆæœ¬ä¿¡æ¯è¯´æ˜è‚¯å®šåˆå§‹åŒ–äº†ä¸¤æ¬¡ Redissonã€‚&lt;/p>
&lt;p>æ˜¯çš„ï¼Œå®šä½å’Œç»“è®ºå°±è¿™ä¹ˆç®€å•ï¼Œå¦‚æœèƒ½æ—©ç‚¹çŸ¥é“ï¼Œæˆ‘å°±èƒ½çœä¸‹è¿™åå‡ ä¸ªå°æ—¶å’Œä¸€å¤§æŠŠå¤´å‘äº†ã€‚&lt;/p>
&lt;h2 id="æ’æŸ¥è¿‡ç¨‹">
&lt;a href="#%e6%8e%92%e6%9f%a5%e8%bf%87%e7%a8%8b">#&lt;/a>
æ’æŸ¥è¿‡ç¨‹
&lt;/h2>&lt;h3 id="ä¸€æœç´¢è§£å†³æ–¹æ¡ˆ">
&lt;a href="#%e4%b8%80%e6%90%9c%e7%b4%a2%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88">#&lt;/a>
ä¸€ã€æœç´¢è§£å†³æ–¹æ¡ˆ
&lt;/h3>&lt;p>æŠŠæŠ¥é”™ä¿¡æ¯å¤åˆ¶å‡ºå»å¾ˆå®¹æ˜“å°±æœåˆ°äº†ä¸€äº›æ–‡ç« é‡åˆ°ç±»ä¼¼çš„æŠ¥é”™ï¼Œè§£å†³æ–¹å¼å°±æ˜¯è§£é”å‰åˆ¤æ–­æ˜¯å¦è‡ªå·±æŒæœ‰çš„è¿™ä¸ªé”ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isHeldByCurrentThread&lt;/span>&lt;span class="p">()){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¹¶ä¸”ä»â€œæºç â€çº§åˆ«è§£é‡Šäº†lockæ–¹æ³•catchäº†InterruptedExceptionç­‰æ¦‚å¿µã€‚&lt;/p>
&lt;h3 id="äºŒè´¨ç–‘è§£å†³æ–¹æ¡ˆ">
&lt;a href="#%e4%ba%8c%e8%b4%a8%e7%96%91%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88">#&lt;/a>
äºŒã€è´¨ç–‘è§£å†³æ–¹æ¡ˆ
&lt;/h3>&lt;p>å¾ˆæ˜¾ç„¶åŠ ä¸Šè¿™ä¸€è¡Œä»£ç ï¼Œä¸ä¼šå†æŠ¥é”™äº†ï¼Œä½†æ˜¯è¿™ç»™æˆ‘å¸¦æ¥çš„é—®é¢˜æ›´å¤šäº†ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è‡ªå·±æ‰‹å†™demoé‡Œå°†çº¿ç¨‹interruptå¤ç°è¿™ä¸ªé—®é¢˜å¯ä»¥ç†è§£ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…é¡¹ç›®ä¸­çº¿ç¨‹è¢«è°interruptäº†ï¼Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŠ äº†&lt;code>if(lock.isHeldByCurrentThread())&lt;/code>çš„ç¡®ä¸æŠ¥é”™äº†ï¼Œä½†è¿™ä¸ªçº¿ç¨‹æœ¬è´¨ä¸Šå°±æ²¡æ‹¿åˆ°è¿™ä¸ªåˆ†å¸ƒå¼é”ï¼Œåœ¨elseä¸­è¿˜æ˜¯åº”è¯¥æ‰‹åŠ¨æŠ›ä¸ªå¼‚å¸¸å‡ºå»çš„ã€‚è½»åº¦å‹æµ‹éƒ½å‡ºç°è¿™ç§æƒ…å†µï¼Œé‚£é¡¹ç›®å²‚ä¸æ˜¯æ¯«æ— å¹¶å‘åº¦å¯è¨€ï¼Ÿ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Redisson åº”è¯¥ä¹Ÿæ˜¯ä¸ªæˆç†Ÿçš„æ¡†æ¶äº†ï¼Œä¸ºä»€ä¹ˆç‰¹åœ°æš´éœ²ä¸ª lock æ¥å£å‡ºæ¥ï¼Œå®é™…åŠŸèƒ½åªæ˜¯éšè—æ‰&lt;code>InterruptedException&lt;/code>? å¦‚æœæˆ‘ä»¬å®é™…é¡¹ç›®ä¸­çº¿ç¨‹è¢« interrupt æ˜¯å¸¸æ€ï¼Œé‚£æš´éœ²è¿™ç§æ¥å£å²‚ä¸æ˜¯æŒ–å‘ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">leaseTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">lockInterruptibly&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leaseTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">interrupt&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>çœ‹æ¥é—®é¢˜å¹¶éä¸€è¡Œä»£ç å°±èƒ½æ©ç›–è¿‡å»çš„ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—æœ‰æ„æ€äº†ã€‚&lt;/p>
&lt;h3 id="ä¸‰æ’æŸ¥çº¿ç¨‹é—®é¢˜">
&lt;a href="#%e4%b8%89%e6%8e%92%e6%9f%a5%e7%ba%bf%e7%a8%8b%e9%97%ae%e9%a2%98">#&lt;/a>
ä¸‰ã€æ’æŸ¥çº¿ç¨‹é—®é¢˜
&lt;/h3>&lt;p>æ—¢ç„¶ç½‘ä¸Šæ–‡ç« éƒ½è¯´æºç é‡Œcatch äº† InterruptedExceptionï¼Œé‚£å°±ç ”ç©¶ä¸‹æºç çœ‹æ˜¯ä¸æ˜¯æœ‰åœ°æ–¹ä¼šinterruptã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">lockInterruptibly&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">leaseTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getId&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…ˆè·å–ä¸€æ¬¡é”è¯•è¯•çœ‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tryAcquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leaseTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// lock acquired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‹¿ä¸åˆ°é”å°±è®¢é˜…channel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RFuture&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">RedissonLockEntry&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">future&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">commandExecutor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">syncSubscription&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">future&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¾ªç¯è·å–é”&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tryAcquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leaseTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unit&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// lock acquired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// waiting for message&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//äº‹å®ä¸Šé€šå¸¸ç­‰é”éƒ½ä¼šèµ°åˆ°è¿™ï¼Œå†…éƒ¨æ˜¯semaphoreåœ¨ç­‰èµ„æºã€‚è€Œå‘ç”ŸInterruptedExceptionä¹Ÿæ˜¯åœ¨è¿™é‡Œé¢ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">getEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getLatch&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">tryAcquire&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MILLISECONDS&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">getEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getLatch&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">acquire&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">unsubscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">future&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">threadId&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è€Œè¿™è¾¹ç”¨åˆ°çš„Semaphoreå…¶å®æ˜¯0ä¸ªpermmitçš„ï¼Œä½œç”¨å°±æ˜¯ç”¨æ¥é˜»å¡çº¿ç¨‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">latch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Semaphore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†ç»§ç»­æ·±å…¥æ— éå°±åªæœ‰Semaphoreå’ŒAQSçš„åŸºç¡€çŸ¥è¯†äº†ã€‚æœ‰å¤„ç†interruptedçš„åœ°æ–¹ï¼Œä½†æ˜¯æ²¡æœ‰æ‰‹åŠ¨interrupt()çš„åœ°æ–¹ã€‚&lt;/p>
&lt;p>&lt;code>unlock()&lt;/code> æ–¹æ³•åˆ™æ›´ä¸ºç®€å•ï¼Œå°±æ˜¯ç”¨è„šæœ¬å»redisæŸ¥è¿™ä¸ªé”ï¼Œè§£é”ã€‚å¤±è´¥çš„è¯ä¼šæŠ¥æˆ‘ä»¬é‡åˆ°çš„é”™è¯¯ã€‚&lt;/p>
&lt;p>æºç å†åŠ ä¸Šä¸€äº›æ‰‹åŠ¨å®éªŒï¼Œéƒ½æ— æ³•çŸ¥é“ä½•æ—¶è¢«interruptï¼Œæ­¤æ—¶çº¿ç¨‹ä¸­æ–­çš„æ’æŸ¥ä¼¼ä¹èµ°åˆ°äº†æ­»èƒ¡åŒã€‚&lt;/p>
&lt;h3 id="å››æ’æŸ¥clienté—®é¢˜">
&lt;a href="#%e5%9b%9b%e6%8e%92%e6%9f%a5client%e9%97%ae%e9%a2%98">#&lt;/a>
å››ã€æ’æŸ¥clienté—®é¢˜
&lt;/h3>&lt;p>ç»è¿‡ä¸€ç•ªæ²Ÿé€šå’ŒæŠ˜è…¾ï¼Œç»ˆäºæµ‹è¯•åŒå­¦å¯ä»¥å‹æµ‹æˆ‘çš„ç”µè„‘ä¸Šéƒ¨ç½²çš„é¡¹ç›®ã€‚&lt;/p>
&lt;p>å‰åå‹äº†5ã€6éï¼Œå‡ åä¸‡æ¬¡è¯·æ±‚ï¼Œæµé‡è¿‘10å€äºå‹æµ‹ç¯å¢ƒã€‚&lt;/p>
&lt;p>ç„¶è€Œåªæœ‰ç¬¬ä¸€æ¬¡å’Œç¬¬ä¸‰æ¬¡å‹å¤ç°äº†å¼‚å¸¸ï¼Œè€Œç¬¬ä¸€æ¬¡å‹æ—¶å‘ç°åŸé¡¹ç›®æ—¥å¿—ç”¨çš„è¿˜æ˜¯&lt;code>System.out.println&lt;/code>ï¼Œæ‰“å°çš„ä¿¡æ¯ä¹Ÿä¸å®Œå–„ï¼Œæ— æ³•å¸®åŠ©æ’æŸ¥ã€‚ç¬¬ä¸‰æ¬¡å‹åˆšå¯åŠ¨è¿›äº†å¼‚å¸¸æ–­ç‚¹ï¼Œä»¥ä¸ºæ˜¯é¡¹ç›®å¯åŠ¨æœ‰é—®é¢˜ï¼Œæ”¾æ‰æ–­ç‚¹è·‘äº†åå‡ ä¸‡æ¬¡è¯·æ±‚éƒ½OKã€‚&lt;/p>
&lt;p>å…¨éƒ¨å‹æµ‹ç»“æŸï¼Œæœ€åå‡ æ¬¡ä¹Ÿæ— æ³•å¤ç°é—®é¢˜ï¼Œåˆ°äº†æ”¶å·¥æ—¶é—´ï¼Œæ— æ³•å†å‹æµ‹ã€‚&lt;/p>
&lt;p>å†å›è¿‡å¤´çœ‹å”¯ä¸€ä¸€æ¬¡æœ‰è®°å½•çš„å¼‚å¸¸æ—¥å¿—ä¿¡æ¯ï¼Œå‘ç°æ—¥å¿—é‡Œæ˜¾ç¤ºçš„æ˜¯ &amp;ldquo;interrupted:false,hold:true&amp;rdquo;ã€‚è¡¨æ˜çº¿ç¨‹æ²¡è¢«ä¸­æ–­è¿‡ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯è¿™ä¸ªé”çš„æŒæœ‰è€…ã€‚&lt;/p>
&lt;p>åªèƒ½ç»§ç»­å¸¦ç€æ›´å¤šçš„é—®é¢˜å»åšæ¨æµ‹&amp;amp;éªŒè¯ã€‚&lt;/p>
&lt;p>Q1:ä¼šä¸ä¼šæ˜¯åŠ é”å’Œè§£é”ç”¨åˆ°çš„ä¸¤ä¸ªæ–¹æ³•å„è‡ªå»è·å–çš„lockå¯¹è±¡ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜ï¼Ÿ&lt;/p>
&lt;p>A1:è‡ªå·±è¯•éªŒäº†å¾ˆå¤šéï¼Œä¸¤ä¸ªå¯¹è±¡ä¸ä¸€è‡´å¹¶ä¸å½±å“ç»“æœã€‚&lt;/p>
&lt;p>Q2:ä¼šä¸ä¼šæ˜¯é¡¹ç›®å¯åŠ¨çš„åˆå§‹åŒ–redissonClientæ²¡åŠ é”å¯¼è‡´äº†å¼‚å¸¸ï¼Ÿ&lt;/p>
&lt;p>A2:ç¿»äº†ä¸‹æ—¥å¿—ï¼Œé¡¹ç›®æ‰“å°æ—¥å¿—å¤šï¼Œè¯·æ±‚é‡åˆç‰¹åˆ«å¤§ï¼Œå‡ åä¸‡è¡Œçš„æ—¥å¿—ä¸­æ‰¾åˆ°æŠ¥é”™ä½ç½®å’Œé¡¹ç›®å¯åŠ¨ä½ç½®ä¼¼ä¹æ—¶é—´é—´éš”æœ‰ç‚¹é•¿ï¼Œåº”è¯¥ä¸æ˜¯è¿™ä¸ªåŸå› ã€‚ï¼ˆå°±æ˜¯è¿™é‡Œç¬¬ä¸€æ¬¡é”™è¿‡äº†æ­£ç¡®çš„ç­”æ¡ˆã€‚ã€‚ã€‚ï¼‰&lt;/p>
&lt;p>Q3:ä¼šä¸ä¼šæ˜¯å› ä¸ºåŠ é”è§£é”é—´éš”è¿‡çŸ­ï¼Œä¸¤ä¸ªlockå¯¹è±¡åˆ†åˆ«è¿æ¥äº†masterå’Œslaveï¼Œä¸»ä»å»¶è¿Ÿå¯¼è‡´çš„ï¼Ÿ(åŠå¤œåˆ·ç‰™æƒ³åˆ°è¿™ä¸ªï¼Œä¼¼ä¹éå¸¸æœ‰å¯èƒ½ï¼Œé«˜å…´åäº†)&lt;/p>
&lt;p>A3:ç¬¬äºŒå¤©æ¥å…¬å¸ç”¨demoéªŒè¯ï¼Œç”¨äº†åŠå¤©æ—¶é—´ï¼Œå„è‡ªæ”¹ä»£ç ï¼Œå‡ ç™¾ä¸Šåƒä¸ªçº¿ç¨‹è·‘äº†å¾ˆå¤šééƒ½æ²¡å¤ç°è¿™ä¸ªé—®é¢˜ï¼Œrediséƒ½æ‰“å¾—æœ‰èŠ‚ç‚¹è¿æ¥ä¸ä¸Šäº†ï¼Œè·‘å¾—æˆ‘éƒ½è¦æ€€ç–‘äººç”Ÿäº†ã€‚&lt;/p>
&lt;p>Q4:è¯•éªŒä¸­å‘ç°è§£é”ç”¨åˆ°çš„lock2å¯¹è±¡å¦‚æœæ˜¯é€šè¿‡redissonClient2è·å–çš„ï¼Œèƒ½ç¨³å®šå¤ç°è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å¦ä¸æˆ‘ä»¬çš„é¡¹ç›®é‡åˆ°çš„å¼‚å¸¸æœ‰å…³è”å‘¢ï¼Ÿ&lt;/p>
&lt;p>A4:å†å»çœ‹äº†ä¸‹é¡¹ç›®ä»£ç ï¼Œé™¤äº†åˆå§‹åŒ–redissonClientæ²¡åŠ é”ä¹‹å¤–ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ç”¨çš„éƒ½æ˜¯é™æ€å˜é‡æŒ‡å‘çš„redissonClientï¼Œåº”è¯¥æ˜¯åŒä¸€ä¸ªï¼Œä¸è¿™ä¸ªè¯•éªŒåœºæ™¯ä¸ä¸€æ ·ã€‚ï¼ˆç¬¬äºŒæ¬¡é”™è¿‡æ­£ç¡®ç­”æ¡ˆã€‚ã€‚ã€‚ï¼‰&lt;/p>
&lt;p>æ²¡æœ‰äº†æ€è·¯ï¼Œåªèƒ½é€è¡Œdebugï¼Œèµ°ä¸€è¡Œçœ‹ä¸€çœ¼Redissonæ‰“çš„é•¿ä¸²æ—¥å¿—ã€‚&lt;/p>
&lt;p>è§‚å¯Ÿå‘ç°è°ƒç”¨ &lt;code>lock.isHeldByCurrentThread()&lt;/code> ç­‰æ–¹æ³•å…¶å®éƒ½æ˜¯åœ¨è¯·æ±‚redisï¼Œå¹¶éåƒæ™®é€šçš„javaå¯¹è±¡ä¸€æ ·è¯»å–æˆå‘˜å˜é‡ã€‚&lt;/p>
&lt;p>ä»”ç»†çœ‹æ¯ä¸ªlockçš„æ¯æ¬¡æŸ¥è¯¢æ˜¯å¦ç”¨äº†ç›¸åŒçš„connectionï¼Œæœç´¢æ¯ä¸ªconnectionçš„idå‘ç°ï¼Œæ¯æ¬¡å¹¶ä¸ç›¸åŒï¼Œä¸”åº”è¯¥éƒ½æ˜¯ä»åˆå§‹åŒ–è¿æ¥æ± ä¸­æ‹¿çš„ã€‚&lt;/p>
&lt;p>æ’é™¤äº†å„ç§æƒ…å†µçš„ç­”æ¡ˆåï¼Œæˆ‘å‘ç°äº†è¯·æ±‚redisçš„è„šæœ¬ä¸­å…ƒç´ çš„keyå…¶å®æœ‰è§„å¾‹ï¼Œæ˜¯id+keyï¼Œè€Œidå°±æ˜¯è¿™ä¸ªclientåˆå§‹åŒ–æ—¶ç”Ÿæˆçš„uuidï¼Œç¨åŠ éªŒè¯ï¼Œå¾ˆè½»æ¾è§£é‡Šäº†ä¹‹å‰çš„Q4ä¸­èƒ½ç¨³å®šå¤ç°è¿™ä¸ªå¼‚å¸¸çš„åŸå› ã€‚å°±æ˜¯å¤šä¸ªclientå°±ç›¸å½“äºåˆ†å¸ƒå¼çš„å¤šä¸ªjvmï¼Œå³ä½¿åŒä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨çš„é”idè‚¯å®šä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>å› æ­¤æˆ‘åˆæŠŠç›®å…‰è½¬å›äº†å¤šä¸ªclientçš„è¿™ä¸ªé—®é¢˜ï¼Œå…‰çœ‹ä»£ç çš„ç¡®æ˜¯æœ‰è¿™ä¸ªå¯èƒ½æ€§ï¼Œç°åœ¨è¿˜éœ€è¦åœ¨é”™è¯¯æ—¥å¿—é‡Œæ‰¾åˆ°ç›¸åº”çš„ä¾æ®å»è¯å®è‡ªå·±çš„çŒœæµ‹ã€‚&lt;/p>
&lt;p>å›åˆ°Q2ä½å¿½ç•¥æ‰çš„æ—¥å¿—ï¼Œåœ¨vscodeä¸­æ‰“å¼€åºå¤§çš„æ—¥å¿—æ–‡ä»¶ï¼ŒCTRL+Fæœç´¢å¼‚å¸¸çš„æ—¶é—´ç‚¹ç­‰ä¿¡æ¯ï¼Œå‘ç°äº†è‡ªå·±ä¹‹å‰çš„ä¸€ä¸ªè¯¯è§£ï¼Œå…¶å® é¡¹ç›®å¯åŠ¨!=clientåˆå§‹åŒ–ï¼Œ clientæ˜¯ç­‰åˆ°è¯·æ±‚æ‰“è¿‡æ¥æ‰åˆå§‹åŒ–çš„ã€‚&lt;/p>
&lt;p>å†ç¨åŠ æœç´¢ï¼Œè™½ç„¶æ—¥å¿—ä¸­æ²¡æœ‰æ‰“å°clientçš„idï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹æ‰“å°äº†ä¸¤æ¬¡Redissionçš„ç‰ˆæœ¬ä¿¡æ¯ä¾¿è¶³ä»¥ä½è¯æˆ‘çš„çŒœæµ‹äº†ã€‚&lt;/p>
&lt;h2 id="åæ€">
&lt;a href="#%e5%8f%8d%e6%80%9d">#&lt;/a>
åæ€
&lt;/h2>&lt;p>åå‡ ä¸ªå°æ—¶çš„æ’æŸ¥è¿‡ç¨‹è™½ç„¶å­¦åˆ°äº†å¾ˆå¤šï¼Œä½†æ˜¯è‡ªå·±çš„å‡ ä¸ªå¤±è¯¯å…¶å®å¤§å¤§æ‹‰é•¿äº†è¿™ç—›è‹¦çš„æ—¶é—´ã€‚&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ²¡æœ‰ç¬¬ä¸€æ—¶é—´å»åŠ æ—¥å¿—ï¼Œå‹æµ‹ï¼Œå¤ç°é—®é¢˜ã€‚&lt;/p>
&lt;p>å¦‚æœåœ¨åŸé¡¹ç›®ä¸­åŠ ä¸Šæ—¥å¿—çœ‹ä¸‹é”çš„ &lt;code>isInterrupted()&lt;/code> å’Œ &lt;code>isHeldByCurrentThread()&lt;/code>çŠ¶æ€ï¼Œå…¶å®å¾ˆå¿«å°±èƒ½å‘ç°çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰è¢« interruptï¼Œä¸ç”¨å¾€é‚£ä¸ªæ–¹å‘æ’æŸ¥ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;lock:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,interrupted:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">isInterrupted&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,hold:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isHeldByCurrentThread&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,threadId:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">currentThread&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getId&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>å¤šæ¬¡é”™è¿‡äº†æ­£ç¡®ç­”æ¡ˆã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å…¶å®ä¹Ÿä¸»è¦æ˜¯å› ä¸ºä¸æ˜¯è‡ªå·±çš„é¡¹ç›®ï¼Œåœ¨æ”¹ä»£ç ã€å‘å¸ƒã€å‹æµ‹ã€æ—¥å¿—ã€ç›‘æ§è¿™äº›æ–¹é¢éƒ½ç¼ºä¹æŒæ§ï¼Œå› æ­¤éš¾å…èµ°äº†ä¸€äº›å¼¯è·¯ã€‚&lt;/p></description></item><item><title>æ—¥å¿—ESé›†ç¾¤çš„æ½œåœ¨æ€§èƒ½ç“¶é¢ˆ--æ®µåˆå¹¶</title><link>https://heeexy.com/p/elasticsearch-segment-merge/</link><pubDate>Sun, 28 Jun 2020 18:37:00 +0800</pubDate><guid>https://heeexy.com/p/elasticsearch-segment-merge/</guid><description>&lt;h2 id="å…ˆæŠ›ç»“è®º">
&lt;a href="#%e5%85%88%e6%8a%9b%e7%bb%93%e8%ae%ba">#&lt;/a>
å…ˆæŠ›ç»“è®º
&lt;/h2>&lt;p>å¦‚æœæ—¥å¿—å‹ESé›†ç¾¤system load è¿‡é«˜ï¼ŒI/Oæ‰“æ»¡ï¼Œå°¤å…¶æ˜¯åœ¨&lt;strong>è¯»å†™ä½è°·æ—¶é—´æ®µ read å¼‚å¸¸é«˜&lt;/strong>ï¼Œå¯ä»¥è€ƒè™‘æ’æŸ¥æ®µåˆå¹¶çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>å¦‚æœçš„ç¡®æ˜¯é‡åˆ°äº†æ®µåˆå¹¶é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä¸¤ä¸ªæ–¹å‘ï¼š&lt;/p>
&lt;ol>
&lt;li>æœºæ¢°ç¡¬ç›˜å‡çº§ä¸ºSSDã€‚&lt;/li>
&lt;li>å¤§ç´¢å¼•æ‹†åˆ†æˆå°ç´¢å¼•ã€‚&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>PS. å†é™„é€ä¸€ä¸ªæ½œåœ¨çš„æŸ¥è¯¢é—®é¢˜å¯èƒ½å¯¼è‡´çš„IOæ‰“æ»¡ï¼šé€šé…ç¬¦æŸ¥è¯¢ï¼Œå‚è§&lt;a class="link" href="https://elasticsearch.cn/article/171" target="_blank" rel="noopener"
>æ–‡ç« &lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="æ’æŸ¥">
&lt;a href="#%e6%8e%92%e6%9f%a5">#&lt;/a>
æ’æŸ¥
&lt;/h2>&lt;p>è¯¦ç»†çš„æ’æŸ¥è¿‡ç¨‹å°±ä¸èµ˜è¿°äº†ï¼Œæ— éæ˜¯åŠ ç›‘æ§ï¼ŒåŒ…æ‹¬ä¸šåŠ¡å±‚é¢ã€ESå±‚é¢ã€æœºå™¨å±‚é¢ï¼Œç„¶åæ¨ªå‘ã€çºµå‘çš„åˆ†æå„ç§ç›‘æ§æŒ‡æ ‡ã€‚&lt;/p>
&lt;p>è¿™é‡Œåˆ†äº«å‡ ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„æŒ‡æ ‡/api&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æŸ¥çœ‹æœ€å¤§çš„ç´¢å¼•çš„ _stats ä¸­mergeéƒ¨åˆ†ï¼š&lt;/p>
&lt;p>total_stopped_time_in_millis ï¼šé€šå¸¸åº”è¯¥æ˜¯0&lt;/p>
&lt;p>total_size_in_bytesï¼šæ€»å…±mergeäº†è¿™ä¹ˆå¤šæ•°æ®ï¼Œä½ ä¼šå‘ç°è¿œå¤§äºç´¢å¼•å¤§å°ã€‚ä¸‹æ–‡ä¼šä»‹ç»è¿™ä¸€æŒ‡æ ‡ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è§‚å¯Ÿçº¿ç¨‹çŠ¶å†µï¼Œapiè¯¦ç»†å‚æ•°å¯ä»¥æŸ¥é˜…&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-hot-threads.html#cluster-nodes-hot-threads-api-query-params" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚æˆ‘åœ¨å®šä½é—®é¢˜æ—¶è¿˜ä¸çŸ¥é“hot_threadsè¿™ä¸ªapiï¼Œå¦‚æœæå‰çŸ¥é“çš„è¯å¯èƒ½å°±çœä¸‹ä¸å°‘æ—¶é—´äº†ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">GET _cat/thread_pool?v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GET /_nodes/hot_threads
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="åŸç†">
&lt;a href="#%e5%8e%9f%e7%90%86">#&lt;/a>
åŸç†
&lt;/h2>&lt;p>æ®µåˆå¹¶çš„åŸºæœ¬åŸç†å¾ˆç®€å•ï¼Œä¸¤ä¸ªï¼ˆå¤šä¸ªï¼‰å·²æäº¤çš„æ®µå†™å…¥ä¸€ä¸ªæ–°çš„æ®µã€‚&lt;/p>
&lt;p>&lt;img src="https://www.elastic.co/guide/cn/elasticsearch/guide/current/images/elas_1110.png"
loading="lazy"
>&lt;/p>
&lt;p>è¿™ç§è¯»å†™é™¤äº†å°šåœ¨å†…å­˜ä¸­çš„éƒ¨åˆ†ï¼Œå°±éš¾å…éœ€è¦æ¶ˆè€—ç£ç›˜IOäº†ã€‚&lt;/p>
&lt;p>è€Œä»&lt;a class="link" href="http://blog.mikemccandless.com/2011/02/visualizing-lucenes-segment-merges.html" target="_blank" rel="noopener"
>å¯è§†åŒ–Luceneæ®µåˆå¹¶&lt;/a>ä¸€æ–‡ä¸­å¾—çŸ¥ï¼Œè¿™ç§ç±»ä¼¼äº&lt;a class="link" href="https://en.wikipedia.org/wiki/Write_amplification" target="_blank" rel="noopener"
>SSDå†™æ”¾å¤§&lt;/a>çš„è¿‡ç¨‹å…¶å®æ˜¯ä¸€ç§æµªè´¹ï¼ˆæ–‡ä¸­ç§°ä¸ºtaxï¼‰ï¼Œä¸€ä¸ªæœ€ç»ˆ1Gçš„ç´¢å¼•å¯èƒ½ç”±äºmergeè€Œéœ€è¦è¯»å†™10Gç£ç›˜ã€‚&lt;/p>
&lt;p>æ®µåˆå¹¶ç®—æ³•ä¼˜åŒ–çš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯é™ä½è¿™ç§æµªè´¹ï¼Œæ›´é«˜æ•ˆåœ°åšæ®µåˆå¹¶ã€‚&lt;/p>
&lt;p>è€Œå‡å°æˆ‘ä»¬ç´¢å¼•çš„ä½“ç§¯å°±å¯ä»¥è½»æ¾çš„å¸¦æ¥æ˜¾è‘—çš„æå‡ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/es-io.png"
loading="lazy"
alt="es-io"
>&lt;/p></description></item><item><title>QPSä»1kåˆ°2wï¼Œæˆ‘åšäº†ä»€ä¹ˆ</title><link>https://heeexy.com/p/optimization-experience/</link><pubDate>Mon, 17 Feb 2020 21:15:00 +0800</pubDate><guid>https://heeexy.com/p/optimization-experience/</guid><description>&lt;p>è¿™ä¸¤å¹´æœ‰å¹¸å‚ä¸äº†å•†å“åˆ—è¡¨ç³»ç»Ÿçš„ä¸¤æ¬¡é»‘äº”æŒ‘æˆ˜ï¼ŒQPSä»æœ€å¼€å§‹çš„1kéƒ½é¡¶ä¸ä½ï¼Œåˆ°1wï¼Œå†åˆ°2wï¼ŒåŠ ä¸Šæ”¯æŒå¤§é‡çš„ABå®éªŒï¼Œæ’åºåƒäººåƒé¢ï¼ŒåŠŸèƒ½è¶Šæ¥è¶Šå¤æ‚ï¼Œç³»ç»Ÿè¶Šæ¥è¶Šåºå¤§ï¼Œå¯èƒ½è¿™æ ·çš„æœºä¼šéƒ½ä¸ä¼šå¸¸æœ‰ï¼Œåœ¨æ­¤ç®€å•è®°å½•ä¸€ä¸‹åšç³»ç»Ÿä¼˜åŒ–çš„å®è·µå¿ƒå¾—ã€‚&lt;/p>
&lt;h1 id="è¦ç´ ">
&lt;a href="#%e8%a6%81%e7%b4%a0">#&lt;/a>
è¦ç´ 
&lt;/h1>&lt;p>ä»”ç»†æƒ³æƒ³ï¼Œåšä¼˜åŒ–å…¶å®å¹¶æ²¡æœ‰å¾ˆå¤šé—¨é“ï¼Œä¸ªäººæ€»ç»“èµ·æ¥å°±ä¸‰ä¸ªè¦ç´ ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸šåŠ¡&lt;/li>
&lt;li>å·¥å…·&lt;/li>
&lt;li>äºº&lt;/li>
&lt;/ol>
&lt;h3 id="ä¸šåŠ¡">
&lt;a href="#%e4%b8%9a%e5%8a%a1">#&lt;/a>
ä¸šåŠ¡
&lt;/h3>&lt;p>ä¸šåŠ¡å°±æ˜¯ä½ çš„ä»»åŠ¡ï¼Œæ˜¯ä¼˜åŒ–çš„ç›®æ ‡ï¼Œä¸šåŠ¡çš„å¤æ‚æ€§å’Œç‹¬ç‰¹æ€§å†³å®šäº†ä½ çš„é—®é¢˜åªæœ‰è‡ªå·±å»è§£å†³ï¼Œç½‘ä¸Šæ²¡æœ‰ç­”æ¡ˆï¼Œå³ä½¿æŒ–ä¸ªå¤§ç¥æ¥ä¹Ÿä¸èƒ½ç«‹é©¬å¸®åˆ°ä½ ã€‚&lt;/p>
&lt;p>ä¸šåŠ¡ä¸ä»…ä»…åŒ…æ‹¬å…¬å¸å¯¹å¤–æä¾›çš„æœåŠ¡ï¼Œè¿˜åŒ…æ‹¬é¡¹ç›®å†…éƒ¨çš„ä¸€åˆ‡ç»†ææœ«èŠ‚ï¼Œæ¯”å¦‚ä»£ç çš„é€»è¾‘ã€æœåŠ¡å™¨çš„éƒ¨ç½²ã€åå°çš„é…ç½®ã€æ•°æ®çš„æµè½¬ï¼Œç”šè‡³ä¸åŒå›¢é˜Ÿé—´çš„åˆ†å·¥åˆä½œç­‰ç­‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è¦åšçš„å…¶å®å°±æ˜¯ä¼˜åŒ–è¿™äº›ä¸šåŠ¡ï¼Œä¸šåŠ¡ä¸­çš„ä»»ä½•ä¸€ä¸ªç‚¹éƒ½å¯ä»¥æ˜¯ä¼˜åŒ–çš„æ–¹å‘ã€‚&lt;/p>
&lt;h3 id="å·¥å…·">
&lt;a href="#%e5%b7%a5%e5%85%b7">#&lt;/a>
å·¥å…·
&lt;/h3>&lt;p>æˆ‘ä»¬èƒ½ç”¨åˆ°çš„ä¸€åˆ‡æ‰‹æ®µéƒ½æ˜¯å·¥å…·ï¼Œæœ‰ç›´æ¥åº”å¯¹çº¿ä¸Šæµé‡çš„æœåŠ¡å™¨ã€ä»£ç ã€JVMã€DBï¼Œä¹Ÿæœ‰é—´æ¥å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšä¼˜åŒ–çš„è¾…åŠ©å·¥å…·ï¼Œç›‘æ§(Prometheus/Grafana)ã€æ—¥å¿—(ELK)ã€å‹æµ‹(Goreplay)ã€è¯Šæ–­å·¥å…·(Arthas)ç­‰ç­‰ã€‚&lt;/p>
&lt;h3 id="äºº">
&lt;a href="#%e4%ba%ba">#&lt;/a>
äºº
&lt;/h3>&lt;p>åªäº†è§£ä¸šåŠ¡çš„äººé¢å¯¹é—®é¢˜æŸæ‰‹æ— ç­–ï¼Œåªé’»ç ”æŠ€æœ¯çš„äººèƒ½è§£å†³çš„é—®é¢˜å¾€å¾€è¢«æŠ€æœ¯é™åˆ¶äº†å¤©èŠ±æ¿ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬éœ€è¦çš„æ˜¯&lt;strong>ç²¾é€šä¸šåŠ¡ï¼Œå–„ç”¨å·¥å…·&lt;/strong>çš„äººï¼Œèƒ½ä»ç›‘æ§æ•°æ®ä¸­å‘ç°è››ä¸é©¬è¿¹ï¼Œèƒ½ä»å¤æ‚çš„ä¸šåŠ¡å…³ç³»ä¸­æŠ½ä¸å‰¥èŒ§ï¼Œèƒ½åˆ©ç”¨æ‰‹ä¸Šä¸€åˆ‡å·¥å…·ï¼Œå‘æŒ¥å®ƒä»¬æœ€å¤§çš„ä½œç”¨ã€‚&lt;/p>
&lt;h1 id="æ­¥éª¤">
&lt;a href="#%e6%ad%a5%e9%aa%a4">#&lt;/a>
æ­¥éª¤
&lt;/h1>&lt;p>æŠ›å¼€æ­å»ºç¯å¢ƒã€å‹æµ‹ã€å›å½’æµ‹è¯•ç­‰å·¥ä½œï¼Œä¼˜åŒ–æ­¥éª¤æœ€ç²¾ç®€çš„è¯åªæœ‰ä¸¤æ­¥ï¼š&lt;/p>
&lt;ol>
&lt;li>æ‰¾ç³»ç»Ÿç“¶é¢ˆ&lt;/li>
&lt;li>ä¼˜åŒ–ï¼Œçªç ´ç“¶é¢ˆ&lt;/li>
&lt;/ol>
&lt;h3 id="æ‰¾ç³»ç»Ÿç“¶é¢ˆ">
&lt;a href="#%e6%89%be%e7%b3%bb%e7%bb%9f%e7%93%b6%e9%a2%88">#&lt;/a>
æ‰¾ç³»ç»Ÿç“¶é¢ˆ
&lt;/h3>&lt;p>æ‰¾ç“¶é¢ˆå°±éœ€è¦æœ‰ä¾æ®ï¼Œä¾æ®å°±æ˜¯ç›‘æ§æŒ‡æ ‡ã€‚&lt;/p>
&lt;p>ç›‘æ§æŒ‡æ ‡çš„å…¨é¢å¯¹äºä¸€ä¸ªåºå¤§çš„ç³»ç»Ÿæ¥è¯´è‡³å…³é‡è¦ï¼Œä¸ä»…åŒ…æ‹¬æ¥å£çš„è€—æ—¶ã€JVMçš„çŠ¶æ€ã€æœºå™¨çš„è´Ÿè½½ç­‰ä¸€äº›å¸¸è§çš„æŒ‡æ ‡ï¼Œæ›´éœ€è¦ç»†è‡´åˆ°æ”¶é›†ç¼“å­˜çš„å‘½ä¸­ç‡ã€ä¸åŒé€»è¾‘åˆ†æ”¯çš„å æ¯”ã€æ¯å¼ è¡¨çš„è¯»å†™é¢‘ç‡ç­‰å…·ä½“ä¸šåŠ¡ç›¸å…³çš„æŒ‡æ ‡ã€‚&lt;/p>
&lt;p>å¦‚æœç¼ºå°‘äº†ä¸šåŠ¡æŒ‡æ ‡çš„ç›‘æ§ï¼Œå®šä½é—®é¢˜å¾ˆå¯èƒ½å®šä½ä¸åˆ°æ ¹æºï¼Œèƒ½ä¼˜åŒ–çš„ç©ºé—´ä¹Ÿä¼šå—åˆ°æŠ€æœ¯çš„é™åˆ¶ã€‚&lt;/p>
&lt;h3 id="ä¼˜åŒ–">
&lt;a href="#%e4%bc%98%e5%8c%96">#&lt;/a>
ä¼˜åŒ–
&lt;/h3>&lt;p>æ‰¾åˆ°ç“¶é¢ˆä¹‹åï¼Œçœ‹èµ·æ¥é—®é¢˜å¾ˆå¿«å°±èƒ½è§£å†³äº†ï¼ŒJVMé¡¶ä¸ä½å°±è°ƒheapï¼Œè°ƒGCï¼ŒDBé¡¶ä¸ä½å°±åŠ å‰¯æœ¬ï¼Œä¼˜åŒ–sqlï¼Œæ¯•ç«Ÿæˆ‘ä»¬å­¦ä¹ çš„æ—¶å€™å­¦çš„å°±æ˜¯è¿™äº›ï¼Œé¢è¯•çš„æ—¶å€™è€ƒçš„ä¹Ÿæ˜¯è¿™äº›ã€‚&lt;/p>
&lt;p>ç„¶è€ŒçœŸæ­£æ¼«é•¿è€Œç—›è‹¦çš„ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œè¿™äº›ç›´æ¥äº†å½“çš„è§£å†³æ–¹å¼å¾€å¾€ä¸ä¼šå¸¦æ¥å¤šå°‘æå‡ï¼Œå› ä¸ºç®€å•çš„æ–¹æ³•å¯èƒ½åœ¨æˆ‘ä»¬å½“åˆå¼€å‘åŠŸèƒ½æ—¶éƒ½å·²ç»åšè¿‡ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ³è¦æˆå€çš„æé«˜ååé‡ï¼Œæˆ‘ä»¬éœ€è¦åšæ›´å¤š&lt;strong>çœ‹ä¼¼ä¾§é¢çš„å·¥ä½œï¼Œè§£å†³æ ¹æºä¸Šçš„é—®é¢˜&lt;/strong>ã€‚&lt;/p>
&lt;h4 id="å‡ ä¸ªä¾‹å­">
&lt;a href="#%e5%87%a0%e4%b8%aa%e4%be%8b%e5%ad%90">#&lt;/a>
å‡ ä¸ªä¾‹å­
&lt;/h4>&lt;p>å½“æˆ‘ä»¬ååé‡åœ¨1kä¸åˆ°æ—¶ï¼ŒJVMé¡¶ä¸ä½ï¼Œè¿™æ—¶å€™ä¸ç®¡æ˜¯å‡æœºå™¨é…ç½®ï¼Œè¿˜æ˜¯JVMè°ƒä¼˜éƒ½æ²¡æœ‰æ˜æ˜¾æ•ˆæœã€‚å› ä¸ºæˆ‘ä»¬æœ‰å¾ˆå¤šæ…¢æ¥å£ï¼Œå³ä½¿åªå è¯·æ±‚æ€»é‡çš„1%ä¸åˆ°ï¼Œåœ¨å¤§æµé‡ä¸‹ä¹Ÿæ˜¯æ‹–å®æœåŠ¡çš„é‡è¦å› ç´ ã€‚æˆ‘ä»¬é‡‡ç”¨äº†ä½¿ç”¨ESçš„ä¸€äº›é«˜çº§ç‰¹æ€§ï¼ŒåŒæ—¶å°†æ•°æ®å‡†å¤‡æˆä¾¿äºæŸ¥è¯¢çš„ç»“æ„ï¼ˆè§&lt;a class="link" href="https://heeexy.com/2018/12/02/es-for-search/" >ElasticSearchåœ¨é«˜å¹¶å‘å¤æ‚æŸ¥è¯¢ä¸šåŠ¡åœºæ™¯çš„åº”ç”¨&lt;/a>ï¼‰ç­‰ä¸€ç³»åˆ—æªæ–½ï¼Œæ¶ˆç­äº†æ…¢æŸ¥è¯¢æ¥å£ã€‚&lt;/p>
&lt;p>å½“æ…¢æ¥å£å¤„ç†å®Œï¼Œååé‡æå‡åˆ°äº†ä¸€å®šç¨‹åº¦ï¼ŒJVMè¿˜æ˜¯çŠ¶å†µä¸ä½³ï¼Œæˆ‘ä»¬å°±è€ƒè™‘æ”¹å–„ç¼“å­˜ã€‚åŸæœ¬ä½¿ç”¨çš„JVMå†…ç¼“å­˜ï¼Œå°è¯•äº†è°ƒæ•´ç¼“å­˜å‚æ•°ï¼Œä½¿ç”¨é›†ä¸­å¼ç¼“å­˜Redisç­‰æ–¹æ¡ˆåéƒ½æ²¡æ•ˆæœã€‚æœ€ç»ˆé€šè¿‡Nginxå±‚çš„ç¼“å­˜å’Œä¸€è‡´æ€§å“ˆå¸Œå¤§å¹…å‡è½»äº†å‹åŠ›ã€‚&lt;/p>
&lt;p>å½“æ¥å£éƒ½å¾ˆå¿«ï¼ŒDBï¼ˆElasticsearchï¼‰å¼€å§‹é¡¶ä¸ä½ï¼Œæˆ‘ä»¬å°è¯•äº†åŠ æœºå™¨ã€æ‰©å‰¯æœ¬ã€è°ƒå †å†…å­˜å¤§å°ç­‰æ‰‹æ®µï¼Œæœ€ç»ˆè¿˜æ˜¯é€šè¿‡å°†å•†å“è¯¦æƒ…çš„æŸ¥è¯¢ç§»å‡ºESï¼Œç”±å•ç‹¬çš„æœåŠ¡é€šè¿‡æŸ¥Redisæ¥æä¾›ï¼Œå‡è½»äº†ESå¤§åŠçš„å‹åŠ›ã€‚&lt;/p>
&lt;p>ã€‚ã€‚ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šçš„æ‰‹æ®µæœªå¿…é€‚åˆå…¶å®ƒé¡¹ç›®ï¼Œä½†ç³»ç»Ÿçš„ä¼˜åŒ–å°±æ˜¯è¿™æ ·ï¼Œä»æ¥å°±æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬èƒ½åšçš„å°±åªæœ‰æ·±å…¥ä¸šåŠ¡ï¼Œåˆ©ç”¨å¥½æ¯ä¸€ç§å·¥å…·ï¼Œç„¶åå……æ»¡ä¿¡å¿ƒåœ°è¿æ¥ä¸‹ä¸€ä¸ªæŒ‘æˆ˜ã€‚&lt;/p></description></item><item><title>JDBCä¸ºä»€ä¹ˆä¸éœ€è¦Class.forName()</title><link>https://heeexy.com/p/classloader/</link><pubDate>Mon, 03 Feb 2020 19:57:00 +0800</pubDate><guid>https://heeexy.com/p/classloader/</guid><description>&lt;h3 id="drivermanager">
&lt;a href="#drivermanager">#&lt;/a>
DriverManager
&lt;/h3>&lt;p>åœ¨åˆå­¦JDBCæ—¶ï¼Œæ€»æ˜¯è®°å¾—å¼€å¤´å°±è¦æ¥è¿™ä¹ˆä¸€å¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;com.mysql.jdbc.Driver&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶è€Œä»Šå¤©å­¦ä¹ ç±»åŠ è½½æœºåˆ¶æ—¶å¶ç„¶çŸ¥é“ä¸éœ€è¦è¿™å¥ä¹ŸåŒæ ·å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæµ‹è¯•çš„ç¡®å¦‚æ­¤ï¼Œçœ‹äº†ä¸€çœ¼æºç ï¼Œçœ‹ä¼¼åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºæ— è®ºå†™ä¸å†™é‚£æ®µ&lt;code>Class.forName&lt;/code>ï¼Œåœ¨è§¦å‘åŠ è½½DriverManageræ—¶ï¼Œä¼šè¿è¡Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Load the initial JDBC drivers by checking the System property
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * jdbc.properties and then use the {@code ServiceLoader} mechanism
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">loadInitialDrivers&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;JDBC DriverManager initialized&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>éƒ½ä¼šæ‰«æåˆ°è¿™ä¸ªDriverï¼Œæ³¨å†Œåˆ°&lt;code>registeredDrivers&lt;/code>ä¸­ã€‚&lt;/p>
&lt;hr>
&lt;p>å¦‚æœåªè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½ä¸Šé¢çš„ç­”æ¡ˆå°±å·²ç»è¶³å¤Ÿäº†ã€‚&lt;/p>
&lt;p>ç„¶è€Œå…´è¶£æ¥äº†ï¼Œæ€»æƒ³æŠŠæºç ç»§ç»­çœ‹ä¸‹å»åˆ°åº•æ‰«æäº†å•¥ï¼Œå’‹æ‰«æçš„ï¼Œæ˜æ˜&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ServiceLoader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Driver&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">loadedDrivers&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServiceLoader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">load&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Driver&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œæ˜¯ &lt;code>java.sql.Driver&lt;/code> æ¥å£ï¼Œä¸Šå“ªæ‰¾å‡ºæ¥çš„å®ç°ç±»ï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬å°±ä¸€å±‚å±‚çš„å¾€ä¸‹çœ‹å§ã€‚&lt;/p>
&lt;h3 id="serviceloader">
&lt;a href="#serviceloader">#&lt;/a>
ServiceLoader
&lt;/h3>&lt;p>ä¸»è¦åšäº†ä¸¤ç‚¹&lt;/p>
&lt;ol>
&lt;li>è®¾ç½®ClassLoaderä¸ºå½“å‰çº¿ç¨‹çš„ã€‚ï¼ˆç ´ååŒäº²å§”æ´¾ï¼Œè®©å®ƒrt.jaråŒ…ä¸­çš„ç±»å¯ä»¥é€šè¿‡AppClassLoaderè·å–åˆ°å¤–éƒ¨çš„ç±»ï¼Œå¾ˆå¤šè®²åŒäº²å§”æ´¾æœºåˆ¶çš„æ–‡ç« å·²ç»å¤§ä¹¦ç‰¹ä¹¦è¿‡äº†ï¼‰&lt;/li>
&lt;li>åˆå§‹åŒ–äº†ä¸€ä¸ªæ‡’åŠ è½½çš„è¿­ä»£å™¨ &lt;code>lookupIterator = new LazyIterator(service, loader);&lt;/code>ã€‚æ­£æ˜¯è¿™ä¸ªè¿­ä»£å™¨ä¸­æœ€ç»ˆå¸®æˆ‘ä»¬æ‰¾åˆ°äº†å„ç§driveræ³¨å†Œè¿›å»ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="lazyiterator">
&lt;a href="#lazyiterator">#&lt;/a>
LazyIterator
&lt;/h3>&lt;p>æ—¢ç„¶æ˜¯è¿­ä»£å™¨ï¼Œæœ€é‡è¦çš„å½“ç„¶æ˜¯hasNext()å’Œnext()æ–¹æ³•ã€‚&lt;/p>
&lt;p>åœ¨next()æ–¹æ³•ä¸­ï¼Œå·²ç»æ‹¿åˆ°äº†nextNameå®Œæ•´çš„&amp;quot;com.mysql.cj.jdbc.Driver&amp;quot;ç±»åï¼Œè¯´æ˜è¿˜æ˜¯hasNext()æ–¹æ³•å¹²äº†çœŸæ­£çš„æ‰«æå·¥ä½œã€‚&lt;/p>
&lt;p>hasNext()æ–¹æ³•çš„ä¸»è¦å·¥ä½œä¹Ÿéƒ½æ”¾åœ¨äº†hasNextService()ä¸­&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">hasNextService&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nextName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">configs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ­¤å¤„æ‹¼å‡ºäº†å…¨åä¸º META-INF/services/java.sql.Driver&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fullName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PREFIX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">loader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">configs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClassLoader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSystemResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fullName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">configs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">loader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fullName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">fail&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Error locating configuration files&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">pending&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">pending&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">configs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasMoreElements&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pending&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">configs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nextElement&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">nextName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pending&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹èµ·æ¥ä¸ç®—å¤æ‚ï¼Œæˆ‘ä»¬æ‹¿ç€&amp;quot;META-INF/services/java.sql.Driver&amp;quot;å»AppClassLoaderæ‰¾ä¸ªconfigsã€‚&lt;/p>
&lt;p>ä½†æ˜¯debugçš„æ—¶å€™å¹¶ä¸ç›´è§‚ï¼Œå› ä¸ºdebugçš„æ—¶å€™çœ‹åˆ°configä¼¼ä¹åŒ…å«äº†å„å±‚ç±»åŠ è½½å™¨æ‰«å‡ºæ¥çš„å‡ åä¸ªjaråŒ…ï¼Œç„¶è€Œåˆ°configs.nextElement()æ—¶çªç„¶å°±ç›´æ¥æ‹¿åˆ°äº†&lt;code>jar:file:/C:/Users/dell/.m2/repository/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar!/META-INF/services/java.sql.Driver&lt;/code>çš„å®Œæ•´è·¯å¾„ã€‚æœ€åå‘ç°å®åœ¨æ˜¯æºç ä½œè€…å¤ªå–œæ¬¢å®ç°hasNext()å’Œnext()æ–¹æ³•ï¼ˆ&lt;code>hasMoreElements&lt;/code>å’Œ&lt;code>nextElement&lt;/code>ï¼‰äº†ï¼Œä¸€å±‚åˆä¸€å±‚çš„æŠŠäººçœ‹æ™•äº†ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆè·Ÿè¿›è¿™æ®µä»£ç &lt;code> configs = loader.getResources(fullName);&lt;/code>ï¼Œçœ‹configsæ˜¯å¦‚ä½•æ‹¿åˆ°çš„å§ã€‚&lt;/p>
&lt;h3 id="classloader">
&lt;a href="#classloader">#&lt;/a>
ClassLoader
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@SuppressWarnings&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;unchecked&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;[]&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;[&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getBootstrapResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//AppClassLoaderå’ŒExtClassLoaderéƒ½æ˜¯è°ƒç”¨çˆ¶ç±»URLClassLoaderçš„findResourcesæ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">findResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CompoundEnumeration&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>éµå¾ªäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå…ˆå‘ä¸Šæ‰¾parentï¼Œä¸€ç›´æ‰¾åˆ°é¡¶éƒ¨çš„Bootstrapå¯åŠ¨ç±»åŠ è½½å™¨ã€‚å†å‘ä¸‹ä¸€ç›´æ‰¾åˆ°è‡ªèº«ç±»åŠ è½½å™¨ã€‚ å½“ç„¶æ­¤å¤„ç”±äºå¯ä»¥è¿”å›å¤šå±‚ç»“æœï¼Œå› æ­¤è¿”å›çš„æœ€ç»ˆæ˜¯&lt;code>CompoundEnumeration&lt;/code> ç»„åˆçš„ç»“æœï¼Œè€Œä¸æ˜¯å•æ¡æ•°æ®ã€‚&lt;/p>
&lt;p>åé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œä¸åŒçš„å®ç°çš„Enumerationçš„&lt;code>hasMoreElements&lt;/code>å’Œ&lt;code>nextElement&lt;/code>çœŸæ˜¯èŠ±é‡Œèƒ¡å“¨ã€‚ç”¨&lt;code>Enumeration&amp;lt;URL&amp;gt;&lt;/code> è¿™ä¸ªçœ‹ä¼¼æœ€ç®€å•çš„åªæœ‰ä¸¤ä¸ªæ–¹æ³•çš„&lt;code>Interface&lt;/code>ä½œä¸ºè¿”å›ç±»å‹ï¼ŒçœŸæ˜¯ç»™ä½œè€…ç©å‡ºèŠ±æ¥äº†ã€‚&lt;/p>
&lt;p>ä¸‰å±‚æ‰¾çš„ç»“æœå¦‚ä¸‹å›¾ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/BootstrapResouces.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/ExtResouces.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/AppResources.png"
loading="lazy"
>&lt;/p>
&lt;p>debugçœ‹å®Œä¸‰å±‚æ‰«æçš„ç»“æœï¼Œä¸‰å±‚ç±»åŠ è½½å™¨ä¸€å…±æ‰«äº†ä¸€ç™¾å¤šä¸ªjaråŒ…å‡ºæ¥ï¼Œè²Œä¼¼æ²¡æ¯›ç—…ï¼Œä½†æ˜¯æ˜æ˜æˆ‘ä¼ äº†nameè¿›å»æ‰¾resourceçš„å•Šï¼Œå¦‚æœä½ è¦è¿”å›å…¨éƒ¨jaråŒ…ï¼Œè¿˜è¦æˆ‘ä¼ nameå¹²å•¥ï¼Ÿè¦æ˜¯éå†ä¸€ç™¾å¤šä¸ªjaråŒ…çš„è¯ï¼Œ&lt;code>pending = parse(service, configs.nextElement());&lt;/code>è¿™è¦éå†ä¸€ç™¾å¤šæ¬¡å»æ‰¾&lt;code>java.sql.Driver&lt;/code>çš„å®ç°ç±»ï¼Ÿ&lt;/p>
&lt;p>ä½†æ˜¯debugåˆ°&lt;code>configs.nextElement()&lt;/code>æ—¶çªç„¶å°±ç›´æ¥æ‹¿åˆ°äº†&lt;code>jar:file:/C:/Users/dell/.m2/repository/mysql/mysql-connector-java/8.0.13/mysql-connector-java-8.0.13.jar!/META-INF/services/java.sql.Driver&lt;/code>çš„å®Œæ•´è·¯å¾„ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€çœ¼è¿™ä¸ªjaråŒ…ä¸­çš„å†…å®¹ï¼Œ&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/TargetDriverMetaInf.png"
loading="lazy"
>&lt;/p>
&lt;p>çš„ç¡®è¿™å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„jaråŒ…å’Œé…ç½®æ–‡ä»¶ï¼Œé‡Œé¢å†™æ˜äº†æˆ‘ä»¬è¦æ³¨å†Œçš„Driverçš„å®ç°ç±»å°±æ˜¯&amp;quot;com.mysql.cj.jdbc.Driver&amp;quot;ã€‚&lt;/p>
&lt;p>é‚£è¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™éå†å‡ºæ¥çš„å‘¢ï¼Ÿçœ‹æ¥è¿”å›çš„è¿™ä¸ª&lt;code>configs&lt;/code>ä¸­é—´å¤§æœ‰ç„æœºï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›å®ƒçš„&lt;strong>è¿­ä»£&lt;/strong>çš„æ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="urlclassloader">
&lt;a href="#urlclassloader">#&lt;/a>
URLClassLoader
&lt;/h3>&lt;p>AppClassLoaderå’ŒExtClassLoaderéƒ½æ˜¯ç»§æ‰¿äºURLClassLoaderï¼Œä¸”å®ƒä»¬çš„&lt;code>findResources&lt;/code>æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨çˆ¶ç±»çš„ã€‚&lt;/p>
&lt;p>è€ŒURLClassLoaderçš„è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåˆæ˜¯è°ƒç”¨URLClassPathçš„&lt;code>findResources&lt;/code>æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ucp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œè¿˜æ˜¯åœ¨URLClassPathè¿”å›çš„Enumerationä¸Šå†åŒ…äº†ä¸€æ¬¡ï¼Œåˆå®ç°äº†ä¸€éEnumeration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">next&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œé¢å¤–åŠ ä¸Šçš„checkURLæ–¹æ³•ï¼Œè¿nameéƒ½æ²¡å¸¦ï¼Œè‚¯å®šä¹Ÿä¸æ˜¯æ ¡éªŒæˆ‘ä»¬java.sql.Driverçš„ï¼Œåªæ˜¯ç®€å•æ ¡éªŒä¸‹è·¯å¾„åˆæ³•æˆ–è€…å­˜åœ¨ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ucp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkURL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="urlclasspath">
&lt;a href="#urlclasspath">#&lt;/a>
URLClassPath
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findResources&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Enumeration&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URLClassPath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getLookupCache&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">next&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">URLClassPath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Loader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç»ˆäºæ‰¾åˆ°éå†jaråŒ…çš„åœ°æ–¹ï¼Œæ­¤å¤„çš„var1xå°±æ˜¯æ¯ä¸ªjaråŒ…&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">var1x&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URLClassPath&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getNextLoader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">cache&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">index&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//findResourceå°±æ˜¯ä»è¿™ä¸ªjaråŒ…ä¸­æ‰¾å‡ºæˆ‘ä»¬è¦çš„META-INF/services/java.sql.Driver&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1x&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">url&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://img.heeexy.com/URLClassPath.png"
loading="lazy"
>&lt;/p>
&lt;p>åœ¨ä¸€ä¸ªjaråŒ…ä¸­ï¼Œåˆæœ‰å¾ˆå¤šçš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ä½•æ‰¾åˆ°æˆ‘ä»¬è¦çš„é‚£ä¸ªçš„å‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œvar1xå°±æ˜¯JarLoaderï¼Œç”¨äº†å…¶ä¸­çš„getResourceæ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="jarloader">
&lt;a href="#jarloader">#&lt;/a>
JarLoader
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Resource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…³é”®å°±åœ¨è¿™ä¸ªmetaIndexä¸­ï¼ŒmayContainæ–¹æ³•å»æŸ¥äº†jaråŒ…ä¸­æ˜¯å¦åŒ…å«æˆ‘ä»¬è¦æ‰¾çš„ç›®æ ‡æ–‡ä»¶&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">metaIndex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">metaIndex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">mayContain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ensureOpen&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InternalError&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">JarEntry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">jar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getJarEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashSet&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://img.heeexy.com/JarLoader.png"
loading="lazy"
>&lt;/p>
&lt;p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†å…¨éƒ¨éå†çš„åœ°æ–¹ï¼ŒURLClassLoaderåŠ è½½äº†å…¨éƒ¨jaråŒ…ä¹‹åï¼Œåœ¨å¼€å§‹è¿­ä»£æ—¶ï¼ŒURLClassPath éå†æ¯ä¸ªjaråŒ…ï¼ŒJarLoaderæŸ¥æ‰¾æ¯ä¸ªjaråŒ…ä¸­æ˜¯å¦æœ‰ç›®æ ‡æ–‡ä»¶META-INF/services/java.sql.Driverã€‚&lt;/p></description></item><item><title>WIFIé‡Œéƒ½æ˜¯è‡ªç”±çš„é¦™å‘³----è½¯è·¯ç”±</title><link>https://heeexy.com/p/router/</link><pubDate>Mon, 23 Dec 2019 22:55:59 +0800</pubDate><guid>https://heeexy.com/p/router/</guid><description>&lt;p>&lt;img src="http://img.heeexy.com/route.png"
loading="lazy"
alt="ç½‘ç»œæ‹“æ‰‘"
>&lt;/p>
&lt;h1 id="æ•™ç¨‹è¸©è¿‡çš„å‘">
&lt;a href="#%e6%95%99%e7%a8%8b%e8%b8%a9%e8%bf%87%e7%9a%84%e5%9d%91">#&lt;/a>
æ•™ç¨‹&amp;amp;è¸©è¿‡çš„å‘
&lt;/h1>&lt;h3 id="å‰ç½®æ¡ä»¶">
&lt;a href="#%e5%89%8d%e7%bd%ae%e6%9d%a1%e4%bb%b6">#&lt;/a>
å‰ç½®æ¡ä»¶
&lt;/h3>&lt;ol>
&lt;li>ç§‘å­¦ä¸Šç½‘èƒ½åŠ›ã€‚SSR/V2rayç­‰ï¼Œæœ€å¥½è‡ªå·±æ­è¿‡æœåŠ¡ç«¯ï¼Œè¯´æ˜æœ‰åŸºç¡€èƒ½åŠ›ã€‚&lt;/li>
&lt;li>é¼ æ ‡&amp;amp;é”®ç›˜&amp;amp;æ˜¾ç¤ºå™¨&amp;amp;ç½‘çº¿ã€‚ä¸ºä»€ä¹ˆè¦å•ç‹¬æ‹å‡ºæ¥ï¼Œå› ä¸ºéœ€è¦è¿™äº›ä¸œè¥¿ï¼Œè¯´æ˜ä½ åœ¨æ“ä½œæ—¶ï¼Œå¯èƒ½è‡³å°‘éœ€è¦æœ‰ï¼š
&lt;ol>
&lt;li>ç¬”è®°æœ¬ç”µè„‘ï¼Œç”¨æ¥çœ‹æ•™ç¨‹ï¼Œæœå„ç§é—®é¢˜ï¼Œè¿œç¨‹è¿å·¥æ§æœº&lt;/li>
&lt;li>å°å¼æœºï¼Œå…¶å®æ˜¯ç”¨æ¥æ‹†é¼ æ ‡&amp;amp;é”®ç›˜&amp;amp;æ˜¾ç¤ºå™¨ç»™å·¥æ§æœºä½¿ç”¨&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Uç›˜ã€‚ç”¨äºç»™å·¥æ§æœºé‡æ–°å®‰è£…ESXiç³»ç»Ÿ&lt;/li>
&lt;li>ä¸ºç§‘å­¦ä¸Šç½‘èŠ±é’±çš„å¿ƒç†å‡†å¤‡ã€‚å› ä¸ºè‡³å°‘éœ€è¦è´­ä¹°ä¸€å°å·¥æ§æœºï¼Œè¦æ±‚é«˜ä¸€ç‚¹çš„è¿˜å¯ä»¥è´­ä¹°ROSæ­£ç‰ˆæˆæƒï¼Œæœºåœºï¼ˆFor Netflixï¼‰&lt;/li>
&lt;li>æŠ˜è…¾çš„è€å¿ƒã€‚å¦‚æœæ²¡æœ‰è€å¿ƒåˆæƒ³è¦è·¯ç”±å™¨ç§‘å­¦ä¸Šç½‘ï¼Œå…¶å®å·¥æ§æœº+OpenWrtå·²ç»éå¸¸æ£’äº†ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="é€‰è´­è½¯è·¯ç”±">
&lt;a href="#%e9%80%89%e8%b4%ad%e8%bd%af%e8%b7%af%e7%94%b1">#&lt;/a>
é€‰è´­è½¯è·¯ç”±
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=rGIUouvATqc" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=rGIUouvATqc&lt;/a>&lt;/p>
&lt;p>å»ºè®®é¢„è£…ä¸ªLEDEï¼Œç­‰ç©æ˜ç™½äº†å†æŠ˜è…¾è™šæ‹Ÿæœºã€‚&lt;/p>
&lt;h4 id="å®‰è£…exsi">
&lt;a href="#%e5%ae%89%e8%a3%85exsi">#&lt;/a>
å®‰è£…EXSi
&lt;/h4>&lt;p>å®˜ç½‘ &lt;a class="link" href="https://my.vmware.com/en/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7" target="_blank" rel="noopener"
>https://my.vmware.com/en/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7&lt;/a>&lt;/p>
&lt;p>æ•™ç¨‹&lt;/p>
&lt;p>&lt;a class="link" href="https://www.cnblogs.com/xiaoyou2018/p/11122144.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/xiaoyou2018/p/11122144.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.vediotalk.com/archives/2356" target="_blank" rel="noopener"
>https://www.vediotalk.com/archives/2356&lt;/a>&lt;/p>
&lt;p>å¿ƒå¾—ï¼š&lt;/p>
&lt;ol>
&lt;li>å°ç™½éœ€è¦è®°ä½æœ‰è¿™ä¹ˆä¸€ä¸ªè®¾ç½®é™æ€ipçš„æ“ä½œï¼Œå¯èƒ½ä½ æœ€ç»ˆéƒ¨ç½²çš„ç½‘ç»œç¯å¢ƒä¸æ˜¯ä½ å½“å‰æ“ä½œå®‰è£…çš„ç½‘ç»œï¼Œè¿™ä¸ªé™æ€ipåœ°å€ç­‰æ”¹äº†ç½‘ç»œç¯å¢ƒå°±éœ€è¦æ”¹ã€‚&lt;/li>
&lt;li>æŒ‰ç…§&lt;a class="link" href="http://www.oadun.com/2019/01/277.html" target="_blank" rel="noopener"
>æ•™ç¨‹&lt;/a>éƒ¨ç½²ç«¯å£ç»„ã€‚&lt;/li>
&lt;/ol>
&lt;h4 id="å®‰è£…ros">
&lt;a href="#%e5%ae%89%e8%a3%85ros">#&lt;/a>
å®‰è£…ROS
&lt;/h4>&lt;p>å®˜ç½‘&lt;/p>
&lt;p>&lt;a class="link" href="https://mikrotik.com/download" target="_blank" rel="noopener"
>https://mikrotik.com/download&lt;/a>&lt;/p>
&lt;p>æ•™ç¨‹&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=mkJxDSMPlPU" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=mkJxDSMPlPU&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=h6K5FThk-T4" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=h6K5FThk-T4&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=jgSM3vXGJ3c" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=jgSM3vXGJ3c&lt;/a>&lt;/p>
&lt;p>å¿ƒå¾—ï¼š&lt;/p>
&lt;ol>
&lt;li>å®˜ç½‘ä¸‹è½½çš„éœ€è¦æ­£ç‰ˆæˆæƒï¼Œå¦åˆ™ä»…èƒ½è¯•ç”¨24h&lt;/li>
&lt;li>æ´‹è‘±çš„æ•™ç¨‹å¾ˆå¥½ï¼Œå¯æƒœåªæœ‰PPPOEæ‹¨å·çš„æ–¹å¼ï¼Œè‡ªåŠ¨è·å–ipçš„ä¸Šç½‘æ–¹å¼å¯ä»¥å‚è€ƒVedio Talkæˆ–å…¶ä»–äººçš„æ•™ç¨‹&lt;/li>
&lt;li>å®‰è£…è°ƒè¯•å¥½è®°å¾—è®¾ç½®è™šæ‹Ÿæœºå¼€æœºè‡ªå¯åŠ¨ï¼ï¼ï¼&lt;/li>
&lt;li>ROSæ˜¯æ•´ä¸ªç³»åˆ—é‡Œæœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€å¤æ‚çš„åœ°æ–¹ï¼Œç¨å¾®é…ç½®é”™ä¸€ç‚¹ï¼Œå°±æ— æ³•ä¸Šç½‘ã€‚ä¸è¿‡å›æƒ³èµ·æ•´ä¸ªè¿‡ç¨‹ï¼Œæ”¶è·æœ€å¤§çš„ä¹Ÿæ˜¯è¿™é‡Œï¼Œéå¸¸å®è´µçš„ç½‘ç»œå®æˆ˜ç»éªŒï¼&lt;/li>
&lt;/ol>
&lt;h4 id="å®‰è£…openwrt">
&lt;a href="#%e5%ae%89%e8%a3%85openwrt">#&lt;/a>
å®‰è£…OpenWrt
&lt;/h4>&lt;p>æ©å±±è®ºå› &lt;a class="link" href="https://www.right.com.cn/forum/forum.php" target="_blank" rel="noopener"
>https://www.right.com.cn/forum/forum.php&lt;/a>&lt;/p>
&lt;p>å®‰è£…æ•™ç¨‹&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=n0aqV8rbKmE" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=n0aqV8rbKmE&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.oadun.com/2019/01/277.html" target="_blank" rel="noopener"
>http://www.oadun.com/2019/01/277.html&lt;/a>&lt;/p>
&lt;p>å¿ƒå¾—ï¼š&lt;/p>
&lt;ol>
&lt;li>å®‰è£…è°ƒè¯•å¥½è®°å¾—è®¾ç½®è™šæ‹Ÿæœºå¼€æœºè‡ªå¯åŠ¨ï¼ï¼ï¼&lt;/li>
&lt;/ol>
&lt;h5 id="æ‹“å±•å»¶ä¼¸">
&lt;a href="#%e6%8b%93%e5%b1%95%e5%bb%b6%e4%bc%b8">#&lt;/a>
æ‹“å±•å»¶ä¼¸
&lt;/h5>&lt;p>æºç  &lt;a class="link" href="https://github.com/coolsnowwolf/lede" target="_blank" rel="noopener"
>https://github.com/coolsnowwolf/lede&lt;/a>&lt;/p>
&lt;p>ä½¿ç”¨Github Actions äº‘ç¼–è¯‘ &lt;a class="link" href="https://www.youtube.com/watch?v=2Y8DN-ROYIs" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=2Y8DN-ROYIs&lt;/a>&lt;/p></description></item><item><title>MemSQLç®€ä»‹</title><link>https://heeexy.com/p/memsql/</link><pubDate>Tue, 18 Jun 2019 22:25:00 +0800</pubDate><guid>https://heeexy.com/p/memsql/</guid><description>&lt;h2 id="ä¸ºä»€ä¹ˆè¦çœ‹memsql">
&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e7%9c%8bmemsql">#&lt;/a>
ä¸ºä»€ä¹ˆè¦çœ‹MemSQL
&lt;/h2>&lt;p>å› ä¸º MemSQL è‡ªç§°çªå‡ºä¸€ä¸ªå¿«ï¼è€Œæˆ‘ä»¬å›¢é˜Ÿçš„æ•°æ®å¹³å°æ­£éœ€è¦ä¸€ä¸ªmsçº§åˆ«æŸ¥è¯¢çš„æ•°æ®åº“ï¼Œå› æ­¤èŠ±äº†ä¸€ç‚¹æ—¶é—´æ¥è°ƒç ” MemSQL ã€‚&lt;/p>
&lt;h2 id="åˆä½“éªŒç»“æœ">
&lt;a href="#%e5%88%9d%e4%bd%93%e9%aa%8c%e7%bb%93%e6%9e%9c">#&lt;/a>
åˆä½“éªŒç»“æœ
&lt;/h2>&lt;p>MemSQLä¸æˆ‘ä»¬æœŸæœ›çš„msçº§åˆ«æŸ¥è¯¢ç›¸å·®ç”šè¿œï¼Œæœ€ç®€å•çš„æŸ¥è¯¢ä¹Ÿé€šå¸¸æ˜¯500msè¿”å›ï¼Œå¹¶ä¸èƒ½åº”å¯¹çº¿ä¸Šçš„é«˜å¹¶å‘å®æ—¶æŸ¥è¯¢ç³»ç»Ÿã€‚ç§’çº§æŸ¥è¯¢å·²ç»æœ‰prestoç­‰å„ç§å¤§æ•°æ®ç»„ä»¶ï¼Œå¯¹äºæˆ‘ä»¬å›¢é˜Ÿå·²ç»æ²¡æœ‰ç†ç”±å†æ¥æ·±å…¥ä½¿ç”¨MemSQLã€‚&lt;/p>
&lt;p>MemSQL å…¶å®æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæœ‰å®Œå–„çš„æ–‡æ¡£ï¼Œç²¾è‡´çš„é¡µé¢ç®¡ç†å·¥å…·ï¼Œæ–¹ä¾¿çš„å®‰è£…ï¼Œç”šè‡³ä¸€é”®å¯¼å…¥å¤§é‡æ•°æ®æ¥æ–¹ä¾¿ç”¨æˆ·ä½“éªŒ ï¼ˆå°±å·®æŠŠsqlçš„è€—æ—¶è´´å‡ºæ¥äº†ï¼Œè¦æ˜¯è´´å‡ºæ¥å°±çœäº†æˆ‘è°ƒç ”çš„æ—¶é—´äº†ï¼‰ï¼Œå¯æƒœåœ¨åŒä¸€æ¢¯é˜Ÿè¿˜æœ‰å¤ªå¤šå…è´¹ã€å¼€æºã€æœ‰æ´»è·ƒç¤¾åŒºçš„ç«äº‰å¯¹æ‰‹ã€‚&lt;/p>
&lt;h2 id="ç‰¹ç‚¹">
&lt;a href="#%e7%89%b9%e7%82%b9">#&lt;/a>
ç‰¹ç‚¹
&lt;/h2>&lt;ul>
&lt;li>MemSQLå±äºå•†ä¸šå…¬å¸ï¼Œå…è´¹4 units. (æ¯8æ ¸32G ä¸º1 unit)ï¼Œä¸å¼€æº&lt;/li>
&lt;li>è‡ªå¸¦portalç•Œé¢ç®¡ç†ï¼ŒMemSQL Studioï¼Œè‡ªå¸¦å®‰è£…å·¥å…·&lt;/li>
&lt;li>å®Œå…¨æ”¯æŒmysqlè¯­æ³•ï¼Œjdbcï¼Œå¢åˆ æ”¹æŸ¥&lt;/li>
&lt;li>æ”¯æŒ in-memory rowstore &amp;amp;&amp;amp; on-disk columnstore&lt;/li>
&lt;li>å¤§ååé‡æ•°æ®å†™å…¥(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes)&lt;/li>
&lt;li>exactly-once&lt;/li>
&lt;li>aggregatorèŠ‚ç‚¹è¿è¡Œsqlï¼Œèšåˆç»“æœï¼›leafèŠ‚ç‚¹å­˜å‚¨&amp;amp;å¤„ç†æ•°æ®&lt;/li>
&lt;/ul>
&lt;h2 id="æ•°æ®å¯¼å…¥">
&lt;a href="#%e6%95%b0%e6%8d%ae%e5%af%bc%e5%85%a5">#&lt;/a>
æ•°æ®å¯¼å…¥
&lt;/h2>&lt;ol>
&lt;li>file , æŒ‡å®šåˆ†éš”ç¬¦&lt;/li>
&lt;li>Streaming (Kafka , S3 , Azure Blob , Filesystem) é€šè¿‡Pipelines&lt;/li>
&lt;li>MySQL (sqlæ–‡ä»¶)&lt;/li>
&lt;/ol>
&lt;h2 id="é€‰æ‹©-shard-key---ç±»ä¼¼esçš„routing">
&lt;a href="#%e9%80%89%e6%8b%a9-shard-key---%e7%b1%bb%e4%bc%bces%e7%9a%84routing">#&lt;/a>
é€‰æ‹© shard key (ç±»ä¼¼ESçš„routing)
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>Using a column or set of columns unique enough to minimize skew.&lt;/p>
&lt;p>ç‹¬ç‰¹çš„keyï¼Œä½¿æ•°æ®å‡åŒ€åˆ†å¸ƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Sharding on columns which you expect to filter or join on often. This allows the optimizer to minimize network traffic during the execution of the query (see [Distributed DML] for more details).&lt;/p>
&lt;p>ä½¿ç”¨ä½ ç»å¸¸è¦joinæˆ–è¿‡æ»¤çš„å­—æ®µï¼Œå‡å°ç½‘ç»œä¼ è¾“ã€‚æ¯”å¦‚è®¢å•ç›¸å…³ï¼Œä½¿ç”¨user_id&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æŸ¥è¯¢è°ƒä¼˜">
&lt;a href="#%e6%9f%a5%e8%af%a2%e8%b0%83%e4%bc%98">#&lt;/a>
æŸ¥è¯¢è°ƒä¼˜
&lt;/h2>&lt;ol>
&lt;li>åŠ index ä¼˜åŒ–è¿‡æ»¤ groupby sort&lt;/li>
&lt;li>shard key : Gather partitions:all ä¼˜åŒ–ä¸º Gather partitions:single&lt;/li>
&lt;li>Reference Tables å°è¡¨ï¼Œä¸å¸¸æ›´æ–° ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¤åˆ¶&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="http://img.heeexy.com/memsql-profile.png"
loading="lazy"
alt="profile"
>&lt;/p>
&lt;h2 id="è¡¨ç»“æ„ä¼˜åŒ–">
&lt;a href="#%e8%a1%a8%e7%bb%93%e6%9e%84%e4%bc%98%e5%8c%96">#&lt;/a>
è¡¨ç»“æ„ä¼˜åŒ–
&lt;/h2>&lt;h3 id="rowstore-vs-columnstore">
&lt;a href="#rowstore-vs-columnstore">#&lt;/a>
Rowstore vs. Columnstore
&lt;/h3>&lt;p>&lt;a class="link" href="https://docs.memsql.com/tutorials/v6.8/optimizing-table-data-structures/" target="_blank" rel="noopener"
>https://docs.memsql.com/tutorials/v6.8/optimizing-table-data-structures/&lt;/a>&lt;/p>
&lt;p>Rowstore : æŸ¥è¯¢æŒ‡å®šåˆ—ï¼Œå¹¶å‘æ›´æ–°ã€‚ä½¿ç”¨æ— é”ç´¢å¼•ï¼Œæ”¯æŒå¤šç´¢å¼•ã€‚é¢‘ç¹æ›´æ–°çš„äº‹åŠ¡åœºæ™¯ã€‚unique constraints ã€‚åŒæ ·ä¼šå¾€diskå†™ä¸€ä»½ ç”¨äºæ¢å¤ã€‚&lt;/p>
&lt;p>Columnstoreï¼š é¡ºåºæ‰«æï¼Œå•ç´¢å¼•ã€‚é€‚ç”¨åœºæ™¯ï¼šèšåˆä»…å¾ˆå°‘åˆ—ï¼ˆ10åˆ—å†…ï¼‰,æ‰«æå¤§é‡è¡Œï¼Œå¾ˆå°‘é¢‘ç¹å•è¡Œåˆ æ”¹ï¼Œæ›´æ–°åº”è¯¥æ˜¯å¤§æ‰¹é‡çš„ä¿®æ”¹&lt;/p>
&lt;h2 id="åˆ†å¸ƒå¼sql">
&lt;a href="#%e5%88%86%e5%b8%83%e5%bc%8fsql">#&lt;/a>
åˆ†å¸ƒå¼SQL
&lt;/h2>&lt;h3 id="ddl">
&lt;a href="#ddl">#&lt;/a>
DDL
&lt;/h3>&lt;ul>
&lt;li>æ¯ä¸€ä¸ªå¹¶è¡Œçš„æŸ¥è¯¢éƒ½åœ¨æ¯ä¸ªleafçš„æ¯ä¸ªpartitionä¸Šåˆ†å¼€æ‰§è¡Œã€‚&lt;/li>
&lt;li>é»˜è®¤æ¯ä¸ªleafçš„partitionæ•°é‡=cpuæ•°é‡&lt;/li>
&lt;li>æ¯ä¸ªpartitionéƒ½æ˜¯ä¸ªå•ç‹¬çš„åº“&lt;/li>
&lt;li>reference tablesåœ¨æ¯ä¸ªaggregatorå’Œleaféƒ½æœ‰ä¸€ä»½å¤åˆ¶ï¼Œé€‚åˆå°è¡¨&lt;/li>
&lt;li>shard key å†³å®šæ•°æ®è½åˆ°å“ªä¸€partition&lt;/li>
&lt;li>ä¸»é”®å’Œunique key éœ€è¦åŒ…å«shard key ï¼Œä¾‹å¦‚ï¼š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">clicks&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">click_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">BIGINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AUTO_INCREMENT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">page_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">SHARD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">click_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="dml">
&lt;a href="#dml">#&lt;/a>
DML
&lt;/h3>&lt;ul>
&lt;li>åˆ†å¸ƒå¼join ç›¸åŒçš„shard keyæ¥joinå¯ä»¥æå‡æ€§èƒ½&lt;/li>
&lt;li>åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç­‰å¾…æ¯ä¸ªpartitionéƒ½readyï¼Œå†ä¸€èµ·æäº¤&lt;/li>
&lt;li>å¼•ç”¨è¡¨å¿…é¡»å…·æœ‰æ˜¾å¼ä¸»é”®ã€‚ åˆ†å¸ƒå¼è¡¨ä¸­çš„AUTO_INCREMENTåˆ—å¿…é¡»æ˜¯BIGINTã€‚ è‡ªåŠ¨å¢é‡å€¼åœ¨æ¯ä¸ªèšåˆå™¨ä¸Šå•è°ƒé€’å¢ï¼Œä½†åœ¨æ•´ä¸ªç¾¤é›†ä¸­ä¸è¿ç»­ã€‚ åˆ†ç‰‡è¡¨ä¸æ”¯æŒå”¯ä¸€é”®ï¼ˆé™¤éå”¯ä¸€é”®æ˜¯åˆ†ç‰‡é”®çš„è¶…é›†ï¼‰ã€‚ åˆ†ç‰‡è¡¨ä¸æ”¯æŒä¿®æ”¹åˆ†ç‰‡é”®çš„UPDATEæŸ¥è¯¢ã€‚ åˆ†ç‰‡è¡¨ä¸æ”¯æŒUPDATE &amp;hellip; LIMITã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="é‡åˆ°é—®é¢˜">
&lt;a href="#%e9%81%87%e5%88%b0%e9%97%ae%e9%a2%98">#&lt;/a>
é‡åˆ°é—®é¢˜
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>mysql frontè¿æ¥ä¸ä¸Š&lt;/p>
&lt;p>æ¢ç”¨å…¶å®ƒå®¢æˆ·ç«¯å¯ä»¥ï¼Œæ¯”å¦‚idea&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://docs.memsql.com/tutorials/v6.8/build-stock-trade-database/" target="_blank" rel="noopener"
>https://docs.memsql.com/tutorials/v6.8/build-stock-trade-database/&lt;/a> å¯¼å…¥csvæ–‡ä»¶æç¤ºæ‰¾ä¸åˆ°æ–‡ä»¶&lt;/p>
&lt;p>docker cp /home/hxy/download/companylist.csv 62b8df2d8761://usr/share&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="æ€§èƒ½ä½“éªŒ">
&lt;a href="#%e6%80%a7%e8%83%bd%e4%bd%93%e9%aa%8c">#&lt;/a>
æ€§èƒ½ä½“éªŒ
&lt;/h2>&lt;h3 id="æµ‹è¯•æœºå™¨">
&lt;a href="#%e6%b5%8b%e8%af%95%e6%9c%ba%e5%99%a8">#&lt;/a>
æµ‹è¯•æœºå™¨
&lt;/h3>&lt;p>AWS 8c32g&lt;/p>
&lt;h3 id="æµ‹è¯•æ•°æ®">
&lt;a href="#%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae">#&lt;/a>
æµ‹è¯•æ•°æ®
&lt;/h3>&lt;p>å®˜æ–¹S3çš„æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨ columnstore å’Œ rowstore å„æµ‹ä¸€æ¬¡sqlæŸ¥è¯¢ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://docs.memsql.com/guides/latest/load-data/pipelines/step-1/" target="_blank" rel="noopener"
>https://docs.memsql.com/guides/latest/load-data/pipelines/step-1/&lt;/a>&lt;/p>
&lt;h4 id="columnstoreæ•°æ®">
&lt;a href="#columnstore%e6%95%b0%e6%8d%ae">#&lt;/a>
&lt;strong>columnstoreæ•°æ®&lt;/strong>
&lt;/h4>&lt;p>&lt;img src="http://img.heeexy.com/columnstore.png"
loading="lazy"
alt="columnstore.png"
>&lt;/p>
&lt;h4 id="rowstore-æ•°æ®">
&lt;a href="#rowstore-%e6%95%b0%e6%8d%ae">#&lt;/a>
&lt;strong>rowstore&lt;/strong> &lt;strong>æ•°æ®&lt;/strong>
&lt;/h4>&lt;p>&lt;img src="http://img.heeexy.com/rowstore.png"
loading="lazy"
alt="rowstore.png"
>&lt;/p>
&lt;p>ç”±äº150Wè¡Œæ•°æ®å­˜disk å 1Gï¼Œå­˜memoryéœ€è¦å 5Gï¼Œå‘ç°æœºå™¨å†…å­˜ä¸è¶³ï¼Œåªå¯¼å…¥äº†ä¸€å¼ 150Wè¡Œå’Œä¸€å¼ 25è¡Œçš„è¡¨ã€‚&lt;/p>
&lt;h4 id="æ‰§è¡Œsqlè€—æ—¶">
&lt;a href="#%e6%89%a7%e8%a1%8csql%e8%80%97%e6%97%b6">#&lt;/a>
æ‰§è¡Œsqlè€—æ—¶
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select * from nation limit 20;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore&lt;/strong> 770ms&lt;/p>
&lt;p>&lt;strong>rowstore&lt;/strong> 700ms&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select l_returnflag,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l_linestatus,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_quantity) as sum_qty,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_extendedprice) as sum_base_price,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">avg(l_quantity) as avg_qty,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">avg(l_extendedprice) as avg_price,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">avg(l_discount) as avg_disc,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">count(*) as count_order
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from lineitem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where l_shipdate &amp;lt;= date(&amp;#39;1998-12-01&amp;#39; - interval &amp;#39;90&amp;#39; day)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group by l_returnflag, l_linestatus
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">order by l_returnflag, l_linestatus;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore 19s 5s 5s&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l_orderkey,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_extendedprice * (1 - l_discount)) as revenue,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_orderdate,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_shippriority
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customer,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">orders,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lineitem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_mktsegment = &amp;#39;BUILDING&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and c_custkey = o_custkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and l_orderkey = o_orderkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and o_orderdate &amp;lt; date(&amp;#39;1995-03-15&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and l_shipdate &amp;gt; date(&amp;#39;1995-03-15&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l_orderkey,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_orderdate,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_shippriority
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">order by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">revenue desc,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_orderdate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">limit 10;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore&lt;/strong> 10s 5s 5s&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_custkey,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_name,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(l_extendedprice * (1 - l_discount)) as revenue,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_acctbal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n_name,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_address,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_phone,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_comment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customer,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">orders,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lineitem,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_custkey = o_custkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and l_orderkey = o_orderkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and o_orderdate &amp;gt;= date(&amp;#39;1993-10-01&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and o_orderdate &amp;lt; date(&amp;#39;1993-10-01&amp;#39;) + interval &amp;#39;3&amp;#39; month
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and l_returnflag = &amp;#39;R&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and c_nationkey = n_nationkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_custkey,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_name,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_acctbal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_phone,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n_name,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_address,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">c_comment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">order by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">revenue desc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">limit 20;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore&lt;/strong> 12s 9s 9s&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_year,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sum(amount) as sum_profit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">n_name as nation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">extract(year from o_orderdate) as o_year,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">part,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">supplier,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lineitem,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">partsupp,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">orders,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">s_suppkey = l_suppkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and ps_suppkey = l_suppkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and ps_partkey = l_partkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and p_partkey = l_partkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and o_orderkey = l_orderkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and s_nationkey = n_nationkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">and p_name like &amp;#39;%green%&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">) as profit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">group by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_year
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">order by
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">o_year desc;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore&lt;/strong> 32s 19s 19s&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from customer c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">left join orders o on c.c_custkey = o.o_custkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">left join nation n on c.c_nationkey = n.n_nationkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where c.c_custkey = &amp;#39;8367&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">limit 10;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore&lt;/strong> 32s 4s 4s&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from customer c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">left join orders o on c.c_custkey = o.o_custkey and o_custkey = &amp;#39;2141&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">left join nation n on c.c_nationkey = n.n_nationkey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where c.c_custkey = &amp;#39;2141&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">limit 10;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>columnstore 2s 1s 1s&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">select *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from customer c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">where c.c_custkey = &amp;#39;2141&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">limit 10;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>rowstore&lt;/strong> 500ms&lt;/p></description></item><item><title>Elasticsearchåœ¨é«˜å¹¶å‘å¤æ‚æŸ¥è¯¢ä¸šåŠ¡åœºæ™¯çš„åº”ç”¨</title><link>https://heeexy.com/p/es-for-search/</link><pubDate>Sun, 02 Dec 2018 16:08:38 +0800</pubDate><guid>https://heeexy.com/p/es-for-search/</guid><description>&lt;p>è¯´èµ· Elasticsearchï¼Œå¾€å¾€å¤§å®¶æƒ³åˆ°çš„éƒ½æ˜¯ ELK çš„ä¸€å¥—ï¼Œä½†æ˜¯ä½œä¸º NoSQLï¼ŒES æœ‰æå¿«çš„å“åº”é€Ÿåº¦ï¼Œå¼ºå¤§çš„èšåˆåŠŸèƒ½ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ï¼Œåº”å¯¹é«˜å¹¶å‘çš„å¤æ‚æŸ¥è¯¢çš„ä¸šåŠ¡åœºæ™¯å…¶å®ä¹Ÿæ˜¯éå¸¸å¼ºåŠ›çš„ã€‚&lt;/p>
&lt;blockquote>
&lt;p>You Know, for Search&lt;/p>
&lt;/blockquote>
&lt;p>æˆ‘ä»¬å›¢é˜Ÿå°±ä¸€ç›´ä½¿ç”¨ ES ä½œä¸ºä¸»åŠ›æ•°æ®åº“ï¼Œ ä»ä¸€å¼€å§‹åšå…¨æ–‡æ£€ç´¢ï¼Œåˆ°ç°åœ¨æ‰¿æ‹…å…¨éƒ¨çš„å•†å“åˆ—è¡¨é¡µæŸ¥è¯¢ã€‚è¿‘å‡ ä¸ªæœˆå°†æŸ¥è¯¢ç³»ç»Ÿçš„ qps ä» 1k ä¼˜åŒ–åˆ°äº† 10k+ï¼Œå…¶ä¸­ ES çš„ä¼˜åŒ–å äº†å¾ˆé‡è¦ä¸€éƒ¨åˆ†ï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œåº”è¯¥æ˜¯å¯¹ ES ç‰¹æ€§çš„æ‰¬é•¿é¿çŸ­èµ·åˆ°äº†éå¸¸å¤§çš„ä½œç”¨ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/webpage.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="æ•°ç»„--åµŒå¥—ç»“æ„">
&lt;a href="#%e6%95%b0%e7%bb%84--%e5%b5%8c%e5%a5%97%e7%bb%93%e6%9e%84">#&lt;/a>
æ•°ç»„ &amp;amp; åµŒå¥—ç»“æ„
&lt;/h2>&lt;p>ES æ²¡æœ‰ joinï¼Œå¾ˆå¤šäººç›´æ¥å°±ä¼šè®¤ä¸º ES æ— æ³•å¤„ç†ä¸€å¯¹å¤šçš„æƒ…å†µï¼Œå…¶å®è¿˜æœ‰&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/array.html" target="_blank" rel="noopener"
>æ•°ç»„&lt;/a>å’Œ&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/nested.html" target="_blank" rel="noopener"
>åµŒå¥—ç»“æ„&lt;/a>å¯ä»¥åº”ä»˜å¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚&lt;/p>
&lt;p>æ¯”å¦‚ä¸€ä¸ªå•†å“æ‹¥æœ‰å¤šç§å±æ€§ï¼Œéƒ½å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„å­—æ®µä¸­ï¼Œä½¿ç”¨ must å’Œ must_not å°±å¯ä»¥çµæ´»åœ°è¿›è¡ŒæŸ¥è¯¢ç­›é€‰ã€‚&lt;/p>
&lt;p>æ¯”å¦‚åŒæ¬¾ä¸åŒè‰²çš„å‡ ä»¶Tæ¤ï¼Œä½¿ç”¨åµŒå¥—ç»“æ„ä¿å­˜ï¼Œæœç´¢æ—¶åªéœ€è¦å…¶ä¸­ä¸€ä»¶æ»¡è¶³ç­›é€‰æ¡ä»¶ï¼Œä¾¿å¯ä»¥å…¨éƒ¨å¸¦å‡ºæ¥ï¼Œåœ¨é¡µé¢ä¸Šä»¥å¤šä¸ªå°è‰²å—å±•ç¤ºï¼Œè€Œæ— éœ€å ç”¨å¤šä¸ªå±•ç¤ºä½ã€‚å¹¶ä¸”è¿˜å¯ä»¥æ‹¿æ»¡è¶³ç­›é€‰æ¡ä»¶çš„å•†å“ä¸­çš„æŸå±æ€§æœ€å¤§å€¼/æœ€å°å€¼ç­‰è¿›è¡Œæ’åºï¼Œå¦‚å®˜ç½‘ç»™å‡ºçš„&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.5/search-request-sort.html" target="_blank" rel="noopener"
>ç¤ºä¾‹&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;query&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;nested&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;parent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;query&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;bool&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;must&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;range&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;parent.age&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;gte&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">21&lt;/span>&lt;span class="p">}}},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;filter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;nested&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;parent.child&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;query&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;match&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;parent.child.name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;matt&amp;#34;&lt;/span>&lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sort&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;parent.child.age&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mode&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;min&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;order&amp;#34;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;asc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;nested&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;parent&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;filter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;range&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;parent.age&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;gte&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">21&lt;/span>&lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;nested&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;path&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;parent.child&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;filter&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;match&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nt">&amp;#34;parent.child.name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;matt&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="èšåˆ">
&lt;a href="#%e8%81%9a%e5%90%88">#&lt;/a>
èšåˆ
&lt;/h2>&lt;p>å•†å“åˆ—è¡¨é¡µé¢èƒ½ç”¨åˆ°èšåˆçš„åœºæ™¯éå¸¸å¤šï¼Œæ¯”å¦‚èšåˆå‡ºåˆ†ç±»ä¸‹ï¼ˆå¯èƒ½å¤šè¾¾æ•°ä¸‡ä¸ªå•†å“ï¼‰çš„å„å­åˆ†ç±»ï¼Œå„å±æ€§çš„æ•°é‡ï¼Œå¹¶ä¸”éœ€è¦æ”¯æŒå¤æ‚çš„ç­›é€‰æ¡ä»¶ï¼Œæ¯”å¦‚åº“å­˜ï¼Œä»·æ ¼èŒƒå›´ç­‰ç­‰ï¼Œå¹¶ä¸”è¿™ç§æŸ¥è¯¢é€Ÿåº¦è¿œæ¯” RDS çš„ join + group by + count å¿«ã€‚&lt;/p>
&lt;p>åˆæ¯”å¦‚éœ€è¦æŸ¥å‡ºæœ€è¿‘10å¤©å†…æœ‰æ–°å•†å“çš„æ—¥æœŸåˆ—è¡¨ï¼Œé‚£å°±å¯ä»¥ç”¨åˆ° date_histogram èšåˆå‡½æ•°ã€‚&lt;/p>
&lt;h2 id="åŠ¨æ€å­—æ®µ">
&lt;a href="#%e5%8a%a8%e6%80%81%e5%ad%97%e6%ae%b5">#&lt;/a>
åŠ¨æ€å­—æ®µ
&lt;/h2>&lt;p>åŠ¨æ€å­—æ®µçš„è®¾è®¡ä¹Ÿä¸ºæˆ‘ä»¬çš„ä¸šåŠ¡æä¾›äº†å¾ˆå¤§ä¾¿åˆ©ï¼Œç”±äºä¸å…·ä½“ä¸šåŠ¡å…³è”æ€§å¤ªå¼ºï¼Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚&lt;/p>
&lt;p>ESèƒ½æ”¯æŒçš„åŠ¨æ€å­—æ®µæ•°é‡éå¸¸çš„å¤šï¼Œä¸è¿‡è¿™é‡Œè¦ç•™æ„çš„å°±æ˜¯åŠ¨æ€å­—æ®µä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“å‡ºé—®é¢˜çš„åœ°æ–¹ï¼Œå°±æ˜¯ç¬æ—¶å†™å…¥å¤§é‡çš„åŠ¨æ€å­—æ®µä¼šå¯¼è‡´é›†ç¾¤ç´¢å¼•çš„å…ƒæ•°æ®å¤§é‡å˜åŠ¨ï¼Œmaster èŠ‚ç‚¹è´Ÿè½½æš´æ¶¨ç”šè‡³æŒ‚æ‰ã€‚&lt;/p>
&lt;h2 id="ç¼ºé™·">
&lt;a href="#%e7%bc%ba%e9%99%b7">#&lt;/a>
ç¼ºé™·
&lt;/h2>&lt;ol>
&lt;li>æ²¡æœ‰ joinã€‚ES çš„æŸ¥è¯¢é€Ÿåº¦éå¸¸çš„å¿«ï¼Œä½†æ˜¯ä¸èƒ½ join æ¯•ç«Ÿè¿˜æ˜¯æœ‰ä¸€äº›ä¸šåŠ¡åœºæ™¯æ— æ³•ä½¿ç”¨ã€‚å½“ç„¶è¯åˆè¯´å›æ¥ï¼Œåœ¨é«˜å¹¶å‘é‡ä¸‹ï¼Œå¤šè¡¨ join èƒ½ä¸èƒ½æŠ—å¾—ä½ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚å¯¹äºæŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¸€è´¯çš„åŸåˆ™è¿˜æ˜¯ï¼š&lt;strong>æŠŠæ•°æ®ç¦»çº¿å‡†å¤‡æˆä¾¿äºæŸ¥è¯¢çš„ç»“æ„ï¼Œçº¿ä¸Šå®æ—¶æŸ¥è¯¢å°½å¯èƒ½çš„ç®€å•ï¼Œä¸€æ­¥åˆ°ä½&lt;/strong>ã€‚&lt;/li>
&lt;li>ç”±äºè¦æŠŠæ•°æ®ç¦»çº¿å‡†å¤‡å¥½ï¼Œè¿™ä¾¿å¸¦æ¥äº†æ•°æ®åŒæ­¥æ›´æ–°çš„é—®é¢˜ï¼Œæ•°æ®çš„æ—¶æ•ˆæ€§ã€å‡†ç¡®æ€§éƒ½éœ€è¦ä¿è¯ï¼Œæ•°ç»„ä¸åµŒå¥—ç»“æ„çš„æ•°æ®æ›´æ–°ä¹Ÿä¸å¤Ÿæ–¹ä¾¿é«˜æ•ˆï¼Œè¿™äº›éƒ½ä¼šå¢åŠ å¾ˆå¤šçš„å·¥ä½œé‡ã€‚&lt;/li>
&lt;/ol></description></item><item><title>Elasticsearch 2.3å‡çº§è‡³6.3</title><link>https://heeexy.com/p/upgrade-elasticsearch/</link><pubDate>Sat, 01 Sep 2018 11:29:00 +0800</pubDate><guid>https://heeexy.com/p/upgrade-elasticsearch/</guid><description>&lt;h1 id="é›†ç¾¤ç®¡ç†">
&lt;a href="#%e9%9b%86%e7%be%a4%e7%ae%a1%e7%90%86">#&lt;/a>
é›†ç¾¤ç®¡ç†
&lt;/h1>&lt;h3 id="èŠ‚ç‚¹åˆ†é…">
&lt;a href="#%e8%8a%82%e7%82%b9%e5%88%86%e9%85%8d">#&lt;/a>
èŠ‚ç‚¹åˆ†é…
&lt;/h3>&lt;p>åŸé›†ç¾¤ master*3 data*12 client*0&lt;/p>
&lt;p>æ–°é›†ç¾¤ master*3 data*12 injest*0 coordinating*0&lt;/p>
&lt;p>ingest èŠ‚ç‚¹ç”¨äºæ”¯æŒ pipeline æ“ä½œ å¯¹bulkå’Œindexæ–‡æ¡£è¿›è¡Œé¢„å¤„ç†&lt;/p>
&lt;p>coordinating åŠŸèƒ½ä¸»è¦æ˜¯åˆ†å‘è¯·æ±‚,èšåˆå„èŠ‚ç‚¹çš„å¤„ç†ç»“æœ,è´Ÿè½½å‡è¡¡,å¤§è§„æ¨¡é›†ç¾¤å¯ä»¥è®¾ç½®ä¸€ä¸ªç»™è¯»,ä¸€ä¸ªç»™å†™ã€‚ä½†coordinating æ•°é‡ä¹Ÿä¸å®œè¿‡å¤š,ä¼šæ‹–æ…¢é€‰ä¸¾ä¸»èŠ‚ç‚¹çš„æ—¶é—´,å¹¶ä¸”dataèŠ‚ç‚¹å…¶å®ä¹Ÿå¯ä»¥å¤„ç†è¿™äº›è¯·æ±‚.&lt;/p>
&lt;h3 id="èŠ‚ç‚¹è®¾ç½®">
&lt;a href="#%e8%8a%82%e7%82%b9%e8%ae%be%e7%bd%ae">#&lt;/a>
èŠ‚ç‚¹è®¾ç½®
&lt;/h3>&lt;p>search.remote.connect: false
node.ingest: false&lt;/p>
&lt;h1 id="æ•°æ®è¿ç§»">
&lt;a href="#%e6%95%b0%e6%8d%ae%e8%bf%81%e7%a7%bb">#&lt;/a>
æ•°æ®è¿ç§»
&lt;/h1>&lt;h3 id="æ•°æ®æº">
&lt;a href="#%e6%95%b0%e6%8d%ae%e6%ba%90">#&lt;/a>
æ•°æ®æº
&lt;/h3>&lt;p>ç”±äºæœ‰æ•°æ®æºåŠåŒæ­¥æ–¹æ¡ˆ,æ‰€ä»¥åªéœ€æ•°æ®å…¨é‡å¯¼å…¥6.3ç‰ˆæœ¬çš„é›†ç¾¤å³å¯.&lt;/p>
&lt;h3 id="ç´¢å¼•ç®¡ç†">
&lt;a href="#%e7%b4%a2%e5%bc%95%e7%ae%a1%e7%90%86">#&lt;/a>
ç´¢å¼•ç®¡ç†
&lt;/h3>&lt;p>ç›®å‰ç”Ÿäº§ç¯å¢ƒæœ‰300ä¸ªç´¢å¼•éœ€è¦åŒæ­¥,è¦æ£€æŸ¥åŒæ­¥è„šæœ¬çš„åˆ›å»ºç´¢å¼•,åˆ‡åˆ«åç­‰æ­¥éª¤.&lt;/p>
&lt;h3 id="mappingè®¾ç½®">
&lt;a href="#mapping%e8%ae%be%e7%bd%ae">#&lt;/a>
mappingè®¾ç½®
&lt;/h3>&lt;ol>
&lt;li>type åªæ”¯æŒ1ç§ï¼Œè‡ª ES7.0 èµ·å°†ä¸å†æ”¯æŒ type&amp;mdash;&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.3/removal-of-types.html" target="_blank" rel="noopener"
>å®˜æ–¹è¯´æ˜&lt;/a>&lt;/li>
&lt;li>å¯¹å¯ä»¥ä½¿ç”¨è‡ªå¢ id çš„ç´¢å¼•ä½¿ç”¨è‡ªå¢ id&lt;/li>
&lt;li>å¯¹å¤§å¤šæ•°å­—ç¬¦ä¸²å­—æ®µä½¿ç”¨ keyword ç±»å‹&lt;/li>
&lt;li>å¯¹ä¸ç”¨äºæ•°å€¼èŒƒå›´æŸ¥æ‰¾çš„æ•°å€¼ç±»å‹æ”¹ä¸ºkeywordç±»å‹&lt;/li>
&lt;li>&lt;a class="link" href="https://www.jianshu.com/p/d53ef9aa8416" target="_blank" rel="noopener"
>åˆ†è¯æ’ä»¶å¯èƒ½éœ€è¦æ”¹åŠ¨&lt;/a>&lt;/li>
&lt;li>index: no æ”¹ä¸º index:false&lt;/li>
&lt;li>index: not_analyzed åˆ æ‰&lt;/li>
&lt;/ol>
&lt;h3 id="æé«˜è¿ç§»é€Ÿåº¦">
&lt;a href="#%e6%8f%90%e9%ab%98%e8%bf%81%e7%a7%bb%e9%80%9f%e5%ba%a6">#&lt;/a>
æé«˜è¿ç§»é€Ÿåº¦
&lt;/h3>&lt;ol>
&lt;li>sudo swapoff -a&lt;/li>
&lt;li>å‰¯æœ¬è®¾ç½®ä¸º0&lt;/li>
&lt;li>refresh_interval è®¾ç½®ä¸º -1 ï¼ˆå¯¹çº¿ä¸Šç”Ÿäº§é›†ç¾¤ä¸Šç´¢å¼•æ‰¹é‡å¯¼å…¥æ—¶ï¼Œè®¾ç½®-1åï¼Œé‡æ–°æ‰“å¼€æ—¶å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤å‹åŠ›æš´å¢ï¼‰&lt;/li>
&lt;li>å¯¼å…¥æ•°æ®&lt;/li>
&lt;li>refresh_interval è®¾ç½®ä¸º30&lt;/li>
&lt;li>ç¡®è®¤æ•°æ®æ­£ç¡®æ€§&lt;/li>
&lt;li>POST /_forcemerge max_num_segments=1ï¼ˆå¯¹äºå¤§ç´¢å¼•å¯èƒ½éå¸¸è€—æ—¶ï¼‰&lt;/li>
&lt;li>å‰¯æœ¬è®¾ç½®ä¸º1&lt;/li>
&lt;/ol>
&lt;h1 id="scalaé¡¹ç›®å‡çº§">
&lt;a href="#scala%e9%a1%b9%e7%9b%ae%e5%8d%87%e7%ba%a7">#&lt;/a>
scalaé¡¹ç›®å‡çº§
&lt;/h1>&lt;ol>
&lt;li>scala &amp;amp; play å‡çº§, å°¤å…¶æ˜¯playçš„å‡çº§ä¼šå¯¼è‡´å¤§é‡ä»£ç æ”¹åŠ¨&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/sksamuel/elastic4s" target="_blank" rel="noopener"
>elastic4s&lt;/a> ä¾èµ–å‡çº§ï¼Œæ³¨æ„é™¤äº†coreåŒ…è¿˜éœ€è¦httpåŒ… ã€‚&lt;/li>
&lt;li>åŸæœ¬çš„è·å–client, æ„å»ºdsl,excute,è§£æresponseçš„å¤§é‡ä»£ç è¦ä¿®æ”¹ï¼Œå°¤å…¶æ˜¯æ„å»ºdslæ¶‰åŠå¤§é‡ä¸šåŠ¡ï¼Œéœ€è¦é€ä¸€æ¯”å¯¹ä¿®æ”¹ã€‚&lt;/li>
&lt;/ol>
&lt;h1 id="ç›‘æ§">
&lt;a href="#%e7%9b%91%e6%8e%a7">#&lt;/a>
ç›‘æ§
&lt;/h1>&lt;p>Prometheus + Grafana ä¸»è¦æ˜¯è·å–ESä¿¡æ¯çš„apiéšä¹‹å‡çº§ï¼Œæ”¹åŠ¨é€šå¸¸ä¸å¤§&lt;/p>
&lt;p>å¦å¤–æ¨è xpack çš„ monitorï¼Œæ”¶é›†äº† segment çš„æ•°æ®ï¼Œæ”¶é›†äº†æ¯ä¸ªç´¢å¼•çš„è¯·æ±‚é‡ï¼Œå“åº”æ—¶é—´ç­‰ä¿¡æ¯ï¼Œä¿¡æ¯é›†æˆè¿›äº† kibana&lt;/p></description></item><item><title>ä½¿ç”¨MyBatisæ—¶ä¸ºä»€ä¹ˆDaoå±‚ä¸éœ€è¦@Repository</title><link>https://heeexy.com/p/mybatis-classpathmapperscanner/</link><pubDate>Tue, 03 Apr 2018 17:07:46 +0800</pubDate><guid>https://heeexy.com/p/mybatis-classpathmapperscanner/</guid><description>&lt;h1 id="é—®é¢˜">
&lt;a href="#%e9%97%ae%e9%a2%98">#&lt;/a>
é—®é¢˜
&lt;/h1>&lt;p>Serviceå±‚æ³¨å…¥Daoæ—¶ï¼Œ Intellij æ€»ä¼šä»¥çº¢è‰²æ³¢æµªçº¿æç¤ºæˆ‘ä»¬&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserDao&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userDao&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Could not autowire. No beans of &amp;lsquo;UserDao&amp;rsquo; type found.
Checks autowiring problems in a bean class.&lt;/p>
&lt;p>å°½ç®¡æˆ‘ä»¬éƒ½çŸ¥é“ Dao å±‚çš„ Bean å®é™…ä¸Šéƒ½æ˜¯æœ‰çš„ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®å…³é—­è¿™æ¼äººçš„æç¤ºï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆ Intellij å°±æ‰¾ä¸åˆ°è¿™ä¸ª Bean å‘¢ï¼Ÿç”šè‡³æœ‰äººæœ‰è¿™ç§åšæ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Repository&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">UserDao&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥é¿å…æç¤ºï¼Œä½†æ˜¯è¿™ç§åšæ³•æ­£ç¡®ä¹ˆï¼Ÿ&lt;/p>
&lt;p>æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬çš„ç–‘é—®å°±æ˜¯&lt;/p>
&lt;ol>
&lt;li>ä¸ºä»€ä¹ˆ Dao å±‚ä¸éœ€è¦åŠ  @Repository æ³¨è§£ï¼Œæºç é‡Œåˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ&lt;/li>
&lt;li>åŠ äº† @Repository æ³¨è§£æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ&lt;/li>
&lt;/ol>
&lt;h1 id="ç­”æ¡ˆ">
&lt;a href="#%e7%ad%94%e6%a1%88">#&lt;/a>
ç­”æ¡ˆ
&lt;/h1>&lt;ol>
&lt;li>
&lt;p>å…³é”®åœ¨äº ClassPathMapperScanner å¯¹æŒ‡å®šåŒ…çš„æ‰«æï¼Œå¹¶ä¸”æ‰«æè¿‡ç¨‹å¯¹ Spring åŸæœ¬çš„æ‰«æ Bean çš„æ­¥éª¤ &amp;ldquo;åŠ äº†æ–™â€ ï¼ŒSpring æœ¬èº«åªæ‰«å®ç°ç±»ï¼Œä½† MyBatis çš„æ‰«æå™¨&lt;strong>æ‰«äº†æ¥å£&lt;/strong> ã€‚å¹¶ä¸”æ‰«å®Œæ¥å£ä¹‹åï¼Œä¸ºæ¥å£é…äº†ä¸ª &lt;strong>BeanDefinition&lt;/strong> ,å¹¶ä¸”è¿™ä¸ª bd çš„ BeanClass æ˜¯ &lt;strong>MapperFactoryBean&lt;/strong> ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å¯¹äº BeanDefinition å’Œ MapperFactoryBean ä¸äº†è§£çš„åŒå­¦è¯·æŸ¥è¯¢ç›¸å…³èµ„æ–™å’Œæºç &lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>ä»…ä»…åªèƒ½è§£å†³ Intellij é™æ€æŸ¥æ‰¾ bean çš„é—®é¢˜ï¼Œæ²¡æœ‰å®é™…ä½œç”¨ã€‚å³ä½¿åŠ äº†æ³¨è§£ï¼Œæ¯”å¦‚@Controllerï¼Œ@Service ç­‰ç­‰ï¼Œä¹Ÿä¼šè¢« Spring çš„æ‰«æå™¨ç»™å¿½ç•¥æ‰ï¼Œå› ä¸º&lt;strong>æ‰«æå™¨ä¼šè¿‡æ»¤æ‰æ¥å£&lt;/strong>ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h1 id="æºç æ¢ç´¢">
&lt;a href="#%e6%ba%90%e7%a0%81%e6%8e%a2%e7%b4%a2">#&lt;/a>
æºç æ¢ç´¢
&lt;/h1>&lt;blockquote>
&lt;p>ä¸‹é¢çš„æºç éƒ¨åˆ†å¦‚æœè¯»è€…æå‰æœ‰ MyBatis çš„ Bean çš„æ‰§è¡Œæµç¨‹ï¼Œå’Œ Spring çš„ BeanåŠ è½½çš„ç›¸å…³çŸ¥è¯†å°±æ›´å¥½ç†è§£ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="1-åˆ†æé—®é¢˜">
&lt;a href="#1-%e5%88%86%e6%9e%90%e9%97%ae%e9%a2%98">#&lt;/a>
1. åˆ†æé—®é¢˜
&lt;/h3>&lt;p>å…³äºä¸ºä»€ä¹ˆä¸éœ€è¦æ³¨è§£å°±èƒ½è·å–åˆ° Dao å±‚çš„ Beanï¼Œçœ‹ä¼¼ç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸ºé…ç½®äº†æ‰«ææŒ‡å®šè¿™ä¸ªåŒ…é‡Œçš„ xxxDao.class å•Šï¼Œæ¯”å¦‚ä½¿ç”¨æ³¨è§£ @MapperScan(&amp;ldquo;com.example.dao&amp;rdquo;)ã€‚&lt;/p>
&lt;p>è¿™ä¸ªç­”æ¡ˆå¤ªè¿‡è¡¨é¢ï¼Œè§‰å¾—é—®é¢˜ç®€å•åªæ˜¯å› ä¸ºå¯¹ Spring çš„ Bean ä¸ç†Ÿæ‚‰ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½•æ—¶è§è¿‡ @Component åŠå…¶è¡ç”Ÿçš„3ä¸ªæ³¨è§£ @Controllerã€@Serviceã€@Repository &lt;strong>åŠ åœ¨æ¥å£ä¸Šé¢&lt;/strong>çš„ï¼Ÿ&lt;/p>
&lt;p>è‡ªå·±æµ‹è¯•æ–°å»ºä¸ªæ¥å£ï¼Œä¸Šé¢åŠ æ³¨è§£ï¼Œç„¶åæ‰¾ä¸ª Controller é‡Œ @Autowired æ³¨å…¥ä¸€ä¸‹ï¼Œé¡¹ç›®ç«‹é©¬ä¼šæŠ¥é”™ NoSuchBeanDefinitionException ã€‚&lt;/p>
&lt;h3 id="2-åˆ‡å…¥æºç ">
&lt;a href="#2-%e5%88%87%e5%85%a5%e6%ba%90%e7%a0%81">#&lt;/a>
2. åˆ‡å…¥æºç 
&lt;/h3>&lt;h4 id="åˆ‡å…¥ç‚¹">
&lt;a href="#%e5%88%87%e5%85%a5%e7%82%b9">#&lt;/a>
åˆ‡å…¥ç‚¹
&lt;/h4>&lt;p>æ—¢ç„¶ä½¿ç”¨æ³¨è§£ @MapperScan å°±å¥½ä½¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™ä¸ªç‚¹åˆ‡å…¥æºç çœ‹ä¸€ä¸‹ï¼Œå…ˆæ‰¾å‡ºæºç ä¸­ä½•å¤„ç”¨äº†æ­¤æ³¨è§£ï¼Œéå¸¸å¹¸è¿çš„æ˜¯ï¼Œåªæœ‰ä¸€å¤„ç”¨åˆ°äº†æ­¤æ³¨è§£ ï¼šMapperScannerRegistrar.registerBeanDefinitions() ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ä»ç±»åå’Œæ–¹æ³•åå°±å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºè¿™ä¸ªç±»çš„åŠŸèƒ½æ˜¯æ‰«æ Mapper å¹¶æ³¨å†Œï¼Œæ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯æ³¨å†Œ BeanDefinitions åˆ° Spring ä¸­ã€‚æ–¹æ³•çš„æºç æˆ‘å°±ä¸è´´äº†ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºæ¥æ˜¯åˆ›å»ºä¸€ä¸ªæ‰«æå™¨ &lt;code>ClassPathMapperScanner&lt;/code> ï¼Œè®¾ç½®å¥½ä¸€ç³»åˆ—å±æ€§æ¯”å¦‚ Spring çš„æ³¨å†Œè¡¨ä¹‹åï¼Œæ‰§è¡Œ doScan() æ–¹æ³•å»æ‰«æ @MapperScan æä¾›çš„åŒ…ã€‚&lt;/p>
&lt;h4 id="doscan-æ‰«æèµ„æºè½¬æ¢ä¸º-beandefinition">
&lt;a href="#doscan-%e6%89%ab%e6%8f%8f%e8%b5%84%e6%ba%90%e8%bd%ac%e6%8d%a2%e4%b8%ba-beandefinition">#&lt;/a>
doScan() æ‰«æèµ„æºï¼Œè½¬æ¢ä¸º BeanDefinition
&lt;/h4>&lt;p>doScan() æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¸¤æ­¥ï¼š&lt;/p>
&lt;ol>
&lt;li>è°ƒç”¨çˆ¶ç±» ClassPathBeanDefinitionScanner çš„doScan()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ Spring æ‰«æBeanDefinition çš„æ–¹æ³•ã€‚è¿‡ç¨‹ä¸æ˜¯å¾ˆé‡è¦ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸ªæ‰«ææ–¹æ³•çš„ä¸€ä¸ªå…³é”®å°±æ˜¯&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">BeanDefinition&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidates&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">findCandidateComponents&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">basePackage&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨å…¶ä¸­å¯¹æ‰€æœ‰çš„å€™é€‰è€…ä½¿ç”¨ isCandidateComponent() æ–¹æ³•åˆ¤æ–­æ˜¯å¦ä¸ºç¬¦åˆè¦æ±‚çš„ BeanDefinitionã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TypeFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">excludeFilters&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metadataReader&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">metadataReaderFactory&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TypeFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">includeFilters&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metadataReader&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">metadataReaderFactory&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isConditionMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metadataReader&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æœ‰ä¸¤ç»„è¿‡æ»¤å™¨æ¥è¿‡æ»¤æ‰«æåˆ°çš„èµ„æºã€‚&lt;strong>Spring é»˜è®¤çš„è¿‡æ»¤å™¨æ˜¯æ’é™¤æ‰æŠ½è±¡ç±»/æ¥å£çš„ã€‚è€ŒMyBatis çš„æ‰«æå™¨é‡æ–°æ³¨å†Œäº†è¿‡æ»¤å™¨ï¼Œé»˜è®¤å¯¹æ¥å£æ”¾è¡Œã€‚&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>å…¶å®è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„è¿‡æ»¤è¦æ±‚ï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬æœ¬é—®é¢˜çš„æ¢ç©¶ï¼Œæ‰€ä»¥ä¸æ·±å…¥è§£è¯»äº†ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æºç è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆæ‰¾åˆ°äº†æœ¬æ–‡çš„ç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚ä¹Ÿå°±æ˜¯ Spring ä¼šå¿½ç•¥æ‰æ¥å£ä¸Šé¢çš„æ³¨è§£ï¼Œä¸ä¼šæ·»åŠ å®ƒè¿›å…¥ BeanDefiniiton ,ä¹Ÿå°±éš¾æ€ªæµ‹è¯•çš„æ—¶å€™ä¼šæŠ›å‡º NoSuchBeanDefinitionException çš„å¼‚å¸¸äº†ã€‚è€Œ MyBatis åˆ™ä¼šæŠŠè¿™äº›æ¥å£æ‹‰è¿‡æ¥æ³¨å†ŒBD ã€‚&lt;/p>
&lt;h4 id="å¯¹-beandefinition-çš„åŠ å·¥">
&lt;a href="#%e5%af%b9-beandefinition-%e7%9a%84%e5%8a%a0%e5%b7%a5">#&lt;/a>
å¯¹ BeanDefinition çš„åŠ å·¥
&lt;/h4>&lt;p>è¯»åˆ°è¿™é‡Œæˆ‘ä»¬å¯èƒ½æœ‰äº†æ›´å¤§çš„ç–‘é—®ï¼Œæ‹¿æ¥å£æ³¨å†Œ BeanDefinition ï¼Œé‚£è·å– Bean çš„æ—¶å€™å¦‚ä½•å»å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡å•Šï¼Ÿæ¥å£å¯æ˜¯ä¸èƒ½å®ä¾‹åŒ–å‡ºå¯¹è±¡çš„å•Šï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åšå®ç°ã€‚&lt;/p>
&lt;p>åŸæ¥æ˜¯ MyBatis çš„æ‰«æå™¨åœ¨è°ƒç”¨å®Œçˆ¶ç±»çš„æ‰«ææ–¹æ³•åï¼Œå¯¹ BeanDefinition è¿›è¡Œäº†åŠ å·¥ processBeanDefinitions() ã€‚å…¶ä¸­æœ€å…³é”®çš„ä¸¤è¡Œä»£ç æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">definition&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getConstructorArgumentValues&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">addGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">definition&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanClassName&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">definition&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setBeanClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">mapperFactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬å‘ç°æŠŠè¿™ä¸ª&lt;strong>æ¥å£çš„ç±»åå¡åˆ°äº†æ„é€ å™¨å‚æ•°ä¸­&lt;/strong>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>å°å½©è›‹ï¼Œè¿™é‡Œå¡çš„æ˜¯ String ï¼Œè€Œæˆ‘ä»¬çš„æ„é€ å™¨å‚æ•°å…¶å®è¦çš„æ˜¯ Class ã€‚ä½†æ˜¯ Spring çš„ ConstructorResolver.autowireConstructor ä¸­ç”¨åˆ°äº† Object[] argsToUse å»åšäº†ä¸ªè½¬æ¢ ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>ç¬¬äºŒè¡Œï¼ŒbeanDefinition çš„ &lt;strong>BeanClass è¢«è®¾ç½®æˆäº† MapperFactoryBean&lt;/strong> !&lt;/p>
&lt;p>ç†Ÿæ‚‰ Spring å’Œ MyBatis çš„è¯»è€…è‚¯å®šä¸€ä¸‹å°±æ˜ç™½äº†ï¼Œå°±æ˜¯è¿™ä¸ªåœ°æ–¹è¿›è¡Œäº†&amp;quot;å·æ¢æ¢æŸ±&amp;rdquo;ï¼&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UserDao&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userDao&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜æ˜¯æ‹¿ UserDao ä¸ºä¾‹ï¼Œæˆ‘ä»¬å‘ Spring å®¹å™¨è¯´ &amp;ldquo;ç»™æˆ‘æ¥ä¸ª UserDao çš„å®ä¾‹&amp;rdquo;ï¼Œè€Œ Spring æ ¹æ®æ³¨å†Œæ—¶å€™çš„ BeanDefinition ï¼Œå»å·¥å‚( &lt;strong>MapperFactoryBean&lt;/strong> )é‡Œé¢æ‰”äº†ä¸ª UserDao.class çš„å‚æ•°è¿›å»ï¼Œå·¥å‚çš„ getObject() æ–¹æ³•ç»™æˆ‘ä»¬è¿”å›äº†å®ƒåˆ¶é€ çš„ userDao ã€‚&lt;/p>
&lt;p>å°±è¿™æ ·ï¼Œæˆ‘ä»¬æ²¡æœ‰å»å†™å®ç°ç±»ï¼Œè½»è½»æ¾æ¾æ‹¿åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ userDao ã€‚&lt;/p>
&lt;p>è‡³äº &lt;strong>MapperFactoryBean&lt;/strong> é‡Œåšäº†ä»€ä¹ˆè¿”å›äº† userDao å‡ºæ¥ï¼Ÿå…¶å®å°±æ˜¯å®ƒçš„ getObject æ–¹æ³•è¿”å›çš„æ˜¯ DefaultSqlSession.getMapper(Class&lt;T> type)æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ MapperProxy ä»£ç†çš„ç±»ï¼Œè€Œè¿™ä¸ªä»£ç†ç±»çš„ invoke æ–¹æ³•å¹¶ä¸åƒæˆ‘ä»¬å¹³æ—¶è§åˆ°çš„ä»£ç†ä¸­çš„ invoke æ–¹æ³•ä¸€æ ·è°ƒç”¨åŸå§‹ç›®æ ‡çš„ method.invoke ï¼Œè€Œæ˜¯å»æ‰¾ MapperMethod æ‰§è¡Œäº†ã€‚&lt;/p>
&lt;h1 id="æ”¶è·">
&lt;a href="#%e6%94%b6%e8%8e%b7">#&lt;/a>
æ”¶è·
&lt;/h1>&lt;p>è¿™æ¬¡çš„æºç æ¢ç©¶ä¸‹æ¥ï¼Œæ”¶è·çš„ä¸ä»…ä»…æ˜¯äº†è§£äº† Dao å±‚ Bean çš„æ³¨å…¥ï¼Œæ›´æ˜¯ä¸²èµ·äº†æˆ‘ä»¬æœ€å¸¸ç”¨çš„ Spring å’Œ MyBatis ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æ‰“é€šäº†ä» Service å±‚åˆ° Dao å±‚ã€‚&lt;/p>
&lt;p>åœ¨ä»¥å¾€ Debug ä»£ç æ—¶çœ‹åˆ°çš„ MapperProxyï¼ŒMapperMethodï¼Œæˆ‘ä»¬æ¸…æ¥šäº†è¿™æ˜¯ä»ä½•è€Œæ¥ï¼Œä¹Ÿå¯¹ MyBatis ä¸­ä»£ç†çš„å·§å¦™è¿ç”¨æ›´åŠ ç†Ÿæ‚‰ã€‚&lt;/p>
&lt;h1 id="å‚è€ƒæ–‡çŒ®">
&lt;a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae">#&lt;/a>
å‚è€ƒæ–‡çŒ®
&lt;/h1>&lt;p>&lt;a class="link" href="https://blog.csdn.net/java280580332/article/details/72123890" target="_blank" rel="noopener"
>https://blog.csdn.net/java280580332/article/details/72123890&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/mingtian625/article/details/47684271" target="_blank" rel="noopener"
>https://blog.csdn.net/mingtian625/article/details/47684271&lt;/a>&lt;/p></description></item><item><title>è¿‘æœŸé˜…è¯»æºç çš„æ€»ç»“ä¸è½¬å˜</title><link>https://heeexy.com/p/recent-summary/</link><pubDate>Sun, 28 Jan 2018 19:11:29 +0800</pubDate><guid>https://heeexy.com/p/recent-summary/</guid><description>&lt;h2 id="é˜…è¯»æºç ">
&lt;a href="#%e9%98%85%e8%af%bb%e6%ba%90%e7%a0%81">#&lt;/a>
é˜…è¯»æºç 
&lt;/h2>&lt;h3 id="åˆè¯»-spring">
&lt;a href="#%e5%88%9d%e8%af%bb-spring">#&lt;/a>
åˆè¯» Spring
&lt;/h3>&lt;p>2017å¹´9æœˆå¼€å§‹é˜…è¯» Spring æºç ï¼Œä¾¿åœ¨åšå®¢ä¸Šè®°å½•è‡ªå·±çš„é˜…è¯»ç¬”è®°ï¼Œé˜…è¯»çš„è¿‡ç¨‹çœŸçš„æ˜¯æ¨ç—›è‹¦ï¼Œä¸€ä¸ªæœˆçš„æ—¶é—´ä¸¤å¤§ç« èŠ‚è¿˜æ²¡è¯»å®Œï¼Œæ•ˆæœä¸Šä¹Ÿä¸æ˜æ˜¾ã€‚&lt;/p>
&lt;p>åé¢å‡ ä¸ªæœˆå…¬å¸ä¸šåŠ¡ç¹å¿™æ›´æ˜¯åœä¸‹äº†è¯»æºç çš„èŠ‚å¥ã€‚&lt;/p>
&lt;h3 id="mybatis">
&lt;a href="#mybatis">#&lt;/a>
MyBatis
&lt;/h3>&lt;p>è€Œ12æœˆå…¥äº†ä¸€æœ¬ã€ŠMyBatis æŠ€æœ¯å†…å¹•ã€‹ï¼Œä»‹ç» MyBatis çš„ä¹¦ï¼Œæƒ³ä» MyBatis å…¥æ‰‹ï¼Œå¹¶ä¸”å¸¦ç€è‡ªå·±çš„å°é—®é¢˜å»ç ”ç©¶ MyBatis çš„æºç ï¼Œå»æ¢ç©¶ä¸€ä¸‹æˆ‘ç”¨ JSONObject ä¸ºä»€ä¹ˆå°±å¯ä»¥æ›¿ä»£ JavaBean ã€‚&lt;/p>
&lt;p>èŠ±äº†ä¸€ä¸ªæœˆçš„æ—¶é—´ä¾¿è¯»å®Œäº†ç¬¬ä¸€éä¹¦ï¼Œä¹Ÿå¤§è‡´è§£ç­”äº†è‡ªå·±çš„ç–‘æƒ‘ã€‚å‘ç°ç ”ç©¶èµ· MyBatis ç¡®å®æ˜¯è½»æ¾å¾ˆå¤šï¼Œæ€»ç»“ä¸€ä¸‹æœ‰ä»¥ä¸‹æ–¹é¢çš„åŸå› ï¼š&lt;/p>
&lt;ul>
&lt;li>MyBatis æºç é‡å°å¾ˆå¤šï¼Œå±‚æ¬¡ç»“æ„æ¸…æ™°ï¼ŒåŠŸèƒ½æ˜ç¡®ï¼Œç¡®å®æ¯” Spring è¦ç®€å•å¾ˆå¤š&lt;/li>
&lt;li>ä½œè€…åˆ’åˆ†ç« èŠ‚å±‚æ¬¡åˆé€‚&lt;/li>
&lt;li>å­¦ä¼šäº† Debug æºç &lt;/li>
&lt;li>æ‹¿èµ·äº†å®ä½“ä¹¦&amp;hellip;æ¯”9æœˆçœ‹ç”µå­ä¹¦æ—¶ç¡®å®æ–¹ä¾¿å¾ˆå¤š&lt;/li>
&lt;/ul>
&lt;p>ä¸€æœ¬ä¹¦èµ°å®Œä¸€éï¼Œæ„Ÿè§‰æ¸…æ¥šäº†å¾ˆå¤šï¼Œå¯¹äº MyBatis å‰©ä¸‹çš„ä»»åŠ¡ï¼Œå°±æ˜¯å†è¯»ä¸€éï¼Œç‰¹åˆ«æ˜¯å¸¦ç€é—®é¢˜å†è¯»ï¼Œæ¯”å¦‚å»ç ”ç©¶å®ƒçš„ç¼“å­˜ã€é…ç½®ã€åå°„ã€‚&lt;/p>
&lt;h3 id="å†è¯»-spring">
&lt;a href="#%e5%86%8d%e8%af%bb-spring">#&lt;/a>
å†è¯» Spring
&lt;/h3>&lt;p>1æœˆå†å›è¿‡å¤´ç»§ç»­å­¦ä¹  Spring ï¼Œå…¶å®æœ€å¤§çš„è½¬å˜å°±æ˜¯ï¼Œä¸å†æ‰§ç€äºè§åˆ°ä¸€æ®µä»£ç å°±æƒ³ä¸€ç›´é’»åˆ°åº•å¼„æ¸…æ¥šäº†ï¼ŒSpring çš„å±‚æ¬¡å¤ªæ·±ï¼Œç‰¹åˆ«å®¹æ˜“é’»ç€é’»ç€å°±æŠŠè‡ªå·±ç»•å¾—ä¸çŸ¥é“åœ¨å“ªäº†ã€‚å› æ­¤ï¼Œè¿˜æ˜¯æ ¹æ®ä¹¦æœ¬ä»‹ç»ï¼Œæ–‡æ¡£æ³¨é‡Šå’Œå‡½æ•°/å˜é‡åç§°å¤§æ¦‚äº†è§£å‡½æ•°çš„ä½œç”¨å…ˆï¼Œå¾…åˆ·å®Œä¸€éä¹‹åå†å›è¿‡å¤´äºŒåˆ·å†è¿½æ±‚ææ˜ç™½å§ã€‚&lt;/p>
&lt;h2 id="è½¬å˜">
&lt;a href="#%e8%bd%ac%e5%8f%98">#&lt;/a>
è½¬å˜
&lt;/h2>&lt;h3 id="åšå®¢">
&lt;a href="#%e5%8d%9a%e5%ae%a2">#&lt;/a>
åšå®¢
&lt;/h3>&lt;p>å…³äºåšå®¢çš„è®°å½•ï¼Œä¹Ÿè¦åšä¸€åšè½¬å˜äº†ã€‚èµ·åˆå†™å¾—ä¸œè¥¿åªæ˜¯ç¬”è®°ï¼Œæ¸æ¸åŠ å…¥äº†è‡ªå·±çš„ç†è§£ï¼Œä½†æ˜¯ç›®å‰æ¥çœ‹è´¨é‡è¿˜æ˜¯ä¸å¤Ÿï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› å°±æ˜¯è‡ªå·±å¯¹ä¸€äº›è¿˜æ²¡æœ‰æ·±åˆ»çš„è®¤è¯†ã€‚&lt;/p>
&lt;p>å‰é˜µå­æƒ³ç‹¬ç«‹é’»ç ”ä¸€æ³¢ Spring çš„ autowiredByTypeï¼Œå°±åŒ†åŒ†å¿™å¿™å¼€äº†ä¸€æ–‡ï¼Œç»“æœè¯»ç€è¯»ç€æ‰å‘ç°è¿™å‘æ·±ä¸è§åº•ï¼Œå®åœ¨ä¸è¯¥åœ¨ç¬¬ä¸€éæ—¶å°±å»ç¢°&amp;hellip;&lt;/p>
&lt;p>å› æ­¤ï¼Œè®¡åˆ’åšå®¢å‘æ›´æœ‰è¥å…»çš„æ–¹å‘å‘å±•ï¼Œå°½é‡è®©åšå®¢èƒ½è®°å½•ã€ä¼ æ’­ä¸€äº›èƒ½æå‡è‡ªå·±å’Œå…¶ä»–è¯»è€…è®¤è¯†çš„ä¸œè¥¿ã€‚åƒä¸Šä¸€æ–‡è‡ªå·±åŠ¨æ‰‹å®ç°è§£å†³å¾ªç¯ä¾èµ–å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¸»é¢˜ï¼Œè™½ç„¶æ–‡ç« å†™å¾—ä¸å¤Ÿå¥½ï¼ŒæŠ€æœ¯å«é‡ä¹Ÿä¸å¤Ÿé«˜ï¼Œä½†æ˜¯è‡³å°‘æ–¹å‘ä¸Šæ¥è¯´ç¡®å®èƒ½å­¦åˆ°æ–°ä¸œè¥¿ã€‚&lt;/p>
&lt;h3 id="å­¦ä¹ ">
&lt;a href="#%e5%ad%a6%e4%b9%a0">#&lt;/a>
å­¦ä¹ 
&lt;/h3>&lt;p>åšå®¢çš„æ›´æ–°é¢‘ç‡å°†ä¼šé™ä½ï¼Œä¸€æ–¹é¢æ˜¯è¦è‡ªå·±å…ˆå­¦é€ï¼Œæç¤ºåšæ–‡è´¨é‡ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿæ˜¯å…¶å®åé¢ä¸€æ®µæ—¶é—´å°†ä¼šå°†é‡å¿ƒæ”¾åœ¨æ‰¾å·¥ä½œä¸Šã€‚æ¯•ç«Ÿå¯¹äºæŠ€æœ¯é¢è¯•å’Œä»¥å‰çš„è€ƒè¯•å·®ä¸å¤šï¼Œç²¾è¯»æºç å®åœ¨æ˜¯æ€§ä»·æ¯”æœ‰ç‚¹ä½ï¼Œå…¨é¢å¤ä¹ å‡†å¤‡é¢è¯•é¢˜æ•ˆæœæ›´å¥½ã€‚è™½ç„¶æˆ‘æ˜¯ä¸å–œæ¬¢å‡†å¤‡é¢è¯•é¢˜çš„ï¼Œä½†æ²¡æœ‰åŠæ³•ï¼Œä¸‹ä¸€ä»½å·¥ä½œå¾ˆå…³é”®ï¼Œåªæœ‰æ‰¾åˆ°ç¨³å®šçš„ï¼Œèƒ½è¿½æ±‚æŠ€æœ¯çš„å›¢é˜Ÿï¼Œæ‰èƒ½æä¾›å®‰å¿ƒçš„é’»ç ”æŠ€æœ¯çš„ç¯å¢ƒã€‚&lt;/p></description></item><item><title>æç®€ Spring æ¡†æ¶ -- æµ…æå¾ªç¯ä¾èµ–</title><link>https://heeexy.com/p/ioc/</link><pubDate>Sun, 28 Jan 2018 13:37:32 +0800</pubDate><guid>https://heeexy.com/p/ioc/</guid><description>&lt;blockquote>
&lt;p>ä»ç½‘ä¸Šçœ‹åˆ°ä¸€ç¯‡åšæ–‡ &lt;a class="link" href="https://diaozxin007.github.io/2018/01/08/spring-ioc/" target="_blank" rel="noopener"
>å¾’æ‰‹æ’¸æ¡†æ¶&amp;ndash;å®ç°IoC&lt;/a> ï¼Œå†™å¾—å¾ˆæ£’ï¼Œä½œè€…æŠ›å¼€äº† Spring æºç ä¸­å¤æ‚çš„æ ¡éªŒï¼Œæ‹“å±•ç­‰åŠŸèƒ½ï¼Œå®ç°äº†ä¸€ä¸ªæç®€çš„ IoC æ¡†æ¶ï¼Œè®© Spring æºç åˆå­¦è€…å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ° IOC çš„å®ç°æµç¨‹ã€‚&lt;/p>
&lt;p>æœ¬æ–‡å°±å€Ÿå…¶æ¡†æ¶ï¼Œç•¥åŠ æ”¹é€ ï¼Œå†æ¬¡ä»‹ç»ä¸€ä¸‹ Spring æ˜¯å¦‚ä½•å¤„ç†å¾ªç¯ä¾èµ–çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>äº†è§£æœ¬é¡¹ç›®æ ¸å¿ƒä»£ç éœ€è¦å…ˆå‚è€ƒåŸä½œè€…çš„åšæ–‡ &lt;a class="link" href="https://diaozxin007.github.io/2018/01/08/spring-ioc/" target="_blank" rel="noopener"
>å¾’æ‰‹æ’¸æ¡†æ¶&amp;ndash;å®ç°IoC&lt;/a> ã€‚&lt;/p>
&lt;h3 id="å¾ªç¯ä¾èµ–">
&lt;a href="#%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96">#&lt;/a>
å¾ªç¯ä¾èµ–
&lt;/h3>&lt;p>å…¶å®å¾ˆå¥½ç†è§£ï¼ŒA ç±»ä¾èµ– Bï¼ŒB åˆä¾èµ– Aã€‚&lt;/p>
&lt;p>è¯´å…·ä½“ç‚¹å°±æ˜¯ ï¼Œæˆ‘ä»¬è¦ getBean(&amp;ldquo;a&amp;rdquo;)ï¼Œ A åœ¨å®ä¾‹åŒ–æ—¶éœ€è¦ä¸ºç±»å‹ä¸º B çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼Œå› æ­¤å» getBean(&amp;ldquo;b&amp;rdquo;)ï¼Œè€Œ getBean(&amp;ldquo;b&amp;rdquo;) çš„æ—¶å€™åˆéœ€è¦ä¸ºå…¶ç±»å‹ä¸ºA çš„æˆå‘˜å˜é‡èµ‹å€¼ï¼Œæ­¤æ—¶åˆä¼šå›è¿‡å¤´å»å®ä¾‹åŒ– A ï¼Œå¯¼è‡´æ— é™å¾ªç¯ã€‚&lt;/p>
&lt;p>ç”¨ä»£ç å±•ç¤ºå°±æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@AutoWired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@AutoWired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä»£ç æ”¹é€ ">
&lt;a href="#%e4%bb%a3%e7%a0%81%e6%94%b9%e9%80%a0">#&lt;/a>
ä»£ç æ”¹é€ 
&lt;/h3>&lt;p>æœ€ä¸»è¦çš„ä»£ç æ”¹é€ åœ¨äº BeanFactoryImpl å†…ï¼Œ æ·»åŠ äº†æˆå‘˜å˜é‡&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">earlySingletonObjects&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨äºç¼“å­˜æ­£åœ¨åˆ›å»ºä¸­çš„ï¼Œæå‰æš´éœ²å‡ºæ¥çš„å•ä¾‹ beanã€‚&lt;/p>
&lt;p>åœ¨è·å– bean æ—¶ï¼Œä¼šåœ¨åˆ›å»ºä¹‹å‰å…ˆä»æ­¤ Map ä¸­å°è¯•è·å–ï¼Œè€Œè¿™å°±æ˜¯è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ã€‚&lt;/p>
&lt;p>ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå°±æ˜¯ä¸€å¼€å§‹ getBean(&amp;ldquo;a&amp;rdquo;) æ—¶ï¼Œå°†æœªå®Œæˆçš„ a æ”¾å…¥ç¼“å­˜ï¼ŒgetBean(&amp;ldquo;b&amp;rdquo;) æ—¶ï¼Œéœ€è¦å»è·å– a ,ä¼šä»ç¼“å­˜ä¸­è·å–ï¼Œè€Œä¸æ˜¯å†å»å®ä¾‹åŒ– aã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/CyclicDependence.png"
loading="lazy"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æŸ¥æ‰¾å¯¹è±¡æ˜¯å¦å·²ç»å®ä¾‹åŒ–è¿‡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">earlyBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">earlyBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å¾ªç¯ä¾èµ–ï¼Œæå‰è¿”å›å°šæœªåŠ è½½å®Œæˆçš„bean:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">earlyBean&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ²¡æœ‰å®ä¾‹åŒ–ï¼Œé‚£å°±éœ€è¦è°ƒç”¨createBeanæ¥åˆ›å»ºå¯¹è±¡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefineMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">createBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¯¹è±¡åˆ›å»ºæˆåŠŸä»¥åï¼Œæ³¨å…¥å¯¹è±¡éœ€è¦çš„å‚æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">populatebean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å†å§å¯¹è±¡å­˜å…¥Mapä¸­æ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä»æ—©æœŸå•ä¾‹Mapä¸­ç§»é™¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç»“æŸè¿”å›&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="q--a">
&lt;a href="#q--a">#&lt;/a>
Q &amp;amp; A
&lt;/h3>&lt;p>Q: æ„é€ å™¨å¾ªç¯ä¾èµ–ä¸ºä»€ä¹ˆæ— æ³•è§£å†³ï¼Ÿ&lt;/p>
&lt;p>A: ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦åœ¨ createBean ä¹‹åï¼Œæ‰èƒ½å°†å…¶æ”¾å…¥ç¼“å­˜ï¼Œè€Œæ„é€ è¿‡ç¨‹æ˜¯åœ¨ createBean ä¹‹å†…çš„ï¼Œæ­¤æ—¶å°šæœªæ„é€ å¥½ä¸€ä¸ªåŸºæœ¬çš„ bean ,æ‹¿ä»€ä¹ˆæ”¾å…¥ç¼“å­˜å‘¢ï¼Ÿ&lt;/p>
&lt;h3 id="å¿ƒå¾—">
&lt;a href="#%e5%bf%83%e5%be%97">#&lt;/a>
å¿ƒå¾—
&lt;/h3>&lt;p>ä¸Šé¢åªè´´äº† getBean çš„ä»£ç ï¼Œä»…ä»…ä¿®æ”¹äº†åŸä½œè€…ä¸åˆ° 10 è¡Œä»£ç ï¼Œå…¶å®åœ¨ä¿®æ”¹åŸæ¡†æ¶ï¼Œå®ç°æˆ‘ä»¬è¦çš„åŠŸèƒ½æ—¶ä¸æ­¢è¿™ä¹ˆå¤šï¼ŒåŒ…æ‹¬è°ƒæ•´å¯¹ json çš„è§£æï¼Œå¯¹ bean çš„å¡«å……ç­‰ã€‚&lt;/p>
&lt;p>æ„Ÿå—åˆ° Spring æ¡†æ¶çœŸçš„æ˜¯å¾ˆå¤æ‚å¾ˆå…¨é¢ï¼Œè¿™å¤æ‚ç¨‹åº¦é è¯´æ˜¯è¯´ä¸æ¸…æ¥šçš„ï¼Œä¹Ÿä¸æ˜¯ç¿»ä¸€éä¹¦çœ‹çœ‹æºç å°±èƒ½æ˜ç™½çš„ã€‚è€Œä¸”çœ‹æºç å…¶å®è¿˜æ˜¯ä¼¼æ‡‚éæ‡‚ï¼Œä¸­é—´çš„ç»†èŠ‚è¿·è¿·ç³Šç³Šå°±å¯èƒ½è·³è¿‡å»äº†ã€‚&lt;/p>
&lt;p>åœ¨è¿½éš Spring è„šæ­¥ï¼Œå¤ç°å…¶ä»£ç çš„æ—¶å€™ï¼Œæ‰æ›´æ·±åˆ»çš„ç†è§£å…¶ä¸­å¾ˆå¤šæ“ä½œï¼Œå¾ˆå¤šç±»çš„ä½œç”¨ã€‚æ¯”å¦‚è¯´ BeanDefinition, BeanWrapper , PropertyDescriptor è¿™äº›ç±»åœ¨æˆ‘æƒ³è¦å®ç°ä¸€äº›åŠŸèƒ½çš„æ—¶å€™æ‰èƒ½ä½“ä¼šåˆ° Spring åˆ›é€ å®ƒä»¬çš„é‡è¦æ€§ã€‚&lt;/p></description></item><item><title>Spring æºç ç¬”è®°-2.8 æ ¹æ®ç±»å‹å¯»æ‰¾ bean--æ‰¾å‡ºæ‰€æœ‰åŒ¹é…ç±»å‹çš„ beanName</title><link>https://heeexy.com/p/beannamesfortypeincludingancestors/</link><pubDate>Wed, 24 Jan 2018 09:48:02 +0800</pubDate><guid>https://heeexy.com/p/beannamesfortypeincludingancestors/</guid><description>&lt;blockquote>
&lt;p>&lt;a class="link" href="https://heeexy.com/2018/01/23/findAutowireCandidates/" >å‰æ–‡&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="æºç è§£æ">
&lt;a href="#%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90">#&lt;/a>
æºç è§£æ
&lt;/h3>&lt;p>å…¥å‚è¯´æ˜&lt;/p>
&lt;ul>
&lt;li>includeNonSingletonsï¼šæ˜¯å¦åŒ…æ‹¬éå•ä¾‹çš„ beanï¼Œæ¯”å¦‚ prototype scope&lt;/li>
&lt;li>allowEagerInitï¼šä¸ºäº†è¿™ä¸ªæ£€æŸ¥ï¼ˆæ‰¾å‡ºæ‰€æœ‰åŒ¹é…ç±»å‹çš„ beanNameï¼‰ï¼Œæ˜¯å¦åˆå§‹åŒ– lazy-init å•ä¾‹å’Œç”± FactoryBeans åˆ›å»ºçš„å¯¹è±¡ã€‚æ­¤å¤„æˆ‘ä»¬ä¼ å…¥çš„å€¼ä¸º trueã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">beanNamesForTypeIncludingAncestors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ListableBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lbf&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">notNull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lbf&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ListableBeanFactory must not be null&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ–¹æ³•ä¸»å¹²è¿˜æ˜¯åœ¨è¿™è¡Œ getBeanNamesForType&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lbf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanNamesForType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¸‹é¢çš„å†…å®¹å°±æ˜¯ä» bf çš„ parent ä¸­æ‰¾ï¼Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lbf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HierarchicalBeanFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HierarchicalBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HierarchicalBeanFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lbf&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hbf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getParentBeanFactory&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ListableBeanFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ­¤å¤„ä»¥ parent å†æ¥è°ƒæ­¤æ–¹æ³•ï¼Œåˆå¹¶ç»“æœã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentResult&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanNamesForTypeIncludingAncestors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ListableBeanFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hbf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getParentBeanFactory&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultList&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">resultList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentResult&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">resultList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">hbf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsLocalBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">resultList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultList&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹æ¥æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­æ·±å…¥åˆ° &lt;code>getBeanNamesForType&lt;/code>ä¸­å»ä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getBeanNamesForType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//configurationFrozenï¼šåˆ¤æ–­æ‰€æœ‰ bean çš„ å®šä¹‰å…ƒæ•°æ®æ˜¯å¦å¯ä»¥è¢«ç¼“å­˜&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸èƒ½ç¼“å­˜ æˆ–æ²¡type æˆ–ä¸å…è®¸æ€¥åˆ‡åˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥æŸ¥ doGetBeanNamesForType&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">isConfigurationFrozen&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doGetBeanNamesForType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResolvableType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forRawClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦åˆ™å…ˆæŸ¥ç¼“å­˜ï¼Œæ²¡æœ‰ç¼“å­˜çš„è¯å†æŸ¥ doGetBeanNamesForType å¹¶å¡å…¥ç¼“å­˜&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">allBeanNamesByType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonBeanNamesByType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doGetBeanNamesForType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResolvableType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forRawClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆ¤æ–­æ˜¯å¦ç¼“å­˜å®‰å…¨ï¼šä¾æ®æˆ‘ä»¬ç›®æ ‡class å’Œå½“å‰beanFactoryçš„classLoaderæ˜¯å¦ä¸€è‡´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isCacheSafe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getBeanClassLoader&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedBeanNames&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†æ·±å…¥ä¸€å±‚åˆ° &lt;code>doGetBeanNamesForType&lt;/code> ï¼Œå…¶ä¸­é€»è¾‘å¤–å±‚æ˜¯éå†æ‰€æœ‰çš„ beanName, å¯¹äºä¸æ˜¯åˆ«åçš„è¿›è¡Œå¤„ç†ï¼Œå¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼ˆçœç•¥äº† try-catch ï¼‰ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//é¦–å…ˆè·å–è¿™ä¸ªbeanNameå¯¹åº”çš„mbdï¼Œå®ƒçš„ç›¸å…³å®šä¹‰é…ç½®ä¿¡æ¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">RootBeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getMergedLocalBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Only check bean definition if it is complete.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ä¸æ˜¯æŠ½è±¡çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// å¹¶ä¸” å…è®¸æ€¥åˆ‡åˆå§‹åŒ– æˆ– ï¼ˆæ­¤beanä¸éœ€è¦æ€¥åˆ‡åˆå§‹åŒ– ä¸”ï¼ˆæœ‰beanClass æˆ– ä¸æ˜¯lazyInit æˆ– å…è®¸æ€¥åˆ‡çš„ç±»åŠ è½½ï¼Œå³ä½¿æ˜¯æ‡’æƒ°çš„åˆå§‹åŒ–beanï¼‰ï¼‰&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAbstract&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasBeanClass&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isLazyInit&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isAllowEagerClassLoading&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">requiresEagerInitForType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getFactoryBeanName&lt;/span>&lt;span class="p">())))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// In case of FactoryBean, match object created by FactoryBean.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//åˆ¤æ–­æ˜¯å¦ FactoryBean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isFactoryBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isFactoryBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDecoratedDefinition&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ¥ä¸‹æ¥åˆæ˜¯ä¸€æ®µéå¸¸é•¿çš„é€»è¾‘åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦åŒ¹é…&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">matchFound&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">allowEagerInit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">isFactoryBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isLazyInit&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containsSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isSingleton&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">)))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">isTypeMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">matchFound&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isFactoryBean&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// In case of FactoryBean, try to match FactoryBean instance itself next.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å¦‚æœä¸åŒ¹é…ï¼Œè¿˜è¦è¯•è¯•åŒ¹é…FactoryBeanæœ¬èº«ï¼Œå› ä¸ºè¯´ä¸å¥½è¦çš„å°±æ˜¯è¿™ä¸ªFactoryBeanå‘¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FACTORY_BEAN_PREFIX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">matchFound&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isSingleton&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isTypeMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">matchFound&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ£€æŸ¥ä¸€éæ‰‹åŠ¨çš„å•ä¾‹é›†åˆ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å¯¹äº FactoryBean ,å¦‚æœåŒ¹é…åˆ°å®ƒçš„getObject()æ»¡è¶³ï¼Œå°±ä¸ä¼šç»§ç»­å»åŒ¹é…å®ƒæœ¬èº«&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">manualSingletonNames&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// In case of FactoryBean, match object created by FactoryBean.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">isFactoryBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">includeNonSingletons&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isTypeMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Match found for this bean: do not match FactoryBean itself anymore.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">continue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// In case of FactoryBean, try to match FactoryBean itself next.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FACTORY_BEAN_PREFIX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Match raw bean instance (might be raw FactoryBean).&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">isTypeMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‰ä¸€æ®µçš„è¶…é•¿çš„é€»è¾‘åˆ¤æ–­çœ‹å¾—äººå¤´ç–¼ï¼Œä½†æ˜¯å…ˆçœ‹ä¸‹åŠæ®µçš„éå†ï¼Œçªç„¶å°±æ‰¾åˆ°äº†æœ€å…³é”®åˆ¤æ–­ç±»å‹åŒ¹é…çš„å‡½æ•° &lt;code>isTypeMatch&lt;/code>ï¼Œä»åå­—å°±çœ‹å‡ºæ¥ï¼Œè¿™åº”è¯¥å°±æ˜¯åˆ¤æ–­ç±»å‹åŒ¹é…çš„åœ°æ–¹å•¦ã€‚&lt;/p>
&lt;p>ç„¶è€Œç‚¹è¿›å»ä¸€çœ‹ï¼Œå±…ç„¶æ˜¯é•¿è¾¾ 100 è¡Œçš„å‡½æ•°ã€‚&lt;/p>
&lt;h4 id="istypematch">
&lt;a href="#istypematch">#&lt;/a>
isTypeMatch
&lt;/h4>&lt;p>é¦–å…ˆä»å•ä¾‹ä¸­æŸ¥æ‰¾ï¼ŒåŒ¹é…è¿™ä¸ªå•ä¾‹ bean çš„ç±»å‹å’Œæˆ‘ä»¬ç›®æ ‡çš„ç±»å‹ï¼Œå…¶ä¸­å¯¹ factoryBean çš„å¤„ç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±ä¸å†è´´ä»£ç äº†ã€‚å¯¹äºæ³¨å†Œçš„ null instance ,ä¹Ÿè¿”å› falseã€‚&lt;/p>
&lt;p>å†ä»çˆ¶å·¥å‚æ‰¾ï¼Œé€’å½’ isTypeMatch ã€‚&lt;/p>
&lt;p>å†å°±æ˜¯å¤æ‚çš„æŸ¥æ‰¾äº†ã€‚&lt;/p>
&lt;p>å…ˆå®šä¹‰ä¸ª typesToMatch ï¼ŒåŒ…æ‹¬äº†ç›®æ ‡ç±»å‹å’Œ FactoryBean .&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å†ç»§ç»­çœ‹ä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Check decorated bean definition, if any: We assume it&amp;#39;ll be easier&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// to determine the decorated bean&amp;#39;s type than the proxy&amp;#39;s type.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// å…ˆæ£€æŸ¥ bean çš„è£…é¥°definitionã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDecoratedDefinition&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">BeanFactoryUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFactoryDereference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RootBeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getMergedBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanName&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanDefinition&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">targetClass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predictBeanType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanName&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typesToMatch&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">targetClass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">FactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">targetClass&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeToMatch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">targetClass&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// æ³¨æ„æ­¤å¤„predictBeanTypeè¿”å›äº†å¾ˆå…³é”®çš„Class ,æˆ‘ä»¬åé¢å†è¯¦ç»†åˆ†ææ­¤æ–¹æ³•ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predictBeanType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typesToMatch&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Check bean class whether we&amp;#39;re dealing with a FactoryBean.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ¥ä¸‹æ¥å°±æ˜¯å¤„ç† FactoryBean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">FactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">BeanFactoryUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFactoryDereference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// If it&amp;#39;s a FactoryBean, we want to look at what it creates, not the factory class.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getTypeForFactoryBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeanFactoryUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFactoryDereference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Special case: A SmartInstantiationAwareBeanPostProcessor returned a non-FactoryBean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// type but we nevertheless are being asked to dereference a FactoryBean...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Let&amp;#39;s check the original bean class and proceed with it if it is a FactoryBean.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">predictBeanType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">FactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å¯¹å…¶ resolvableType è¿›è¡Œå¤„ç†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ResolvableType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">targetType&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">factoryMethodReturnType&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resolve&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeToMatch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvableType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰å¤„ç†æ‰çš„è¯ï¼Œ åˆ™åˆ¤è¯»typeToMatchå’Œ beanType &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeToMatch&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ€»ç»“ï¼š&lt;/p>
&lt;p>ç›®å‰å¾ˆé—æ†¾ isTypeMatch å¾€ä¸‹è¿˜æœ‰å¾ˆå¤æ‚çš„é€»è¾‘æš‚æ—¶ä¸èƒ½çœ‹æ‡‚ï¼Œä½†æ˜¯ä»å¤–å±‚çš„é€»è¾‘å¤§è‡´çŸ¥é“å¯»æ‰¾æ‰€æœ‰åŒ¹é…çš„beanName çš„æ–¹æ³•éå¸¸çš„â€œå¤æ‚ç²—æš´â€ã€‚éå† beanDefinitionNames å·²å®šä¹‰çš„æ‰€æœ‰ beanï¼Œå³ä½¿æ˜¯ä¸€ä¸ªå°å‹çš„é¡¹ç›®ä¹Ÿæœ‰è¿‘200ä¸ª bean éœ€è¦éå†ï¼Œå¹¶ä¸”è¿™æ•°ç™¾ä¸ª beanName è¿˜è¦éå†éå¸¸å¤šæ¬¡ã€‚&lt;/p>
&lt;p>åªèƒ½è¯´æ ¹æ® type å¯»æ‰¾ bean å®åœ¨æ˜¯æ¯”æ ¹æ® name å¤æ‚äº†å¤ªå¤šå¤ªå¤šï¼Œä»æºç çœ‹çœŸæ˜¯æ·±å‘ï¼Œç†è§£äº†ä¸ºä»€ä¹ˆä½œè€…ç›´æ¥å¿½ç•¥äº†è¿™éƒ¨åˆ†&amp;hellip;åº”è¯¥æ˜¯ç¬¬äºŒéæˆ–ç¬¬ä¸‰éé˜…è¯» Spring æºç æ—¶æ‰èƒ½ç†è§£ã€‚&lt;/p></description></item><item><title>Spring æºç ç¬”è®°-2.7 æ ¹æ®ç±»å‹å¯»æ‰¾ bean</title><link>https://heeexy.com/p/findautowirecandidates/</link><pubDate>Tue, 23 Jan 2018 09:00:22 +0800</pubDate><guid>https://heeexy.com/p/findautowirecandidates/</guid><description>&lt;h2 id="å‰è¨€">
&lt;a href="#%e5%89%8d%e8%a8%80">#&lt;/a>
å‰è¨€
&lt;/h2>&lt;p>Spring è£…é… bean æœ‰ä¸¤ç§ç±»å‹ï¼š&lt;code>autowireByName&lt;/code> å’Œ &lt;code>autowireByType&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;code>autowireByName&lt;/code> é€šè¿‡åç§°æŸ¥æ‰¾å¾ˆç›´æ¥ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸€ç›´åœ¨å­¦çš„ getBean() ã€‚&lt;/p>
&lt;p>è€Œ &lt;code>autowireByType&lt;/code> æ ¹æ®ç±»å‹æŸ¥æ‰¾ç›¸æ¯”èµ·æ¥å°±è¦å¤æ‚ä¸€äº›äº†ï¼Œã€Š Spring æºç æ·±åº¦è§£æ ã€‹ ä¸­æœ‰ä»‹ç»è¿‡çš„éƒ¨åˆ†æˆ‘å°±ä¸å†é‡å¤è´´äº†ï¼Œä½†æ˜¯ä¹¦ä¸­é—æ¼äº†ä¸€å¤„é‡è¦çš„éƒ¨åˆ†&amp;mdash;&amp;mdash; &lt;strong>findAutowireCandidates æŸ¥æ‰¾æ‰€æœ‰åˆé€‚çš„ bean&lt;/strong>ï¼Œè¿˜æœ‰ä¸€å¤„æ–°ç‰ˆæœ¬ Spring ä¸­å‡çº§çš„éƒ¨åˆ†&amp;mdash;&amp;mdash;&lt;strong>å¦‚æœåªéœ€è¦ä¸€ä¸ªä½†æ˜¯æ‰¾å‡ºå¤šä¸ª bean è¯¥æ€ä¹ˆå¤„ç†&lt;/strong>ï¼Œä»Šå¤©æˆ‘ä»¬å…ˆæ¥å­¦ä¹ ç¬¬ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;h2 id="æ­£æ–‡">
&lt;a href="#%e6%ad%a3%e6%96%87">#&lt;/a>
æ­£æ–‡
&lt;/h2>&lt;h3 id="æœ¬å‡½æ•°è¦åšä»€ä¹ˆ">
&lt;a href="#%e6%9c%ac%e5%87%bd%e6%95%b0%e8%a6%81%e5%81%9a%e4%bb%80%e4%b9%88">#&lt;/a>
æœ¬å‡½æ•°è¦åšä»€ä¹ˆ
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@RequestMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/article&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ArticleController&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArticleService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">articleService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨åˆå§‹åŒ– ArticleController çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦ä¸ºå…¶è£…é… ArticleService ã€‚&lt;/p>
&lt;p>å¿½ç•¥æ‰å¤–é¢ä»£ç ä¸€å±‚ä¸€å±‚çš„åŒ…è£¹ä¹‹åï¼Œæˆ‘ä»¬èµ°åˆ° &lt;code>DefaultListableBeanFactory.findAutowireCandidates&lt;/code> è¿™ä¸ªå‡½æ•°ä¸­ï¼Œè¦å¯»æ‰¾åˆé€‚çš„å€™é€‰ bean ã€‚ç”±äºå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªï¼Œå› æ­¤è¿”å›ç»“æœæ˜¯å€™é€‰ bean çš„åç§°å’Œå…¶å¯¹åº”å®ä¾‹æ„æˆçš„ Map ã€‚&lt;/p>
&lt;h3 id="æºç è§£æ">
&lt;a href="#%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90">#&lt;/a>
æºç è§£æ
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ä¾æ¬¡æ˜¯ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// æ­£åœ¨è§£æçš„ beanName, æœ¬ä¾‹ä¸­å³ &amp;#34;articleController&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// éœ€è¦è£…é…çš„ bean ç±»å‹, æœ¬ä¾‹ä¸­å³ ArticleService.class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// å¯¹å½“å‰ä¾èµ–å…³ç³»çš„è§£æç±»ï¼Œè®°å½•äº† ArticleController å’Œ ArticleService çš„ä¾èµ–å…³ç³»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">findAutowireCandidates&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">DependencyDescriptor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç¬¬ä¸€æ­¥å°±æ˜¯æŸ¥æ‰¾å‡ºæ‰€æœ‰ç¬¦åˆç±»å‹çš„ beanName ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¼¼ä¹ç¬¬ä¸€å¥å°±å¹²å®Œå…¨éƒ¨é€»è¾‘äº†ï¼Ÿï¼Ÿï¼Ÿç¨åæˆ‘ä»¬å†è¯¦ç»†åˆ†æè¿™ä¸ªæ–¹æ³•ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidateNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanFactoryUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanNamesForTypeIncludingAncestors&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEager&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedHashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">candidateNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * resolvableDependencies è®°å½•äº† ä¾èµ–ç±»å‹--å…·ä½“è£…é…å€¼ çš„æ˜ å°„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * éå† resolvableDependenciesã€‚å¦‚æœè¯¥ç±»å‹æ˜¯æˆ‘ä»¬éœ€è¦çš„ç±»å‹ï¼ˆArticleServiceï¼‰ï¼Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> *
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">autowiringType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resolvableDependencies&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">keySet&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">autowiringType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resolvableDependencies&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">autowiringType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//keyå€¼æ˜¯æˆ‘ä»¬éœ€è¦çš„ç±»å‹ï¼Œä½†valueå€¼æœªå¿…ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//valueå¯èƒ½æ˜¯ObjectFactoryï¼Œå°±å¾—è°ƒç”¨å®ƒçš„ getObject() æ¥è·å–çœŸæ­£çš„bean.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AutowireUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resolveAutowiringValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœç±»å‹åŒ¹é…ï¼Œåˆ™å¡å…¥result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ObjectUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">identityToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">autowiringValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidateNames&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸æ˜¯è‡ªå·±ä¾èµ–è‡ªå·± ï¼Œ å¹¶ä¸”ç¬¦åˆè£…é…å€™é€‰ï¼Œå°±å¡å…¥resultã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä½•ä¸ºç¬¦åˆè£…é…å€™é€‰ï¼ˆisAutowireCandidateï¼‰å‘¢ï¼Ÿç¨åæˆ‘ä»¬å†è¯¦ç»†åˆ†æã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">isSelfReference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isAutowireCandidate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">addCandidateEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">indicatesMultipleBeans&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Consider fallback matches if the first pass failed to find anything...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¹‹å‰ä¸€è½®éƒ½æ²¡æ‰¾åˆ°ï¼Œåˆ™è€ƒè™‘å›é€€åŒ¹é…ï¼Œä»€ä¹ˆæ˜¯å›é€€åŒ¹é…ï¼Ÿç¨åå†åˆ†æã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">DependencyDescriptor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fallbackDescriptor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forFallbackMatch&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidateNames&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">isSelfReference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isAutowireCandidate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fallbackDescriptor&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å†æ‰§è¡Œä¸€éä¸Šé¢çš„æ–¹æ³•ã€‚å¦‚æœä¸æ˜¯è‡ªå·±ä¾èµ–è‡ªå·±ï¼Œå¹¶ä¸”ç¬¦åˆè£…é…å€™é€‰ï¼Œå°±å¡å…¥resultã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">addCandidateEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// Consider self references as a final pass...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// but in the case of a dependency collection, not the very same bean itself.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// å¦‚æœä¾ç„¶æ²¡æ‰¾åˆ°ç»“æœï¼Œé‚£ä¹ˆæ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„ä¹Ÿæ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 1.æ˜¯è‡ªå¼•ç”¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 2.ä¾èµ–ä¸æ˜¯å¤šå…ƒç´ ä¾èµ– æˆ–è€… beanåå’Œå€™é€‰è€…åå­—ä¸ç›¸ç­‰ï¼ˆè¿™é‡Œå°±é¿å…äº†è‡ªå¼•ç”¨å¯¼è‡´æ— é™å¾ªç¯ï¼‰&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// 3.å€™é€‰è€…ç¬¦åˆå›é€€åŒ¹é…ä¹‹åçš„è£…é…å€™é€‰&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidateNames&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">isSelfReference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MultiElementDescriptor&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">isAutowireCandidate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fallbackDescriptor&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">addCandidateEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">candidate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">descriptor&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹å®Œä¸»å¹²è‡ªç„¶è¿˜æ˜¯æœ‰ç‚¹è¿·ç³Šï¼Œæˆ‘ä»¬ç•™ä¸‹äº†ä¸‰ä¸ªé—®é¢˜è¦ç»§ç»­ç ”ç©¶ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://heeexy.com/2018/01/24/beanNamesForTypeIncludingAncestors/" >å¦‚ä½•æŸ¥æ‰¾å‡ºæ‰€æœ‰ç¬¦åˆç±»å‹çš„ beanName&lt;/a>&lt;/li>
&lt;li>ä»€ä¹ˆæ˜¯ç¬¦åˆè£…é…å€™é€‰&lt;/li>
&lt;li>ä»€ä¹ˆæ˜¯å›é€€åŒ¹é…&lt;/li>
&lt;/ul></description></item><item><title>Spring æºç ç¬”è®°-2.6 BeanWrapper å¯¹æ¯” MyBatis</title><link>https://heeexy.com/p/beanwrapper/</link><pubDate>Fri, 19 Jan 2018 15:21:58 +0800</pubDate><guid>https://heeexy.com/p/beanwrapper/</guid><description>&lt;h2 id="spring-vs-mybatis">
&lt;a href="#spring-vs-mybatis">#&lt;/a>
Spring vs MyBatis
&lt;/h2>&lt;p>Spring å’Œ MyBatis ä¸­éƒ½æœ‰ BeanWrapper , Spring ä¸­ä¸ºæ¥å£ï¼Œ å®ç°ç±»ä¸º BeanWrapperImpl , ä¸ºäº†æ–¹ä¾¿åé¢åŒºåˆ†ï¼Œæœ¬æ–‡ç”¨ SB æŒ‡ä»£ Spring çš„ BeanWrapperImpl ï¼Œç”¨ MB æŒ‡ä»£ MyBatis ä¸­çš„ BeanWrapperã€‚&lt;/p>
&lt;h2 id="åŠŸèƒ½">
&lt;a href="#%e5%8a%9f%e8%83%bd">#&lt;/a>
åŠŸèƒ½
&lt;/h2>&lt;p>BeanWrapper éƒ½å±äºå„è‡ªæ¡†æ¶çš„&lt;strong>åå°„å·¥å…·ç®±&lt;/strong>çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚éƒ½æ˜¯åˆ›å»ºå®ä¾‹å¹¶ä¸”ä¸ºå…¶å±æ€§èµ‹å€¼çš„ã€‚ä»¥ SB ä¸ºä¾‹ï¼Œä¸‹é¢çš„ä»£ç åº”è¯¥å¾ˆå®¹æ˜“çœ‹æ˜ç™½å®ƒçš„åŠŸèƒ½ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">BeanWrapper&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">company&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanWrapperImpl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Company&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// setting the company name..&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">company&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setPropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Some Company Inc.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ... can also be done like this:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">PropertyValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Some Company Inc.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">company&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setPropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ok, let&amp;#39;s create the director and tie it to the company:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">BeanWrapper&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jim&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanWrapperImpl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Employee&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">jim&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setPropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Jim Stravinsky&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">company&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setPropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;managingDirector&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jim&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getWrappedInstance&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// retrieving the salary of the managingDirector through the company&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Float&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">salary&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Float&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">company&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getPropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;managingDirector.salary&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å…±åŒç‚¹">
&lt;a href="#%e5%85%b1%e5%90%8c%e7%82%b9">#&lt;/a>
å…±åŒç‚¹
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>æ ¸å¿ƒåŠŸèƒ½&lt;/strong>åŠŸèƒ½åŸºæœ¬ç›¸åŒ&lt;/li>
&lt;li>å¯¹è¦ç”Ÿæˆçš„ç±»çš„è¦æ±‚è§„èŒƒä¹Ÿç›¸åŒï¼Œæœ‰ get set æ–¹æ³•ã€‚&lt;/li>
&lt;li>å®ƒä»¬çš„&lt;strong>åº•å±‚&lt;/strong>ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç§˜å¯†ï¼Œå½’æ ¹åˆ°åº•éƒ½æ˜¯ä½¿ç”¨ &lt;code>java.lang.reflect&lt;/code> åŒ…ä¸‹çš„ Constructor , Method ç­‰ç­‰å·¥å…·ã€‚&lt;/li>
&lt;/ol>
&lt;h2 id="ä¸åŒç‚¹">
&lt;a href="#%e4%b8%8d%e5%90%8c%e7%82%b9">#&lt;/a>
ä¸åŒç‚¹
&lt;/h2>&lt;p>å¯èƒ½æ˜¯æˆ‘åˆšå¼€å§‹ç ”ç©¶ SB çš„åŸå› ï¼Œæ„Ÿè§‰ SB æºç æ›´åŠ å¤æ‚ï¼Œç»“æ„ä¹Ÿæ²¡é‚£ä¹ˆæ¸…æ¥šï¼Œå…³è”äº†å‘ä¸‹å±‚çº§çš„å·¥å…·ç±»ï¼Œå¾ˆé•¿å¾ˆé•¿ä¸€æ®µçš„æºç ã€‚ &lt;a class="link" href="http://blog.csdn.net/zhiweianran/article/details/7919129" target="_blank" rel="noopener"
>è¿™ç¯‡åšæ–‡&lt;/a> åˆ†æäº†å…¶ä¸­ä¸€éƒ¨åˆ†ã€‚&lt;/p>
&lt;p>å¾—ç›Šäºå·²ç»å­¦ä¹ è¿‡ç»“æ„æ›´ä¸ºæ¸…æ™°çš„ MBï¼Œå°½ç®¡ SB æºç å¤æ‚ï¼Œä½†æ˜¯è¯»çš„æ—¶å€™ä¸å†ä¼šææƒ§ï¼Œå› ä¸ºç®€ç•¥çš„Debug ä¸€éå°±çŸ¥é“å®ƒåº•å±‚è¿˜æ˜¯è°ƒ getter/setter çš„åå°„ã€‚å†å¤æ‚çš„ç»“æ„ä¹Ÿç¦»ä¸å¼€è¿™æœ€ç»ˆçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>å·²ç›®å‰å¯¹ SB ç²—æµ…çš„äº†è§£æ¥è¯´ï¼Œæ„Ÿå—åˆ°æœ€å¤§çš„åŒºåˆ«å°±æ˜¯åœ¨å·¥å…·ç®±ä¸­çš„&lt;strong>ç»“æ„åœ°ä½ä¸åŒ&lt;/strong>ã€‚&lt;/p>
&lt;p>MB å±äº&lt;code>BaseWrapper&lt;/code> çš„å­ç±»ä¹‹ä¸€ï¼ŒåŒçº§åˆ«çš„è¿˜æœ‰ MapWrapper ï¼Œä¸Šçº§è¿˜æœ‰ CollectionWrapper ã€‚&lt;/p>
&lt;p>è€Œ SB å°±å·²ç»æ˜¯åœ¨åˆ›å»º Bean æ—¶ç›´æ¥ä½¿ç”¨åˆ°çš„æ¥å£äº†ã€‚&lt;/p>
&lt;p>åƒ&lt;strong>è§£æåµŒå¥—å‚æ•°å&lt;/strong> (æ¯”å¦‚ user.name / address.city.mailcode)ï¼Œ&lt;strong>ç±»å‹è½¬æ¢&lt;/strong>è¿™äº›äº‹æƒ…ï¼ŒSB éƒ½èƒ½å¤„ç†å®Œã€‚è€Œ MB éƒ½æ˜¯å…ˆè¦ä½¿ç”¨å…¶å®ƒå·¥å…·ç±»å¤„ç†ï¼Œæ¯”å¦‚ä¾é  PropertyTokenizer ã€‚&lt;/p>
&lt;p>æ€»è€Œè¨€ä¹‹ï¼ŒSB å°±æ˜¯å¯¹å¤–çš„ä¸€ä¸ªå¤§æ¥å£ï¼ŒåŒ…å«å¾ˆå¤šåŠŸèƒ½ï¼ŒMB åˆ™æ˜¯MyBatis åå°„å·¥å…·ç®±å†…çš„ä¸€ä¸ªå°çš„å·¥å…·å®ç°ã€‚&lt;/p></description></item><item><title>Springæºç ç¬”è®°-2.5 createBean</title><link>https://heeexy.com/p/createbean/</link><pubDate>Thu, 18 Jan 2018 14:22:06 +0800</pubDate><guid>https://heeexy.com/p/createbean/</guid><description>&lt;p>æ­¤æ–¹æ³•äº¤ç»™äº† &lt;code>AbstractBeanFactory&lt;/code> çš„å­ç±» &lt;code>AbstractAutowireCapableBeanFactory&lt;/code> å»å®ç°ã€‚&lt;/p>
&lt;p>å¹¶ä¸”ä¸ç®¡è¿™ä¸ªbeanæ˜¯å•ä¾‹è¿˜æ˜¯ prototype è¿˜æ˜¯å…¶å®ƒ scope ,æœ€ç»ˆéƒ½æ˜¯ä¼šèµ°åˆ°æ­¤å¤„ï¼Œåªæ˜¯å‰åçš„ä¸€äº›éªŒè¯ã€å¤„ç†æœ‰åŒºåˆ«ã€‚æ¯”å¦‚å•ä¾‹çš„å°±è¦å…ˆå»ç¼“å­˜ä¸­è·å–ï¼Œprototype å°±ä¸éœ€è¦ã€‚&lt;/p>
&lt;p>æºç é˜…è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»ä¹ æƒ¯äº†ä¸€å±‚ä¸€å±‚å‰¥ã€‚createBean ä¾ç„¶è¿˜æ˜¯æ²¡æœ‰ç›´æ¥åœ°æŠŠ bean åˆ›å»ºå‡ºæ¥ï¼ˆå½“ç„¶æˆ‘æ‰€æœŸæœ›çš„çœ‹åˆ°åˆ›å»º bean å°±æ˜¯çœ‹åˆ°å®ƒçš„åå°„æºç ä¸ºæ­¢ï¼‰ã€‚&lt;/p>
&lt;p>createBean çš„å¤§è‡´æ­¥éª¤ä¸º:&lt;/p>
&lt;ol>
&lt;li>æ ¹æ® RootBeanDefinition æ¥è·å–è¦åˆ›å»º bean çš„ class ã€‚è¿™ class è¿˜æœ‰å¯èƒ½ä¸º nullã€‚&lt;/li>
&lt;li>prepareMethodOverrides ã€‚å‡†å¤‡ override æ–¹æ³•ï¼Œå¯¹ override å±æ€§è¿›è¡ŒéªŒè¯ã€‚&lt;/li>
&lt;li>ç»™åå¤„ç†å™¨ä¸€ä¸ªæœºä¼šæ¥è¿”å›ä»£ç†ï¼Œæ›¿ä»£çœŸæ­£çš„ bean.&lt;/li>
&lt;li>doCreateBean åˆ›å»ºçœŸæ­£çš„ bean å®ä¾‹ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="preparemethodoverrides">
&lt;a href="#preparemethodoverrides">#&lt;/a>
prepareMethodOverrides
&lt;/h3>&lt;p>é¦–å…ˆå»æ¸©ä¹ ä¸€é lookup-method å’Œ replace-method å§ã€‚&lt;a class="link" href="http://blog.csdn.net/qq_22912803/article/details/52503914" target="_blank" rel="noopener"
>åšæ–‡&lt;/a>&lt;/p>
&lt;p>å…¶å®å°±æ˜¯é€šè¿‡é…ç½®æŠŠåŸæœ¬ bean ä¸­çš„æŸä¸ªæ–¹æ³•ç»™æ›¿ä»£æ‰ã€‚&lt;/p>
&lt;p>æ­¤å¤„æˆ‘ä»¬å…ˆåªæ˜¯ç¡®è®¤ä¸€éæŒ‡å®šçš„æ›¿ä»£æ–¹æ³•å­˜åœ¨äºè¦ç”Ÿæˆçš„ bean ä¸­ã€‚&lt;/p>
&lt;p>é¡ºå¸¦çœ‹ä¸€çœ‹è¿™ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰é‡è½½overload)ï¼Œåšä¸ªæ ‡è®°ã€‚&lt;/p>
&lt;h3 id="resolvebeforeinstantiation">
&lt;a href="#resolvebeforeinstantiation">#&lt;/a>
resolveBeforeInstantiation
&lt;/h3>&lt;p>ç»è¿‡ä¸€æ³¢é¢„å¤„ç†å™¨&lt;code>InstantiationAwareBeanPostProcessor&lt;/code> ï¼Œå¦‚æœç”Ÿäº§å‡ºäº† beanï¼Œå†ç»è¿‡ä¸€æ³¢åå¤„ç†å™¨ã€‚&lt;/p>
&lt;p>ä¸€æ—¦ç”Ÿäº§å‡º beanï¼Œåˆ™ç«‹å³å°†æ­¤ bean è¿”å›ã€‚&lt;/p>
&lt;p>æ­¤å¤„å°±æ˜¯ç•™ä¸‹äº†ä¸€ä¸ªæ‹“å±•ç‚¹ï¼Œç»è¿‡æ­¤æ–¹æ³•ä¹‹åï¼Œbeanå¯èƒ½å·²ç»ä¸æ˜¯æˆ‘ä»¬è®¤ä¸ºçš„ bean äº†ï¼Œè€Œå¯èƒ½å·²ç»å˜æˆäº†ä¸€ä¸ªç»è¿‡å¤„ç†çš„ä»£ç† bean ã€‚&lt;/p>
&lt;h1 id="å¾ªç¯ä¾èµ–">
&lt;a href="#%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96">#&lt;/a>
å¾ªç¯ä¾èµ–
&lt;/h1>&lt;h4 id="æ„é€ å™¨å¾ªç¯ä¾èµ–">
&lt;a href="#%e6%9e%84%e9%80%a0%e5%99%a8%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96">#&lt;/a>
æ„é€ å™¨å¾ªç¯ä¾èµ–
&lt;/h4>&lt;p>å¦‚æœæ˜¯ prototypeï¼Œæ— æ³•è§£å†³ï¼Œåªèƒ½æŠ›é”™ã€‚&lt;/p>
&lt;p>ä»£ç åœ¨ &lt;code>AbstractBeanFactory&lt;/code> : 256 &lt;code>doGetBean()&lt;/code> ã€‚&lt;/p>
&lt;p>å½“åˆ›å»º bean æ—¶ï¼Œé¦–å…ˆå»â€œå½“å‰åˆ›å»º bean æ± â€æŸ¥æ‰¾æ˜¯å¦å½“å‰ bean æ­£åœ¨åˆ›å»ºï¼Œå¦‚æœå‘ç°å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºå¾ªç¯ä¾èµ–äº†ã€‚æŠ›å‡º BeanCurrentlyInCreationExcetion ã€‚&lt;/p>
&lt;p>å½“å‰åˆ›å»º bean æ± ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prototypesCurrentlyInCreation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NamedThreadLocal&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Prototype beans currently in creation&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="setter-å¾ªç¯ä¾èµ–">
&lt;a href="#setter-%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96">#&lt;/a>
setter å¾ªç¯ä¾èµ–
&lt;/h4>&lt;p>åªèƒ½è§£å†³å•ä¾‹çš„æƒ…å†µã€‚&lt;/p>
&lt;p>åœ¨åˆ›å»ºå•ä¾‹ bean æ—¶ï¼Œæå‰æš´éœ²åˆšå®Œæˆæ„é€ å™¨ä½†æœªå®Œæˆå…¶ä»–æ­¥éª¤ï¼ˆå¦‚ setter æ³¨å…¥ï¼‰çš„ bean ã€‚&lt;/p>
&lt;p>é€šè¿‡æå‰æš´éœ²è¿™ä¸ªå•ä¾‹å·¥å‚æ–¹æ³•ï¼Œä»è€Œä½¿å…¶ä»– bean èƒ½å¤Ÿå¼•ç”¨åˆ°æ­¤ beanã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">earlySingletonExposure&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Eagerly caching bean &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; to allow for resolving potential circular references&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">addSingletonFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObject&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯ æ—©æœŸå¼•ç”¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getEarlyBeanReference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addSingletonFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">notNull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Singleton factory must not be null&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å•ä¾‹å·¥å‚æ³¨å†Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonFactories&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ—©æœŸå•ä¾‹ç§»å‡º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨å†Œå•ä¾‹åŠ å…¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registeredSingletons&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç®€å•åœ°è®°ä¸€ä¸‹è¿™é‡Œè§£å†³æ­¥éª¤ï¼š&lt;/p>
&lt;p>testA å…ˆåˆ›å»ºï¼Œå¹¶ä¸”æš´éœ²ä¸€ä¸ªå·¥å‚å‡ºå»ï¼Œè¿›è¡Œ setter æ³¨å…¥ testB.&lt;/p>
&lt;p>testB åˆ›å»ºï¼Œå¹¶ä¸”æš´éœ²ä¸€ä¸ªå·¥å‚ï¼Œè¿›è¡Œ setter æ³¨å…¥ testA.&lt;/p>
&lt;p>åœ¨è¿™é‡Œæƒ³ç”¨ testA æ—¶ï¼Œ&lt;strong>ç”±äºå‘ç°æå‰æš´éœ²çš„å·¥å‚ï¼Œä»è€Œåœ¨æ­¤å¤„èµ°äº†å¦ä¸€æ¡è·¯&lt;/strong>ï¼Œä½¿ç”¨æ­¤å·¥å‚æ¥åˆ›å»º testA ,åœ¨æ­¤å¤„è§£å†³äº†å¾ªç¯é—®é¢˜ã€‚&lt;/p>
&lt;p>å†è¿”å›å›å»ç»§ç»­å®Œæˆ testA çš„ setter æ³¨å…¥ã€‚&lt;/p></description></item><item><title>MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(äºŒ)TypeHandlerRegistry</title><link>https://heeexy.com/p/typehandlerregistry/</link><pubDate>Thu, 04 Jan 2018 21:22:33 +0800</pubDate><guid>https://heeexy.com/p/typehandlerregistry/</guid><description>&lt;h1 id="é—®é¢˜">
&lt;a href="#%e9%97%ae%e9%a2%98">#&lt;/a>
é—®é¢˜
&lt;/h1>&lt;p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²åˆ°ï¼Œå¯¹äºæœªçŸ¥æ•°æ®ç±»å‹çš„è§£æï¼ŒUnknownTypeHandler æŠŠéƒ¨åˆ†ä»»åŠ¡äº¤ç»™äº† TypeHandlerRegistry ,ç”šè‡³å¯èƒ½ä»…ä»…åªä¸¢äº†ä¸€ä¸ª javaType è¿‡æ¥å°±è¦æ±‚è¿”å›ä¸€ä¸ªåˆé€‚çš„è§£æå™¨å›å» ã€‚TypeHandlerRegistry åˆ°åº•é‡Œé¢åšäº†å•¥å¯ä»¥æ‰¾åˆ°åˆé€‚çš„è§£æå™¨å‘¢ï¼Ÿ&lt;/p>
&lt;h1 id="åŠŸèƒ½">
&lt;a href="#%e5%8a%9f%e8%83%bd">#&lt;/a>
åŠŸèƒ½
&lt;/h1>&lt;p>ä»ç±»çš„åå­—æˆ‘ä»¬å°±çŸ¥é“è¿™ä¸ªç±»çš„åŠŸèƒ½å¤§æ¦‚å°±æ˜¯ä¸ªæ³¨å†Œè¡¨ï¼Œè€Œä¸”å¾ˆå¯èƒ½æ˜¯å…¨å±€å…±ç”¨çš„ï¼Œè®°å½•å„ç§ javaType,jdbcType,TypeHandler çš„æ˜ å°„å…³ç³»ã€‚å®é™…è¿™ä¸ªç±»çš„æ ¸å¿ƒä¹Ÿå°±æ˜¯ç»´æŠ¤äº†å‡ ä¸ª map ã€‚&lt;/p>
&lt;h1 id="æ ¸å¿ƒå­—æ®µ">
&lt;a href="#%e6%a0%b8%e5%bf%83%e5%ad%97%e6%ae%b5">#&lt;/a>
æ ¸å¿ƒå­—æ®µ
&lt;/h1>&lt;h3 id="jdbc_type_handler_map">
&lt;a href="#jdbc_type_handler_map">#&lt;/a>
JDBC_TYPE_HANDLER_MAP
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JDBC_TYPE_HANDLER_MAP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EnumMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªå¾ˆç›´è§‚ï¼Œå°±æ˜¯æ³¨å†Œ jdbcType å’Œè§£æå™¨çš„å¯¹åº”å…³ç³»ã€‚&lt;/p>
&lt;h3 id="type_handler_map">
&lt;a href="#type_handler_map">#&lt;/a>
TYPE_HANDLER_MAP
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TYPE_HANDLER_MAP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹¦ä¸ŠåŸæ–‡æ˜¯ï¼šâ€œè®°å½•äº† java ç±»å‹å‘æŒ‡å®šçš„ JdbcType è½¬æ¢æ—¶ï¼Œéœ€è¦ä½¿ç”¨çš„ TypeHandler å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šJava ç±»å‹ä¸­çš„ String è½¬æ¢æˆæ•°æ®åº“çš„ char ã€varchar ç­‰å¤šç§ç±»å‹ï¼Œæ‰€ä»¥å­˜åœ¨ä¸€å¯¹å¤šå…³ç³»â€ã€‚&lt;/p>
&lt;p>Type æ˜¯ java.lang.reflect åŒ…ä¸‹çš„æ¥å£ï¼ŒClass ç±»å®ç°äº†æ­¤æ¥å£ã€‚æ‰€ä»¥æ­¤ map çš„ key å€¼æ˜¯ javaType ,æ¯”å¦‚ String.class ã€‚&lt;/p>
&lt;h3 id="unknown_type_handler">
&lt;a href="#unknown_type_handler">#&lt;/a>
UNKNOWN_TYPE_HANDLER
&lt;/h3>&lt;p>å°±æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« å­¦ä¹ è¿‡çš„ UnknownTypeHandler çš„å®ä¾‹ï¼Œä¸»è¦ç”¨åœ¨ Object.class å’Œ JdbcType.OTHER ä¸Šã€‚&lt;/p>
&lt;h3 id="all_type_handlers_map">
&lt;a href="#all_type_handlers_map">#&lt;/a>
ALL_TYPE_HANDLERS_MAP
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ALL_TYPE_HANDLERS_MAP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>key æ˜¯è§£æå™¨çš„ class ,value æ˜¯è§£æå™¨è‡ªèº«ã€‚&lt;/p>
&lt;p>è®°å½•äº†å…¨éƒ¨çš„è§£æå™¨çš„ç±»å‹åŠè¯¥ç±»å‹ç›¸å¯¹åº”çš„ TypeHandler å¯¹è±¡ã€‚&lt;/p>
&lt;h3 id="null_type_handler_map">
&lt;a href="#null_type_handler_map">#&lt;/a>
NULL_TYPE_HANDLER_MAP
&lt;/h3>&lt;p>ä»…ä»…æ˜¯ä¸€ä¸ªç©º TypeHandler é›†åˆçš„æ ‡è¯†ã€‚å› ä¸º TYPE_HANDLER_MAP æ˜¯ConcurrentHashMap, ä¸èƒ½å¡ null å€¼ï¼Œå› æ­¤åœ¨éœ€è¦çš„åœ°æ–¹ä»¥æ­¤ç©ºæ ‡è¯†ä½œä¸º value æ›¿ä»£nullå¡å…¥ã€‚&lt;/p>
&lt;h1 id="æ³¨å†Œ">
&lt;a href="#%e6%b3%a8%e5%86%8c">#&lt;/a>
æ³¨å†Œ
&lt;/h1>&lt;p>åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œå°±è°ƒç”¨äº†å¤§é‡çš„ register(&amp;hellip;) çš„æ–¹æ³•ï¼Œæ³¨å†Œäº†å¾ˆå¤šæ˜ å°„å…³ç³»ã€‚&lt;/p>
&lt;p>register æœ‰å¾ˆå¤šé‡è½½æ–¹æ³•ï¼Œé™¤äº†ç®€å•çš„å‘ JDBC_TYPE_HANDLER_MAP æ³¨å†Œä¹‹å¤–ï¼Œå…¨éƒ½æœ€ç»ˆæŒ‡å‘äº†ä¸‹é¢çš„é‡è½½æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TYPE_HANDLER_MAP&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TYPE_HANDLER_MAP&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">map&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ALL_TYPE_HANDLERS_MAP&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–¹æ³•å¹¶ä¸å¤æ‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£çš„æ˜¯è¿™é‡Œä¸ºä¸¤ä¸ª map ä¸­éƒ½å¡å…¥äº†å€¼ï¼Œä¸€ä¸ªæ˜¯ key ä¸º javaType çš„ map , ä¹Ÿå°±æ˜¯ String ä¸ char/varchar çš„ä¸€å¯¹å¤šçš„å…³ç³»ã€‚å¦ä¸€ä¸ªåˆ™æ˜¯è®°å½•å…¨éƒ¨ handler çš„mapã€‚&lt;/p>
&lt;p>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«ç•™æ„çš„å°±æ˜¯ï¼Œæ¯”å¦‚ String ç±»ï¼Œé™¤äº†æ˜ å°„ char/varchar ä¹‹å¤–ï¼Œè¿˜&lt;strong>æ˜ å°„ null&lt;/strong> ï¼Œå¯¹åº”çš„è§£æå™¨ä¹Ÿæ˜¯ StringTypeHandler ã€‚&lt;/p>
&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/registerString.png"
loading="lazy"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//è¿™ä¸€è¡Œå°±æ˜¯javaTypeä¸ºString.class jdbcType ä¸ºnull çš„è§£æå™¨æ³¨å†Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringTypeHandler&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//è¿™æ˜¯æ™®é€šçš„æ³¨å†Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">CHAR&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringTypeHandler&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="æŸ¥æ‰¾-typehandler">
&lt;a href="#%e6%9f%a5%e6%89%be-typehandler">#&lt;/a>
æŸ¥æ‰¾ TypeHandler
&lt;/h1>&lt;p>ç»ˆäºåˆ°äº†æŸ¥æ‰¾ TypeHandler çš„éƒ¨åˆ†äº†ï¼Œçœ‹äº†è¿™ä¹ˆä¹…ï¼Œæ˜¯ä¸æ˜¯å·®ç‚¹æ™•å¾—éƒ½å¿˜äº†æˆ‘ä»¬çš„è¿™ä¸ªæ³¨å†Œè¡¨æœ€æ ¸å¿ƒçš„åŠŸèƒ½åœ¨è¿™å‘¢ï¼Ÿ&lt;/p>
&lt;p>æ ¹æ® jdbcType å’Œ typeHandler çš„class æŸ¥æ‰¾è§£æå™¨çš„åŠŸèƒ½éƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸Šé¢çš„ JDBC_TYPE_HANDLER_MAP å’Œ ALL_TYPE_HANDLERS_MAP ä¸­å–å€¼ã€‚&lt;/p>
&lt;p>å…³é”®çš„åœ¨äºæ ¹æ® javaType å¯»æ‰¾è§£æå™¨ã€‚è€Œä¸”æˆ‘ä»¬çš„åœ¨ä¸Šä¸€ç¯‡ä¹Ÿè®²åˆ°äº† PreparedStatement åœ¨èµ‹å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ²¡æœ‰æä¾› jdbcType ( null ), ä»…ä»…åªæœ‰ javaType ã€‚&lt;/p>
&lt;p>getTypeHandler å…¶å®å°±æ˜¯ä» TYPE_HANDLER_MAP å–å€¼.æˆ‘ä»¬å…¥å‚ç±»å‹ä¸º String ä¸ºä¾‹æ¥çœ‹çœ‹å…¶æŸ¥æ‰¾è§£æå™¨çš„è¿‡ç¨‹ ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//é¦–å…ˆæ ¹æ® String.class æŸ¥æ‰¾å…¶ä¸€å¯¹å¤šçš„è§£æå™¨é›†åˆ.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcHandlerMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getJdbcHandlerMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcHandlerMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç„¶åæ ¹æ®å…¶æŒ‡å®šçš„ jdbcType æ¥æ‰¾å¯¹åº”çš„è§£æå™¨ã€‚è€Œæ­¤å¤„æˆ‘ä»¬çš„ jdbcType æ˜¯null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä½†æ˜¯åœ¨æ³¨å†Œçš„æ—¶å€™æˆ‘ä»¬ç•™æ„è¿‡ï¼Œå¯¹äº null ,åŒæ ·ä¹Ÿè¿›è¡Œäº†æ³¨å†Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°±ç›¸å½“äºæ˜¯ç»™äº†ä¸ªé»˜è®¤çš„è§£æå™¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcHandlerMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcHandlerMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pickSoleHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcHandlerMap&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="æ€»ç»“">
&lt;a href="#%e6%80%bb%e7%bb%93">#&lt;/a>
æ€»ç»“
&lt;/h1>&lt;p>ç›®å‰æˆ‘ä»¬å·²ç»æ¥è§¦è¿‡äº†ä¸¤ç§æ–¹å¼å¯¹æ˜ç¡®æŒ‡æ˜çš„ javaType çš„è½¬æ¢ã€‚ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼š&lt;/p>
&lt;h3 id="objecttypehandler">
&lt;a href="#objecttypehandler">#&lt;/a>
ObjectTypeHandler
&lt;/h3>&lt;p>è¿™ä¸ªä¸»è¦ä¾é  JDBC åº•å±‚çš„æ–¹æ³•æ¥æŸ¥æ‰¾åˆé€‚çš„ javaType ï¼Œå¤§é‡çš„ switch-case è¯­å¥ã€‚ä¸»è¦ç”¨åœ¨å°†è¿”å›å€¼çš„å°è£…åˆ° JSONObject ä¸­ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">switch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">field&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSQLType&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">TINYINT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">field&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isUnsigned&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getByte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">SMALLINT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">getInt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="typehandlerregistry">
&lt;a href="#typehandlerregistry">#&lt;/a>
TypeHandlerRegistry
&lt;/h3>&lt;p>æ³¨å†Œè¡¨åŠŸèƒ½ï¼Œå°†å¸¸è§„çš„æ•°åç§å…³ç³»æ˜ å°„åœ¨åˆå§‹åŒ–æ—¶å°±éƒ½æ³¨å†Œå¥½ï¼Œä¹Ÿå°±æ˜¯æå‰å­˜å…¥ map ä¸­ï¼Œéœ€è¦çš„æ—¶å€™å» map ä¸­å–ã€‚&lt;/p>
&lt;p>å°¤å…¶æ˜¯å°† javaType å’Œ TypeHandler å…³è”èµ·æ¥ï¼Œå¹¶å¯¹ä¸€äº›ç±»å‹æ³¨å†Œäº†é»˜è®¤çš„è§£æå™¨ï¼Œå³ jdbcType æœªæŒ‡æ˜æ—¶æ‰€è¦é‡‡ç”¨çš„è§£æå™¨ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ›´å¤šæ˜¯ç”¨åœ¨ PreparedStatement å…¥å‚çš„èµ‹å€¼æ—¶ã€‚&lt;/p></description></item><item><title>MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(ä¸€)TypeHandler</title><link>https://heeexy.com/p/typehandler/</link><pubDate>Tue, 02 Jan 2018 22:35:52 +0800</pubDate><guid>https://heeexy.com/p/typehandler/</guid><description>&lt;h1 id="é—®é¢˜">
&lt;a href="#%e9%97%ae%e9%a2%98">#&lt;/a>
é—®é¢˜
&lt;/h1>&lt;p>å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JSONObject æ›¿ä»£ä¹ æƒ¯ä½¿ç”¨çš„ JavaBean ï¼Œè€Œä¹‹æ‰€ä»¥èƒ½ç”¨ JSONObject ä¸»è¦å°±æ˜¯å› ä¸ºå®ƒå®ç°äº† &lt;code>Map&amp;lt;String,Object&amp;gt;&lt;/code> ã€‚&lt;/p>
&lt;p>å®é™…ä½¿ç”¨æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒMyBatis ä½¿ç”¨JSONObject å°è£…è¿”å›ç»“æœçš„æ—¶å€™å¾ˆâ€œæ™ºèƒ½â€ï¼Œæ•°æ®åº“é‡Œå­—æ®µæ˜¯ varchar ç±»å‹ï¼ŒJSONObject ä¸­è¿”å›å€¼å°±æ˜¯ String ç±»å‹ï¼Œæ•°æ®åº“å­—æ®µæ˜¯ int/float ç±»å‹ï¼ŒJSONObject ä¸­è¿”å›å€¼å°±æ˜¯å¯¹åº”çš„æ•°å€¼ç±»å‹ã€‚ç”šè‡³é€šè¿‡ debug å‘ç°æ•°æ®åº“ä¸­ä¿å­˜äº†datetime ç±»å‹çš„æ•°æ®ï¼ŒJSONObject ä¸­ä¿å­˜çš„æ˜¯ &lt;code>java.sql.timestamp&lt;/code> ç±»å‹ï¼Œè€Œ&lt;code>timestamp&lt;/code> ç±»å‹ç»§æ‰¿äº†å¸¸è§çš„ &lt;code>java.util.Date&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/DataType.png"
loading="lazy"
>&lt;/p>
&lt;p>ä¸ºä»€ä¹ˆ MyBatis å¯ä»¥ç”¨å¾—è¿™ä¹ˆçˆ½å‘¢ï¼Ÿæˆ‘ä»¬å®ç°å¯å®Œå…¨æ²¡å£°æ˜éœ€è¦æ­¤å­—æ®µçš„ javaType å‘¢ã€‚è€Œä¸”ç”¨å¾—çˆ½äº†ï¼Œç±»å‹è½¬æ¢ä¼šä¸ä¼šå¯¼è‡´ç¨‹åºæ€§èƒ½å¤§æ‰“æŠ˜æ‰£å‘¢ï¼Ÿ&lt;/p>
&lt;p>ä»Šå¤©æˆ‘ä»¬å°±ä»æ·±å…¥æºç ï¼Œæ¢ç©¶ä¸€ç•ª MyBatis åˆ°åº•æ˜¯æ€æ ·åšåˆ°å¯¹æœªæ˜ç¡®å£°æ˜çš„å­—æ®µå¤„ç†è¿”å›ç±»å‹çš„ã€‚&lt;/p>
&lt;h1 id="typehandler">
&lt;a href="#typehandler">#&lt;/a>
TypeHandler
&lt;/h1>&lt;p>MyBatis ç±»å‹è½¬æ¢çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªæ¥å£ï¼Œå®šä¹‰çš„æ–¹æ³•å¯ä»¥çœ‹åšå°±ä¸¤ç§ setParameter å’Œ getResult ,å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¼ å‚å’Œæ¥æ”¶ sql ç»“æœæ—¶å°±è°ƒç”¨è¿™ä¸ªã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setParameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PreparedStatement&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ps&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CallableStatement&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">cs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æŠ½è±¡ç±» BaseTypeHandler éƒ¨åˆ†å®ç°äº† TypeHandler ,ä¸»è¦å®Œæˆäº†å¯¹ç©ºå€¼çš„å¤„ç†ã€‚ éç©ºå€¼çš„å¤„ç†å…¨éƒ¨äº¤ç»™äº†å­ç±»å®Œæˆã€‚&lt;/p>
&lt;p>BaseTypeHandler å­ç±»éå¸¸å¤šï¼Œå¯¹åº”äº†æ•°æ®åº“çš„å„ç§æ•°æ®ç±»å‹ï¼Œå®ç°éƒ½å¾ˆç®€å•ï¼Œæ¯”å¦‚&lt;code>SqlTimestampTypeHandler&lt;/code> å¤„ç† Timestamp ç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setNonNullParameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PreparedStatement&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ps&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Timestamp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ps&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setTimestamp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Timestamp&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getNullableResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTimestamp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>éƒ½æ˜¯ç›´æ¥è°ƒç”¨äº† PreparedStatement å’Œ ResultSet å¤„ç†ç›¸åº”ç±»å‹å­—æ®µçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>å¾ˆæ˜æ˜¾ï¼Œä¸€æ—¦æŒ‡æ˜äº†æˆ‘ä»¬éœ€è¦ MyBatis ç»™æˆ‘ä»¬è¿”å›çš„æ­¤å­—æ®µç±»å‹ï¼ŒMyBatis è‚¯å®šå°±å»æ‰¾åˆ°å¯¹åº”çš„ TypeHandler å®ç°ç±»å»å¤„ç†ã€‚è€Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šè¿”å›ç±»å‹çš„æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå¯¹äº Object ç±»å‹æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ&lt;/p>
&lt;h1 id="objecttypehandler">
&lt;a href="#objecttypehandler">#&lt;/a>
ObjectTypeHandler
&lt;/h1>&lt;p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œçœ‹åå­—å°±ä¼šçŒœå¯èƒ½ä¼°è®¡æœªçŸ¥ç±»å‹å…¨é å®ƒäº†å§ã€‚æå‰é¢„å‘Šä¸‹ï¼Œå¹¶ä¸æ˜¯å“¦ï¼ŒgetNullableResult è¿˜ç®—ç»å¸¸ä½¿ç”¨ï¼Œå…¥å‚èµ‹å€¼å°±æ²¡è§ç”¨äº†ï¼Œæ¯•ç«Ÿå…¥å‚çš„ JavaType æˆ‘ä»¬é€šè¿‡åå°„è¿˜æ˜¯å¯ä»¥æ‰¾åˆ°çš„ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setNonNullParameter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PreparedStatement&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ps&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ps&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getNullableResult&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultSet&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸€çœ‹è¿™å®ç°ï¼Œå±…ç„¶è¿˜æ˜¯è°ƒç”¨çš„ JDBC åº•å±‚çš„å¯¹åº”æ–¹æ³•ã€‚äº‹å®ä¸Š &lt;code>com.mysql.jdbc&lt;/code> åœ¨å¤„ç†&lt;code>Object&lt;/code> ç±»å‹æ˜¯ä¹Ÿæ˜¯é€šè¿‡å¤§é‡çš„ if-else æˆ– switch-case æ¥æ‰¾åˆ°æœ¬æ•°æ®çœŸæ­£çš„ç±»å‹çš„ã€‚å…¥å‚ç»‘å®šä¾æ® parameterObj instanceof å„ç§ç±»å‹ï¼Œè¿”å›ç»“æœç±»å‹ä¾æ® field.getSQLType çš„å„ç§ç±»å‹ã€‚&lt;/p>
&lt;h1 id="unknowntypehandler">
&lt;a href="#unknowntypehandler">#&lt;/a>
UnknownTypeHandler
&lt;/h1>&lt;p>äº‹å®ä¸Šï¼ŒMyBatis åœ¨å¾ˆå¤šæˆ‘ä»¬æ²¡æœ‰æŒ‡æ˜å‚æ•°ç±»å‹çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ UnknownTypeHandler æ¥è§£å†³ç±»å‹è½¬æ¢çš„ã€‚UnknownTypeHandler ä¸­çš„æ ¸å¿ƒ&lt;code>resolveTypeHandler&lt;/code> æ–¹æ³•ï¼Œå°±æ˜¯æŸ¥æ‰¾å¯¹åº”æ•°æ®çš„ç±»å‹è§£æå™¨ï¼ˆTypeHandler) ï¼Œ å†ç”¨è¿™ä¸ªåˆé€‚çš„ typeHandler è¿›è¡Œè§£æã€‚&lt;/p>
&lt;p>&lt;code>resolveTypeHandler&lt;/code> æ–¹æ³•çš„é‡è½½æœ‰3ç§ï¼Œä¸»è¦çš„ä¸¤ç§å°±æ˜¯ä¸€ç§å¤„ç†å…¥å‚çš„ï¼Œä¸€ç§å¤„ç†è¿”å›ç»“æœçš„ã€‚&lt;/p>
&lt;h3 id="å…¥å‚ç±»å‹è§£æ">
&lt;a href="#%e5%85%a5%e5%8f%82%e7%b1%bb%e5%9e%8b%e8%a7%a3%e6%9e%90">#&lt;/a>
å…¥å‚ç±»å‹è§£æ
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">resolveTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OBJECT_TYPE_HANDLER&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeHandlerRegistry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// check if handler is null (issue #270)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UnknownTypeHandler&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">OBJECT_TYPE_HANDLER&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨å…¥å‚ä¸º null æˆ–è€…å®åœ¨æ‰¾ä¸åˆ°è§£æå™¨çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šè¿”å›æˆ‘ä»¬ä¸Šé¢è®²çš„ ObjectTypeHandler ã€‚&lt;/p>
&lt;p>è€Œè¿™é‡Œé¢å…³é”®çš„æ–¹æ³•å°±æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">typeHandlerRegistry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parameter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>typeHandlerRegistry å¯ä»¥ç†è§£ä¸ºå…¨å±€å…±ç”¨çš„å„ç§ç±»å‹ä¸è§£æå™¨å…³ç³»çš„æ³¨å†Œè¡¨ï¼Œåé¢çš„æ–‡ç« è¿˜ä¼šç»§ç»­æ·±å…¥è®²è§£ï¼Œæˆ‘ä»¬é¦–å…ˆæ³¨æ„è¿™ä¸ªæ–¹æ³•çš„å…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ‹¿åˆ°äº†å‚æ•°çš„ class , ç¬¬äºŒä¸ªå‚æ•°æ‹¿åˆ°äº† jdbcType ã€‚è¿™ä¸å°±ç›¸å½“äºjavaType å’Œ jdbcType éƒ½æœ‰äº†å—ï¼Ÿé‚£å³ä½¿è¿˜æ²¡ç ”ç©¶ typeHandlerRegistry åˆ°åº•å¹²äº†å•¥ï¼Œä½†æ˜¯æ¡ä»¶ç»™çš„è¿™ä¹ˆå……åˆ†äº†ï¼Œæ³¨å†Œè¡¨çš„ä»»åŠ¡ä¹Ÿå¤ªè½»æ¾äº†å§ï¼&lt;/p>
&lt;p>ç­‰ç­‰ï¼Œæˆ‘ä»¬çš„ DAO å±‚ç»™å…¥å‚æ˜¯ JSONObject ç±»å‹,é‡Œé¢ username å­—æ®µæ˜¯ String ç±»å‹ï¼Œmoney å­—æ®µæ˜¯ float ç±»å‹ï¼Œè¿™äº›éƒ½èƒ½é€šè¿‡ getClass() è·å–åˆ°ç¡®å®æ²¡æ¯›ç—…ã€‚ä½†æ˜¯ jdbcType æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨å¯æ˜¯åœ¨å¤„ç† PreparedStatement å‘¢ï¼&lt;/p>
&lt;p>é€šè¿‡ debug æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œçš„ jdbcType æˆ‘ä»¬æ²¡æœ‰æŒ‡æ˜çš„æƒ…å†µä¸‹ï¼Œç¡®å®éƒ½æ˜¯ null ã€‚è¯´æ˜ typeHandlerRegistry é‡Œä»…ä»…æ˜¯é€šè¿‡ javaType æ¥å¯»æ‰¾è§£æå™¨çš„ã€‚æ‰€ä»¥ typeHandlerRegistry è¿˜æ˜¯æœ‰å¾ˆå¤šé—¨é“ç­‰ç€æˆ‘ä»¬å»æ¢ç´¢å“¦ã€‚&lt;/p>
&lt;h3 id="è¿”å›ç»“æœç±»å‹è§£æ">
&lt;a href="#%e8%bf%94%e5%9b%9e%e7%bb%93%e6%9e%9c%e7%b1%bb%e5%9e%8b%e8%a7%a3%e6%9e%90">#&lt;/a>
è¿”å›ç»“æœç±»å‹è§£æ
&lt;/h3>&lt;p>å¯¹ ResultSet çš„è§£ææœ‰ä¸¤ç§æ–¹å¼ï¼Œé¦–å…ˆæŸ¥çœ‹æ­¤ç»“æœå­—æ®µ&amp;ndash;æ¯”å¦‚nickname&amp;ndash;åœ¨ field ä¸­çš„åºå·ï¼Œå¦‚æœæ²¡åºå·ï¼Œåˆ™ç›´æ¥è¿”å› ObjectTypeHandler ã€‚å¦‚æœæœ‰åºå·ï¼Œåˆ™è¿›å…¥ä¸‹é¢çš„æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolveTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultSetMetaData&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">TypeHandler&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é€šè¿‡ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•è·å–åˆ°jdbcTypeå’ŒjavaType&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">safeGetJdbcTypeForColumn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">safeGetClassForColumn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åé¢çš„ä»»åŠ¡å°±è¿˜æ˜¯äº¤ç»™äº†typeHandlerRegistry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeHandlerRegistry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeHandlerRegistry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeHandlerRegistry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jdbcType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­çš„å…³é”®æ–¹æ³•è¿˜æ˜¯ä» rsmd ä¸­è·å– jdbcType å’Œ javaType ï¼Œç„¶åå†é€šè¿‡ typeHandlerRegistry å»æŸ¥æ‰¾å¯¹åº”çš„ handler ã€‚&lt;/p>
&lt;p>debug å‘ç°å‡ ä¹æ¯æ¬¡ä» rsmd ä¸­è·å– jdbcType å’Œ javaType éƒ½è·å–åˆ°äº†ï¼Œçœ‹æ¥ç„æœºéƒ½åœ¨&lt;code>safeGetJdbcTypeForColumn&lt;/code> å’Œ &lt;code>safeGetClassForColumn&lt;/code> ä¸­äº†ã€‚&lt;/p>
&lt;p>ä¸¤ä¸ªæ–¹æ³•çš„å…³é”®ä»£ç åˆ†åˆ«å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forCode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getColumnType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Resources&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">classForName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getColumnClassName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columnIndex&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="jdbctype">
&lt;a href="#jdbctype">#&lt;/a>
JdbcType
&lt;/h4>&lt;p>&lt;code>com.mysql.jdbc.ResultSetMetaData&lt;/code> å®ç°äº† &lt;code>java.sql.ResultSetMetaData &lt;/code> æ¥å£ï¼Œæ­¤å¤„æˆ‘ä»¬è°ƒç”¨äº†å…¶ä¸­çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getColumnType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getSQLType&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åºå·çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œæ ¹æ®åºå·æ‰¾åˆ°æ­¤ field ,å†æ‰¾å…¶ SQLType ï¼Œæ ¹æ® SQLType å»JdbcType ç±» (enumç±»å‹) å†…æŸ¥æ‰¾å¯¹åº”çš„ jdbcTypeã€‚&lt;/p>
&lt;p>JdbcType ç±»å†…ç»´æŠ¤äº†ä¸€ä¸ª map ç±»å‹é™æ€å˜é‡ codeLookup ï¼Œç±»åŠ è½½æ—¶ä¸º codeLookup æ·»åŠ äº†39ä¸ªå…ƒç´ ï¼Œkey å€¼å…¶å®å°±æ˜¯ SQLType ï¼Œ int ç±»å‹ï¼Œvalue å°±æ˜¯æœ¬ jdbcType ã€‚&lt;/p>
&lt;p>å› æ­¤æ ¹æ® SQLType åœ¨æ­¤å¤„å°±ç›´æ¥èƒ½æ¯«ä¸è´¹åŠ›åœ°æ‰¾å‡ºå¯¹åº”çš„ jdbcTypeã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JdbcType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">values&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">codeLookup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">TYPE_CODE&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="javatype">
&lt;a href="#javatype">#&lt;/a>
javaType
&lt;/h4>&lt;p>åŒæ ·éœ€è¦å…ˆæ‰¾åˆ° SQLType ï¼Œä»¥åŠfield å†…çš„å¦å¤–å‡ ä¸ªå±æ€§å€¼ï¼Œä¾‹å¦‚ isUnsigned ç­‰ä¸€èµ·è¿›å…¥ getClassNameForJavaType æ–¹æ³•æ‰¾åˆ°å¯¹åº”ç±»åã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getClassNameForJavaType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isUnsigned&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mysqlTypeIfKnown&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isBinaryOrBlob&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isOpaqueBinary&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">treatYearAsDate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">switch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">javaType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">BIT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">BOOLEAN&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;java.lang.Boolean&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Types&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">TINYINT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">isUnsigned&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;java.lang.Integer&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;java.lang.Integer&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//......å¤§é‡ case&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">default&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;java.lang.Object&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è€Œè¿™é‡Œçš„å¤§é‡çš„ swtich-case ç»ˆäºç®—æ˜¯è§£é™¤äº†æˆ‘ä»¬ä¸€éƒ¨åˆ†çš„ç–‘æƒ‘äº†ï¼åº•å±‚ç»ˆå½’è¿˜æ˜¯é€šè¿‡ swtich-case è¿™ç§æœ€åŸå§‹çš„æ“ä½œæ¥æŠŠ jdbcType æ˜ å°„åˆ° java ç±»é‡Œå»çš„ï¼&lt;/p>
&lt;h4 id="å¥‡æ€ªçš„ç°è±¡">
&lt;a href="#%e5%a5%87%e6%80%aa%e7%9a%84%e7%8e%b0%e8%b1%a1">#&lt;/a>
å¥‡æ€ªçš„ç°è±¡
&lt;/h4>&lt;p>ä¸Šé¢è¯´åˆ°ï¼Œå¦‚æœæ²¡åºå·ï¼Œåˆ™ç›´æ¥è¿”å› ObjectTypeHandlerã€‚&lt;/p>
&lt;p>åºå·æ˜¯&lt;code>getColumnType(int column)&lt;/code> ç”¨äºæ‰¾åˆ°åˆ°å¯¹åº”çš„ field çš„å…³é”®å±æ€§ã€‚&lt;/p>
&lt;p>é‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰å¯èƒ½ä¼šæ²¡æœ‰åºå·å‘¢ï¼Ÿ&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/debug-fields.png"
loading="lazy"
>&lt;/p>
&lt;p>é€šè¿‡ debug æˆ‘ä»¬å‘ç°ï¼Œæ˜æ˜ fields å†…æœ‰ 8 ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå­—æ®µçš„åŸå§‹åå’Œåˆ«åéƒ½æ¸…æ¸…æ¥šæ¥šï¼Œåˆ° columnIndexLookup é‡Œå±…ç„¶åªå‰©ä¸‹ 6 ä¸ªï¼Ÿ å¾ˆæ˜¾ç„¶ï¼Œé—®é¢˜å‡ºåœ¨äº†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rsmd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getColumnName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸­é—´æœ‰å‡ æ¬¡å–å‡ºäº†é‡å¤çš„ name ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰é‡å¤çš„ name å‘¢ï¼Œæˆ‘ä»¬è¿›å…¥&lt;code>getColumnName&lt;/code> ä¸€æ¢ç©¶ç«Ÿã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getColumnName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SQLException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">useOldAliasBehavior&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœè®¾ç½®äº†ä½¿ç”¨åˆ«åçš„å±æ€§ï¼Œå°±è·å–æ­¤fieldçš„åˆ«åã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è·å–æ­¤fieldçš„nameå±æ€§ï¼Œè€Œä¸æ˜¯åˆ«åã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getNameNoAliases&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœè¿åŸå§‹å­—æ®µåéƒ½æ‰¾ä¸åˆ°ï¼Œå°±è¿˜æ˜¯è·å–åˆ«å&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å®é™…debugå‘ç°ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½æ˜¯é€šè¿‡ getNameNoAliases æ‰¾åˆ° name çš„ã€‚å†åº•å±‚çš„ä»£ç å°±ä¸éœ€è¦è´´äº†ï¼Œçœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ˜ç™½äº†ã€‚è¿™é‡Œçš„ name å…¶å®æ˜¯æ¯ä¸ªå­—æ®µçš„æ•°æ®åº“å†…çš„å­—æ®µåï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„åˆ«åï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°é‡å¤çš„æƒ…å†µï¼Œæ¯”å¦‚ user è¡¨æœ‰ id å­—æ®µï¼Œaddress è¡¨åŒæ ·ä¼šæœ‰ id å­—æ®µã€‚&lt;/p>
&lt;h1 id="æ€»ç»“">
&lt;a href="#%e6%80%bb%e7%bb%93">#&lt;/a>
æ€»ç»“
&lt;/h1>&lt;p>ä»Šå¤©æˆ‘ä»¬åˆ†æå®Œäº†ç±»å‹è½¬æ¢å™¨ï¼Œå‘ç°å¯¹äºæœªçŸ¥çš„æ•°æ®ç±»å‹ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯é€šè¿‡ObjectTypeHandler è§£æï¼Œå…¶åº•å±‚çš„ç”¨äº†&lt;code>com.mysql.jdbc.ResultSetImpl.getObject&lt;/code> å†…çš„ä¾æ® Field.SQLType çš„ swtich-case ã€‚&lt;/p>
&lt;p>å¦ä¸€éƒ¨åˆ†åˆ™æ˜¯é€šè¿‡&lt;code>UnknownTypeHandler&lt;/code> å»æŸ¥æ‰¾åˆé€‚çš„è§£æå™¨æ¥è§£æã€‚&lt;/p>
&lt;p>å…³äºæŸ¥æ‰¾è§£æå™¨çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä¸‹ä¸€å±‚çº§&lt;code>TypeHandlerRegistry&lt;/code> æ¥ç»§ç»­å­¦ä¹ ã€‚&lt;/p></description></item><item><title>MyBatis ä¸­ä½¿ç”¨ JSONObject å¤„ç†ä¸€å¯¹å¤šç»“æœ</title><link>https://heeexy.com/p/one2many/</link><pubDate>Sun, 31 Dec 2017 12:11:29 +0800</pubDate><guid>https://heeexy.com/p/one2many/</guid><description>&lt;h1 id="é—®é¢˜">
&lt;a href="#%e9%97%ae%e9%a2%98">#&lt;/a>
é—®é¢˜
&lt;/h1>&lt;p>åœ¨&lt;a class="link" href="https://heeexy.com/2017/12/30/JSONObject-in-MyBatis/" >ä¸Šä¸€æ–‡&lt;/a>ä»‹ç»äº† JSONObject æ¥å— MyBatis çš„ç»“æœé›†çš„ç®€å•ç”¨æ³•ï¼Œä½†æ˜¯åœ¨å¤„ç†ä¸€å¯¹å¤šçš„æƒ…å†µæ—¶ï¼Œå•çº¯çš„JSONObjectå°±ä¸å¥½ä½¿äº†ã€‚&lt;/p>
&lt;p>æ¯”å¦‚è¦æŸ¥è¯¢ä¸€ä¸ªè§’è‰²ä¸‹çš„å¤šä¸ªç”¨æˆ·ï¼ŒresultMapå¦‚ä¸‹å®šä¹‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;resultMap&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;roleMap&amp;#34;&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;com.alibaba.fastjson.JSONObject&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;roleId&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;roleId&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;result&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;roleName&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;roleName&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;collection&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;users&amp;#34;&lt;/span> &lt;span class="na">ofType=&lt;/span>&lt;span class="s">&amp;#34;com.alibaba.fastjson.JSONObject&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;userId&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;userId&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;result&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;nickname&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;nickname&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/collection&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/resultMap&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœŸæœ›æŸ¥å‡ºæ¥çš„&lt;code>users&lt;/code> å±æ€§å¯¹åº”ç€ä¸€ä¸ªæ•°ç»„,&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/rightJson.png"
loading="lazy"
>&lt;/p>
&lt;p>ç„¶è€Œå®é™…æŸ¥å‡ºæ¥åªæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåªæœ‰ä¸€æ¡æ•°æ®ã€‚&lt;/p>
&lt;p>&lt;img src="http://img.heeexy.com/wrongJson.png"
loading="lazy"
>&lt;/p>
&lt;h1 id="è§£å†³æ–¹æ¡ˆ">
&lt;a href="#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88">#&lt;/a>
è§£å†³æ–¹æ¡ˆ
&lt;/h1>&lt;p>åªéœ€è¦å»ºä¸€ä¸ªå®ä½“ç±»ç»§æ‰¿ JSONObject ,é‡Œé¢æœ‰ä½ è¦çš„é›†åˆç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå°±è¶³å¤Ÿäº†ã€‚&lt;/p>
&lt;p>æ¯”å¦‚æˆ‘å»ºçš„ One2Many ç±»ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">One2Many&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶åxmlæ”¹ä¸º&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;resultMap&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;roleMap&amp;#34;&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#34;com.heeexy.example.util.model.One2Many&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;roleId&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;roleId&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;result&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;roleName&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;roleName&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;collection&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;users&amp;#34;&lt;/span> &lt;span class="na">ofType=&lt;/span>&lt;span class="s">&amp;#34;com.alibaba.fastjson.JSONObject&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;id&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;userId&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;userId&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;result&lt;/span> &lt;span class="na">column=&lt;/span>&lt;span class="s">&amp;#34;nickname&amp;#34;&lt;/span> &lt;span class="na">property=&lt;/span>&lt;span class="s">&amp;#34;nickname&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/collection&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/resultMap&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼Ÿ&lt;/p>
&lt;p>æ›´æ£’çš„æ˜¯ï¼Œè¿™ä¸ª One2Many ç±»æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œé‡Œé¢å†æ·»åŠ å…¶å®ƒçš„æˆå‘˜å˜é‡å°± OK äº†ã€‚è€Œä¸” Dao å±‚ä¸éœ€è¦æ”¹åŠ¨ï¼Œå¤–é¢æ­£å¸¸çš„è¿˜æ˜¯ç”¨ JSONObject å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h1 id="åŸç†">
&lt;a href="#%e5%8e%9f%e7%90%86">#&lt;/a>
åŸç†
&lt;/h1>&lt;p>MyBatis åœ¨å¤„ç†åµŒå¥—ç»“æœçš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­è¿™ä¸ªå±æ€§çš„ç±»å‹ï¼Œå¦‚æœæ˜¯é›†åˆï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªé›†åˆæ¥æ¥æ”¶è¿™ä¸ªå±æ€§ï¼Œå¦åˆ™å°±åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ Object äº†ã€‚&lt;/p>
&lt;p>ä»€ä¹ˆï¼Œä¸æ»¡æ„è¿™ä¸ªç­”æ¡ˆï¼Ÿé‚£å°±æ‹¿å‡ºæºç æ¥å§ï¼&lt;/p>
&lt;p>é¦–å…ˆæˆ‘ä»¬ç›´æ¥çœ‹åˆ°æœ€åº•å±‚åˆ¤æ–­è¿™ä¸ªå±æ€§æ˜¯ä¸æ˜¯é›†åˆçš„è¿™æ®µæºç ï¼š&lt;/p>
&lt;p>DefaultResultSetHandler.instantiateCollectionPropertyIfAppropriate&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">instantiateCollectionPropertyIfAppropriate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ResultMapping&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MetaObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">propertyName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…ˆå»æ‹¿åœ¨metaObjectå·²ç»å­˜å¥½çš„è¿™ä¸ªå±æ€§å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥userså±æ€§ä¸ºä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">propertyName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åœ¨è¿™é‡Œæ‹¿ä½ çš„usersçš„javaç±»å‹ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯JSONObject,è¿™é‡Œçš„ç±»å‹éƒ½ä¼šè¿”å›Objectï¼Œå¦‚æœæ˜¯One2Many,è¿™é‡Œå°±ä¼šæ‹¿åˆ°Listç±»å‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getJavaType&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSetterType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">propertyName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆ¤æ–­å±æ€§ç±»å‹æ˜¯ä¸æ˜¯é›†åˆï¼Œå¦‚æœæ˜¯ç»“åˆæ‰ä¼šåˆå§‹åŒ–ä¸€ä¸ªé›†åˆçš„å€¼è¿”å›åˆ°ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™éƒ½ä¼šè¿”å›null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">objectFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isCollection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">objectFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">propertyName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ExecutorException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Error instantiating collection property for result &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;. Cause: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">objectFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isCollection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//propertyValueä¸ä¸ºç©ºçš„æƒ…å†µï¼Œå³æˆ‘ä»¬çš„JSONObjecté‡Œå·²ç»å¡å…¥äº†userså±æ€§ï¼Œå³ä½¿æ˜¯è¿™æ ·ï¼ŒMyBatisè¿˜æ˜¯è¦æ±‚ä½ å¡å…¥çš„userså±æ€§å¿…é¡»æ˜¯é›†åˆï¼Œæ‰è¿”å›åˆ°ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™è¿˜æ˜¯ä¼šè¿”å›nullåˆ°ä¸‹ä¸€æ­¥ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">propertyValue&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»ä¸Šé¢è¿™æ®µä»£ç æˆ‘ä»¬å°±çŸ¥é“ MyBatis ç¡®å®æœ‰åšè¿™ä¸ªåˆ¤æ–­ï¼Œä½ å®šä¹‰çš„ users å±æ€§åˆ°åº•æ˜¯ä¸æ˜¯é›†åˆç±»å‹ï¼Œ&lt;/p>
&lt;ol>
&lt;li>å¦‚æœæ˜¯å¹¶ä¸”æ²¡æœ‰åˆå§‹åŒ–å¥½çš„è¯ï¼Œå°±å¸®ä½ åˆå§‹åŒ–ä¸€ä¸ªé›†åˆåˆ°ä¸‹ä¸€æ­¥ï¼Œ&lt;/li>
&lt;li>å¦‚æœå·²ç»åˆå§‹åŒ–å¥½äº†ï¼ˆé€šå¸¸è¿™æ—¶å€™å°±æ˜¯å·²ç»å¡å…¥äº†å‡ ä¸ª user å¯¹è±¡äº†ï¼‰ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ª users çš„å€¼åˆ°ä¸‹ä¸€æ­¥&lt;/li>
&lt;li>å¦‚æœä¸æ˜¯é›†åˆç±»å‹ï¼Œå°±è¿”å› null åˆ°ä¸‹ä¸€æ­¥ã€‚&lt;/li>
&lt;/ol>
&lt;p>é‚£ä¹ˆä¸‹ä¸€æ­¥åˆ°åº•æ˜¯å¹²å•¥å‘¢ï¼Ÿæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥å°±æ˜¯ç»§ç»­å¾€ users é›†åˆé‡Œæ·»åŠ å…ƒç´ å§ã€‚&lt;/p>
&lt;p>DefaultResultSetHandler.linkObjects&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">linkObjects&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MetaObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResultMapping&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rowValue&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">collectionProperty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">instantiateCollectionPropertyIfAppropriate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">collectionProperty&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸Šä¸€æ­¥è¿”å›æ¥çš„ä¸æ˜¯null,é‚£å°±å‘è¿™ä¸ªé›†åˆé‡Œæ·»åŠ å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MetaObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">targetMetaObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">configuration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">newMetaObject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">collectionProperty&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">targetMetaObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rowValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¸Šä¸€æ­¥è¿”å›äº†null,é‚£å°±ç›´æ¥æŠŠè¿™ä¸ªå±æ€§èµ‹ä¸Šæœ¬å€¼ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µå¯¼è‡´äº†ä¸Šé¢çš„ç¬¬äºŒå¼ å›¾ç‰‡çš„æƒ…å†µï¼Œæˆ‘ä»¬çš„userså˜æˆäº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æƒ³è¦çš„æ•°ç»„ã€‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">metaObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultMapping&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rowValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>MyBatis ä¸­ä½¿ç”¨ JSONObject æ›¿ä»£ JavaBean</title><link>https://heeexy.com/p/jsonobject-in-mybatis/</link><pubDate>Sat, 30 Dec 2017 21:51:55 +0800</pubDate><guid>https://heeexy.com/p/jsonobject-in-mybatis/</guid><description>&lt;h1 id="é—®é¢˜èƒŒæ™¯">
&lt;a href="#%e9%97%ae%e9%a2%98%e8%83%8c%e6%99%af">#&lt;/a>
é—®é¢˜èƒŒæ™¯
&lt;/h1>&lt;p>é¡¹ç›®åç«¯ä¸å‰ç«¯å…¨éƒ¨ä½¿ç”¨ JSON è¿›è¡Œæ•°æ®äº¤äº’ï¼Œæ¯”å¦‚æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ï¼Œé€šå¸¸åç«¯ä»æ•°æ®åº“æŸ¥å‡ºçš„æ•°æ®æ”¾å…¥å®ä½“ç±»å†è½¬ä¸º JSON è¿”å›ç»™å‰ç«¯ï¼Œä½†æ˜¯å‰ç«¯çš„å°ä¼™ä¼´è¡¨ç¤ºæ˜æ˜åªéœ€è¦ nickname,avatar,userId ä¸‰ä¸ªå­—æ®µï¼Œä¸ºä»€ä¹ˆä¼ è¿‡æ¥çš„æ•°æ®å¤šå‡º phone,address ,profile ä¹‹ç±»åå‡ ä¸ªå­—æ®µï¼Œé‡Œé¢éƒ½ null,0 ç­‰å€¼ï¼Ÿ&lt;/p>
&lt;p>å…¶å®æ˜¯å› ä¸º User å®ä½“ç±»å®šä¹‰äº†å¤ªå¤šå­—æ®µï¼Œè½¬ä¸º JSON çš„æ—¶å€™éƒ½è¢«åŒ…æ‹¬è¿›å»äº†ã€‚ç¨å¾®å¤šå‡ ä¸ªè¿˜èƒ½å¿ï¼Œä½†é€šå¸¸ User/Order è¿™äº›å®ä½“ç±»å­—æ®µç‰¹åˆ«å¤šï¼Œå¯¹è°ƒè¯•å¼€å‘å®åœ¨éå¸¸ä¸å‹å¥½ã€‚&lt;/p>
&lt;p>å› æ­¤æœ¬æ¬¡ä»»åŠ¡å°±æ˜¯ï¼šç¡®ä¿æ¯ä¸ªæ¥å£è¿”å›å­—æ®µéƒ½ä¸æ¥å£æ–‡æ¡£ä¸Šä¸€æ¨¡ä¸€æ ·ï¼Œå»é™¤å†—ä½™å­—æ®µã€‚&lt;/p>
&lt;p>è§£å†³è¿‡ç¨‹å°±çœç•¥äº†ï¼Œç›´æ¥æŠ›å‡ºæˆ‘æœ€åçš„è§£å†³æ–¹æ¡ˆå§ï¼šå°±æ˜¯ MyBatis çš„è¿”å›å€¼å‡ ä¹å®Œå…¨æŠ›å¼ƒå®ä½“ç±»ï¼Œå…¨éƒ¨ä½¿ç”¨&lt;code>com.alibaba.fastjson.JSONObject&lt;/code> ã€‚&lt;/p>
&lt;h1 id="ä½¿ç”¨-jsonobject">
&lt;a href="#%e4%bd%bf%e7%94%a8-jsonobject">#&lt;/a>
ä½¿ç”¨ JSONObject
&lt;/h1>&lt;p>å…ˆæœ€ç®€åŒ–ç›´è§‚çš„çœ‹ä¸€ä¸‹ JSONObject çš„ä½¿ç”¨å§ã€‚&lt;/p>
&lt;p>Controller:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@GetMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/list&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nd">@RequestBody&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requestJson&lt;/span>&lt;span class="p">){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requestJson&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Service:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ServiceImpl:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//fillPageParamæ˜¯è‡ªå®šä¹‰çš„å°è£…åˆ†é¡µå‚æ•°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">CommonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">fillPageParam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userDao&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">countUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">userDao&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è‡ªå®šä¹‰successPageå°è£…åˆ†é¡µç»“æœ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">successPage&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Dao:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">UserDao&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">countUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">listUser&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>UserMapper.xml , è¿™é‡Œçš„ resultType ç›´æ¥å°±æ˜¯ JSONObject ,å¦‚æœæ˜¯ä¸€å¯¹å¤šçš„æƒ…å†µï¼Œå°±è¦å¤šåŠ ä¸€æ­¥ï¼Œè¯·ç§»æ­¥çœ‹&lt;a class="link" href="https://heeexy.com/2017/12/31/One2Many" >è¿™ç¯‡æ–‡ç« &lt;/a>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;select&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;countUser&amp;#34;&lt;/span> &lt;span class="na">resultType=&lt;/span>&lt;span class="s">&amp;#34;Integer&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SELECT count(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FROM sys_user u
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> WHERE age=#{age}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;select&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;users&amp;#34;&lt;/span> &lt;span class="na">resultType=&lt;/span>&lt;span class="s">&amp;#34;com.alibaba.fastjson.JSONObject&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SELECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> id userId,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nickname nickname,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> avatar avatar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FROM sys_user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> WHERE age=#{age}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LIMIT #{offSet}, #{pageRow}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨jsonobject">
&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8jsonobject">#&lt;/a>
ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨JSONObject
&lt;/h1>&lt;p>å› ä¸º JSONObject å®ç°äº† &lt;code>Map&amp;lt;String,Object&amp;gt;&lt;/code> , MyBatis é‚£è¾¹å®Œå…¨æ˜¯æŠŠå®ƒå½“æˆ &lt;code>Map&amp;lt;String,Object&amp;gt;&lt;/code> å¤„ç†çš„ï¼Œç›¸ä¿¡ä¸å°‘äººéƒ½ç›´æ¥ç”¨è¿‡ map æ¥æ¥æ”¶MyBatis è¿”å›ç»“æœã€‚&lt;/p>
&lt;blockquote>
&lt;p>fastjson æ˜¯è¿™æ ·çš„ï¼ŒGson å¹¶ä¸æ˜¯ï¼Œæ‰€ä»¥ Gson çš„ JsonObject æ˜¯ä¸å¯ä»¥çš„ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>æœ‰å…´è¶£äº†è§£æ›´æ·±å…¥çš„åŸç†çš„è¯ï¼Œè¯·å‚è€ƒæˆ‘æ­¤ç³»åˆ—çš„å…¶å®ƒæ–‡ç« ã€‚&lt;/p>
&lt;h1 id="ä¼˜åŠ£å¯¹æ¯”">
&lt;a href="#%e4%bc%98%e5%8a%a3%e5%af%b9%e6%af%94">#&lt;/a>
ä¼˜åŠ£å¯¹æ¯”
&lt;/h1>&lt;h4 id="ä¾¿æ·æ€§">
&lt;a href="#%e4%be%bf%e6%8d%b7%e6%80%a7">#&lt;/a>
ä¾¿æ·æ€§
&lt;/h4>&lt;p>JSONObject ä¾¿æ·åˆ°å¯ä»¥è¯´æ˜¯æ— è„‘ï¼Œæ¥æ”¶å‚æ•°ã€ sql ä¼ å‚ã€å°è£… sql ç»“æœã€è¿”å›åˆ°å‰ç«¯ï¼Œå…¨ç¨‹ä½¿ç”¨ã€‚&lt;/p>
&lt;p>JavaBean åˆ™æ¥å£å±‚æ¥æ”¶å‚æ•°è½¬ä¸ºå®ä½“ç±»ï¼Œè¿”å›ç»™å‰ç«¯å†è½¬ä¸º jsonï¼Œæ–°å¢ä¸€ä¸ªä¸šåŠ¡é€šå¸¸è¿˜éœ€è¦å¤šå»ºä¸€ä¸ªå®ä½“ç±»ã€‚&lt;/p>
&lt;h4 id="å·¥å…·æ–¹æ³•æ‹“å±•">
&lt;a href="#%e5%b7%a5%e5%85%b7%e6%96%b9%e6%b3%95%e6%8b%93%e5%b1%95">#&lt;/a>
å·¥å…·æ–¹æ³•æ‹“å±•
&lt;/h4>&lt;p>JSONObject å¯ä»¥æ–¹ä¾¿åœ°å°è£…å‡ºé€šç”¨çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚å°è£…åˆ†é¡µä¿¡æ¯ï¼Œæ¯”å¦‚å°è£…å¤„ç†ç»“æœçš„æˆåŠŸå’Œå¤±è´¥ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯æ ¡éªŒå‚æ•°å­—æ®µéç©ºï¼Œä¸åŒçš„æ¥å£é€šå¸¸éœ€è¦æ ¡éªŒçš„å­—æ®µä¸åŒï¼Œå¦‚ä¸‹é¢è¿™ä¸ªç®€å•çš„æ–¹æ³•å°±å¯ä»¥æ ¡éªŒå„å­—æ®µæ˜¯å¦éƒ½éç©ºã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">hasAllRequired&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredColumns&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">StringTools&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isNullOrEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredColumns&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredColumns&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">missCol&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">trim&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringTools&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isNullOrEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">val&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">missCol&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; &amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">StringTools&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isNullOrEmpty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">missCol&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">clear&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;returnCode&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ErrorEnum&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">E_90003&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getErrorCode&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;returnMsg&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ç¼ºå°‘å¿…å¡«å‚æ•°:&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">missCol&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">trim&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CommonJsonException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>JavaBean åœ¨å¤„ç†åˆ†é¡µä¸Šé€šå¸¸è¦å¼•å„è‡ªå†™çš„ PageBean å·¥å…·ç±» , ä½¿ç”¨è¿‡ç¨‹é€šå¸¸ä¸ä¼šæ¯”ä¸Šé¢ServiceImplé‡Œçš„åˆ†é¡µç®€å•ã€‚&lt;/p>
&lt;p>JavaBean çš„å‚æ•°æ ¡éªŒéƒ½ä¸ç”¨è¯´ï¼Œæ›´å¤´ç—›æ›´å¤æ‚äº†ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰äººæœ‰ç”¨èµ·æ¥å¾ˆçˆ½çš„æ–¹æ³•ã€‚&lt;/p>
&lt;h4 id="è¿”å›å­—æ®µ">
&lt;a href="#%e8%bf%94%e5%9b%9e%e5%ad%97%e6%ae%b5">#&lt;/a>
è¿”å›å­—æ®µ
&lt;/h4>&lt;p>JSONObject æƒ³è¿”å›å‡ ä¸ªå­—æ®µå°±å‡ ä¸ªå­—æ®µï¼Œè€Œ JavaBean å¦‚æœåªæƒ³è¿”å›æŸå‡ ä¸ªå­—æ®µçš„è¯ï¼Œå°±éœ€è¦å•ç‹¬å»ºä¸ªå®ä½“ç±»ã€‚&lt;/p>
&lt;p>å­—æ®µæœ‰æ”¹åŠ¨çš„è¯ï¼ŒJSONObject çµæ´»æ€§å°±æ›´å¼ºäº†ï¼Œç›´æ¥åœ¨ mapper.xml é‡Œæ”¹ä¸‹å°±å®Œäº‹ã€‚&lt;/p>
&lt;h4 id="ä¸šåŠ¡å±‚">
&lt;a href="#%e4%b8%9a%e5%8a%a1%e5%b1%82">#&lt;/a>
ä¸šåŠ¡å±‚
&lt;/h4>&lt;p>ä¸å¯å¦è®¤çš„æ˜¯ï¼ŒJSONObject åœ¨ä¸šåŠ¡å±‚è¿›è¡Œå¤„ç†æ—¶ï¼Œå¤±å»äº† JavaBean çš„ç¼–è¯‘æç¤ºï¼Œä¹Ÿå¤±å»äº† IDE çš„å¿«æ·è¡¥å…¨ï¼Œæ›´æœ‰å¯èƒ½å‡ºç°å–é”™å€¼çš„æƒ…å†µã€‚&lt;/p>
&lt;p>æ¯”å¦‚ jsonObject.getString(&amp;ldquo;pasword&amp;rdquo;) ,è¾“å…¥é”™äº†å•è¯éƒ½å¯èƒ½æ²¡æ³¨æ„ï¼Œæœ€ç»ˆå–å‡ºæ¥ null ã€‚&lt;/p>
&lt;h4 id="å¯è¯»æ€§">
&lt;a href="#%e5%8f%af%e8%af%bb%e6%80%a7">#&lt;/a>
å¯è¯»æ€§
&lt;/h4>&lt;p>é€šå¸¸å¤§å®¶å¯èƒ½è®¤ä¸º JavaBean æœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼Œæˆ‘è§‰å¾—åªè¦å˜é‡åå–å¾—å¥½ï¼ŒJSONObject ä¹Ÿæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ã€‚æ¯•ç«Ÿç±»åæ˜¯å›ºå®šæ­»çš„ï¼Œå˜é‡åå’Œå‚æ•°åæ‰èƒ½æ›´å¥½åœ°åæ˜ æ­¤å¤„ä¸šåŠ¡çš„å¤„ç†ã€‚&lt;/p>
&lt;p>å°¤å…¶æ˜¯å¦‚ä»Šå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œå‰åç«¯å¼€å‘äººå‘˜ä¸€èˆ¬å¯¹ç…§ç€æ–‡æ¡£ç¡®è®¤å­—æ®µå«ä¹‰ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">
&lt;a href="#%e6%80%bb%e7%bb%93">#&lt;/a>
æ€»ç»“
&lt;/h2>&lt;p>JSONObject å¼€å‘éå¸¸æ–¹ä¾¿ï¼Œå…·æœ‰æ›´å¼ºçš„çµæ´»æ€§ï¼Œé€‚ç”¨äºä¸­å°å‹é¡¹ç›®ï¼Œç®€å•ä¸šåŠ¡çš„å¼€å‘ï¼Œä¹Ÿé€‚ç”¨äº&lt;strong>æ–‡æ¡£è‡³ä¸Š&lt;/strong>çš„å‰åç«¯åˆ†ç¦»å¼€å‘ä¸å¾®æœåŠ¡é¡¹ç›®ã€‚&lt;/p>
&lt;p>æ›´å…·ä½“çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ &lt;a class="link" href="https://github.com/Heeexy/SpringBoot-Shiro-Vue" target="_blank" rel="noopener"
>Github é¡¹ç›®&lt;/a>ã€‚&lt;/p></description></item><item><title>MyBatis çš„æ—¥å¿—è®¾è®¡--é€‚é…å™¨æ¨¡å¼ &amp; å·¥å‚æ¨¡å¼</title><link>https://heeexy.com/p/mybatis_design_patterns/</link><pubDate>Thu, 14 Dec 2017 14:45:47 +0800</pubDate><guid>https://heeexy.com/p/mybatis_design_patterns/</guid><description>&lt;p>â€‹ MyBatis æƒ³è¦æ‰“å°æ—¥å¿—ï¼Œæ—¶ä¸æ—¶æƒ³è¦æ¥å¥ log.debug() ã€log.error() ï¼Œéœ€è¦ä¸ªæ‰“å°æœº ï¼Œå¯æ˜¯è‡ªå·±åˆä¸æƒ³å»å®ç°ï¼ˆè€Œä¸”è·Ÿç€æ•´ä¸ªé¡¹ç›®ç”¨åŒæ ·çš„æ‰“å°ç³»ç»Ÿæ‰æ˜¯ç‹é“å•Šï¼‰ï¼Œéœ€è¦å»ç”¨åˆ«äººå®¶çš„æ‰“å°æœºï¼Œè¦ç”¨åˆ«äººå®¶çš„äº§å“å•Šï¼Œé‚£é—®é¢˜å¯å°±æ¥äº†ã€‚&lt;/p>
&lt;h2 id="é—®é¢˜-1">
&lt;a href="#%e9%97%ae%e9%a2%98-1">#&lt;/a>
é—®é¢˜ 1
&lt;/h2>&lt;p>â€‹ å¸‚é¢ä¸Šå„å®¶çš„æ‰“å°æœº slf4jã€java.util.loggingã€log4j ç”šè‡³ System.out éƒ½æ˜¯å„ç§ä¸åŒçš„ç”¨æ³•ï¼Œè¿™ä½¿ç”¨èµ·æ¥å°±å¤ªéº»çƒ¦äº†ã€‚&lt;/p>
&lt;h4 id="æ€è·¯">
&lt;a href="#%e6%80%9d%e8%b7%af">#&lt;/a>
æ€è·¯
&lt;/h4>&lt;p>â€‹ ä¸ç®¡å¸‚é¢ä¸Šæ‰“å°æœºæœ‰å¤šå°‘å‹å·ï¼Œæˆ‘å®¶ MyBatis åŒ…é‡Œçš„ç±»åªç”¨è‡ªå®¶çš„ç»Ÿä¸€æ¥å£ï¼Œæˆ‘å®¶çš„ç±»åªç®¡ log.debug()ã€log.error()&amp;hellip;&lt;/p>
&lt;p>â€‹ å®šä¹‰å¥½äº†æ¥å£ï¼Œå°±éœ€è¦å®ç°ç±» impl æ¥å®ç°è¿™äº› debug()ã€error() æ–¹æ³•äº† , å’±å‡è£…æ˜¯è‡ªå·±æ¥å®ç°ï¼Œå…¶å®å»è°ƒç”¨çœŸæ­£æ‰“å°æœº slf4ã€log4j çš„æ–¹æ³•ï¼Œè¿™æ ·å°±æŠŠåˆ«äººå®¶çš„æ‰“å°æœºå’Œå’±è‡ªå®¶çš„æ¥å£å…³è”èµ·æ¥å•¦ã€‚&lt;/p>
&lt;p>â€‹ è¿™å°±æ˜¯&lt;strong>é€‚é…å™¨æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;p>â€‹ æˆ‘å®¶çš„æ¯ä¸ªå®ç°ç±»å…¶å®å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ï¼Œæ¯ä¸ªé€‚é…å™¨å»é€‚é…ä¸€ç§æ‰“å°æœºã€‚æ¯”å¦‚ slf4jLoggerImpl å°±å®Œæˆäº†å¯¹ slf4j æ‰“å°æœºçš„é€‚é…ï¼Œslf4jLoggerImpl .debug() è°ƒç”¨äº†slf4j.Logger.debug()ã€‚&lt;/p>
&lt;p>â€‹ è¿™æ ·å¸‚é¢ä¸Šæ¯å¤šä¸€ç§æ‰“å°æœºï¼Œæ¯”å¦‚æƒ³ç”¨ log4j2 äº†ï¼Œæˆ‘å°±åªéœ€è¦åŠ ä¸€ç§é€‚é…å™¨ log4j2LoggerImpl å»é€‚é…å®ƒå°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h4 id="ä»£ç ">
&lt;a href="#%e4%bb%a3%e7%a0%81">#&lt;/a>
ä»£ç 
&lt;/h4>&lt;p>â€‹ å®šä¹‰æ¥å£&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">Log&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isDebugEnabled&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ åœ¨å®ç°ç±»é‡Œå®Œæˆé€‚é…ï¼Œæ¯”å¦‚é€‚é… slf4j çš„ &lt;code>Slf4jLoggerImpl&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.apache.ibatis.logging.Log&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.slf4j.Logger&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Slf4jLoggerImpl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Logger&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„è¿™ä¸ªåœ°æ–¹ï¼Œå…¥å‚ä¸º org.slf4j.Logger &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¯´æ˜å’±è¿™ä¸ªé€‚é…å™¨è¦ç”¨èµ·æ¥ï¼Œæ˜¯éœ€è¦ä¼ å…¥ä¸€ä¸ªçœŸæ­£çš„ slf4j å®¶çš„æ‰“å°æœºè¿›æ¥çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">Slf4jLoggerImpl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Logger&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//çœ‹ä¼¼å¤–é¢è°ƒç”¨å’± MyBatis çš„ Log çš„ debug()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…¶å®æ˜¯è°ƒç”¨ org.slf4j.Logger çš„ debug() &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é—®é¢˜-2">
&lt;a href="#%e9%97%ae%e9%a2%98-2">#&lt;/a>
é—®é¢˜ 2
&lt;/h2>&lt;p>â€‹ é€‚é…å™¨å’±æ˜¯åšå¥½äº†ï¼Œslf4jã€log4jã€stdout&amp;hellip;åšäº†é‚£ä¹ˆå¤šé€‚é…å™¨ï¼Œå¯æ˜¯æ€ä¹ˆç”¨å•Šï¼Ÿæˆ‘çœŸæ­£è¦æ‰“å°æœºçš„æ—¶å€™ï¼Œæ€ä¹ˆæ‰èƒ½çŸ¥é“æˆ‘è¯¥è°ƒç”¨å“ªæ¬¾é€‚é…å™¨å•Šï¼Ÿéš¾é“æ¯æ¬¡å–æ‰“å°æœºçš„æ—¶å€™ï¼Œéƒ½å»æŸ¥ä¸€éå’±çš„ç³»ç»Ÿé…äº†é‚£æ¬¾æ‰“å°æœºï¼ˆjar) åŒ…ä¹ˆï¼Ÿè€Œä¸”ä»¥åå¤šåŠ äº†1ç§æ‰“å°æœºï¼Œæˆ‘è¿˜å»æ¯ä¸ªåœ°æ–¹éƒ½æ”¹ä¸€éï¼Œéƒ½å¤šåŠ ä¸€é“åˆ¤æ–­ä¹ˆï¼Ÿ&lt;/p>
&lt;h4 id="æ€è·¯-1">
&lt;a href="#%e6%80%9d%e8%b7%af-1">#&lt;/a>
æ€è·¯
&lt;/h4>&lt;p>â€‹ è¿™å…¶å®å°±æ˜¯è·å–å®ä¾‹çš„æ—¶å€™çš„é—®é¢˜ï¼Œå’±è·å–å®ä¾‹å¤ªç´¯äº†ï¼Œä¸å¦‚æ¥ä¸ªç»Ÿä¸€çš„å·¥å‚å§ï¼Œæˆ‘æ¯æ¬¡æƒ³æ‰“å°çš„æ—¶å€™ï¼Œéƒ½å»æ‰¾å·¥å‚è¦ä¸€å°æ‰“å°æœºï¼Œä½ å·¥å‚æŒ‰ç…§æˆ‘ Log çš„æ¥å£ç»™æˆ‘ä¸€ä¸ªå®ä¾‹å°±æ˜¯äº†ã€‚æˆ‘ä¹Ÿä¸ç®¡ä½ ç»™çš„å…·ä½“å®ç°åˆ°åº•æ˜¯ slf4j å®¶çš„ï¼Œè¿˜æ˜¯ log4j çš„ï¼Œç”šè‡³å¯èƒ½æ˜¯ &lt;code>NoLoggingImpl&lt;/code> æ¯æ¬¡è°ƒæ¥å£éƒ½ä¸å¤„ç†çš„è¿™ç§ç©ºå£³æ‰“å°æœºã€‚&lt;/p>
&lt;p>â€‹ è¿™æ ·ä¸€æ¥ï¼Œæœ‰äº†ç»Ÿä¸€çš„å·¥å‚ï¼Œåˆ¤æ–­ç³»ç»Ÿç”¨å“ªç§é€‚é…å™¨çš„ä»»åŠ¡å°±å¯ä»¥åœ¨å·¥å‚å®Œæˆäº†ã€‚&lt;/p>
&lt;p>â€‹ è€Œä¸”ä»¥åå°±ç®—æ–°åŠ äº†æ‰“å°æœºï¼Œä¹Ÿåªè¦æ”¹æ”¹å·¥å‚çš„ä»£ç ï¼Œåœ¨å·¥å‚é‡Œå¤šåŠ ä¸€é‡åˆ¤æ–­å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>â€‹ è¿™å°±æ˜¯&lt;strong>å·¥å‚æ¨¡å¼&lt;/strong>ã€‚&lt;/p>
&lt;h4 id="ä»£ç -1">
&lt;a href="#%e4%bb%a3%e7%a0%81-1">#&lt;/a>
ä»£ç 
&lt;/h4>&lt;p>â€‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">LogFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Constructor&lt;/span>&lt;span class="o">&amp;lt;?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">logConstructor&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tryImplementation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useSlf4jLogging&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tryImplementation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useCommonsLogging&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">LogFactory&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// disable construction&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Log&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getLog&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">logConstructor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">newInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">logger&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Throwable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ LogFactory æä¾›äº†å¯¹å¤–çš„ getLog(String logger) æ–¹æ³•ï¼Œç»™éœ€è¦ logger çš„åœ°æ–¹æä¾›ä¸€ä¸ª Log çš„å®ä¾‹ã€‚&lt;/p>
&lt;p>â€‹ å†…éƒ¨çš„å®ç°ä¾é  &lt;code>logConstructor&lt;/code> è¿™ä¸ªæ„é€ å™¨é€šè¿‡åå°„æ¥å®ä¾‹åŒ–ä¸€ä¸ª Log çš„ Impl ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰çš„é€‚é…å™¨ï¼Œæ¯”å¦‚ Slf4jLoggerImpl ã€‚&lt;/p>
&lt;p>â€‹ åˆ¤æ–­é‡‡ç”¨å“ªç§&lt;code>logConstructor&lt;/code> çš„ä»»åŠ¡åˆ™åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™å°±æ‰§è¡Œäº†ï¼Œä¾æ¬¡å°è¯•äº†æˆ‘ä»¬çš„æ¯ä¸€æ¬¾é€‚é…å™¨ï¼Œç¢°ä¸ŠæŠ¥é”™å°±è¯´æ˜æ²¡ jar åŒ…ï¼Œä¸‹ä¸€æ¬¾ï¼Œå…¨éƒ½æ²¡æœ‰çš„è¯ï¼Œå°±ç”¨ NoLoggingImpl äº†ã€‚&lt;/p></description></item><item><title>è°·æ­Œäº‘æ­å»ºSSR</title><link>https://heeexy.com/p/setup-ssr-in-gce/</link><pubDate>Mon, 13 Nov 2017 14:02:44 +0800</pubDate><guid>https://heeexy.com/p/setup-ssr-in-gce/</guid><description>&lt;blockquote>
&lt;p>âš ï¸ 2024 å¹´æ³¨: GCE å·²ä¸å†æ¨èï¼Œè¿‘å¹´å·²æ”¹æˆäº†å…è´¹ 3 ä¸ªæœˆï¼Œå¹¶ä¸”å°†æˆ‘çš„æœåŠ¡å°æ‰ï¼Œç›´æ¥å¯¼è‡´äº†VPSä¸Šçš„æ•°æ®æ— æ³•æ¢å¤ï¼Œåšå®¢çš„å›¾ç‰‡å…¨éƒ¨ä¸¢å¤±ã€‚&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>åœ¨å…¨å›½å–œè¿å¤§ä¼šèƒœåˆ©å¬å¼€çš„æ—¶å€™,å¢™å‡ºä¸å»äº†,ç»å¸¸çœ‹åˆ°å¤§å®¶æœ‰è¿™ä¹ˆä¸€ç§æƒ³æ³• : ç­‰ä¼šå¼€å®Œå°±å¥½äº†&amp;hellip;&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;h1 id="ä¸ºä»€ä¹ˆç”¨gce">
&lt;a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e7%94%a8gce">#&lt;/a>
ä¸ºä»€ä¹ˆç”¨GCE
&lt;/h1>&lt;ol>
&lt;li>
&lt;p>&lt;strong>é€Ÿåº¦å¿«&lt;/strong>. æœ‰å°æ¹¾æœåŠ¡å™¨,å—äº¬ç”µä¿¡ping ç¨³å®šåœ¨40-60 ,youtube4Kæ— å‹åŠ›. Chromeå¯ä»¥æ„‰å¿«åœ°æŠŠGoogleç”¨ä½œé»˜è®¤æµè§ˆå™¨äº†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å…è´¹ä¸€å¹´&lt;/strong>. åªæ˜¯éœ€è¦æä¾›ä¸€å¼ å¤–å¸ä¿¡ç”¨å¡,ä½†æ˜¯ä¸ä¼šæ‰£æ¬¾,æ›´ä¸ä¼šåœ¨ä¸€å¹´åˆ°æœŸåè‡ªåŠ¨æ‰£æ¬¾!(è¢«AWSå‘äº†å‡ ç¾å…ƒå»)&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h1 id="å¦‚ä½•ç”³è¯·gce">
&lt;a href="#%e5%a6%82%e4%bd%95%e7%94%b3%e8%af%b7gce">#&lt;/a>
å¦‚ä½•ç”³è¯·GCE
&lt;/h1>&lt;p>â€‹ ç½‘ä¸Šæœåˆ°æ•™ç¨‹å¾ˆå¤š,å°±ä¸ç»†è¿°äº†&lt;/p>
&lt;p>â€‹ æœ‰å‡ ä¸ªå¯èƒ½ä¼šå¡æ—¶é—´çš„æ­¥éª¤åŒ…æ‹¬&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é€‰ç”¨é™æ€IP&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å’ŒAWSä¸€æ ·, æ”¾å¼€ä½ è¦åˆ†é…ç»™SSRçš„ç«¯å£ ,å¦‚æœæ‰¾ä¸åˆ°è¿™ä¸ªèœå•å¯ä»¥æœç´¢Firewall rules&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Xshellç”Ÿæˆçš„SSHçš„ç§é’¥å¯èƒ½è¦åœ¨åé¢åŠ ä¸Š&lt;/p>
&lt;p>&lt;code> google-ssh {&amp;quot;userName&amp;quot;:&amp;quot;xxxxx@gmail.com&amp;quot;,&amp;quot;expireOn&amp;quot;:&amp;quot;2017-11-10T04:39:03+0000&amp;quot;}&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h1 id="å¦‚ä½•éƒ¨ç½²ssr">
&lt;a href="#%e5%a6%82%e4%bd%95%e9%83%a8%e7%bd%b2ssr">#&lt;/a>
å¦‚ä½•éƒ¨ç½²SSR
&lt;/h1>&lt;h3 id="æ­¥éª¤">
&lt;a href="#%e6%ad%a5%e9%aa%a4">#&lt;/a>
æ­¥éª¤
&lt;/h3>&lt;ol>
&lt;li>è·å–rootæƒé™&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo su
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>å®‰è£…SSR&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget -N --no-check-certificate https://raw.githubusercontent.com/91yun/shadowsocks_install/master/shadowsocksR.sh &amp;amp;&amp;amp; bash shadowsocksR.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ å®‰è£…å®Œæˆçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸²æˆåŠŸçš„æç¤ºä¿¡æ¯, å¯ä»¥å¤åˆ¶è®°ä¸‹ä½ çš„ip/ç«¯å£/å¯†ç /åŠ å¯†æ–¹å¼ç­‰ä¿¡æ¯&lt;/p>
&lt;ol start="3">
&lt;li>å®‰è£…BBR&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">chmod +x bbr.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">./bbr.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>
&lt;p>é‡ç½®VMå®ä¾‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>sudo su&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ£€æŸ¥æ˜¯å¦æˆåŠŸ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sysctl net.ipv4.tcp_available_congestion_control
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹æ˜¯ä¸æ˜¯å‡ºç°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net.ipv4.tcp_available_congestion_control = bbr cubic reno
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç±»ä¼¼æœ‰ bbr çš„å­—æ ·,æœ‰å°±è¡¨ç¤ºBBRä¹Ÿè£…å¥½äº†&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="å¸¸ç”¨å‘½ä»¤">
&lt;a href="#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4">#&lt;/a>
å¸¸ç”¨å‘½ä»¤
&lt;/h4>&lt;p>/etc/init.d/shadowsocks restart é‡å¯SSR&lt;/p>
&lt;p>vi /etc/shadowsocks.json ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/p>
&lt;h1 id="ssrå®¢æˆ·ç«¯">
&lt;a href="#ssr%e5%ae%a2%e6%88%b7%e7%ab%af">#&lt;/a>
SSRå®¢æˆ·ç«¯
&lt;/h1>&lt;p>ä¸‹è½½ç½‘å€ &lt;a class="link" href="https://github.com/shadowsocksrr/shadowsocks-rss" target="_blank" rel="noopener"
>github&lt;/a>&lt;/p>
&lt;p>æˆ–è€…&lt;a class="link" href="http://ots7yt7am.bkt.clouddn.com/file/ShadowsocksR-4.7.0.7z" target="_blank" rel="noopener"
>è¿™é‡Œç›´æ¥ä¸‹è½½&lt;/a>&lt;/p>
&lt;p>é…ç½®å’Œä»¥å‰çš„SSä¹Ÿå·®ä¸å¤š, æœ‰å‡ ç‚¹æ³¨æ„çš„æ˜¯&lt;/p>
&lt;ol>
&lt;li>å¡«å†™åŠ å¯†/åè®®/æ··æ·†, é»˜è®¤çš„æ˜¯chacha20/auth_sha1_v4/tls1.2_ticket_auth&lt;/li>
&lt;li>åœ¨é€‰é¡¹è®¾ç½®é‡Œå°†æœ¬åœ°ç«¯å£è®¾ç½®æˆä½ SwitchOmegaé…ç½®çš„æœ¬åœ°ç«¯å£.æ¯”å¦‚æˆ‘å°±ç”¨äº†10801è€Œä¸æ˜¯é»˜è®¤çš„1080&lt;/li>
&lt;/ol>
&lt;h1 id="å…¶å®ƒssr">
&lt;a href="#%e5%85%b6%e5%ae%83ssr">#&lt;/a>
å…¶å®ƒSSR
&lt;/h1>&lt;p>â€‹ https://52world.top&lt;/p>
&lt;p>â€‹ ä¸çŸ¥é“åœ¨å“ªçœ‹æ¥çš„è¿™ä¸ªSSRç½‘ç«™,æœ‰å…è´¹SSR,ä¹Ÿå¯ä»¥å……é’±å‡çº§ä¸“ä¸šç‰ˆ. ç›®å‰è¿˜æ˜¯èƒ½ç”¨çš„ , å¯ä»¥æ”¶è—ç€é˜²æ­¢å“ªå¤©å…¶å®ƒç¿»å¢™æ–¹å¼å¤±æ•ˆå§.&lt;/p>
&lt;p>â€‹ æ¯•ç«Ÿç¿»å¢™ç¬¬ä¸€å®šå¾‹å°±æ˜¯:æ°¸è¿œä¸è¦åœ¨ä¸€ç§ç¿»å¢™æ–¹å¼ä¸ŠåŠæ­»!&lt;/p>
&lt;hr>
&lt;p>å‚è€ƒç½‘ç«™&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://suiyuanjian.com/124.html" target="_blank" rel="noopener"
>https://suiyuanjian.com/124.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://www.jianshu.com/p/6bd66829a1ce" target="_blank" rel="noopener"
>http://www.jianshu.com/p/6bd66829a1ce&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://suppore.cn/512.html" target="_blank" rel="noopener"
>http://suppore.cn/512.html&lt;/a>&lt;/li>
&lt;/ol></description></item><item><title>å‰åç«¯åˆ†ç¦»å®è·µå°ç»“</title><link>https://heeexy.com/p/end-to-end/</link><pubDate>Sun, 29 Oct 2017 00:27:05 +0800</pubDate><guid>https://heeexy.com/p/end-to-end/</guid><description>&lt;h2 id="èƒŒæ™¯">
&lt;a href="#%e8%83%8c%e6%99%af">#&lt;/a>
èƒŒæ™¯
&lt;/h2>&lt;p>â€‹ å…¬å¸é¡¹ç›®è½¬å‹,è¦å¼€æ–°çš„è¿è¥ç®¡ç†å¹³å°,æˆ‘æè®®å€Ÿæ­¤å¼€æ–°é¡¹ç›®çš„æœºä¼š,è¿›è¡Œå‰åç«¯åˆ†ç¦»,ç”±æˆ‘è´Ÿè´£å¸¦é¢†å°ç»„æ–°æŠ€æœ¯å­¦ä¹ /åˆ†äº«,æ¢å‘å¡«å‘.&lt;/p>
&lt;h2 id="åˆ†ç¦»åŸå› ">
&lt;a href="#%e5%88%86%e7%a6%bb%e5%8e%9f%e5%9b%a0">#&lt;/a>
åˆ†ç¦»åŸå› 
&lt;/h2>&lt;ol>
&lt;li>æœ€å…³é”®ä¸€ç‚¹,å—ä¸äº†jsp/freemarkeré‡Œä¸€å¡Œç³Šæ¶‚çš„ä»£ç ,åˆ†ç¦»ä¹‹å,ä»£ç æŒ‰è§„èŒƒå†™,ç®€æ´,å¥½ç®¡ç†&lt;/li>
&lt;li>åŸæœ¬æˆ‘ä»¬åç«¯å°±ä¸€ç›´åœ¨ç»™Android/iOSæä¾›æ¥å£,æœ¬æ¬¡åˆ†ç¦»,å¯ä»¥æ–¹ä¾¿ä»¥åH5ç«¯çš„é¡¹ç›®é‡æ„,å®ç°Android+iOS+H5çš„ç»Ÿä¸€,ä¸€å¥—æ¥å£å¯ä»¥ä¾›ä¸‰ç«¯åŒæ—¶ä½¿ç”¨,å¤§é‡èŠ‚çœå·¥ä½œé‡,ä¹Ÿå¯ä»¥æ›´å¥½åœ°ä¿è¯å…¬å¸äº§å“è´¨é‡çš„ç»Ÿä¸€æ€§.&lt;/li>
&lt;li>æ–¹ä¾¿åç«¯ä¸“å¿ƒå¤„ç†æ•°æ®,å‰ç«¯å®ç°é¡µé¢æ•ˆæœ.è€Œä¸æ˜¯å‰ç«¯ä»…ä»…ç”»é¡µé¢å†™css,åç«¯è¿˜éœ€è¦å¤åˆ¶ç²˜è´´è¿‡æ¥,å¥—æ•°æ®,ä¿®æ”¹å·²æœ‰é¡µé¢æ—¶,å‰ç«¯æ›´æ˜¯ä¸æ–¹ä¾¿æ’æ‰‹.&lt;/li>
&lt;/ol>
&lt;h2 id="æŠ€æœ¯é€‰å‹">
&lt;a href="#%e6%8a%80%e6%9c%af%e9%80%89%e5%9e%8b">#&lt;/a>
æŠ€æœ¯é€‰å‹
&lt;/h2>&lt;p>â€‹ ç»„å‘˜åç«¯æŠ€æœ¯éƒ½æ˜¯SSM,å‰ç«¯éƒ½åªæ˜¯ç•¥æ¥è§¦è¿‡AngularJS/Vue.&lt;/p>
&lt;p>â€‹ æˆ‘ä¹‹å‰æ¥è§¦äº†ä¸€ä¸‹Spring Boot,æ„Ÿè§‰é…ç½®å¾ˆæ¸…çˆ½,æ­æ¡†æ¶è½»æ¾,ä¸šåŠ¡å†™èµ·æ¥å¿«,å¯ä»¥è®©ç»„å‘˜æ— ç¼åˆ‡è¿‡æ¥,æ— éœ€è´¹æ—¶å­¦ä¹ ,å› æ­¤åç«¯æ¡†æ¶é€‰å®šSpring Boot.è€Œç™»å½•æ§åˆ¶ä¸æƒé™ç®¡ç†ä¸€ç›´æ˜¯å…¬å¸ä»¥å‰å‡ ä¸ªé¡¹ç›®çš„å¼±é¡¹,å› æ­¤æœ¬æ¬¡å†³å®šå¼•å…¥shiro,è€Œç»„å‘˜æ— ä¸€å¯¹shiroç†Ÿæ‚‰çš„,ç ”ç©¶shiroçš„ä»»åŠ¡è‡ªç„¶ç”±æˆ‘æ‰¿æ‹….&lt;/p>
&lt;p>â€‹ å‰ç«¯æ¡†æ¶æ˜¯æœ¬æ¬¡å‰åç«¯åˆ†ç¦»çš„é‡ç‚¹,ç”±äºæˆ‘ä»¬ç»„æ— äººç†Ÿæ‚‰å‰ç«¯çš„æ–°æ¡†æ¶,æ‰€ä»¥è¿™æ¬¡åŠ¿å¿…æ¯ä¸ªäººéƒ½éœ€è¦å­¦ä¹ è®¸å¤šæ–°çš„å‰ç«¯çŸ¥è¯†.æˆ‘æ‹¿å…¬å¸çš„H5é¡¹ç›®çš„å‡ ä¸ªé¡µé¢è¿›è¡Œè¿‡æ­å»ºvueæ¡†æ¶é‡æ„ç»ƒæ‰‹,è®¤ä¸ºvueæ–‡æ¡£æ¸…æ™°,èµ„æ–™ä¸°å¯Œ,ç›¸å…³å¼€æºæ–¹æ¡ˆå¤Ÿå¤š,æˆ‘ä»¬è¿™æ¬¡å¯ä»¥æ”¾å¿ƒå­¦ä¹ ,ä½¿ç”¨.(å½“ç„¶æœ€ä¸»è¦çš„è¿˜æ˜¯å› ä¸ºå‘å…¨éƒ½å¾—ç”±æˆ‘æ¥å¡«,å¾—æŒ‘ä¸ªç†Ÿæ‚‰çš„)&lt;/p>
&lt;h2 id="ç›®å‰è¿›å±•">
&lt;a href="#%e7%9b%ae%e5%89%8d%e8%bf%9b%e5%b1%95">#&lt;/a>
ç›®å‰è¿›å±•
&lt;/h2>&lt;p>â€‹ åç«¯:Spring Bootæ¡†æ¶æ­å»ºå®Œæˆ,shiroå¯ä»¥è¿›è¡Œæƒé™ç®¡ç†,è‡ªå®šä¹‰æ‹¦æˆªå™¨,å¸¸ç”¨å·¥å…·ç±»å®Œæˆ,å¯¹å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥,è¿”å›ç»“æœ,å¼‚å¸¸å¤„ç†éƒ½å¯ä»¥å¿«é€Ÿæå®š.&lt;/p>
&lt;p>â€‹ å‰ç«¯:æ•°æ®äº¤äº’å°è£…å®Œæ¯•,è·¯ç”±ç†Ÿæ‚‰,å‰ç«¯æƒé™ç®¡ç†åˆæ­¥ç†Ÿæ‚‰,é€‰ç”¨é¥¿äº†ä¹ˆå¼€æºçš„Elementæ¡†æ¶,å¸¸ç”¨çš„å¢åˆ æ”¹æŸ¥çš„é¡µé¢å…ƒç´ åŠå·¥å…·æ–¹æ³•éƒ½å·²è®©å¤§å®¶æŒæ¡.&lt;/p>
&lt;p>â€‹ æœ¬å‘¨ä¸€å¼€å§‹æ•™ç»„å‘˜ä½¿ç”¨Intellij IDEA,æ•™å‰ç«¯å¿«é€Ÿé“ºé¡µé¢çš„æ–¹æ³•,ä»‹ç»å‰åç«¯æˆ‘å°è£…çš„å„ç§å°è½®å­.ç»è¿‡ä¸€å‘¨æ—¶é—´,å…¨éƒ¨éƒ½å·²ç†Ÿæ‚‰è¿™å¥—æ–°çš„å‰åç«¯æ¡†æ¶,æ¯ä¸ªäººéƒ½å¯ä»¥ç‹¬ç«‹å¿«é€Ÿåœ°æ¨å‡ºå¸¸ç”¨é¡µé¢.&lt;/p>
&lt;h2 id="æ¥å£ç«¯å°æŠ€å·§">
&lt;a href="#%e6%8e%a5%e5%8f%a3%e7%ab%af%e5%b0%8f%e6%8a%80%e5%b7%a7">#&lt;/a>
æ¥å£ç«¯å°æŠ€å·§
&lt;/h2>&lt;p>â€‹ å› ä¸ºåç«¯å…¨éƒ¨è¿”å›ç»Ÿä¸€jsonæ ¼å¼çš„æ¥å£,æ‰€ä»¥æˆ‘è®¾è®¡äº†ä¸€äº›å°çš„å·¥å…·æ–¹æ³•,æ–¹ä¾¿å¿«é€Ÿæ¨å‡ºæ–°æ¥å£,èŠ‚çœé‡å¤ä»£ç .&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ä½¿ç”¨JSONObjectè€Œä¸æ˜¯å®ä½“ç±»&lt;/p>
&lt;p>â€‹ å› ä¸ºåç«¯ä¸šåŠ¡ä¸ç®—å¤æ‚,æ‰€ä»¥èˆå¼ƒäº†å®ä½“ç±»çš„è¯­ä¹‰æ€§,è½¬è€Œä½¿ç”¨é˜¿é‡Œçš„fastjsonçš„JSONObjectæ¥æ”¶MyBatisè¿”å›çš„ç»“æœ.æ¯”å¦‚ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢åªéœ€è¦&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;select&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;getSimple&amp;#34;&lt;/span> &lt;span class="na">resultType=&lt;/span>&lt;span class="s">&amp;#34;com.alibaba.fastjson.JSONObject&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SELECT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> s.order_id shopOrderId,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> s.operation operation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> date_format(s.create_time, &amp;#39;%Y.%m.%d %H:%i:%s&amp;#39;) createTime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FROM shop_order_log s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> WHERE s.user_delete_status = &amp;#34;1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/select&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°±å¯ä»¥å°†ä¸‰ä¸ªå­—æ®µshopOrderId,operation,createTimeæ”¾å…¥jsonå†…,å­—æ®µåç§°æ›´åŠ çµæ´»,ä¹Ÿå…å»äº†å¤§é‡çš„å»ºå®ä½“ç±»,å†™resultMapçš„ä»£ç .&lt;/p>
&lt;p>â€‹ æ›´å¥½çš„ä¸€ç‚¹æ˜¯,ä¸ä½¿ç”¨å®ä½“ç±»,å¯ä»¥åœ¨è¿”å›ç»“æœä¸­é¿å…æ‰å¾ˆå¤šç©ºçš„éœ€ä¸è¦çš„å­—æ®µ.&lt;/p>
&lt;p>â€‹ è¿˜æœ‰,å› ä¸ºæ‰€æœ‰çš„æ¥å£å±‚éƒ½è¿”å›JSONObject,æ‰€ä»¥ç¼–å†™å·¥å…·æ–¹æ³•,å¿«é€Ÿè¿”å›æˆåŠŸ/å¤±è´¥ç»“æœä¹Ÿå¾ˆç®€å•,æˆ‘å†™äº†å¤šä¸ªå·¥å…·æ–¹æ³•,åŒ…æ‹¬å…¥å‚è½¬json,å…¥å‚éç©ºæ ¡éªŒ,è¿”å›æˆåŠŸ/å¤±è´¥ç»“æœ,åˆ†é¡µ,è¿™é‡Œå°±ä¸ä¸€ä¸€è´´å‡ºä»£ç äº†.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è‡ªå®šä¹‰Exception&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">CommonJsonException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RuntimeException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultJson&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">* è°ƒç”¨æ—¶å¯ä»¥åœ¨ä»»ä½•ä»£ç å¤„ç›´æ¥throwsè¿™ä¸ªException,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">* éƒ½ä¼šç»Ÿä¸€è¢«æ‹¦æˆª,å¹¶å°è£…å¥½jsonè¿”å›ç»™å‰å°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">* @param errorEnum ä»¥é”™è¯¯çš„ErrorEnumåšå‚æ•°
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">*/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">CommonJsonException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ErrorEnum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">errorEnum&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">CommonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">returnJson&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">errorEnum&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resultJson&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">CommonJsonException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultJson&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resultJson&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultJson&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getResultJson&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resultJson&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@ControllerAdvice&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@ResponseBody&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">GlobalExceptionHandler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@ExceptionHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CommonJsonException&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">CommonJsonExceptionHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">CommonJsonException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonJsonException&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">commonJsonException&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResultJson&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>åœ¨éœ€è¦è¿”å›ç»™å‰ç«¯é”™è¯¯ä»£ç ç¼–å·æ—¶,æ¯”å¦‚æ ¡éªŒå‚æ•°éç©º,æ ¡éªŒæ‰‹æœºå·å¤±è´¥,å¯ä»¥ç›´æ¥æŠ›å‡ºæ­¤å¼‚å¸¸,ç»é”™è¯¯æ‹¦æˆªå™¨æ‹¦æˆªåˆ°æ­¤å¼‚å¸¸å,å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯ç ç»™å‰ç«¯,èŠ‚çœå¤§é‡çš„åˆ¤æ–­/è¿”å›çš„ä»£ç .è¿™ä¸€ç‚¹ä¹Ÿæ˜¯å‰é˜µå­ä»Springæºç ä¸­å­¦åˆ°çš„.&lt;/p>
&lt;h2 id="å­˜åœ¨çš„é—®é¢˜">
&lt;a href="#%e5%ad%98%e5%9c%a8%e7%9a%84%e9%97%ae%e9%a2%98">#&lt;/a>
å­˜åœ¨çš„é—®é¢˜
&lt;/h2>&lt;ol>
&lt;li>è¿‘æœŸä¸»è¦é—®é¢˜åŸºæœ¬éƒ½æ˜¯å¾…æˆ‘å»ç ”ç©¶æ·±å…¥çš„æŠ€æœ¯,æ¯”å¦‚shiroçš„åŠ¨æ€æƒé™ä¸vue-routerçš„å¼‚æ­¥è·¯ç”±çš„ç»“åˆ,vueç»„ä»¶çš„é€šä¿¡,vuexçš„çŠ¶æ€ç®¡ç†&lt;/li>
&lt;li>å…¶æ¬¡æ˜¯ç»„å‘˜éœ€è¦å¯¹vueæ›´åŠ ç†Ÿæ‚‰,æˆ‘è¿™æ¬¡è¦æ±‚äº†å¤§å®¶æŠ›å¼ƒjQuery,ç”¨æ•°æ®ç»‘å®šçš„æ€æƒ³å»å†™å‰ç«¯.ç›®å‰å¤§å®¶çš„å‰ç«¯æ°´å¹³ä¹Ÿè¿˜åªæ˜¯å¯ä»¥å¿«é€Ÿå¤åˆ¶ç²˜è´´å‡ºé¡µé¢,å¯¹äºå¤æ‚çš„é¡µé¢å’Œç»„ä»¶,ç”šè‡³å¯¹æˆ‘ä»¬å‰ç«¯é¡¹ç›®çš„ç›®å½•ç»“æ„ä¸å„éƒ¨åˆ†åŠŸèƒ½,éƒ½ä¸ç®—æŒæ¡.&lt;/li>
&lt;li>ç›®å‰æˆ‘ä»¬æ‰€è°“çš„å‰åç«¯åˆ†ç¦»å…¶å®è¿˜åªæ˜¯åˆæ­¥çš„ä¸šåŠ¡å’Œä»£ç ä¸Šçš„åˆ†ç¦»,ä»¥åå¦‚æœè¦é‡æ„H5é¡¹ç›®,å¯èƒ½è¿˜éœ€è¦å¼€NodeJSé¡¹ç›®æ¥è§£å†³å’ŒAndroid/iOSä¸€æ ·çš„æ¥å£åŠ å¯†é—®é¢˜,ç»Ÿä¸€sessionç®¡ç†é—®é¢˜,ä»¥åŠæ›´å¤šçš„å‰åç«¯åˆ†ç¦»å¯èƒ½ç»™æˆ‘ä»¬å¸¦æ¥çš„é—®é¢˜.&lt;/li>
&lt;/ol></description></item><item><title>æ­å»ºspringboot-shiro-vueæ¡†æ¶æ—¶é‡åˆ°çš„å‘</title><link>https://heeexy.com/p/build-springboot-shiro-vue/</link><pubDate>Sun, 22 Oct 2017 11:19:33 +0800</pubDate><guid>https://heeexy.com/p/build-springboot-shiro-vue/</guid><description>&lt;p>â€‹ æœ€è¿‘åœ¨åšå‰åç«¯åˆ†ç¦»çš„æ–°æ¡†æ¶,é€‰ç”¨äº†åç«¯springboot+shiro,å‰ç«¯vue+elementUI,ç¬¬ä¸€æ¬¡æ­SSMä¹‹å¤–çš„édemoé¡¹ç›®,å°¤å…¶shiroæ›´æ˜¯ä¹‹å‰ä»æœªæ¥è§¦,æŠ˜è…¾äº†å¾ˆå¤šå¤©,é‡åˆ°å¾ˆå¤šé—®é¢˜,å¤§éƒ¨åˆ†èƒ½ç™¾åº¦å‡ºæ¥,å‰©ä¸‹çš„éå¸¸è´¹æ—¶çš„é—®é¢˜ä¸”ç§°ä¹‹ä¸ºå‘å§.&lt;/p>
&lt;h3 id="è·¨åŸŸ">
&lt;a href="#%e8%b7%a8%e5%9f%9f">#&lt;/a>
è·¨åŸŸ
&lt;/h3>&lt;p>â€‹ ä¸€å¤§éƒ¨åˆ†é—®é¢˜å°±æ˜¯è·¨åŸŸé€ æˆçš„,æœ¬èº«vue-cliæ­å»ºçš„é¡¹ç›®å¯ä»¥ç”¨&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-javascript" data-lang="javascript">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 1. axiosçš„baseURLè®¾ç½®ä¸º/api
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 2. å¦‚ä¸‹è®¾ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">proxyTable&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;/api&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">target&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;http://127.0.0.1:8080/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">changeOrigin&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pathRewrite&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;^/api&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥è§£å†³å¼€å‘ç¯å¢ƒè·¨åŸŸçš„é—®é¢˜,ç”Ÿäº§ç¯å¢ƒåæ­£å¯ä»¥æ‰“åŒ…é™æ€æ–‡ä»¶åˆ°springbooté¡¹ç›®ä¸­ç›´æ¥è·‘.&lt;/p>
&lt;p>è€Œæˆ‘è¿˜æ˜¯è„‘æŠ½å¾—é€‰æ‹©äº†å¼ºè¡Œè·¨åŸŸ,å‡è£…è‡ªå·±è¦æŠŠé™æ€æ–‡ä»¶å•ç‹¬æ”¾ä¸ªæœåŠ¡å™¨è·‘&amp;hellip;ä¸ºæ­¤é‡åˆ°å¾ˆå¤šé—®é¢˜,æŠ˜è…¾å¥½å‡ å¤©.&lt;/p>
&lt;p>&lt;strong>å› æ­¤å¼ºåŠ›æ¨èä¸Šé¢çš„æ–¹æ¡ˆ,ç®€å•å¿«æ·åœ°è§£å†³è·¨åŸŸ!&lt;/strong>&lt;/p>
&lt;p>å¦‚æœç”Ÿäº§ç¯å¢ƒçœŸçš„éœ€è¦è·¨åŸŸçš„è¯,å†æŒ‰ä¸‹é¢æ–¹æ³•è®¾ç½®&lt;/p>
&lt;p>å¤§éƒ¨åˆ†è·¨åŸŸçš„é…ç½®éƒ½èƒ½ç™¾åº¦æœå‡ºæ¥:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>axiosè¦ &lt;code>withCredentials: true&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”¨sessionè€Œä¸ç”¨å•¥ç‰¹æ®Šçš„tokenä¹‹ç±»çš„è¯,å°±ä¸ç”¨ &lt;code>config.headers['X-Token'] = getToken() &lt;/code> ,è¿™å¥æ˜¯&lt;a class="link" href="https://github.com/PanJiaChen/vueAdmin-template" target="_blank" rel="noopener"
>&lt;strong>vueAdmin-template&lt;/strong>&lt;/a> ä¸­å¸¦çš„,éœ€è¦åˆ æ‰.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åç«¯éœ€è¦é…ç½®å…è®¸è·¨åŸŸ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Configuration&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">CorsConfig&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">buildConfig&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CorsConfiguration&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAllowedOrigin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 1 è®¾ç½®è®¿é—®æºåœ°å€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAllowedHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 2 è®¾ç½®è®¿é—®æºè¯·æ±‚å¤´&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAllowedMethod&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 3 è®¾ç½®è®¿é—®æºè¯·æ±‚æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setAllowCredentials&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">corsConfiguration&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CorsFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">corsFilter&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">UrlBasedCorsConfigurationSource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UrlBasedCorsConfigurationSource&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerCorsConfiguration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/**&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">buildConfig&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 4 å¯¹æ¥å£é…ç½®è·¨åŸŸè®¾ç½®&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CorsFilter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="shiroæ‹¦æˆªajaxè¿”å›json">
&lt;a href="#shiro%e6%8b%a6%e6%88%aaajax%e8%bf%94%e5%9b%9ejson">#&lt;/a>
shiroæ‹¦æˆªajaxè¿”å›json
&lt;/h3>&lt;p>â€‹ shiroæ‹¦æˆªåˆ°éœ€è¦ç™»å½•è€Œç”¨æˆ·å°šæœªçš„è¯·æ±‚æ—¶,ä¼šé‡å®šå‘è‡³ /login/auth (æœªé…ç½®æ—¶æ˜¯login.jsp),è€Œajaxæ˜¯ä¸å…è®¸é‡å®šå‘çš„,ajaxä¼šæ”¶åˆ°302é”™è¯¯ç ,æŠ¥é”™&lt;/p>
&lt;blockquote>
&lt;p>Failed to load http://localhost:8080/test: Redirect from &amp;lsquo;http://localhost:8080/test&amp;rsquo; to &amp;lsquo;http://localhost:8080/login/auth&amp;rsquo; has been blocked by CORS policy: No &amp;lsquo;Access-Control-Allow-Origin&amp;rsquo; header is present on the requested resource. Origin &amp;lsquo;http://localhost:9528&amp;rsquo; is therefore not allowed access.&lt;/p>
&lt;/blockquote>
&lt;p>å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹æ‹¦æˆªå™¨è¿›è¡Œæ”¹é€ ,ä¸è¦å®ƒé»˜è®¤çš„é‡å®šå‘äº†,æˆ‘ä»¬ç›´æ¥å»responseé‡ŒæŠŠjsonå†™å¥½è¾“å‡ºç»™å‰ç«¯.&lt;/p>
&lt;p>è‡ªå®šä¹‰filter,(å› ä¸ºæˆ‘çš„åç«¯å…¨éƒ¨è¿”å›json,æ‰€ä»¥è¿™é‡Œä¸åˆ¤æ–­æ˜¯å¦ajaxäº†)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">AjaxPermissionsAuthorizationFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FormAuthenticationFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">onAccessDenied&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ServletRequest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ServletResponse&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">JSONObject&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;returnMsg&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;æœªç™»å½•æˆ–ç™»å½•å·²å¤±æ•ˆ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isLoginRequest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isLoginSubmission&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">executeLogin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">PrintWriter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">HttpServletResponse&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">HttpServletResponse&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¸‹é¢è¿™å‡ è¡Œä¹Ÿæ˜¯åé¢è¦è®²çš„å‘, è¿™é‡Œçš„Access-Control-Allow-Origin è®¾ç½®ä¸º*çš„è¯,å‰ç«¯è¿˜æ˜¯ä¼šæŠ¥é”™. &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;http://localhost:9528&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// response1.setHeader(&amp;#34;Access-Control-Allow-Origin&amp;#34;, &amp;#34;*&amp;#34;);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Access-Control-Allow-Credentials&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;true&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setCharacterEncoding&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;UTF-8&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//è®¾ç½®ç¼–ç &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setContentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;application/json&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//è®¾ç½®è¿”å›ç±»å‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getWriter&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//è¾“å‡º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flush&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">close&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ä¸‹æ¥å°±æ˜¯æœ€å‘çš„åœ°æ–¹äº†,æ‹¦æˆªå™¨çš„æ³¨å…¥.&lt;/p>
&lt;p>&lt;a class="link" href="http://m.blog.csdn.net/u014042146/article/details/72834582" target="_blank" rel="noopener"
>åŸæœ¬æœåˆ°çš„æ–¹æ³•&lt;/a>æ˜¯åœ¨ShiroConfigurationç±»ä¸­æ³¨å…¥.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Bean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ajaxPermissionsAuthorizationFilter&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AjaxPermissionsAuthorizationFilter&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ajaxPermissionsAuthorizationFilter&lt;/span>&lt;span class="p">(){&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AjaxPermissionsAuthorizationFilter&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç„¶åshiroFilterFactoryBeanè®¾ç½®è¿‡æ»¤å™¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">filterMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedHashMap&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">filterMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;authc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AjaxPermissionsAuthorizationFilter&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">shiroFilterFactoryBean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setFilters&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filterMap&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç»“æœè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨æŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½æ‹¦æˆªäº†,ç›´æ¥æ— è§†äº†æˆ‘è®¾ç½®çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">filterChainDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;anon&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">filterChainDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/static/**&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;anon&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">filterChainDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/login/**&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;anon&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">filterChainDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/error&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;anon&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">filterChainDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/**&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;authc&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å„ç§ç™¾åº¦,èƒ½æœåˆ°çš„ç›¸å…³çš„èµ„æ–™ä¹Ÿå°±åªæœ‰&lt;a class="link" href="https://segmentfault.com/q/1010000010747919" target="_blank" rel="noopener"
>segmentfaultçš„æé—®æ²¡è§£å†³,é¢˜ä¸»ç»™æˆ‘çš„å›å¤ä¹Ÿä¸èƒ½è§£å†³&lt;/a> , &lt;a class="link" href="https://zhidao.baidu.com/question/436777330932025604.html" target="_blank" rel="noopener"
>ç™¾åº¦çŸ¥é“æé—®çš„æ²¡è§£å†³&lt;/a> , &lt;a class="link" href="http://www.jianshu.com/p/e30dc5e78641" target="_blank" rel="noopener"
>ç®€ä¹¦æ–¹æ¡ˆå¹¶ä¸èƒ½è§£å†³&lt;/a> .&lt;/p>
&lt;p>æœ€ç»ˆåœ¨æŸä¸ªç™¾åº¦ç»“æœçš„ç¬¬ä¸‰é¡µæ‰¾åˆ°&lt;a class="link" href="http://www.hillfly.com/2017/179.html" target="_blank" rel="noopener"
>è¿™ç¯‡åšå®¢&lt;/a> ,åšä¸»å¯¹é—®é¢˜ä¸€æ­¥ä¸€æ­¥çš„æ’æŸ¥åˆ†æ,debugæºç ,æœ€ç»ˆçŸ¥é“&lt;/p>
&lt;p>&lt;strong>Springboot å…ˆåŠ è½½äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ Filterï¼Œç„¶åå†åŠ è½½äº† ShiroFilter&lt;/strong>&lt;/p>
&lt;p>è§£å†³æ–¹æ³•:
åœ¨è‡ªå®šä¹‰çš„filteré‡ŒåŠ ä¸Šä¸‹é¢çš„ä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@Bean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">public FilterRegistrationBean registration(è‡ªå®šä¹‰Filter filter) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FilterRegistrationBean registration = new FilterRegistrationBean(filter);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> registration.setEnabled(false);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return registration;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨configrationç±»é‡Œå°±ä¸éœ€è¦å£°æ˜è¿™ä¸ªbean,åªéœ€è¦ç›´æ¥è°ƒç”¨Â &lt;code>filterMap.put(&amp;quot;authc&amp;quot;, new è‡ªå®šä¹‰Filter());&lt;/code>&lt;/p>
&lt;h3 id="access-control-allow-origin">
&lt;a href="#access-control-allow-origin">#&lt;/a>
Access-Control-Allow-Origin
&lt;/h3>&lt;p>åœ¨ä¸Šé¢çš„è‡ªå®šä¹‰filteré‡Œ,&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setHeader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;http://localhost:9528&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœè®¾ç½®ä¸º*çš„è¯,å‰ç«¯è™½ç„¶å¯ä»¥æ”¶åˆ°json,ä½†è¿˜æ˜¯ä¼šæŠ¥é”™&lt;/p>
&lt;blockquote>
&lt;p>Failed to load http://localhost:8080/test: The value of the &amp;lsquo;Access-Control-Allow-Origin&amp;rsquo; header in the response must not be the wildcard &amp;lsquo;*&amp;rsquo; when the request&amp;rsquo;s credentials mode is &amp;lsquo;include&amp;rsquo;. Origin &amp;lsquo;http://localhost:9528&amp;rsquo; is therefore not allowed access. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute.&lt;/p>
&lt;/blockquote>
&lt;p>ä¸å…è®¸è®¾ç½®ä¸ºé€šé…ç¬¦* .&lt;/p>
&lt;p>è™½ç„¶æ­¤å¤„è®¾ç½®äº†&amp;quot;http://localhost:9528&amp;quot; ä½†æ˜¯è¿™ç§åšæ³•ç»ˆç©¶ä¸åˆé€‚.&lt;/p>
&lt;p>ç™¾åº¦ç»§ç»­æœåˆ°&lt;a class="link" href="http://blog.csdn.net/u011517841/article/details/68490586" target="_blank" rel="noopener"
>æ­¤åšå®¢&lt;/a>&lt;/p>
&lt;p>å¾—åˆ°è§£å†³æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">res.setHeader(&amp;#34;Access-Control-Allow-Origin&amp;#34;, ((HttpServletRequest) request).getHeader(&amp;#34;Origin&amp;#34;));
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Springæºç ç¬”è®°-2.4 è·å–å•ä¾‹</title><link>https://heeexy.com/p/getsingleton/</link><pubDate>Fri, 29 Sep 2017 22:49:00 +0800</pubDate><guid>https://heeexy.com/p/getsingleton/</guid><description>&lt;h2 id="è·å–å•ä¾‹bean-getsingleton">
&lt;a href="#%e8%8e%b7%e5%8f%96%e5%8d%95%e4%be%8bbean-getsingleton">#&lt;/a>
è·å–å•ä¾‹bean &lt;code>getSingleton&lt;/code>
&lt;/h2>&lt;blockquote>
&lt;p>æ˜æ˜ä¹‹å‰ä¸€ç¯‡å·²ç»è®²è¿‡äº†è·å–å•ä¾‹,ä¸ºä»€ä¹ˆè¿™é‡Œåˆæ˜¯è·å–å•ä¾‹beanå‘¢?&lt;/p>
&lt;p>ä¸¤å¤©ä¸çœ‹ä¹¦,æœæ–­åˆå¿˜äº†.å‰é¢å­¦çš„æ˜¯&lt;strong>ä»ç¼“å­˜ä¸­&lt;/strong>è·å–,è¿™é‡Œæ˜¯çœŸæ­£çš„è·å–.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;code>DefaultSingletonBeanRegistry&lt;/code> ä¸­é‡è½½æ­¤æ–¹æ³•,ç¬¬äºŒå‚æ•°ä¸ºObjectFactory&lt;?>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">notNull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;beanName&amp;#39; must not be null&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œå†æ¬¡çœ‹åˆ°äº†è¿™ä¸ªsingletonObjects,ä¸Šç¯‡æ–‡ç« ä»‹ç»è¿‡,æ˜¯ç»´æŠ¤äº†å•ä¾‹å¯¹è±¡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¹¦ä¸­è¯´æ³•æ˜¯:ç”¨äºä¿å­˜BeanNameå’Œåˆ›å»ºbeanå®ä¾‹ä¹‹é—´çš„å…³ç³»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é¦–å…ˆè·å–ä¸€é,å¦‚æœä¸å­˜åœ¨,æ‰å»åˆ›å»º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å·¥å‚å¦‚æœæ­£åœ¨é”€æ¯,è¿™æ—¶å€™è·å–beanå°±ä¼šæŠ¥é”™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonsCurrentlyInDestruction&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanCreationNotAllowedException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Singleton bean creation not allowed while the singletons of this factory are in destruction (Do not request a bean from a BeanFactory in a destroy method implementation!)&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‰“å°æ—¥å¿—,æ­£åœ¨åˆ›å»ºå•ä¾‹bean(beanName)çš„å…±äº«çš„å®ä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Creating shared instance of singleton bean &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ ‡å¿—è¿™ä¸ªbeanNameæ­£åœ¨åˆ›å»º,å¦‚æœåŒæ—¶é‡å¤åˆ›å»º,ä¼šæŠ¥é”™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beforeSingletonCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newSingleton&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">recordSuppressedExceptions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">suppressedExceptions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">recordSuppressedExceptions&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">suppressedExceptions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//=============è¿™é‡Œåº”è¯¥æ˜¯æœ€å…³é”®çš„åˆ›å»ºbeançš„æ­¥éª¤===============&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObject&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ ‡è¯†æ–°åˆ›å»ºå‡ºæ¥çš„å•ä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">newSingleton&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IllegalStateException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var16&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//éæ³•çŠ¶æ€é”™è¯¯,åº”è¯¥æ˜¯åˆ›å»ºè¿‡ç¨‹ä¸­å‘ç°å­˜åœ¨å…¶ä»–çº¿ç¨‹å·²åˆ›å»ºæ­¤å•ä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‰€ä»¥æ­¤å¤„catché‡Œé¢å†æ¬¡è°ƒç”¨äº†singletonObjects.get(beanName);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var16&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeanCreationException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var17&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…¶å®ƒåˆ›å»ºbeané”™è¯¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanCreationException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var17&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">recordSuppressedExceptions&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">suppressedExceptions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">suppressedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">var8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æŠŠå…¶å®ƒrecordSuppressedExceptionså¡å…¥è¿™ä¸ªexä¸€å¹¶æŠ›å‡º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addRelatedCause&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">suppressedException&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ex&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">recordSuppressedExceptions&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">suppressedExceptions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç¡®è®¤è¿™ä¸ªbeanNameåœ¨å‡ ä¸ªsetä¸­çš„çŠ¶æ€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">afterSingletonCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newSingleton&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ˜¯æ–°åˆ›å»ºçš„,åˆ™åŠ å…¥ç¼“å­˜,ç§»é™¤å‡ ä¸ªæ–°åˆ›å»ºçš„æ ‡è¯†,åå­—åŠ å…¥registeredSingletons&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿”å›,å¦‚æœæ˜¯NULL_OBJECTä¹Ÿä½œä¸ºnullè¿”å›.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™ä¸ªNULL_OBJECTåº”è¯¥æ˜¯åœ¨å‰é¢çš„è·å–æ–¹æ³•ä¸­æœ‰å¯èƒ½çš„ç‰¹æ®Šè¿”å›å€¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NULL_OBJECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»ä¸Šå¯ä»¥çœ‹å‡º,è·å–å•ä¾‹è¿˜æ˜¯é€šè¿‡ &lt;code>synchronized(this.singletonObjects)&lt;/code> åŠ é”æ¥å®ç°ï¼Œå…ˆä» &lt;code>singletonObjects&lt;/code> æŸ¥ä¸€éæœ‰æ²¡æœ‰å·²å­˜åœ¨çš„ï¼Œè‹¥æ²¡æœ‰åˆ™å†è¿›è¡Œåˆ›å»ºã€‚&lt;/p>
&lt;p>è€Œåˆ›å»ºçš„æ­¥éª¤ï¼Œåˆ™æ˜¯åœ¨å…¥å‚çš„ &lt;code> ObjectFactory&amp;lt;?&amp;gt;&lt;/code> ä¸­å®Œæˆï¼Œè°ƒç”¨å…¶ getObject() ä¾ç„¶è¿˜æ˜¯è°ƒç”¨æˆ‘ä»¬æœ¬èº«&lt;code>AbstractBeanFactory&lt;/code> çš„ &lt;code>createBean&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;hr>
&lt;p>æˆ‘ä»¬å…ˆä¸æ€¥ç€å¾€ä¸‹çœ‹ï¼Œå…ˆç†ä¸€ç†ï¼Œé¦–å…ˆç¬¬ä¸€ç‚¹è¦çŸ¥é“çš„æ˜¯å•ä¾‹åŠ é”éƒ½æ˜¯ &lt;code>synchronized(this.singletonObjects)&lt;/code> ã€‚å…¶æ¬¡è·å–å•ä¾‹ bean çš„å¤§è‡´æ­¥éª¤ï¼Œæ— éå°±æ˜¯ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ä¸Šä¸€æ–‡ä¸­ä»‹ç»çš„ï¼Œä»ç¼“å­˜ä¸­æ‹¿ï¼Œå¹¶ä¸”å…è®¸â€œæ—©æœŸå¼•ç”¨â€ ï¼Œå³ä» &lt;code>earlySingletonObjects&lt;/code> ä¸­æ‹¿ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™è‡ªå·±åˆ›å»ºï¼Œ&lt;/p>
&lt;p>2.1 åœ¨å„ç§ map é‡Œè®°å½•å®ƒçš„ åˆ›å»ºã€é”€æ¯ç­‰ä¿¡æ¯&lt;/p>
&lt;p>2.2 é€šè¿‡&lt;code>createBean&lt;/code> æ–¹æ³•å»å…·ä½“åˆ›å»ºè¿™ä¸ªå®ä¾‹ã€‚&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Springæºç ç¬”è®°-2.3 ç¼“å­˜ä¸­è·å–å•ä¾‹beanåŠè·å–å¯¹è±¡</title><link>https://heeexy.com/p/getsingleton/</link><pubDate>Tue, 26 Sep 2017 23:28:00 +0800</pubDate><guid>https://heeexy.com/p/getsingleton/</guid><description>&lt;h2 id="ç¼“å­˜ä¸­è·å–å•ä¾‹bean-getsingleton">
&lt;a href="#%e7%bc%93%e5%ad%98%e4%b8%ad%e8%8e%b7%e5%8f%96%e5%8d%95%e4%be%8bbean-getsingleton">#&lt;/a>
ç¼“å­˜ä¸­è·å–å•ä¾‹bean &lt;code>getSingleton&lt;/code>
&lt;/h2>&lt;p>&lt;code>DefaultSingletonBeanRegistry&lt;/code> ä¸­å®ç°æ­¤æ–¹æ³•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//è¿™ä¸ªmapç»´æŠ¤äº†å•ä¾‹å¯¹è±¡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObjects&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">256&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å½“å‰æ­£åœ¨åˆ›å»ºä¸­çš„å•ä¾‹å¯¹è±¡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonsCurrentlyInCreation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Collections&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">newSetFromMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ—©æœŸå•ä¾‹å¯¹è±¡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">earlySingletonObjects&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å•ä¾‹å·¥å‚?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactories&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">HashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEarlyReference&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ ¹æ®è¿™ä¸ªbeanNameæ²¡å–åˆ°å¯¹è±¡,ä½†å‘ç°è¿™ä¸ªå¯¹è±¡è¿˜åœ¨åˆ›å»ºä¸­.....&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isSingletonCurrentlyInCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonObjects&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ—©æœŸå•ä¾‹å¯¹è±¡ä¸­æ²¡æœ‰æ­¤bean,å¹¶ä¸”å…è®¸æ—©æœŸä¾èµ–&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allowEarlyReference&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å½“æŸäº›æ–¹æ³•éœ€è¦æå‰åˆå§‹åŒ–çš„æ—¶å€™åˆ™ä¼šè°ƒç”¨ addSingletonFactoryæ–¹æ³•å°†å¯¹åº”çš„ObjectFactoryåˆå§‹åŒ–ç­–ç•¥å­˜å‚¨åœ¨singletonFactories&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonFactories&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è°ƒç”¨é¢„å…ˆè®¾å®šçš„getObjectæ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObject&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è®°å½•åœ¨ç¼“å­˜ä¸­,earlySingletonObjects å’Œ singletonFactoriesäº’æ–¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">earlySingletonObjects&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">singletonFactories&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NULL_OBJECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">singletonObject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/DefaultSingletonBeanRegistry.png"
loading="lazy"
>&lt;/p>
&lt;p>è¿™é‡Œè¿˜æ˜¯çœ‹å¾—è¿·è¿·ç³Šç³Šçš„,æ¯•ç«Ÿä¸€æ¥å°±å„ç§å–å€¼, å¾€åçœ‹çœ‹åœ¨å“ªå¡å€¼çš„å§!&lt;/p>
&lt;h2 id="ä»beançš„å®ä¾‹ä¸­è·å–å¯¹è±¡-getobjectforbeaninstance">
&lt;a href="#%e4%bb%8ebean%e7%9a%84%e5%ae%9e%e4%be%8b%e4%b8%ad%e8%8e%b7%e5%8f%96%e5%af%b9%e8%b1%a1-getobjectforbeaninstance">#&lt;/a>
ä»beançš„å®ä¾‹ä¸­è·å–å¯¹è±¡ &lt;code>getObjectForBeanInstance&lt;/code>
&lt;/h2>&lt;p>â€‹ æˆ‘ä»¬å¾—åˆ°beançš„å®ä¾‹åè¦åšçš„ç¬¬ä¸€æ­¥éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥æ£€æµ‹ä¸€ä¸‹æ­£ç¡®æ€§,å…¶å®å°±æ˜¯ç”¨äºæ£€æµ‹å½“å‰beanæ˜¯å¦æ˜¯&lt;code>FactoryBean&lt;/code> ç±»å‹çš„bean,å¦‚æœæ˜¯,å°±è¦è°ƒç”¨&lt;code>getObject()&lt;/code> æ–¹æ³•ä½œä¸ºè¿”å›å€¼&lt;/p>
&lt;p>â€‹ &lt;a class="link" href="http://heeexy.com/2017/09/26/FactoryBean/" target="_blank" rel="noopener"
>FactoryBean&lt;/a> åœ¨ä¹‹å‰æˆ‘ä»¬ä¾¿å·²ç»æ¥è§¦è¿‡.&lt;/p>
&lt;p>â€‹ &lt;code>getObjectForBeanInstance&lt;/code> æ–¹æ³•å°±ä¸è´´äº†, ä¸»è¦å°±æ˜¯å„ç§éªŒè¯, å–ç¼“å­˜ç­‰ç­‰, é‡Œé¢éœ€è¦æ³¨é‡Šçš„ä¸€æ®µå¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°†å­˜å‚¨XMLé…ç½®æ–‡ä»¶çš„GernericBeanDefinition è½¬æ¢ä¸ºRootBeanDefinition,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæŒ‡å®šBeanNameæ˜¯å­beançš„è¯,åŒæ—¶ä¼šåˆå¹¶çˆ¶ç±»çš„ç›¸å…³å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getMergedLocalBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ æ–¹æ³•ä¸­çš„å…³é”®æ˜¯ &lt;code>getObjectFromFactoryBean&lt;/code> , å®ç°ç±»ä¸º &lt;code>FactoryBeanRegistrySupport&lt;/code>&lt;/p>
&lt;p>â€‹ è€Œ &lt;code>getObjectFromFactoryBean&lt;/code> æ–¹æ³•ä¸­ä¹Ÿè¿˜ä¸æ˜¯æœ€æ ¸å¿ƒçš„, å…¶ä»£ç ä¸»è¦æ˜¯ä¿è¯å•ä¾‹beançš„å…¨å±€å”¯ä¸€. å¦‚æœæ˜¯å•ä¾‹,é‚£å°±ä¸ç”¨é‡å¤åˆ›å»º,å¯ä»¥ä½¿ç”¨ç¼“å­˜æ¥æé«˜æ€§èƒ½. å¦å¤–æ–¹æ³•è¿˜æ ¹æ®éœ€è¦å¯¹beanè¿›è¡Œäº†åå¤„ç†&lt;code>postProcessObjectFromFactoryBean()&lt;/code>&lt;/p>
&lt;p>&lt;strong>åå¤„ç†&lt;/strong>å³æ˜¯éå†æ‰€æœ‰çš„beanåå¤„ç†å™¨,åœ¨beanåˆå§‹åŒ–åè°ƒç”¨å®ƒçš„å¤„ç†æ–¹æ³•,åé¢è¿˜ä¼šè¯¦ç»†å­¦ä¹ .&lt;/p>
&lt;p>â€‹ å®ƒçš„å…³é”®æ˜¯ &lt;code>doGetObjectFromFactoryBean&lt;/code> ,æ–¹æ³•åå‰é¢å¤šåŠ äº†ä¸ªdo&amp;hellip;&lt;/p>
&lt;pre>&lt;code>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢,æˆ‘ä»¬ç»ˆäºçœ‹åˆ°æƒ³è¦çœ‹åˆ°çš„ `object = factory.getObject();` ,è™½ç„¶æ—©å·²çŸ¥é“å¿…é¡»è¦èµ°åˆ°è¿™,ä½†æ˜¯åˆ°è¿™ä¸€æ­¥`getObject()` è¿˜æ˜¯ç»•äº†å¾ˆå¤šè·¯,åŒ…æ‹¬åˆ°è¿™é‡Œå±…ç„¶è¿˜ä½¿ç”¨äº†`java.security.AccessController` æƒé™éªŒè¯...
&lt;/code>&lt;/pre>
&lt;p>â€‹&lt;/p></description></item><item><title>Springæºç ç¬”è®°-2.2 FactoryBean</title><link>https://heeexy.com/p/factorybean/</link><pubDate>Tue, 26 Sep 2017 14:47:00 +0800</pubDate><guid>https://heeexy.com/p/factorybean/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.springframework.beans.factory&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">interface&lt;/span> &lt;span class="nc">FactoryBean&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿”å›ç”±FactoryBeanåˆ›å»ºçš„beanå®ä¾‹,å¦‚æœisSingleton()è¿”å›true,åˆ™è¯¥å®ä¾‹ä¼šæ”¾åˆ°Springå®¹å™¨ä¸­å•å®ä¾‹ç¼“å­˜æ± ä¸­&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObject&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿”å›FactoryBeanåˆ›å»ºçš„beanç±»å‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getObjectType&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿”å›beanå®ä¾‹çš„ä½œç”¨åŸŸæ˜¯singletonè¿˜æ˜¯prototype&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isSingleton&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ å½“é…ç½®æ–‡ä»¶&lt;bean>çš„classå±æ€§é…ç½®çš„å®ç°ç±»æ˜¯&lt;code>FactoryBean&lt;/code> æ—¶,é€šè¿‡&lt;code>getBean()&lt;/code> æ–¹æ³•è¿”å›çš„ä¸æ˜¯&lt;code>FactoryBean&lt;/code> æœ¬èº«,è€Œæ˜¯&lt;code>FactoryBean.getObject()&lt;/code> æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡.&lt;/p>
&lt;p>â€‹ ç›¸å½“äº&lt;code>FactoryBean.getObject()&lt;/code> ä»£ç†äº†&lt;code>getBean()&lt;/code> æ–¹æ³•.&lt;/p>
&lt;p>â€‹ ä¾‹å¦‚,å¦‚æœä½¿ç”¨ä¼ ç»Ÿæ–¹å¼é…ç½®Carçš„bean,Carçš„æ¯ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ª&lt;property> å…ƒç´ æ ‡ç­¾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">maxSpeed&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">brand&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">double&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//get/set&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ å¦‚æœä½¿ç”¨FactoryBeançš„æ–¹å¼å°±ä¼šçµæ´»ä¸€äº›,ä¸‹é¢é€šè¿‡é€—å·åˆ†éš”ç¬¦çš„æ–¹å¼ä¸€æ¬¡æ€§åœ°ä¸ºCarçš„æ‰€æœ‰å±æ€§æŒ‡å®šé…ç½®å€¼:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">CarFactoryBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FactoryBean&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">carInfo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObject&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">infos&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">carInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;,&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setBrand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">infos&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setMaxSpeed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">infos&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setPrice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Double&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">valueOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">infos&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">2&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">car&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getObjectType&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Car&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isSingleton&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getCarInfo&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">carInfo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setCarInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">carInfo&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">carInfo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">carInfo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ‰äº†è¿™ä¸ªCarFactoryBeanä¹‹å,å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä½¿ç”¨ä¸‹é¢è¿™ç§è‡ªå®šä¹‰çš„é…ç½®æ–¹å¼é…ç½®Car beanäº†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;bean&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;car&amp;#34;&lt;/span> &lt;span class="na">class=&lt;/span>&lt;span class="s">&amp;#34;com.test.factoryBean.CarFactoryBean&amp;#34;&lt;/span> &lt;span class="na">carInfo=&lt;/span>&lt;span class="s">&amp;#34;è¶…çº§è·‘è½¦,400,3000&amp;#34;&lt;/span> &lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è°ƒç”¨ getBean(&amp;ldquo;car&amp;rdquo;) , Springå¹¶ä¸ä¼šè¿”å›&lt;code>CarFactoryBean&lt;/code> è€Œæ˜¯è¿”å›car&lt;/p>
&lt;p>å¦‚æœå¸Œæœ›è¿”å›&lt;code>CarFactoryBean&lt;/code> é‚£å°± getBean(&amp;quot;&amp;amp;car&amp;quot;)&lt;/p>
&lt;hr>
&lt;p>ä¹¦æœ¬ä½œè€…è®²åˆ°&lt;code>FactoryBean&lt;/code> æ¥å£å¯¹äºSpringæ¡†æ¶å¾ˆå…³é”®, Springè‡ªèº«å°±æä¾›äº†70å¤šä¸ªå®ç°.&lt;/p>
&lt;p>å®ƒä»¬éšè—äº†å®ä¾‹åŒ–ä¸€äº›å¤æ‚çš„beançš„ç»†èŠ‚,ç»™ä¸Šå±‚åº”ç”¨å¸¦æ¥äº†ä¾¿åˆ©.&lt;/p>
&lt;blockquote>
&lt;p>ç–‘é—®: å…·ä½“å“ªäº›åœ°æ–¹ç”¨&lt;code>FactoryBean&lt;/code> å¸¦æ¥äº†çœŸæ­£çš„ä¾¿åˆ©å‘¢?&lt;/p>
&lt;p>ç­”:&lt;/p>
&lt;/blockquote></description></item><item><title>Springæºç ç¬”è®°-2.1 beançš„åŠ è½½åˆæ¢</title><link>https://heeexy.com/p/load_bean/</link><pubDate>Tue, 26 Sep 2017 11:16:00 +0800</pubDate><guid>https://heeexy.com/p/load_bean/</guid><description>&lt;h3 id="æœ¬æ–‡è¦çœ‹å•¥">
&lt;a href="#%e6%9c%ac%e6%96%87%e8%a6%81%e7%9c%8b%e5%95%a5">#&lt;/a>
æœ¬æ–‡è¦çœ‹å•¥?
&lt;/h3>&lt;p>â€‹ å‰é¢å·²ç»äº†è§£äº†beanä»é…ç½®æ–‡ä»¶åˆ°è§£ææˆBDHolderåˆ°æ³¨å†Œçš„æµç¨‹,æˆ‘ä»¬å·²ç»å°†beançš„ä¿¡æ¯å°è£…å¥½,å¡å…¥äº†mapä¸­,è¿™ä¸ªmapå¯èƒ½åœ¨ä¸åŒçš„å®ç°é‡Œé¢,å‰é¢é‡ç‚¹å­¦çš„å°±æ˜¯DefaultListableBeanFactoryé‡Œçš„beanDefinitionMap.&lt;/p>
&lt;p>â€‹ æˆ‘ä»¬ç°åœ¨è¦æ¢ç´¢beançš„åŠ è½½,å›´ç»•æœ€åˆçš„ç¤ºä¾‹ä»£ç :&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">MyTestBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MyTestBean&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">bf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;myTestBean&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>â€‹ BeanFactoryæ˜¯ä¸ªæ¥å£,å…¶ä¸‹å®ç°å…³ç³»å¾ˆå¤æ‚, getBeanæ–¹æ³•çš„å®ç°ä¸»è¦æ˜¯åœ¨&lt;code>AbstractBeanFactory&lt;/code> è¿™ä¸€å±‚.&lt;/p>
&lt;p>â€‹ æœ¬æ–‡å°±æ˜¯å…ˆæ¥å¿«é€Ÿä½“éªŒä¸€ä¸‹åŠ è½½beançš„å¤§ä½“æµç¨‹&lt;/p>
&lt;h3 id="è¿›å…¥ä»£ç å§">
&lt;a href="#%e8%bf%9b%e5%85%a5%e4%bb%a3%e7%a0%81%e5%90%a7">#&lt;/a>
è¿›å…¥ä»£ç å§
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">doGetBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">typeCheckOnly&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è½¬æ¢beanName&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">transformedBeanName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ ¹æ®beanNameæ‰¾å…¶å•ä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sharedInstance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sharedInstance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isSingletonCurrentlyInCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Returning eagerly cached instance of singleton bean &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; that is not fully initialized yet - a consequence of a circular reference&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Returning cached instance of singleton bean &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿”å›å¯¹åº”çš„å®ä¾‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectForBeanInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sharedInstance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RootBeanDefinition&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åŸå‹æ¨¡å¼ä¸‹,å¦‚æœè¿™ä¸ªbeanå·²ç»æ­£åœ¨åˆ›å»ºä¸­,è¯´æ˜æ˜¯å¦‚ä¸‹æƒ…å†µ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//Aä¸­æœ‰Bçš„å±æ€§,Bä¸­æœ‰Açš„å±æ€§,å½“ä¾èµ–æ³¨å…¥çš„æ—¶å€™,å°±å›äº§ç”Ÿå½“Aè¿˜æœªåˆ›å»ºå®Œçš„æ—¶å€™,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å› ä¸ºå¯¹äºBçš„åˆ›å»º,å†æ¬¡è¿”å›åˆ›å»ºA,é€ æˆå¾ªç¯ä¾èµ–&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‰€ä»¥å°±ä¼šæŠ¥é”™&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isPrototypeCurrentlyInCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanCurrentlyInCreationException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è·å–çˆ¶å·¥å‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getParentBeanFactory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæœ¬å·¥å‚æ²¡æœ‰è¿™ä¸ªbean,å­˜åœ¨çˆ¶å·¥å‚,å°±å»çˆ¶å·¥å‚æ‰¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nameToLookup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">originalBeanName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„ä¸‹é¢æ˜¯é€’å½’åœ°å»çˆ¶å·¥å‚æ‰¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nameToLookup&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nameToLookup&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸æ˜¯ä»…ä»…åšç±»æ£€æŸ¥åˆ™æ˜¯åˆ›å»ºbean,è¿™é‡Œè¦è¿›è¡Œè®°å½•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">typeCheckOnly&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">markBeanAsCreated&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RootBeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getMergedLocalBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkMergedBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dependsOn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDependsOn&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var11&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœå­˜åœ¨ä¾èµ–,å°±é€’å½’åœ°å…ˆå»å®ä¾‹åŒ–ä¾èµ–çš„bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dependsOn&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">var11&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dependsOn&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var12&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dependsOn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var13&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var13&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var12&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">var13&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dep&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var11&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">var13&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDependent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dep&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanCreationException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResourceDescription&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Circular depends-on relationship between &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; and &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dep&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerDependentBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dep&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dep&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isSingleton&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å•ä¾‹æ¨¡å¼çš„åˆ›å»º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sharedInstance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObject&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AbstractBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">AbstractBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">destroySingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectForBeanInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sharedInstance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isPrototype&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åŸå‹æ¨¡å¼çš„åˆ›å»º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">var11&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">prototypeInstance&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆ›å»ºåŸå‹ä¹‹å‰,å…ˆæŠŠprototypesCurrentlyInCreationé‡Œå¡å€¼,è¡¨ç¤ºå½“å‰æ­£åœ¨åˆ›å»ºå“ªäº›åŸå‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beforePrototypeCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„åˆ°createBeanè¿™ä¸ªæ–¹æ³•ç•™ç»™äº†å­ç±»å»å®ç°&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">prototypeInstance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ç§»å‡ºprototypesCurrentlyInCreation,è¡¨ç¤ºåˆ›å»ºè¿™ä¸ªåŸå‹ç»“æŸ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">afterPrototypeCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectForBeanInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">prototypeInstance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…¶å®ƒæ¨¡å¼çš„åˆ›å»º(æŒ‡å®šçš„scopeä¸Šå®ä¾‹åŒ–bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scopeName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getScope&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Scope&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scope&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Scope&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">scopes&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">scopeName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">scope&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;No Scope registered for scope name &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scopeName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scopedInstance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scope&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectFactory&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObject&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">AbstractBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beforePrototypeCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AbstractBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createBean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">AbstractBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">afterPrototypeCreation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectForBeanInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">scopedInstance&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mbd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IllegalStateException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var21&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanCreationException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Scope &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">scopeName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; is not active for the current thread; consider defining a scoped proxy for this bean if you intend to refer to it from a singleton&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var21&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var23&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">cleanupAfterBeanCreationFailure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var23&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ£€æŸ¥ç±»å‹æ˜¯å¦ç¬¦åˆbeançš„å®é™…ç±»å‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getTypeConverter&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">convertIfNecessary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TypeMismatchException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var22&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to convert bean &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; to required type &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getQualifiedName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var22&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanNotOfRequiredTypeException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getClass&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bean&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="æç‚¼å¤§è‡´æ­¥éª¤">
&lt;a href="#%e6%8f%90%e7%82%bc%e5%a4%a7%e8%87%b4%e6%ad%a5%e9%aa%a4">#&lt;/a>
æç‚¼å¤§è‡´æ­¥éª¤
&lt;/h4>&lt;p>è¿™120å¤šè¡Œçš„ä»£ç ,Springéƒ½å¹¶æ²¡æœ‰å†è¿›è¡Œé‡æ„,å¯è§å…¶å¤æ‚ç¨‹åº¦,è¾›äºæœ‰ä¹¦æœ¬è§£é‡Š,äº†è§£åˆ°å¤§è‡´æ­¥éª¤:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è½¬æ¢å¯¹åº”çš„beanName,å› ä¸ºä¼ å…¥çš„å‚æ•°å¯èƒ½æ˜¯alias&lt;/p>
&lt;p>ä»å…¶å…·ä½“æ–¹æ³•ä¸­çœ‹,æ˜¯ä¹‹å‰è§è¿‡çš„, å¤„ç†&lt;code>&amp;amp;&lt;/code> å’Œåˆ«åçš„é€’å½’å¯»æ‰¾æœ¬å.&lt;/p>
&lt;p>å»å‰é¢ç¬”è®°ä¸­å¯»æ‰¾,åœ¨ &lt;a class="link" href="http://heeexy.com/2017/09/15/spring_SimpleAliasRegistry/" target="_blank" rel="noopener"
>SimpleAliasRegistry&lt;/a> ä¸­å·²ç»ç ”ç©¶è¿‡æ­¤æ–¹æ³•&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°è¯•ä»ç¼“å­˜ä¸­åŠ è½½å•ä¾‹&lt;/p>
&lt;p>æ­¤æ—¶å¯èƒ½ä»ç¼“å­˜ä¸­å–å‡ºçš„æ˜¯è¿˜æ²¡åˆ›å»ºå¥½çš„bean,ä¸»è¦æ˜¯å› ä¸ºé˜²æ­¢å¾ªç¯ä¾èµ–&lt;/p>
&lt;/li>
&lt;li>
&lt;p>beançš„å®ä¾‹åŒ–&lt;/p>
&lt;p>å¦‚æœä»ç¼“å­˜ä¸­å¾—åˆ°äº†beançš„åŸå§‹çŠ¶æ€,åˆ™éœ€è¦å¯¹beanè¿›è¡Œå®ä¾‹åŒ–.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åŸå‹æ¨¡å¼çš„ä¾èµ–æ£€æŸ¥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ£€æµ‹parentBeanFactory&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†å­˜å‚¨XMLé…ç½®æ–‡ä»¶çš„GernericBeanDefinitionè½¬æ¢ä¸ºRootBeanDefinition&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯»æ‰¾ä¾èµ–&lt;/p>
&lt;p>å› ä¸ºbeançš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­å¾ˆå¯èƒ½ä¼šç”¨åˆ°æŸäº›å±æ€§,è€ŒæŸäº›å±æ€§å¾ˆå¯èƒ½æ˜¯åŠ¨æ€é…ç½®çš„,å¹¶ä¸”é…ç½®æˆä¾èµ–äºå…¶ä»–çš„bean,é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±æœ‰å¿…è¦å…ˆåŠ è½½ä¾èµ–çš„bean.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>é’ˆå¯¹ä¸åŒçš„scopeè¿›è¡Œbeançš„åˆ›å»º&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç±»å‹è½¬æ¢&lt;/p>
&lt;p>æœ‰å¯èƒ½æœ‰è¿™ç§æƒ…å†µ,è¿”å›çš„bean,æ˜¯ä¸ªString,ä½†æ˜¯requiredTypeä¼ å…¥çš„æ˜¯Integerç±»å‹,é‚£ä¹ˆè¿™æ—¶å€™æœ¬æ­¥éª¤å°±ä¼šèµ·ä½œç”¨äº†. Springä¸­æä¾›äº†å„ç§å„æ ·çš„è½¬æ¢å™¨,ç”¨æˆ·ä¹Ÿå¯ä»¥è‡ªå·±æ‰©å±•è½¬æ¢å™¨æ¥æ»¡è¶³éœ€æ±‚&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Springæºç ç¬”è®°-1.6 è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æ</title><link>https://heeexy.com/p/custom_element/</link><pubDate>Tue, 19 Sep 2017 19:33:23 +0800</pubDate><guid>https://heeexy.com/p/custom_element/</guid><description>&lt;h2 id="è‡ªå®šä¹‰æ ‡ç­¾çš„ä½¿ç”¨">
&lt;a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e6%a0%87%e7%ad%be%e7%9a%84%e4%bd%bf%e7%94%a8">#&lt;/a>
è‡ªå®šä¹‰æ ‡ç­¾çš„ä½¿ç”¨
&lt;/h2>&lt;p>ä¸»è¦å†…å®¹éƒ½åœ¨ä¹¦ä¸Š,p80&lt;/p>
&lt;p>å…³é”®çš„éƒ¨åˆ†ä¸º&lt;/p>
&lt;ul>
&lt;li>åˆ›å»ºXSDæ–‡ä»¶&lt;/li>
&lt;li>åˆ›å»ºç±» ç»§æ‰¿AbstractSingleBeanDefinitionParser , å…¶ç»§æ‰¿å…³ç³»æœ€ä¸»è¦æ˜¯å®ç°äº†&lt;code>BeanDefinitionParser&lt;/code> æ¥å£,é¡¾åæ€ä¹‰,å¯ä»¥ç”¨æ¥è§£æbean.&lt;/li>
&lt;li>åˆ›å»ºHandleræ–‡ä»¶, ç»§æ‰¿è‡ª NamespaceHandlerSupport ,ç›®çš„æ˜¯å°†ä¸Šé¢çš„ç»„ä»¶æ³¨å†Œåˆ°Springå®¹å™¨å†…&lt;/li>
&lt;li>ç¼–å†™Spring.handlers å’Œ Spring.schemasæ–‡ä»¶.&lt;/li>
&lt;/ul>
&lt;p>è¿™æ ·,è‡ªå®šä¹‰çš„é…ç½®å°±ç»“æŸäº†.&lt;/p>
&lt;p>SpringåŠ è½½è‡ªå®šä¹‰beançš„æµç¨‹ä¸»è¦å°±æ˜¯é‡åˆ°è‡ªå®šä¹‰æ ‡ç­¾åå°±å»Spring.handlerså’ŒSpring.schemasä¸­å–æ‰¾å¯¹åº”çš„handler å’Œ XSD .ä»è€Œå¯ä»¥æ‹¿åˆ°parser&lt;/p>
&lt;p>è€Œä»£ç é‡Œçš„ä¸»è¦æ­¥éª¤ä¸º&lt;/p>
&lt;ol>
&lt;li>æ‹¿åˆ°æ ‡ç­¾å¯¹åº”çš„å‘½åç©ºé—´&lt;/li>
&lt;li>æ ¹æ®å‘½åç©ºé—´æ‰¾åˆ°å¯¹åº”çš„handler&lt;/li>
&lt;li>è°ƒç”¨handlerçš„parseæ–¹æ³•&lt;/li>
&lt;/ol>
&lt;h2 id="è·å–æ ‡ç­¾çš„å‘½åç©ºé—´">
&lt;a href="#%e8%8e%b7%e5%8f%96%e6%a0%87%e7%ad%be%e7%9a%84%e5%91%bd%e5%90%8d%e7%a9%ba%e9%97%b4">#&lt;/a>
è·å–æ ‡ç­¾çš„å‘½åç©ºé—´
&lt;/h2>&lt;p>è°ƒç”¨org.w3c.dom.Nodeä¸­çš„getNamespaceURI()&lt;/p>
&lt;h2 id="æå–è‡ªå®šä¹‰æ ‡ç­¾å¤„ç†å™¨">
&lt;a href="#%e6%8f%90%e5%8f%96%e8%87%aa%e5%ae%9a%e4%b9%89%e6%a0%87%e7%ad%be%e5%a4%84%e7%90%86%e5%99%a8">#&lt;/a>
æå–è‡ªå®šä¹‰æ ‡ç­¾å¤„ç†å™¨
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readerContext&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getNamespaceHandlerResolver&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªresolveæ–¹æ³•æ˜¯æ¥å£,ç”±DefaultNamespaceHandlerResolver é»˜è®¤å‘½åç©ºé—´è§£æå™¨æ¥å®ç°,å…¶å®ç°é‡Œé¢çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getHandlerMappings&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åŸæ¥&lt;code>handlerMappings&lt;/code> æ˜¯ä¸ªmap,æƒ³å¿…æ˜¯åœ¨æ³¨å†Œæ—¶è‚¯å®šæŠŠè§£æå™¨æ·»åŠ åˆ°è¿™ä¸ªmapé‡Œé¢æ¥,ç”¨namespaceUriåškey,è¿™æ ·æ‰¾çš„æ—¶å€™å°±å¾ˆå¥½æ‰¾äº†.&lt;/p>
&lt;p>å–å‡ºç»“æœå¦‚æœæ˜¯NamespaceHandler ä¾¿å¯ä»¥è¿”å›,å¾€ä¸‹è¯»æˆ‘ä»¬å‘ç°,ä¹‹æ‰€ä»¥è¿™ä¹ˆçˆ½å–å‡ºæ¥å°±æ˜¯handler,æ˜¯å› ä¸ºå·²ç»åšè¿‡è¿™ä¸ªè§£æ,æŠŠæ‰¾å‡ºçš„handlerå¡å…¥äº†map,ç›¸å½“äºæ˜¯ç¼“å­˜äº†.&lt;/p>
&lt;p>å¦åˆ™å°±æ˜¯ç±»å className, æˆ‘ä»¬éœ€è¦æŠŠå®ƒè½¬ä¸ºhandler&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä½¿ç”¨åå°„,å°†ç±»è·¯å¾„è½¬åŒ–ä¸ºç±»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerClass&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">forName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">className&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">classLoader&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableFrom&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handlerClass&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FatalBeanException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Class [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">className&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;] for namespace [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;] does not implement the [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">class&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;] interface&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆå§‹åŒ–ç±»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceHandler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">BeanUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">instantiateClass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handlerClass&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è°ƒç”¨ç±»è‡ªå®šä¹‰çš„init()æ–¹æ³•,è¿™æ˜¯æ‰€æœ‰handleréƒ½å¿…é¡»å®ç°çš„æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceHandler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">init&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¡å…¥ç¼“å­˜&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceHandler&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceHandler&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è®¾è®¡æ¨¡å¼--å•ä¾‹æ¨¡å¼">
&lt;a href="#%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f--%e5%8d%95%e4%be%8b%e6%a8%a1%e5%bc%8f">#&lt;/a>
è®¾è®¡æ¨¡å¼&amp;ndash;å•ä¾‹æ¨¡å¼
&lt;/h3>&lt;p>this.getHandlerMappings(); è·å–handlerMappingå¤„ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼&lt;/p>
&lt;p>å£°æ˜ä¸ºvolatile&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">volatile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è·å–å•ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getHandlerMappings&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¯»å–&amp;#34;META-INF/spring.handlers&amp;#34; è½¬ä¸ºmap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Properties&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PropertiesLoaderUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">loadAllProperties&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappingsLocation&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">classLoader&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Loaded NamespaceHandler mappings: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mappings&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mappings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">CollectionUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">mergePropertiesIntoMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mappings&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappings&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handlerMappings&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">IOException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Unable to load NamespaceHandler mappings from location [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappingsLocation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">handlerMappings&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸Šé¢çš„volatileéå¸¸å…³é”®,å¦‚æœæ²¡æœ‰çš„è¯,åœ¨&lt;strong>åˆå§‹åŒ–å¯¹è±¡&lt;/strong> å’Œ &lt;strong>è®¾ç½®handlerMappingæŒ‡å‘å†…å­˜ç©ºé—´&lt;/strong> ä¸­é—´å¯èƒ½å‘ç”Ÿ&lt;strong>é‡æ’åº&lt;/strong>,å¯¼è‡´å¦å¤–çš„çº¿ç¨‹æ‹¿åˆ°äº†handlerMappingçš„ç©ºé—´åœ°å€,ä½†æ˜¯å…¶å®è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ.&lt;/p>
&lt;h2 id="æ ‡ç­¾è§£æ">
&lt;a href="#%e6%a0%87%e7%ad%be%e8%a7%a3%e6%9e%90">#&lt;/a>
æ ‡ç­¾è§£æ
&lt;/h2>&lt;p>æ‹¿åˆ°è§£æå™¨ä¹‹å,å°±è°ƒç”¨è§£æçš„parseæ–¹æ³•,è¿”å›BeanDefinition&lt;/p>
&lt;p>æˆ‘ä»¬çš„è‡ªå®šä¹‰handleré‡Œé¢æ— éœ€å®ç°parseæ–¹æ³•,åœ¨çˆ¶ç±»&lt;code>NamespaceHandlerSupport&lt;/code> ä¸­è‡ªæœ‰å®ç°,&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ParserContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parserContext&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findParserForElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parserContext&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">parse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parserContext&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/findParserForElement.png"
loading="lazy"
>&lt;/p>
&lt;p>è€Œparseæ–¹æ³•ä¸»è¦æ­¥éª¤å°±æ˜¯è°ƒç”¨è‡ªå·±å®ç°ç±»çš„&lt;code>parseInternal&lt;/code> æ–¹æ³•,&lt;code>parseInternal&lt;/code> æ–¹æ³•é™¤äº†è°ƒç”¨æˆ‘ä»¬å®ç°çš„doParseæ–¹æ³•ä¹‹å¤–,é¦–å…ˆä¼šè¿›è¡Œä¸€ç³»åˆ—çš„æ•°æ®å‡†å¤‡,åŒ…æ‹¬å¯¹beanClass.scope.lazyInitç­‰å±æ€§çš„å‡†å¤‡&lt;/p></description></item><item><title>Springæºç ç¬”è®°-1.5 å…¶å®ƒæ ‡ç­¾è§£æ</title><link>https://heeexy.com/p/other_default_elements/</link><pubDate>Tue, 19 Sep 2017 19:33:04 +0800</pubDate><guid>https://heeexy.com/p/other_default_elements/</guid><description>&lt;h2 id="æœ¬æ–‡è¦çœ‹å•¥">
&lt;a href="#%e6%9c%ac%e6%96%87%e8%a6%81%e7%9c%8b%e5%95%a5">#&lt;/a>
æœ¬æ–‡è¦çœ‹å•¥
&lt;/h2>&lt;p>ä¹‹å‰æˆ‘ä»¬çœ‹è§£æé»˜è®¤æ ‡ç­¾,ä»æœ€æ ¸å¿ƒçš„beanå¼€å§‹çœ‹çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">parseDefaultElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;import&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">importBeanDefinitionResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;alias&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">processAliasRegistration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;bean&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">processBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;beans&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doRegisterBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç°åœ¨ä¸»è¦å°±å‰©ä¸‹aliaså’Œimportå•¦, beanså…¶å®å°±æ˜¯è¿­ä»£è§£æ.&lt;/p>
&lt;h2 id="aliasæ ‡ç­¾çš„è§£æ">
&lt;a href="#alias%e6%a0%87%e7%ad%be%e7%9a%84%e8%a7%a3%e6%9e%90">#&lt;/a>
aliasæ ‡ç­¾çš„è§£æ
&lt;/h2>&lt;p>ä¸ºbeanå®šä¹‰åˆ«å,é™¤äº†ä¹‹å‰æˆ‘ä»¬æ¥è§¦è¿‡çš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;bean&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;testBean&amp;#34;&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;aliasTestBean&amp;#34;&lt;/span> &lt;span class="na">class=&lt;/span>&lt;span class="s">&amp;#34;com.test&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜å¯ä»¥ç›´æ¥ç”¨aliasæ ‡ç­¾&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;alias&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;testBean&amp;#34;&lt;/span> &lt;span class="na">alias=&lt;/span>&lt;span class="s">&amp;#34;aliasTestBean&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è§£ææ­¥éª¤å³ä½¿ä¸çœ‹æºç ä¹ŸçŸ¥é“å¾ˆç®€å•,å› ä¸ºä¹‹å‰æˆ‘ä»¬å·²ç»æ·±å…¥ç ”ç©¶è¿‡äº†&lt;a class="link" href="http://heeexy.com/2017/09/15/spring_SimpleAliasRegistry/" target="_blank" rel="noopener"
>SimpleAliasRegistry&lt;/a>&lt;/p>
&lt;ol>
&lt;li>æ ¡éªŒ name alias ä¸¤ä¸ªå±æ€§ä¸èƒ½ä¸ºç©º&lt;/li>
&lt;li>&lt;code>this.getReaderContext().getRegistry().registerAlias(name, alias);&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>è¿™ä¸ªgetRegistry() ç„¶åregisterAlias() æœç„¶å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„&lt;code>SimpleAliasRegistry&lt;/code> é‡Œé¢çš„æ³¨å†Œåˆ«åçš„æ–¹æ³•.&lt;/p>
&lt;h2 id="imporyæ ‡ç­¾çš„è§£æ">
&lt;a href="#impory%e6%a0%87%e7%ad%be%e7%9a%84%e8%a7%a3%e6%9e%90">#&lt;/a>
imporyæ ‡ç­¾çš„è§£æ
&lt;/h2>&lt;p>importæ ‡ç­¾å’Œbeanæ ‡ç­¾ä¸€æ ·æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ ‡ç­¾,å¯¹äºåˆ†æ¨¡å—ç®¡ç†é…ç½®æ–‡ä»¶å¾ˆå…³é”®.&lt;/p>
&lt;h4 id="è§£ææ­¥éª¤">
&lt;a href="#%e8%a7%a3%e6%9e%90%e6%ad%a5%e9%aa%a4">#&lt;/a>
è§£ææ­¥éª¤
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>å–å‡ºå¹¶æ ¡éªŒ&lt;code>resource&lt;/code> å±æ€§ä½œä¸ºåœ°å€location&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å°†åœ°å€ä¸­çš„ç³»ç»Ÿå±æ€§ å¦‚ &amp;ldquo;${user.dir}&amp;rdquo;&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ¤æ–­locationæ˜¯ç»å¯¹è·¯å¾„è¿˜æ˜¯ç›¸å¯¹è·¯å¾„&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¦‚æœæ˜¯,åˆ™&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">importCount&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getReader&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">loadBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">actualResources&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>å¦åˆ™&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Resource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">relativeResource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">createRelative&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">relativeResource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">exists&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">importCount&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getReader&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">loadBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">relativeResource&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">actualResources&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">relativeResource&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">baseLocation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getURL&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">importCount&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getReader&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">loadBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">applyRelativePath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">baseLocation&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">actualResources&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>è¿˜æ˜¯é¢„ç•™ç»™æ‹“å±•ç›‘å¬äº‹ä»¶çš„ä½ç½®.&lt;/li>
&lt;/ol>
&lt;h4 id="å…³é”®æ­¥éª¤">
&lt;a href="#%e5%85%b3%e9%94%ae%e6%ad%a5%e9%aa%a4">#&lt;/a>
å…³é”®æ­¥éª¤
&lt;/h4>&lt;h5 id="åˆ¤æ–­æ˜¯å¦ç»å¯¹è·¯å¾„">
&lt;a href="#%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e7%bb%9d%e5%af%b9%e8%b7%af%e5%be%84">#&lt;/a>
åˆ¤æ–­æ˜¯å¦ç»å¯¹è·¯å¾„
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">absoluteLocation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResourcePatternUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isUrl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResourceUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toURI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">location&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">isAbsolute&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>isUrl : ä»¥ classpath*: å¼€å¤´ æˆ–è€… classpath: å¼€å¤´ æˆ–è€… å¯ä»¥new URL(resourceLocation); è€Œä¸æŠ¥é”™&lt;/p>
&lt;p>ResourceUtils.toURI(location): æ›¿æ¢è·¯å¾„ä¸­ç©ºæ ¼ä¸º%20 å new URI ,ç„¶åæ‹¿absoluteå±æ€§&lt;/p>
&lt;h5 id="åŠ è½½bean">
&lt;a href="#%e5%8a%a0%e8%bd%bdbean">#&lt;/a>
åŠ è½½bean
&lt;/h5>&lt;p>å…¶å®æœ€åéƒ½æ˜¯è°ƒç”¨åœ¨ç¬¬ä¸€ç¯‡åšæ–‡ä¸­æˆ‘ä»¬å°±çœ‹è¿‡çš„ &lt;code>loadBeanDefinitions&lt;/code> æ–¹æ³•&lt;/p></description></item><item><title>test_volatile_object</title><link>https://heeexy.com/p/test_volatile_object/</link><pubDate>Mon, 18 Sep 2017 22:28:29 +0800</pubDate><guid>https://heeexy.com/p/test_volatile_object/</guid><description>&lt;h3 id="æœ¬æ–‡è¦çœ‹å•¥">
&lt;a href="#%e6%9c%ac%e6%96%87%e8%a6%81%e7%9c%8b%e5%95%a5">#&lt;/a>
æœ¬æ–‡è¦çœ‹å•¥
&lt;/h3>&lt;hr>
&lt;p>å…ˆä¸ç»†è°ˆvolatileçš„åŸºæœ¬åŸç†,åœ¨è¯»(å†™)è¿™ç¯‡æ–‡ç« æ—¶,éƒ½æ˜¯å‡è®¾æˆ‘ä»¬å·²ç»ç²—ç•¥äº†è§£äº†ä¸€ç‚¹volatileçš„åŸç†å’Œä½œç”¨çš„,ä¸»è¦å°±æ˜¯ &amp;ldquo;&lt;u>è¯»å†™éƒ½èµ°ä¸»å†…å­˜,ä¿è¯ä»»æ„çº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡çš„å¯è§æ€§&lt;/u>&amp;rdquo;&lt;/p>
&lt;p>åœ¨æŸ¥çœ‹springæºç çš„æ—¶å€™,æ³¨æ„åˆ°springåœ¨å¤„ç†å¹¶å‘çš„æ“ä½œList&lt;String>æ—¶, è™½ç„¶å¯¹listä½¿ç”¨äº†volatile, ç„¶è€Œå‘listé‡Œé¢æ·»åŠ å…ƒç´ æ—¶,ç”¨çš„è¿˜æ˜¯æ–°å»ºä¸€ä¸ªlist,å¤åˆ¶å…¨éƒ¨æ—§å€¼,å¢åŠ æ–°å…ƒç´ ,ç„¶åå°†æ—§çš„liståœ°å€æŒ‡å‘æ–°çš„list.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¹ˆéº»çƒ¦çš„æ“ä½œ,ç¬¬ä¸€ååº”å°±æ˜¯,volatileä¿®é¥°çš„list, ç›´æ¥æ·»åŠ å…ƒç´ &lt;strong>ä¾ç„¶ä¸å®‰å…¨&lt;/strong>ä¹ˆ?&lt;/p>
&lt;p>å»ç½‘ä¸Šæœäº†ä¸€ä¸‹ç›¸å…³é—®é¢˜, &lt;a class="link" href="http://blog.csdn.net/u014108122/article/details/38173201" target="_blank" rel="noopener"
>å‚è€ƒåšæ–‡åœ°å€&lt;/a> ,å‘ç°ä¸æ­¢list, å¯¹è±¡ä¹Ÿæ˜¯ä¸€æ ·çš„.&lt;/p>
&lt;p>æœ¬æ–‡å°±æ˜¯è¦æ¥ç”¨ä»£ç ç›´è§‚åœ°çœ‹çœ‹volatile åˆ°åº•æœ‰ä»€ä¹ˆæ•ˆæœ,æ€ä¹ˆç”¨æ‰æœ‰æ•ˆæœ.&lt;/p>
&lt;h3 id="å¼€å§‹ä»£ç å§">
&lt;a href="#%e5%bc%80%e5%a7%8b%e4%bb%a3%e7%a0%81%e5%90%a7">#&lt;/a>
å¼€å§‹ä»£ç å§
&lt;/h3>&lt;hr>
&lt;h4 id="çº¿ç¨‹å…±äº«å¯¹è±¡é‡Œçš„boolean">
&lt;a href="#%e7%ba%bf%e7%a8%8b%e5%85%b1%e4%ba%ab%e5%af%b9%e8%b1%a1%e9%87%8c%e7%9a%84boolean">#&lt;/a>
çº¿ç¨‹å…±äº«å¯¹è±¡é‡Œçš„boolean
&lt;/h4>&lt;p>æ³¨æ„ä»£ç è¦ä»¥**-serveræ¨¡å¼**è¿è¡Œï¼Œå¼ºåˆ¶è™šæ‹Ÿæœºå¼€å¯ä¼˜åŒ–&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">VolatileObjectTest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// åŠ ä¸Švolatile å°±å¯ä»¥æ­£å¸¸ç»“æŸWhileå¾ªç¯äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">VolatileObjectTest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">stop&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setFlag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFlag&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> æ³¨æ„è¿™é‡Œçš„sysout,å¦‚æœæœ‰è°ƒç”¨çš„è¯,å³ä½¿æ²¡æœ‰volatile,å­çº¿ç¨‹ä¹Ÿç»å¸¸èƒ½æ‹¿åˆ°a.flag,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ç»“åˆåé¢çš„æµ‹è¯•,å‘ç°sysout æˆ–è€… sysout(a.isFlag())ä¹‹å‰æœ‰&amp;#34;---&amp;#34;ä¹‹ç±»å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> éƒ½å¯èƒ½è®©aå»ä»ä¸»å†…å­˜å»è·å–å€¼,å½±å“æˆ‘ä»¬æµ‹è¯•çš„ç»“æœ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> æ‰€ä»¥æµ‹è¯•çš„æ—¶å€™ä¸è¦ä¹±æ‰“sysoutäº†,æ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªå·±å»å„ç§æµ‹è¯•ä¸€é
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// System.out.println(); &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å­çº¿ç¨‹æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ³¨æ„ä»£ç è¦ä»¥-serveræ¨¡å¼è¿è¡Œï¼Œå¼ºåˆ¶è™šæ‹Ÿæœºå¼€å¯ä¼˜åŒ–&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå¯åŠ¨çš„æ—¶å€™åŠ ä¸Š-server å‚æ•°åˆ™ä¼š è¾“å‡º Java HotSpot(TM) Server VM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;java.vm.name&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">VolatileObjectTest2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">VolatileObjectTest2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">stop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹ç»“æŸ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isFlag&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setFlag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªä»£ç è¿˜æ˜¯å¾ˆç®€å•,&lt;/p>
&lt;p>ä¸»çº¿ç¨‹å°†açš„flagæ”¹ä¸ºfalse,&lt;/p>
&lt;p>å­çº¿ç¨‹èƒ½æ­£å¸¸ç»“æŸçš„è¯, è¯´æ˜å­çº¿ç¨‹é‡Œ a çš„ flagå€¼è·å–åˆ°äº†false,&lt;/p>
&lt;p>ä¸èƒ½æ­£å¸¸ç»“æŸçš„è¯, è¯´æ˜å­çº¿ç¨‹aä¸€ç›´éƒ½æ˜¯ç”¨å…¶æœ¬åœ°å†…å­˜é‡Œçš„flagå€¼,ä¸€ç›´éƒ½æ˜¯true.&lt;/p>
&lt;p>æµ‹è¯•ç»“æœå°±æ˜¯&lt;/p>
&lt;ol>
&lt;li>æœ‰volatile ä¿®é¥°çš„æƒ…å†µä¸‹, å­çº¿ç¨‹èƒ½æ‹¿åˆ°falseå€¼&lt;/li>
&lt;li>æ²¡æœ‰volatile ,å­çº¿ç¨‹æ— æ³•æ­£å¸¸ç»“æŸ&lt;/li>
&lt;/ol>
&lt;p>åœ¨åˆæ­¥äº†è§£volatile çš„å¯è§æ€§çš„æƒ…å†µä¸‹, æˆ‘ä¼šè§‰å¾—è¿™ä¸ªç»“æœå¾ˆæ­£å¸¸, è§‰å¾—è‡ªå·±æŒæ¡äº†volatile , ä½†æ˜¯æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹&amp;hellip;&lt;/p>
&lt;h4 id="çº¿ç¨‹å…±äº«å¯¹è±¡é‡Œçš„å¯¹è±¡">
&lt;a href="#%e7%ba%bf%e7%a8%8b%e5%85%b1%e4%ba%ab%e5%af%b9%e8%b1%a1%e9%87%8c%e7%9a%84%e5%af%b9%e8%b1%a1">#&lt;/a>
çº¿ç¨‹å…±äº«å¯¹è±¡é‡Œçš„å¯¹è±¡
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">VolatileObjectTest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">implements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Runnable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// åŠ ä¸Švolatile å°±å¯ä»¥æ­£å¸¸ç»“æŸWhileå¾ªç¯äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">volatile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">VolatileObjectTest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">stop&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectB&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">setFlag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Override&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">run&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">long&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFlag&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFlag&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectB&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">isFlag&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å­çº¿ç¨‹æ­£å¸¸ç»“æŸ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">InterruptedException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¦‚æœå¯åŠ¨çš„æ—¶å€™åŠ ä¸Š-server å‚æ•°åˆ™ä¼š è¾“å‡º Java HotSpot(TM) Server VM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getProperty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;java.vm.name&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">VolatileObjectTest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">VolatileObjectTest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectA&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="na">start&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">stop&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Thread&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;ä¸»çº¿ç¨‹ç»“æŸ&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ObjectA&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">objectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isFlag&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setFlag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getObjectB&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">objectB&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ObjectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isFlag&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setFlag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">flag&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">flag&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ¬¡åœ¨ObjectAå†…æ·»åŠ äº†ä¸€ä¸ªæˆå‘˜å˜é‡ObjectB,æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­è·³å‡ºå¾ªç¯éœ€è¦ObjectBä¸­çš„flagå˜ä¸ºfalse;&lt;/p>
&lt;p>å®é™…æµ‹è¯•æ—¶å‘ç°:&lt;/p>
&lt;ol>
&lt;li>æ— è®ºObjectAå‰æœ‰æ²¡æœ‰ volatile, è°ƒç”¨stop()æ–¹æ³•éƒ½å¹¶ä¸èƒ½æ­£ç¡®ç»ˆæ­¢å­çº¿ç¨‹&lt;/li>
&lt;li>æˆå‘˜å˜é‡ObjectBå‰æ·»åŠ volatile,åŒæ ·ä¸èƒ½æ­£ç¡®ç»ˆæ­¢å­çº¿ç¨‹&lt;/li>
&lt;li>ObjectBçš„flagå‰åŠ volatile,å¯ä»¥ç»ˆæ­¢å­çº¿ç¨‹ (è¿™æ˜¯å½“ç„¶çš„å•¦&amp;hellip;)&lt;/li>
&lt;li>å¦‚æœå¾ªç¯é‡Œç”¨çš„æ˜¯ &lt;code>while (a.getObjectB().isFlag())&lt;/code> , ObjectAå‰åˆæœ‰volatileçš„è¯, è¿™æ ·è¿˜æ˜¯å¯ä»¥ç»ˆæ­¢å­çº¿ç¨‹.&lt;/li>
&lt;/ol>
&lt;p>æµ‹åˆ°è¿™é‡Œ,æ„Ÿè§‰è¿™ä¸ªåšä¸»ç»™çš„ä¾‹å­æ˜¯ä¸æ˜¯æœ‰é—®é¢˜å•Š,&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectB&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getObjectB&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">b&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isFlag&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é—®é¢˜æ˜¯å‡ºåœ¨è¿™é‡Œæå‰ä»aé‡Œé¢å–å‡ºäº†bä¹ˆ,bå·²ç»æŒ‡å‘ä¸åŒçš„å†…å­˜åœ°å€äº†ä¹ˆ?ä¸åº”è¯¥å§&amp;hellip;&lt;/p>
&lt;p>ç¨åŠ æ€è€ƒ,ç¬¬ä¸‰ç§ç»“æœé‡Œ,b.flagç”¨volatileä¿®é¥°å,å°±å¯ä»¥æ­£å¸¸é€€å‡º,è¯´æ˜bè¿˜æ˜¯æŒ‡å‘çš„aé‡Œé¢çš„bçš„åœ°å€å•Š,æ²¡æ¯›ç—…å•Š.&lt;/p>
&lt;p>çªç„¶æ„Ÿè§‰æ›´æ™•äº†,æŠŠåŸåšçš„è¯„è®ºç¿»åˆ°åº•,å‘ç°è¿˜çœŸæœ‰äººè¯„è®ºåˆ°è¿™ä¸ª,ä»è¯„è®ºé‡Œåˆå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿.&lt;/p>
&lt;h4 id="åŸåšè¯„è®ºåŒºçš„è§£ç–‘">
&lt;a href="#%e5%8e%9f%e5%8d%9a%e8%af%84%e8%ae%ba%e5%8c%ba%e7%9a%84%e8%a7%a3%e7%96%91">#&lt;/a>
åŸåšè¯„è®ºåŒºçš„è§£ç–‘
&lt;/h4>&lt;p>Q: ä¸ºä»€ä¹ˆsysoutå½±å“ç»“æœ?&lt;/p>
&lt;p>A: å¦‚æœåœ¨å¾ªç¯ä½“å†…åŠ ä¸€äº›è¯­å¥,æ¯”å¦‚sysoutæˆ–è€…newå¯¹è±¡ä¹‹ç±»çš„ç¨å¾®å¤æ‚è€Œè€—æ—¶çš„æ“ä½œ,å°±ä¼šå‘ç°å°±ç®—æ²¡æœ‰volatile,çº¿ç¨‹åŒæ ·å¯èƒ½è¢«æ­£å¸¸ä¸­æ–­.å› ä¸º&lt;strong>ç»è¿‡é«˜è€—æ—¶æ“ä½œä¹‹å,CPUä¼š&amp;quot;æ€€ç–‘äººç”Ÿ&amp;quot;&lt;/strong>,å•å¿ƒè‡ªå·±å¯¹b.flagçš„ç¼“å­˜ä¸æ˜¯æœ€æ–°çš„,è€Œå»ä»ä¸»å­˜è·å–.åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçº¿ç¨‹ä¼šç»“æŸï¼Œåªä¸è¿‡ä¸åŠæ—¶è€Œå·²ã€‚&lt;/p>
&lt;p>Q: ä¸ºä»€ä¹ˆ while (b.isFlag()) å’Œwhile(a.getObjectB.isFlag()) ç»“æœæœ‰åŒºåˆ«,åè€…å°±å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„flagå€¼?&lt;/p>
&lt;p>A: ä¸€ä¸ªvolatileå¼•ç”¨çš„åŸŸæˆ–è€…å…ƒç´ å¹¶ä¸å…·å¤‡volatileç‰¹æ€§ï¼Œå› ä¸ºå¯¹äºè¯¥åŸŸçš„å†™å…¥å¹¶ä¸ä¼šè§¦å‘StoreLoadå±éšœï¼Œå°±&lt;strong>ä¸ä¼šå¼ºè¿«è¯¥åŸŸå€¼ç«‹åˆ»å›å†™ä¸»å­˜&lt;/strong>ã€‚ä¸è¿‡å…¶è¯»ç‰¹æ€§å¹¶æ²¡æœ‰é—®é¢˜ï¼Œ&lt;strong>å¯¹volatileçš„è¯»æ“ä½œä¸€å®šæ˜¯å»ä¸»å­˜å½“ä¸­è¯»å–çš„&lt;/strong>ã€‚&lt;/p>
&lt;p>æ‰€ä»¥a.getObjectB åœ¨è¿™é‡Œaå°±å·²ç»å»ä»ä¸»å­˜ä¸­è¯»å–äº†.&lt;/p>
&lt;p>è¿™ä¸€ç‚¹å› æ­¤ä¹Ÿå°±è§£é‡Šäº†ç¬¬ä¸€ä¸ªä¾‹å­ä¸­,æˆ‘ä»¬ä¿®æ”¹a.flag,å¯ä»¥æ­£å¸¸åœ°è¯»åˆ°flagå€¼.&lt;/p>
&lt;p>Q: ä½†æ˜¯é—®é¢˜åˆæ¥äº†,å†™å…¥ä¸èƒ½ä¿è¯åˆ·æ–°åˆ°ä¸»å­˜çš„è¯,å²‚ä¸æ˜¯å³ä½¿&lt;code>while(a.getObjectB.isFlag())&lt;/code> ä¹Ÿæ˜¯ä»ç„¶å¾ˆæœ‰å¯èƒ½å¤±è´¥çš„?ç»è¿‡åˆšæ‰ä¾‹å­çš„åå¤æµ‹è¯•,ä¾ç„¶å¾ˆéš¾ç¢°åˆ°ç»ˆæ­¢çº¿ç¨‹å¤±è´¥çš„æƒ…å†µ.&lt;/p>
&lt;p>A: è¿™ä¸ªä¾‹å­è¿˜æ˜¯æ— æ³•æµ‹å‡ºè¿™ç§åˆ·æ–°ä¸»å­˜ä¸åŠæ—¶çš„æƒ…å†µ,æ¯•ç«Ÿå³ä½¿æ˜¯ä¸åŠæ—¶åˆ·æ–°,æœ€ç»ˆåˆ·æ–°äº†è¿˜æ˜¯å¯ä»¥è®©å­çº¿ç¨‹ç»“æŸçš„.&lt;/p>
&lt;p>&lt;a class="link" href="http://ifeve.com/volatile-array-visiblity/" target="_blank" rel="noopener"
>å¦å¤–ä¸€ç¯‡åšå®¢&lt;/a> ä»æ±‡ç¼–è¯­å¥çš„è§’åº¦åˆ†æäº†&lt;strong>volatileçš„æ•°ç»„åªé’ˆå¯¹æ•°ç»„çš„å¼•ç”¨å…·æœ‰volatileçš„è¯­ä¹‰ï¼Œè€Œä¸æ˜¯å®ƒçš„å…ƒç´ &lt;/strong> , æš‚æ—¶åªèƒ½è®°å½•ä¸‹æ¥,å¾…ä»¥åå†æ·±å…¥åŸç†å»ç†è§£.&lt;/p>
&lt;h4 id="ç•™ä¸‹æ›´å¤šçš„ç–‘æƒ‘">
&lt;a href="#%e7%95%99%e4%b8%8b%e6%9b%b4%e5%a4%9a%e7%9a%84%e7%96%91%e6%83%91">#&lt;/a>
ç•™ä¸‹æ›´å¤šçš„ç–‘æƒ‘
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>å¦‚ä¸Šé¢æ‰€è¯´,ä¸€ä¸ªvolatileå¼•ç”¨çš„åŸŸæˆ–è€…å…ƒç´ å¹¶ä¸å…·å¤‡volatileç‰¹æ€§ï¼Œå› ä¸ºå¯¹äºè¯¥åŸŸçš„å†™å…¥å¹¶ä¸ä¼šè§¦å‘StoreLoadå±éšœï¼Œå°±&lt;strong>ä¸ä¼šå¼ºè¿«è¯¥åŸŸå€¼ç«‹åˆ»å›å†™ä¸»å­˜&lt;/strong>ã€‚ å¦‚ä½•è¯æ˜?&lt;/p>
&lt;/li>
&lt;li>
&lt;p>springé‡Œç”¨ç½®æ¢çš„æ–¹å¼çœŸçš„ä¸ä¼šå‡ºé—®é¢˜ä¹ˆ? å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–äº†ä¸€ä¸ªlist,ç„¶åå„è‡ªåŠ ä¸€ä¸ªå…ƒç´ è¿›å»,åˆ·æ–°,è¿™æ ·ä¸å°±å‡ºäº†é—®é¢˜?&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœè¯´è¿™æ ·å¹¶ä¸å®‰å…¨,é‚£ä¹ˆconcurrentåŒ…é‡Œæ˜¯æ€ä¹ˆå®ç°å®‰å…¨çš„listçš„å‘¢?&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ReentrantLock&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">lock&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">elements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getArray&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">elements&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Object&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newElements&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">copyOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">elements&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">newElements&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">setArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newElements&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">finally&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">lock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">unlock&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ReentrantLock è²Œä¼¼æ˜¯å®‰å…¨äº†, ä½†æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œä¹Ÿç”¨äº†ç½®æ¢æ•°ç»„å•Š???&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>SimpleAliasRegistry</title><link>https://heeexy.com/p/spring_simplealiasregistry/</link><pubDate>Fri, 15 Sep 2017 21:27:09 +0800</pubDate><guid>https://heeexy.com/p/spring_simplealiasregistry/</guid><description>&lt;p>åŠŸèƒ½:æ³¨å†Œ/å­˜æ”¾åˆ«å&lt;/p>
&lt;p>å”¯ä¸€æˆå‘˜å˜é‡ä¸º&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliasMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™Map&amp;lt;String,String&amp;gt; å…¶å®keyæ˜¯alias,valueæ˜¯name. åˆšå¼€å§‹æ²¡æ³¨æ„å¯èƒ½æåäº†å‘¢&lt;/p>
&lt;h2 id="æ³¨å†Œåˆ«åregisteralias">
&lt;a href="#%e6%b3%a8%e5%86%8c%e5%88%ab%e5%90%8dregisteralias">#&lt;/a>
æ³¨å†Œåˆ«å&lt;code>registerAlias()&lt;/code>
&lt;/h2>&lt;hr>
&lt;p>ä¸¾ä¾‹æ¥è¯´ æˆ‘ä»¬è¦æ³¨å†Œçš„beanNameä¸º&lt;strong>myTestBean&lt;/strong> , åˆ«åä¸º&lt;strong>mtb&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ ¡éªŒnameå’Œaliaséƒ½ä¸ä¸ºç©º&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœnameå’Œaliasä¸€æ ·,é‚£mapé‡Œåˆ äº†è¿™æ¡name,ç»“æŸ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¾æ®alias å³ &lt;strong>mtb&lt;/strong>å»mapé‡Œé¢å–å·²æ³¨å†Œçš„name,å¦‚æœçœŸçš„æœ‰å·²æ³¨å†Œè¿‡çš„è¯:&lt;/p>
&lt;ol>
&lt;li>&lt;code>registeredName&lt;/code> å’Œ&lt;code>name&lt;/code>ç›¸ç­‰çš„è¯,é‚£å°±ä¸ç”¨ç®¡,ç»“æŸ.&lt;/li>
&lt;li>å¦‚æœä»–ä¿©ä¸ç›¸ç­‰,è¿™ä¸ªå·¥å‚åˆä¸å…è®¸é‡å†™alias,é‚£å°±æŠ›å¼‚å¸¸! (&lt;code>allowAliasOverriding()&lt;/code> è¿™ä¸ªæ–¹æ³•åœ¨SimpleAliasRegistryçš„å­ç±»é‡Œé¢æœ‰çš„ä¼šè¢«é‡å†™.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœå‰é¢éƒ½é€šè¿‡äº†,&lt;code>this.checkForAliasCircle(name, alias);&lt;/code> å†æ¬¡å¾ªç¯æ£€æŸ¥ä¸€é,åˆ¤æ–­æ˜¯å¦&lt;code>hasAlias()&lt;/code>,å¦‚æœæ˜¯trueçš„è¯,å°±æŠ¥é”™,ä¸æ˜¯çš„è¯,èµ°ç¬¬5æ­¥. å…·ä½“&lt;code>hasAlias()&lt;/code>æµç¨‹å¦‚ä¸‹:&lt;/p>
&lt;ol>
&lt;li>å¾ªç¯æ‰¾å‡º&lt;code>registeredName&lt;/code> ä¸º&lt;strong>myTestBean&lt;/strong>çš„é‚£ç»„é”®å€¼å¯¹ (è¿™é‡Œå’Œä¸Šé¢çš„éå†ä¸ä¸€æ ·å“¦,è¿™é‡Œæ˜¯æ ¹æ®ç›´æ¥æ‰¾é‡å¤çš„beanNameçš„,ä¸Šé¢æ˜¯æ‰¾é‡å¤çš„aliasçš„&lt;/li>
&lt;li>å¦‚æœè¿™ä¸ªé”®å€¼å¯¹çš„keyå³aliasä¹Ÿæ˜¯ç­‰äº&lt;strong>mtb&lt;/strong>çš„è¯,æŠ¥é”™ (ä½†æ˜¯å®é™…æˆ‘ä»¬è¿™ç¬¬ä¸‰æ­¥ä¹ŸæŸ¥è¿‡è¿™ç§æƒ…å†µ)&lt;/li>
&lt;li>å¦‚æœè¿™ä¸ªmyTestBeanæ‰¾å‡ºæ¥çš„aliasæ˜¯&amp;quot;myTB&amp;quot;,é‚£å°±è¿˜è¦èµ°ä¸€é&lt;code>hasAlias(&amp;quot;myTB&amp;quot;,&amp;quot;mtb&amp;quot;)&lt;/code> ,æ¢å¥è¯è¯´,å°±æ˜¯è¦çœ‹ä¸€çœ‹æ˜¯ä¸æ˜¯æœ‰å“ªä¸ªbeanåå­—å«myTB,åˆ«åå«mtbçš„,å¦‚æœçœŸçš„æœ‰,å°±è¿”å›true&lt;/li>
&lt;/ol>
&lt;p>ç¬¬å››æ­¥çš„&lt;code>hasAlias()&lt;/code> è¿™ç§åˆ¤æ–­æ˜¯å•¥æ„æ€å‘¢?&lt;/p>
&lt;p>æƒ³æ³¨å†Œ mtb&amp;ndash;myTestBean (åˆ«å&amp;ndash;æœ¬å)&lt;/p>
&lt;p>å¦‚æœå·²å­˜åœ¨ mtb&amp;ndash;myTestBean ,é‚£ä¹ˆè¿”å›true&lt;/p>
&lt;p>å¦‚æœå·²å­˜åœ¨ myTB&amp;ndash;myTestBean,&lt;/p>
&lt;p>â€‹ ä¸”å­˜åœ¨ mtb&amp;ndash;myTB ,&lt;/p>
&lt;p>é‚£å°±æ„æˆäº† &lt;strong>mtb&amp;ndash;myTB&amp;ndash;myTestBean&lt;/strong> ä¹Ÿè¿”å›true&lt;/p>
&lt;p>å¦‚æœå·²å­˜åœ¨ myTB&amp;ndash;myTestBean,&lt;/p>
&lt;p>â€‹ ä¸”å­˜åœ¨ mta&amp;ndash;myTB&lt;/p>
&lt;p>â€‹ ä¸”å­˜åœ¨ mtb&amp;ndash;mta ,&lt;/p>
&lt;p>é‚£å°±æ„æˆäº† &lt;strong>mtb&amp;ndash;mta&amp;ndash;myTB&amp;ndash;myTestBean&lt;/strong> è¿˜æ˜¯è¿”å›true&lt;/p>
&lt;p>.&lt;/p>
&lt;p>è¿™ä¸‹çœ‹æ˜ç™½äº†å§,&lt;/p>
&lt;p>è¯´æ˜hasAlias()æ–¹æ³•ä¸æ­¢åˆ¤æ–­mtbæ˜¯å¦å·²ç»åšäº†myTestBeançš„åˆ«å,&lt;/p>
&lt;p>è¿˜åˆ¤æ–­äº†mtbæ˜¯ä¸æ˜¯myTestBeançš„åˆ«å çš„åˆ«å çš„åˆ«å çš„åˆ«å çš„åˆ«å&amp;hellip;.æœ€ç»ˆèƒ½é€šè¿‡ä¸€æ¡çº¿å¯¼å‘myTestBean&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœå‰é¢å„ç§æ ¡éªŒå…¨éƒ¨é€šè¿‡ ,&lt;code>this.aliasMap.put(alias, name);&lt;/code> å¾ˆç®€å•,mapé‡Œé¢å¡å€¼å§!&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>å‰é¢æ ¡éªŒçœ‹ç€å¾ˆå•°å—¦,å…¶å®æ€»ç»“èµ·æ¥éƒ½å¾ˆç®€å•&lt;/p>
&lt;ol>
&lt;li>é”®å€¼éƒ½ä¸èƒ½ä¸ºç©º&lt;/li>
&lt;li>åˆ«é”®å€¼ç›¸ç­‰,æˆ‘ä¼šåˆ äº†è¿™ä¸ªåˆ«åçš„(è™½ç„¶ä½ åº”è¯¥æœ¬æ¥å°±æ·»åŠ ä¸è¿›æ¥)&lt;/li>
&lt;li>åˆ«åå·²ç”¨è¿‡,å¦‚æœè¿˜æ˜¯åŸname,é‚£ä¸ç”¨æ“ä½œ&lt;/li>
&lt;li>åˆ«åå·²ç”¨è¿‡,è¿™æ¬¡æ¢äº†æ–°name,é‚£å°±çœ‹ä½ æ³¨å†Œå™¨å…ä¸å…è®¸æˆ‘æè¦†ç›–å’¯&lt;/li>
&lt;li>åˆ«å‘Šè¯‰æˆ‘è¿™ä¸ªaliaså±…ç„¶è¿˜æ˜¯é‚£ä¸ªnameçš„åˆ«åçš„åˆ«å&amp;hellip;&lt;/li>
&lt;/ol>
&lt;p>ç¬¬5ç§çš„æƒ…å†µè®©æˆ‘çªç„¶æƒ³åˆ°,è¿™ç§è¿ç¯å…³ç³»åº”è¯¥è¿ç”³è¯·éƒ½ç”³è¯·ä¸äº†å§,å³ä½¿çœŸçš„æƒ³æå‡ºè¿ç¯å…³ç³»,ä¹Ÿåº”è¯¥æ˜¯ä¸‹é¢è¿™ç§æƒ…å†µå§??&lt;/p>
&lt;p>&lt;strong>myTB&amp;ndash;myTestBeanå·²æ³¨å†Œå¥½äº†,æ–°æ¥ä¸ªbeanæƒ³æ³¨å†ŒbeanNameå«myTB&lt;/strong>&lt;/p>
&lt;p>åº”è¯¥åœ¨ç”³è¯·æ³¨å†ŒbeanNameå«myTBçš„æ—¶å€™å°±&lt;strong>æ ¡éªŒè¿‡äº†å§&lt;/strong>!!!&lt;/p>
&lt;p>å¥½,ç¿»å›å»æ‰¾æ‰¾æ³¨å†ŒbeanNameçš„æ—¶å€™,æ˜¯ä¸æ˜¯å·²ç»æ ¡éªŒè¿‡ä¸èƒ½å’Œå·²æ³¨å†Œçš„aliasé‡å!&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">parseBeanDefinitionElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containingBean&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nameAttr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//éƒ½å¿˜æ‰äº†beanåŸæœ¬æ²¡æœ‰aliaså±æ€§äº†......&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//aliasesæ•°ç»„æ˜¯åŸæœ¬çš„nameé‡Œé¢çš„å¤šä¸ªå€¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é™¤éä¹‹å‰æ²¡id,æœ‰name, é‚£ä¹ˆä»aliasesé‡Œremove(0)å‡ºå»åšbeanName,å‰©ä¸‹çš„ç»§ç»­åšalias&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasLength&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nameAttr&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nameArr&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">tokenizeToStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nameAttr&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nameArr&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;No XML &amp;#39;id&amp;#39; specified - using &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; as bean name and &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34; as aliases&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">containingBean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åœ¨è¿™é‡Œæ ¡éªŒä¸€æ³¢beanNameå’Œaliasçš„å”¯ä¸€æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkNameUniqueness&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">....&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ ¡éªŒé‡åçš„æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">checkNameUniqueness&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanElement&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//çœ‹å·²ç”¨åé‡Œæ˜¯å¦åŒ…æ‹¬äº†beanName&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">usedNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//çœ‹å·²ç”¨åé‡Œæ˜¯å¦ç”¨è¿‡äº†è¿™äº›alias&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">CollectionUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">findFirstMatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">usedNames&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Bean name &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foundName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; is already used in this &amp;lt;beans&amp;gt; element&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanElement&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„è¿™ä¸ªåœ°æ–¹, beanNameå’Œaliaseséƒ½æ˜¯å…¨éƒ¨åŠ å…¥usedNamesçš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é‚£å°±è¯´æ˜,åœ¨å‰é¢æ ¡éªŒçš„æ—¶å€™,å·²ç”¨åå°±æ˜¯åŒ…æ‹¬å·²ç”¨beanNameå’Œå·²ç”¨aliasçš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‰€ä»¥å¦‚æœmyTB--myTestBeanå·²æ³¨å†Œå¥½äº†,myTBå’ŒmyTestBeanéƒ½è¢«usedNameæ”¶å½•äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å†æƒ³æ‹¿myTBåšbeanNameè‚¯å®šä¸è¡Œäº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">usedNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">usedNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰€ä»¥å…¶å®æ˜¯æ ¡éªŒè¿‡çš„å•Š,æ„Ÿè§‰ä¸Šé¢è€ƒè™‘çš„ç¬¬5ç§æƒ…å†µæœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾å‘¢&amp;hellip;&lt;/p>
&lt;p>è¿˜æ˜¯æ¥çœ‹çœ‹ç±»é‡Œé¢çš„å…¶å®ƒæ–¹æ³•å§&lt;/p>
&lt;h2 id="å–æ¶ˆæ³¨å†Œåˆ«åremovealias">
&lt;a href="#%e5%8f%96%e6%b6%88%e6%b3%a8%e5%86%8c%e5%88%ab%e5%90%8dremovealias">#&lt;/a>
å–æ¶ˆæ³¨å†Œåˆ«å&lt;code>removeAlias()&lt;/code>
&lt;/h2>&lt;hr>
&lt;p>å¾ˆç®€å•,mapç›´æ¥removeè¿™ä¸ªåˆ«å,å¦‚æœremoveç»“æœæ˜¯null,é‚£æŠ›ä¸ªå¼‚å¸¸&lt;/p>
&lt;h2 id="åˆ¤æ–­æ˜¯å¦ä¸ºåˆ«å-isalias">
&lt;a href="#%e5%88%a4%e6%96%ad%e6%98%af%e5%90%a6%e4%b8%ba%e5%88%ab%e5%90%8d-isalias">#&lt;/a>
åˆ¤æ–­æ˜¯å¦ä¸ºåˆ«å &lt;code>isAlias()&lt;/code>
&lt;/h2>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è·å–æŸä¸ªnameçš„æ‰€æœ‰åˆ«å-getaliasesstring-name">
&lt;a href="#%e8%8e%b7%e5%8f%96%e6%9f%90%e4%b8%aaname%e7%9a%84%e6%89%80%e6%9c%89%e5%88%ab%e5%90%8d-getaliasesstring-name">#&lt;/a>
è·å–æŸä¸ªnameçš„æ‰€æœ‰åˆ«å &lt;code>getAliases(String name)&lt;/code>
&lt;/h2>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//åŠ äº†ä¸ªåŒæ­¥,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">retrieveAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">retrieveAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">entrySet&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//éå†map,æ‰¾å‡ºvalueç­‰äºè¿™ä¸ªnameçš„key&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Entry&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Entry&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">var3&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">registeredName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">registeredName&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">entry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getKey&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„è¿™é‡Œ,å‰å®³äº†,å±…ç„¶è¿˜çœŸçš„é€’å½’åœ°å»æ‰¾å®ƒçš„åˆ«åçš„åˆ«å(çš„åˆ«åçš„åˆ«å...)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åˆ°åº•ä»€ä¹ˆåœ°æ–¹èƒ½åˆ¶é€ å‡ºé“¾å¼çš„åˆ«åå•Šå•Šå•Šå•Š????&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">retrieveAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦å¤–æ³¨æ„åˆ°,getAliases()æ–¹æ³•åœ¨AbstractBeanFactoryå…¶å®æ˜¯æœ‰é‡å†™çš„å•Š,ç¨åå»çœ‹çœ‹!&lt;/p>
&lt;h2 id="æ‰¾æœ¬åcanonicalname">
&lt;a href="#%e6%89%be%e6%9c%ac%e5%90%8dcanonicalname">#&lt;/a>
æ‰¾æœ¬å&lt;code>canonicalName()&lt;/code>
&lt;/h2>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">canonicalName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canonicalName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">canonicalName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">canonicalName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">canonicalName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–¹æ³•å¾ˆç®€å•,å°±æ˜¯ä¸€å±‚ä¸€å±‚åœ°å»æ‰¾è¿™ä¸ªåå­—çš„æœ¬å.&lt;/p>
&lt;h2 id="abstractbeanfactory-å¯¹getaliases-çš„é‡å†™">
&lt;a href="#abstractbeanfactory-%e5%af%b9getaliases-%e7%9a%84%e9%87%8d%e5%86%99">#&lt;/a>
&lt;code>AbstractBeanFactory&lt;/code> å¯¹&lt;code>getAliases()&lt;/code> çš„é‡å†™
&lt;/h2>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‰¾åˆ°è¿™ä¸ªnameçš„çœŸæ­£çš„beanName, &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//transformedBeanNameé‡Œé¢çš„æ“ä½œä¸»è¦æ˜¯å»é™¤å¤´éƒ¨æ‰€æœ‰&amp;amp;ç¬¦å·,ä»¥åŠè°ƒç”¨ä¸Šé¢çš„canonicalName()æ¥æ‰¾æœ¬å&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">transformedBeanName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">factoryPrefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">startsWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">fullBeanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">factoryPrefix&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœåŸnameä»¥&amp;amp;å¼€å¤´(å¯èƒ½å¤šä¸ª&amp;amp;),è¡¨ç¤ºå·¥å‚å‰ç¼€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//beanå…¨åå°±åŠ ä¸Šä¸€ä¸ª&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">fullBeanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">fullBeanName&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœbeanå…¨åè¿˜ä¸ç­‰äºåŸå, è¯´æ˜åŸåå¯èƒ½æ˜¯ &amp;amp;&amp;amp;&amp;amp;myTestBean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é‚£ä¹ˆæŠŠ&amp;amp;myTestBeanä¹Ÿä½œä¸ºå®ƒçš„ä¸€ä¸ªåˆ«å&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fullBeanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//è°ƒç”¨ä¸Šé¢æˆ‘ä»¬SimpleAliasRegistryçš„æ–¹æ³•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">retrievedAliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">retrievedAliases&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">retrievedAliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var9&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var9&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var8&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">var9&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">retrievedAlias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var7&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">var9&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ˜¯å·¥å‚bean,é…ä¸Šå·¥å‚å‰ç¼€&amp;amp;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">factoryPrefix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">retrievedAlias&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//åªè¦ä¸ç­‰äºæˆ‘ä»¬çš„name,é€šé€šå¯ä»¥åšä¸ºåˆ«å &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//å¦‚æœè¿™ä¸ªbeanNameå¯¹åº”çš„beanä¸æ˜¯å•ä¾‹,å¹¶ä¸”è¿™ä¸ªbeanNameè¿˜æ²¡æ³¨å†Œbean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getParentBeanFactory&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¹¶ä¸”å®ƒè¿˜æœ‰çˆ¶å·¥å‚,é‚£å°±ä»å®ƒçš„çˆ¶å·¥å‚é‡Œé¢æ‰¾&amp;amp;myTestBeançš„åˆ«å ,éƒ½ç®—è¿›æ¥æ˜¯å®ƒçš„åˆ«å&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Arrays&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">asList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAliases&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fullBeanName&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è™½ç„¶è¿™ä¸ªæ–¹æ³•çœ‹å¾—è¿˜ä¸æ˜¯å¾ˆæ˜ç™½,ä½†å¤§æ¦‚çŸ¥é“,è¿™é‡Œçš„é‡å†™ä¸»è¦æ˜¯ç‰µæ‰¯åˆ°äº†è¿™ä¸ªbeançš„å·¥å‚ç›¸å…³å±æ€§,å¾…åé¢äº†è§£äº†å·¥å‚åº”è¯¥å°±èƒ½æ¸…æ¥šè¿™é‡Œçš„åˆ«åä¸å·¥å‚çš„å…³ç³»äº†.&lt;/p>
&lt;h2 id="è§£æåˆ«åresolvealiasesstringvalueresolver-valueresolver">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%88%ab%e5%90%8dresolvealiasesstringvalueresolver-valueresolver">#&lt;/a>
è§£æåˆ«å&lt;code>resolveAliases(StringValueResolver valueResolver)&lt;/code>
&lt;/h2>&lt;hr>
&lt;p>è¿™é‡Œçš„å…¥å‚éœ€è¦ä¼ ä¸ªå€¼è§£æå™¨,&lt;/p>
&lt;p>åŠ é”,å¤åˆ¶å‡ºmap,éå†map,æ‹¿åˆ°alias,registeredName, ä»¥åŠ,ç”¨è§£æå™¨è§£æåçš„resolvedAlias,resolvedName&lt;/p>
&lt;p>å¦‚æœè§£æåçš„åˆ«å,æœ¬åæœ‰ä¸€è€…ä¸ºç©º,æˆ–è€…äºŒè€…ç›¸ç­‰,é‚£ä¹ˆå°±è¦ä»mapé‡Œç§»é™¤è¿™ä¸ªalias,è¯´æ˜è¿™ä¸ªaliaså¤šä½™äº†,æ²¡ä½œç”¨.&lt;/p>
&lt;p>å¦åˆ™&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¦‚æœè§£æååˆ«åå’Œè§£æå‰åˆ«åä¸€è‡´,é‚£ä¹ˆæŠŠè§£æå‰åˆ«å aliasæŒ‡å‘è§£æåçš„æœ¬å,resolvedName (è¿™é‡Œå°±ç›´æ¥è¦†ç›–æ‰åŸaliasçš„æ˜ å°„äº†&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœè§£æååˆ«åå’Œè§£æå‰ä¸ä¸€è‡´&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//å…ˆæ‰¾æ‰¾è§£æååˆ«åæ˜¯ä¸æ˜¯åœ¨mapé‡Œæœ‰æ˜ å°„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">existingName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedAlias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">existingName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæœ‰çš„è¯,å¹¶ä¸”è¿˜æŒ‡å‘äº†å…¶å®ƒå€¼,é‚£å°±è¦æŠ›å¼‚å¸¸äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">existingName&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">throw&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Cannot register resolved alias &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedAlias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39; (original: &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;) for name &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;: It is already registered for name &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">registeredName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;.&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦åˆ™ç›´æ¥ä»mapé‡Œç§»é™¤åŸæ¥çš„aliasåˆ«åå°±å¤Ÿäº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨å†Œè§£æåçš„åˆ«å--è§£æåçš„æœ¬å&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">checkForAliasCircle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedAlias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„åˆ°è¿™é‡Œå’Œæ™®é€šæ³¨å†Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯è¿™é‡Œè¿˜è¦ç§»é™¤åŸalias&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">aliasMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resolvedAlias&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resolvedName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>æ‰€ä»¥æ€»ç»“ä¸€ä¸‹è¿™ä¸ªå¤„ç†è§£æAliasesçš„ç›®çš„&lt;/p>
&lt;p>éå†map,æ¯ä¸ªé”®å€¼å¯¹éƒ½è§£æä¸€é,&lt;/p>
&lt;p>å¦‚æœè¿™å¯¹èƒ½è§£æå‡ºæ–°çš„ä¸€å¯¹åˆæ³•åˆ«å&amp;ndash;æœ¬åé”®å€¼å¯¹,é‚£ä¹ˆå°±æŠŠä¹‹å‰çš„é‚£å¯¹åˆ æ‰,æ³¨å†Œæ–°çš„è¿™ä¸ªè§£æåçš„ä¸€å¯¹,&lt;/p>
&lt;p>æ­¤å¤–æ£€éªŒä¸‹è§£æåçš„åˆ«åæ˜¯ä¸æ˜¯è¢«å ç”¨,å¦‚æœå ç”¨äº†è¿˜æŒ‡å‘é”™äº†å€¼,å°±æŠ›å¼‚å¸¸,&lt;/p>
&lt;p>å¦‚æœå ç”¨äº†ä¹Ÿæ˜¯æŒ‡å‘è§£æååå­—,é‚£å°±è¯´æ˜è§£æåçš„è¿™å¯¹å·²ç»æ³¨å†Œå¥½äº†,åªéœ€åˆ æ‰æ—§çš„é‚£å¯¹&lt;/p></description></item><item><title>Springæºç ç¬”è®°-1.4 è·å–beanæµç¨‹ä¹‹æ³¨å†ŒBeanDefinition</title><link>https://heeexy.com/p/registerbeandefinition/</link><pubDate>Fri, 15 Sep 2017 21:26:00 +0800</pubDate><guid>https://heeexy.com/p/registerbeandefinition/</guid><description>&lt;h3 id="æœ¬æ–‡è¦çœ‹å•¥">
&lt;a href="#%e6%9c%ac%e6%96%87%e8%a6%81%e7%9c%8b%e5%95%a5">#&lt;/a>
æœ¬æ–‡è¦çœ‹å•¥
&lt;/h3>&lt;hr>
&lt;p>è¿™ä¸ªbeanæ€»ç®—æ˜¯è§£æå®Œäº†,ä¹Ÿè£…é¥°å®Œäº†,ç­‰äºæ˜¯è¯´ä¿¡æ¯æˆ‘ä»¬éƒ½æå–å¥½äº†,ç°åœ¨è¯¥åšçš„å°±æ˜¯å»æ³¨å†Œå•¦.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionReaderUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getRegistry&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°±æ˜¯è¿™ä¸ªæ–¹æ³•äº†&lt;/p>
&lt;h3 id="å¼€å§‹è¿›å…¥æ–¹æ³•å§">
&lt;a href="#%e5%bc%80%e5%a7%8b%e8%bf%9b%e5%85%a5%e6%96%b9%e6%b3%95%e5%90%a7">#&lt;/a>
å¼€å§‹è¿›å…¥æ–¹æ³•å§
&lt;/h3>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">registerBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">definitionHolder&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionRegistry&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">registry&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionStoreException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">definitionHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanName&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">registry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">definitionHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanDefinition&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">definitionHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAliases&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">length&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var6&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">var6&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="o">[&lt;/span>&lt;span class="n">var6&lt;/span>&lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">registry&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerAlias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">alias&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>
&lt;p>æ‹¿åˆ°beanName&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”¨beanNameå’Œbdå»registryé‡Œæ³¨å†Œ.&lt;/p>
&lt;blockquote>
&lt;p>registryæ˜¯ä¸ªæ¥å£,å…·ä½“çš„å®ç°åœ¨4.3.7ç‰ˆæœ¬ä¸­çœ‹åˆ°ä¸¤ç§,ä¸€ç§æ˜¯SimpleBeanDefinitionRegistryé‡Œ,å’Œå®ƒåå­—ä¸€æ ·éå¸¸ç®€å•,å°±æ˜¯å¡è¿›map, å¦å¤–ä¸€ç§å°±å¤æ‚äº†,ç¨åæˆ‘ä»¬å†æ¥çœ‹&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>ç”¨beanNameå’Œaliaså»registryé‡Œæ³¨å†Œ&lt;/p>
&lt;blockquote>
&lt;p>æ³¨å†Œaliasesä¹Ÿæ˜¯æ¥å£ ,BeanDefinitionRegistryè¿˜æ˜¯ç»§æ‰¿è‡ªAliasRegistryçš„, 4.3.7åªçœ‹åˆ°SimpleAliasRegistryä¸€ç§å®ç°&lt;/p>
&lt;/blockquote>
&lt;p>æ³¨å†Œaliaså°±ç®€å•å¤šäº†, SimpleAliasRegistryé‡Œæœ‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliasMap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConcurrentHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">16&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¨åæˆ‘å†å¦å¼€ä¸€æ–‡æŠŠSimpleAliasRegistryæ¥è¯»ä¸€é&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="æ³¨å†Œbeandefinitionholder">
&lt;a href="#%e6%b3%a8%e5%86%8cbeandefinitionholder">#&lt;/a>
æ³¨å†ŒBeanDefinitionHolder
&lt;/h3>&lt;hr>
&lt;p>é™¤äº†ä¹‹å‰çš„&lt;code>SimpleBeanDefinitionRegistry&lt;/code> ç›´æ¥å¾€mapé‡Œé¢å¡å€¼çš„æ³¨å†Œæ–¹å¼ä¹‹å¤–,æˆ‘ä»¬è¿˜æœ‰DefaultListableBeanFactory è¿™ä¸ªç±»æ¥å®ç°æ³¨å†ŒåŠŸèƒ½,æˆ‘ä»¬ä¸»è¦æ¥äº†è§£ä¸€ä¸‹è¿™ç§æ³¨å†Œæ–¹å¼&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ ¡éªŒç©ºå‚æ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœbdhæ˜¯&lt;code>AbstractBeanDefinition&lt;/code> ,é‚£å°±è¦æ‰§è¡Œå®ƒçš„&lt;code>validate()&lt;/code> æ ¡éªŒ&lt;/p>
&lt;ol>
&lt;li>bdhçš„methodOverrideå’Œå®ƒçš„å·¥å‚&lt;strong>ä¸èƒ½åŒæ—¶å­˜åœ¨&lt;/strong>&lt;/li>
&lt;li>å¦‚æœå®ƒbeanClassæœ‰å€¼,é‚£å°±è¦ä¸ºæ–¹æ³•è¦†ç›–åšå‡†å¤‡ &lt;code>prepareMethodOverrides()&lt;/code> ,éå†å®ƒçš„overrides,æ‰¾è¿™ä¸ªBeançš„Classé‡Œé¢æœ‰å‡ ä¸ªå«è¿™ä¸ªåå­—çš„æ–¹æ³•, &lt;strong>å¦‚æœ0ä¸ª,å°±æŠ›é”™&lt;/strong>,å¦‚æœ1ä¸ª,å°±è®¾ç½®é‡è½½å±æ€§ä¸ºfalseè¡¨ç¤ºæ²¡é‡è½½.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>ä»è¿™ä¸ªå·¥å‚é‡Œé¢&lt;code>beanDefinitionMap&lt;/code> æ‹¿åŸæ¥çš„å«è¿™ä¸ªbeanNameçš„bdå‡ºæ¥,å¦‚æœä¸ä¸ºç©º,è¿›è¡Œä¸‹åˆ—æ ¡éªŒåŠæ“ä½œ&lt;/p>
&lt;blockquote>
&lt;p>ä¹¦ä¸­æºç spring 3.2 é‡‡ç”¨sychronized , è€Œ4.3ç‰ˆæœ¬çš„beanDefinitionMapå·²ç»ç”¨ä¸Šäº†ConcurrentHashMap,å¹¶ä¸”mapçš„valueç”¨äº†BD,è€Œä¸æ˜¯3.2é‡Œé¢çš„Object&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>å¦‚æœå·¥å‚ä¸å…è®¸beanè¦†ç›–,é‚£ä¹ˆæŠ›é”™&lt;/li>
&lt;li>å¦‚æœæ—§beançš„roleå€¼å°äºæ–°çš„,æˆ–è€…æ–°æ—§bdå®Œå…¨ç›¸ç­‰,æˆ–è€…ä¸ç›¸ç­‰,å„æ‰“å°ä¸€ä¸‹æ—¥å¿—&lt;/li>
&lt;li>æŠŠæ–°çš„bdæ”¾å…¥&lt;code>beanDefinitionMap&lt;/code>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>ç¬¬ä¸€æ¬¡æ³¨å†Œè¿™ä¸ªbean, å¦‚æœæœ¬å·¥å‚çš„&lt;code>alreadyCreated&lt;/code> ä¹Ÿæ˜¯ç©ºçš„è¯,é‚£å°±ä¸ç”¨åŠ é”,ç›´æ¥&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//mapé‡Œå¡å…¥bd &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å·²æ³¨å†Œåå­—é‡ŒåŠ å…¥beanName &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å”¯ä¸€åå†Œé‡Œç§»å‡ºbeanName(å•¥æ—¶å€™åŠ å…¥äº†???) &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">manualSingletonNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœæœ¬å·¥ç¨‹å·²ç»æœ‰åˆ›å»ºè¿‡beanäº†,é‚£ä¹ˆæ¥ä¸‹æ¥ä¸€æ®µä»£ç å°±è¦åŠ synchronizedäº†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Map&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionMap&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">synchronized&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionMap&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//mapé‡Œå¡å…¥bd &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionMap&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ³¨æ„åˆ°åé¢è¿™æ®µæ“ä½œå…¶å®æ˜¯æ–°å»ºä¸ªæ•°ç»„,åŠ ä¸Šè¿™æ¬¡æ³¨å†ŒbeanName,ç„¶åæ›¿æ¢ä¹‹å‰çš„æ•°ç»„....&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä¸ºä»€ä¹ˆè¿™ä¹ˆå¤æ‚å‘¢???&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ArrayList&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addAll&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">beanDefinitionNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedDefinitions&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœå”¯ä¸€åå†Œé‡ŒåŒ…å«beanName&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">manualSingletonNames&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°±ç§»å‡ºå»,ä½†æ˜¯è¿™é‡Œä¹Ÿå’Œä¸Šé¢ä¸€æ ·,ææ›¿æ¢....&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedSingletons&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedHashSet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">manualSingletonNames&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">updatedSingletons&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">manualSingletonNames&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">updatedSingletons&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>ç–‘é—®: è¿™é‡Œéƒ½ç”¨äº†æ›¿æ¢,æ˜æ˜&lt;code>beanDefinitionNames&lt;/code> å’Œ&lt;code>manualSingletonNames&lt;/code> éƒ½æ˜¯volatileå£°æ˜çš„,æ¯æ¬¡è¯»éƒ½ä»ä¸»å†…å­˜å–,æ¯æ¬¡å†™éƒ½éƒ½å°†å€¼å†™åˆ°ä¸»å†…å­˜, è¿™é‡Œä¸ºä»€ä¹ˆè¿˜è¦è¿™ä¹ˆéº»çƒ¦å¾—å»å¼€æ–°çš„listå’Œset,æ›¿æ¢æ—§çš„å‘¢?&lt;/p>
&lt;p>ç­”:ä»ç½‘ä¸Šæœåˆ°,volatileä¿®é¥°çš„å˜é‡å¦‚æœæ˜¯å¯¹è±¡æˆ–æ•°ç»„ä¹‹ç±»çš„ï¼Œå…¶å«ä¹‰æ˜¯å¯¹è±¡æˆ–æ•°ç»„çš„&lt;strong>åœ°å€å…·æœ‰å¯è§æ€§&lt;/strong>ï¼Œä½†æ˜¯æ•°ç»„æˆ–å¯¹è±¡&lt;strong>å†…éƒ¨çš„æˆå‘˜æ”¹å˜ä¸å…·å¤‡å¯è§æ€§&lt;/strong>,é‚£ç­‰äºå°±æ˜¯è¯´éå¾—æ•´ä¸ªåœ°å€æ›¿æ¢æ‰è¡Œå’¯.&lt;/p>
&lt;p>å¾ˆçˆ½,ä»è¿™æœ¬ä¹¦è¦è·³åˆ°æˆ‘æ­£åœ¨è¯»çš„å¹¶å‘ç¼–ç¨‹ç›¸å…³çš„å†…å®¹äº†,è¿™å‡ å¤©å†å»ç ”ç©¶ä¸€æ³¢volatile,å¯ä»¥å†å¼€ä¸€æ–‡. &lt;a class="link" href="http://blog.csdn.net/u014108122/article/details/38173201" target="_blank" rel="noopener"
>å‡†å¤‡å‚è€ƒåœ°å€&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ol>
&lt;p>ç„¶å&lt;code>this.frozenBeanDefinitionNames = null;&lt;/code> è¿™ä¸ªå†»ç»“/å–æ¶ˆå†»ç»“bdNamesçš„åŠŸèƒ½æš‚æ—¶ä¹Ÿä¸çŸ¥é“å¹²å•¥çš„,åœ¨æ³¨å†Œå’Œåˆ é™¤bdçš„åœ°æ–¹çœ‹åˆ°äº†è¿™æ ·çš„ç½®ä¸ºnull,&lt;/p>
&lt;p>â€‹ åªåœ¨&lt;code>freezeConfiguration()&lt;/code> æ–¹æ³•å†…çœ‹åˆ°æŠŠå®ƒç½®ä¸ºbdNamesè½¬çš„String[] .&lt;/p>
&lt;p>â€‹ å¦å¤–åœ¨&lt;code>getBeanDefinitionNames()&lt;/code> æ–¹æ³•é‡Œæœ‰åˆ¤æ–­è¿™ä¸ª&lt;/p>
&lt;p>ç„¶å&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//å¦‚æœæœ‰è€bdæˆ–è€… è¿™ä¸ªbeanæ˜¯å•ä¾‹å¯¹è±¡?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">oldBeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">containsSingleton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//é‡ç½®bean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">resetBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é‡ç½®çš„ä¸»è¦å†…å®¹æœ‰&lt;/p>
&lt;ul>
&lt;li>æ¸…é™¤mergedBD&lt;/li>
&lt;li>é”€æ¯å•ä¾‹&lt;/li>
&lt;li>éå†ä¹‹å‰çš„bean,çœ‹æ–°æ³¨å†Œçš„è¿™ä¸ªbeanæ˜¯è°çš„çˆ¹(parent),é‚£äº›å„¿å­ä¹Ÿéƒ½è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œé‡ç½®&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>ä¸å¾—ä¸è¯´è¿™ä¸ª&lt;code>DefaultListableBeanFactory&lt;/code> çš„æˆå‘˜å˜é‡å®åœ¨å¤ªå¤šäº†,æä¸æ¸…æ¥šä¸€ä¸ªä¸ªéƒ½æ˜¯è¦å¹²å•¥çš„,åé¢å†æ¬¡é‡åˆ°çš„æ—¶å€™å†æ…¢æ…¢çœ‹å§&lt;/p>
&lt;/blockquote>
&lt;h3 id="æ³¨å†Œalias">
&lt;a href="#%e6%b3%a8%e5%86%8calias">#&lt;/a>
æ³¨å†ŒAlias
&lt;/h3>&lt;hr>
&lt;p>4.3.7ç‰ˆæœ¬çš„å®ç°åœ¨&lt;code>SimpleAliasRegistry&lt;/code> é‡Œ, è¯¦æƒ…è§ &lt;a class="link" href="https://heeexy.com/2017/09/15/spring_SimpleAliasRegistry/" >è¿™ä¸€ç¯‡åšæ–‡&lt;/a>&lt;/p>
&lt;h3 id="æ³¨å†Œå®Œæˆ">
&lt;a href="#%e6%b3%a8%e5%86%8c%e5%ae%8c%e6%88%90">#&lt;/a>
æ³¨å†Œå®Œæˆ
&lt;/h3>&lt;hr>
&lt;p>å…¶å®æ²¡æœ‰æ“ä½œäº†, ä½†æ˜¯ä½œè€…ç•™äº†ä¸ªä½ç½®åœ¨è¿™&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">fireComponentRegistered&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanComponentDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœç¨‹åºå¼€å‘äººå‘˜éœ€è¦å¯¹æ³¨å†ŒBeanDefinitionæ—¶é—´è¿›è¡Œç›‘å¬æ—¶,å¯ä»¥é€šè¿‡æ³¨å†Œç›‘å¬å™¨çš„æ–¹å¼æ¥åš.Springå¹¶æ²¡æœ‰å†æ­¤åšä»»ä½•é€»è¾‘å¤„ç†&lt;/p>
&lt;h3 id="å‘Šä¸€æ®µè½">
&lt;a href="#%e5%91%8a%e4%b8%80%e6%ae%b5%e8%90%bd">#&lt;/a>
å‘Šä¸€æ®µè½
&lt;/h3>&lt;hr>
&lt;p>è‡³æ­¤,æˆ‘ä»¬çš„è§£ææ³¨å†ŒBeanæ ‡ç­¾å¯ç®—æ˜¯å‘Šä¸€æ®µè½å•¦,è™½ç„¶é‡Œé¢è¿˜ç•™ä¸‹äº†å¾ˆå¤šç–‘é—®å¾…åç»­é˜…è¯»ä¸­å¼„æ¸….&lt;/p>
&lt;p>å…ˆæƒ³æƒ³ä¹‹å‰æ˜¯åœ¨å“ªåˆ†å‰å‡ºå»çš„å§.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">parseDefaultElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;import&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">importBeanDefinitionResource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;alias&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">processAliasRegistration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;bean&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°±æ˜¯è¿™é‡Œå•¦,æˆ‘ä»¬å…ˆå»é˜…è¯»æœ€å¤æ‚çš„beançš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">processBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">nodeNameEquals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;beans&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™ä¸ªåœ°æ–¹æˆ‘è¿˜è®°å¾—,beansæ ‡ç­¾æ˜¯ç»•å›å»è§£æçš„,ä¸ç”¨çœ‹äº†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doRegisterBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†ä¹‹å‰å‘¢,&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">parseBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NodeList&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getChildNodes&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getLength&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">nl&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">item&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°±æ˜¯è¿™ä¸ªåœ°æ–¹,å·®ä¸å¤šæƒ³èµ·æ¥äº†,beansæ ‡ç­¾é‡Œé¢çš„å­å…ƒç´ , å¦‚æœæ˜¯é»˜è®¤å‘½åç©ºé—´,å°±æŒ‰é»˜è®¤æ–¹å¼å»è§£æ&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseDefaultElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œæ˜¯ä¸ªåˆ†å‰,è§£æè‡ªå®šä¹‰å…ƒç´ ,ä»¥åå†çœ‹&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseCustomElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™å’Œä¸Šé¢ä¸€æ ·çš„åˆ†å‰,è§£æè‡ªå®šä¹‰å…ƒç´ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseCustomElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å†ä¹‹å‰å‘¢&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">doRegisterBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createDelegate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;profile&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">specifiedProfiles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">tokenizeToStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getEnvironment&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">acceptsProfiles&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">specifiedProfiles&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isInfoEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Skipped XML bean definition file due to specified profiles [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;] not matching: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">preProcessXml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä»è¿™é‡Œèµ°å‡ºå»çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">postProcessXml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åˆ°è¿™è¿˜è¦æ¸©ä¹ ä¸€éçš„è¯,å¯ä»¥å»çœ‹Springçš„&lt;a class="link" href="https://heeexy.com/2017/09/11/spring_note_1/" >ç¬¬ä¸€ç¯‡ç¬”è®°&lt;/a>äº†&lt;/p>
&lt;p>å“ˆå“ˆ,è¿™ä¹ˆç‚¹ä¸œè¥¿,è¯»äº†ä¸€ä¸ªç¤¼æ‹œ,è¯»äº†åé¢çš„å¿˜äº†å‰é¢çš„,è¿˜æ˜¯åœ¨è¯»è¯»è®°è®°çš„æƒ…å†µä¸‹,&lt;/p>
&lt;p>è¦æ˜¯æ²¡æœ‰è¿™ä¸ªç¬”è®°,è¿™æ—¶å€™ä¼°è®¡å·²ç»è¿·è·¯å¾—è¦æ”¾å¼ƒäº†,ä¸å®¹æ˜“å•Š&lt;/p>
&lt;p>ä¸è¯´äº† &lt;a class="link" href="https://heeexy.com/2017/09/15/spring_SimpleAliasRegistry/" >SimpleAliasRegistry&lt;/a> å’Œ&lt;code>volatile&lt;/code> ä¸¤ç¯‡æ–‡ç« çš„å‘è¿˜ç•™ç€å‘¢,ç»§ç»­&amp;hellip;&lt;/p></description></item><item><title>Springæºç ç¬”è®°-1.3 è·å–beanæµç¨‹ä¹‹è§£æbeanæ ‡ç­¾ä¸­çš„è‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ </title><link>https://heeexy.com/p/spring_note_3/</link><pubDate>Fri, 15 Sep 2017 21:24:00 +0800</pubDate><guid>https://heeexy.com/p/spring_note_3/</guid><description>&lt;h3 id="æœ¬æ–‡è¦çœ‹å•¥">
&lt;a href="#%e6%9c%ac%e6%96%87%e8%a6%81%e7%9c%8b%e5%95%a5">#&lt;/a>
æœ¬æ–‡è¦çœ‹å•¥
&lt;/h3>&lt;hr>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">processBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitionElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">decorateBeanDefinitionIfRequired&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">try&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionReaderUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerBeanDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getRegistry&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">catch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BeanDefinitionStoreException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to register bean definition with name &amp;#39;&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getBeanName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">fireComponentRegistered&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanComponentDefinition&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å‰é¢çš„ç¬”è®°ä¸­,æˆ‘ä»¬å·²ç»èµ°å®Œäº†è¿™ä¸ªæ–¹æ³•ä¸­çš„ç¬¬ä¸€æ­¥,æ„Ÿè§‰ç¬¬ä¸€æ­¥å°±èµ°äº†å¾ˆè¿œ,çœ¼ç…è¦è¿·è·¯äº†,ä½†æ— è®ºå¦‚ä½•,æ€»å½’æ˜¯æ‹¿åˆ°äº†æˆ‘ä»¬çš„bdHolder, é‡Œé¢å·²ç»å­˜æ”¾äº†Beanæ ‡ç­¾é‡Œé¢çš„é»˜è®¤çš„å…ƒç´ .&lt;/p>
&lt;p>å¦‚æœbdHolderä¸ä¸ºç©ºçš„è¯,æˆ‘ä»¬å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°å•¦.&lt;/p>
&lt;p>ä»Šå¤©æ¥ç ”ç©¶ä¸‹è¿™æ®µä»£ç &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">bdHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">decorateBeanDefinitionIfRequired&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>çœ‹æ–¹æ³•åå­—å°±å¤§æ¦‚çŸ¥é“,è¿™é‡Œè¦åšçš„äº‹æƒ…å°±æ˜¯ å¦‚æœæœ‰éœ€è¦çš„è¯,è£…é¥°æˆ‘ä»¬åˆšæ‹¿åˆ°çš„bdHolder.&lt;/p>
&lt;p>é‚£ä¹ˆä½•ä¸ºéœ€è¦å‘¢?ä¸‹é¢è¿™æ ·çš„åœºæ™¯ä¾¿æ˜¯äº†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;bean&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;test&amp;#34;&lt;/span> &lt;span class="na">class=&lt;/span>&lt;span class="s">&amp;#34;test.myClass&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;mybean:user&lt;/span> &lt;span class="na">username=&lt;/span>&lt;span class="s">&amp;#34;aaa&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/bean&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œçš„è‡ªå®šä¹‰æ ‡ç­¾å’Œ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;mvc:resources&lt;/span> &lt;span class="na">mapping=&lt;/span>&lt;span class="s">&amp;#34;/img/**&amp;#34;&lt;/span> &lt;span class="na">location=&lt;/span>&lt;span class="s">&amp;#34;img/&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;aop:config/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;tx:advice&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;transactionAdvice&amp;#34;&lt;/span> &lt;span class="na">transaction-manager=&lt;/span>&lt;span class="s">&amp;#34;transactionManager&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¹¶ä¸åŒ,è¿™é‡Œçš„æ˜¯åœ¨beanå†…çš„, è€Œmvcé‚£ç§æ ‡ç­¾æ˜¯åœ¨beansé‡Œé¢,ä¸beanåŒçº§çš„&lt;/p>
&lt;h3 id="å¼€å§‹è¿›å…¥æ–¹æ³•å§">
&lt;a href="#%e5%bc%80%e5%a7%8b%e8%bf%9b%e5%85%a5%e6%96%b9%e6%b3%95%e5%90%a7">#&lt;/a>
å¼€å§‹è¿›å…¥æ–¹æ³•å§
&lt;/h3>&lt;hr>
&lt;p>è¿™æ¬¡è¦çœ‹çš„ä¸»è¦æ–¹æ³•å°±æ˜¯ &lt;strong>decorateBeanDefinitionIfRequired&lt;/strong>&lt;/p>
&lt;p>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯æ‹†å¼€æˆ‘ä»¬ä¹‹å‰çš„bean,å°†å…¶å„å±æ€§å’Œå„å­èŠ‚ç‚¹å…¨éƒ¨å˜ä¸ºnode,&lt;/p>
&lt;p>ç„¶åå¸¦ç€æ¯ä¸ªnodeå’Œä¹‹å‰çš„bdå» &lt;strong>decorateIfRequired&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">decorateIfRequired&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">originalDef&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containingBd&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getNamespaceURI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//çœ‹çœ‹æ˜¯ä¸æ˜¯é»˜è®¤å‘½åç©ºé—´, å¦‚æœæ˜¯çš„è¯é‚£å°±ä¸ç”¨ç®¡äº†, åœ¨è¿™æ–¹æ³•é‡Œ,æˆ‘ä»¬åªéœ€å¤„ç†è‡ªå®šä¹‰çš„æ ‡ç­¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‹¿åˆ°è¿™ä¸ªå‘½åç©ºé—´çš„è§£æå™¨ handler&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">NamespaceHandler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readerContext&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getNamespaceHandlerResolver&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">resolve&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœèƒ½æ‰¾åˆ°è§£æå™¨,æˆ‘ä»¬å°±å¯ä»¥è¿›å…¥è£…é¥°æ–¹æ³•å•¦&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">handler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">decorate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">originalDef&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ParserContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readerContext&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containingBd&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//ä»¥ä¸‹éƒ½æ˜¯æ²¡æ‰¾åˆ°è§£æå™¨çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å‘½åç©ºé—´ä¸ä¸ºnull,è€Œä¸”è¿˜ä»¥springå®¶çš„ç½‘å€å¼€å¤´,é‚£å°±æŠ¥é”™è¡¨ç¤ºæ‰¾ä¸åˆ°springè§£æå™¨&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">startsWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;http://www.springframework.org/&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Unable to locate Spring NamespaceHandler for XML schema namespace [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDebugEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœèƒ½æ‰“æ—¥å¿—çš„è¯,æ‰“ä¸ªæ—¥å¿—å®Œäº‹ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;No Spring NamespaceHandler found for XML schema namespace [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;]&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">originalDef&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…·ä½“çš„ç”¨handlerè§£ænodeä¼šåœ¨åé¢è¯¦ç»†å­¦ä¹ ,è¿™ä¸ªå°±å…ˆåˆ°è¿™å§!&lt;/p>
&lt;blockquote>
&lt;p>å‰é¢å‡ ç¯‡æ–‡ç« éƒ½é•¿å¾—æ²¡æ³•çœ‹äº†&amp;hellip;å¸å–æ•™è®­ ç¯‡å¹…å°½é‡ä¸è¦å¤ªé•¿äº†.&lt;/p>
&lt;/blockquote></description></item><item><title>ConstructorArgumentValues æ„é€ å™¨å‚æ•°å€¼ä¿å­˜å™¨</title><link>https://heeexy.com/p/spring_note_3_constructorargumentvalues/</link><pubDate>Thu, 14 Sep 2017 21:10:33 +0800</pubDate><guid>https://heeexy.com/p/spring_note_3_constructorargumentvalues/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">indexedArgumentValues&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedHashMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">genericArgumentValues&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LinkedList&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªä¿å­˜å™¨çš„æ ¸å¿ƒå°±åœ¨ä»–çš„LinkedHashMapå’ŒLinkedList&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>ç–‘é—®: è¿™é‡Œä¸ºä»€ä¹ˆé€‰ç”¨linkedæ¥å‚¨å­˜å‘¢?&lt;/strong>&lt;/p>
&lt;p>ç­”:&lt;/p>
&lt;/blockquote>
&lt;p>æ·»åŠ æœ‰indexçš„å…³é”®ä»£ç å¦‚ä¸‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addOrMergeIndexedArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Integer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ‹¿å½“å‰è¿™ä¸ªä½ç½®çš„å€¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœå½“å‰ä½ç½®æœ‰å€¼,å¹¶ä¸”æ–°å€¼æ˜¯æ¥å—åˆå¹¶çš„è¯,é‚£åˆå¹¶ä¸€æ³¢ä¹‹åä½œä¸ºæ–°å€¼&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸æ¥å—åˆå¹¶çš„è¯,é‚£æ‰”äº†ä¹‹å‰çš„valueä¸ç®¡äº†,åªç”¨æ–°æ¥çš„value&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isMergeEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">merge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">()));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°†æ–°å€¼æ”¾å…¥LinkedHashMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>&lt;strong>ç–‘é—®:åœ¨è·å–vhä¹‹å‰æˆ‘ä»¬ä¸å°±éªŒè¯è¿‡indexä¸èƒ½é‡å¤ä¹ˆ?ä¸ºä»€ä¹ˆè¿™é‡Œè¿˜æœ‰å¯èƒ½æä¸€æ³¢åˆå¹¶?æ˜¯æœ‰å…¶å®ƒåœ°æ–¹ä¹Ÿè°ƒç”¨è¿™ä¸ªæ–¹æ³•,é‚£é‡Œå¯ä»¥åˆå¹¶?&lt;/strong>&lt;/p>
&lt;p>ç­”: æ³¨æ„åˆ°è¿™ä¸ªç±»é‡Œæœ‰ä¸ªæ–¹æ³•,addArgumentValues(ConstructorArgumentValues other),è²Œä¼¼å°±æ˜¯ä¸“é—¨å’Œå…¶å®ƒCAVæåˆå¹¶çš„,ç”¨CAVåšæ„é€ å‚æ•°çš„é‚£ä¸ªæ„é€ å™¨è°ƒç”¨äº†æ­¤æ–¹æ³•,è¿™é‡Œä¼šæœ‰å¯èƒ½éœ€è¦åˆå¹¶&lt;/p>
&lt;/blockquote>
&lt;p>æ·»åŠ æ²¡æœ‰indexçš„å‚æ•°&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ ¡éªŒä¸ä¸ºç©º&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">notNull&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;ValueHolder must not be null&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœlistå†…å·²ç»å«æœ‰æ­¤valueåˆ™è·³è¿‡&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">addOrMergeGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">//æ·»åŠ æˆ–åˆå¹¶VH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">addOrMergeGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ–°VHæœ‰name,é‚£ä¹ˆå°±è¦éå†ä¹‹å‰çš„list,æ‰¾å‡ºåŒåçš„è€VH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//çœ‹æ–°VHæ¥ä¸æ¥å—åˆå¹¶,æ¥æ”¶å°±åˆå¹¶ä¸‹å†åˆ ,ä¸æ¥å—å°±ç›´æ¥åˆ æ‰.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Mergeable&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isMergeEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">mergeable&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">merge&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">currentValue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">()));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">remove&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°†æ–°VHå¡å…¥listé‡Œé¢&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newValue&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>å‘ç°addGenericArgumentValue(Object value) å’ŒaddGenericArgumentValue(Object value, String type)å°±æ²¡è¿™ä¹ˆéº»çƒ¦,å› ä¸ºä»–ä»¬æ‹¿Objectæ„é€ çš„è‚¯å®šæ²¡name,ä¹Ÿä¸ä¼šä¸ºnull,ç›´æ¥æ‡’å¾—è€ƒè™‘åˆå¹¶,ä¹Ÿä¸å»éªŒè¯listæ˜¯å¦å·²å­˜åœ¨è¿™ä¸ªVH, ç›´æ¥å¡&amp;hellip;æœ‰ç›¸åŒçš„è¦†ç›–æ‰å°±æ˜¯äº†&amp;hellip;&lt;/p>
&lt;p>åªæ˜¯æš‚æ—¶è¿˜æ²¡çœ‹åˆ°åœ¨å“ªè¿™ä¹ˆç›´æ¥åœ°è°ƒç”¨è¿™ç§å¡Objectçš„æ–¹æ³•&lt;/p>
&lt;/blockquote>
&lt;p>æ—¢ç„¶éƒ½çœ‹å®Œäº†CAVçš„èµ‹å€¼,å¹²è„†æ¥çœ‹çœ‹å®ƒçš„å–å€¼å’Œå…¶å®ƒæ–¹æ³•å§!&lt;/p>
&lt;ol>
&lt;li>
&lt;p>è·å–å®ƒçš„list,mapéƒ½æ˜¯ &lt;strong>Collections.unmodifiableMap&lt;/strong>(this.indexedArgumentValues);&lt;/p>
&lt;p>&lt;strong>Collections.unmodifiableList&lt;/strong>(this.genericArgumentValues);è¿™æ ·éƒ½æ˜¯è¿”å›åªè¯»çš„é›†åˆå‡ºå»,è°ƒç”¨set/add/removeçš„è¯ä¼šæŠ¥é”™&lt;/p>
&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getArgumentCount&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">size&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">clear&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">clear&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">clear&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>é‡å¤´æˆ,æ‹¿å‚æ•°å€¼,è¿™é‡Œåˆåˆ†ä¸º3ç§æƒ…å†µ,å–Indexedçš„,å–Genericçš„,æ‹¿ä¸ªindexå°±æƒ³ç›´æ¥å–çš„,æ¯ç§æƒ…å†µé‡Œéƒ½æœ‰ä¸åŒå‚æ•°çš„é‡è½½.&lt;/p>
&lt;p>æˆ‘ä¼°è®¡å®é™…ä½¿ç”¨åº”è¯¥æ˜¯éƒ½ç”¨ç¬¬ä¸‰ç§æƒ…å†µå§,å› ä¸ºåŒ…æ‹¬äº†å‰ä¸¤ç§,&lt;/p>
&lt;p>è€Œä¸”çœŸæ­£æ„é€ éœ€è¦æ‹¿å‚æ•°çš„æ—¶å€™,è‚¯å®šæ˜¯æƒ³ç»™ä¸ªindex,æŒ‰ç…§é¡ºåºå»CAVé‡Œç›´æ¥æ‹¿,ä¸ç®¡æ”¾å…¥å‚æ•°æ—¶æ˜¯å¦indexed&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">usedValueHolders&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isTrue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Index must not be negative&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å…ˆæ ¹æ®indexå»Mapé‡Œé¢æ‰¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getIndexedArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæ²¡æœ‰çš„è¯,å°±å†å»listé‡Œé¢æ‰¾, ä»è¿™å¯ä»¥çœ‹å‡º,æˆ‘ä»¬åœ¨XMLé‡Œå†™å‚æ•°çš„æ—¶å€™,æœ€å¥½æ˜¯å¸¦ä¸Šindex,åœ¨è¿™é‡Œæ‰¾çš„å¿«ä¸€ç‚¹å“¦!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">usedValueHolders&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;p>ä»mapé‡Œé¢å–Indexedçš„&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getIndexedArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Assert&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isTrue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Index must not be negative&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">indexedArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œä¸€æ³¢||&amp;amp;&amp;amp;!ç®€ç›´äº†...æ€»ç»“ä¸€ä¸‹æœ‰å“ªäº›æƒ…å†µè¿”å›nullå§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 1. æ ¹æ®è¿™ä¸ªindexå–å‡ºæ¥çš„VHå°±æ˜¯null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 2. VHçš„typeä¸ä¸ºnull,å¯æ˜¯( requiredTypeä¸ºnull æˆ–è€… ä¸¤è€…typeä¸åŒ¹é…)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 3. VHçš„nameä¸ä¸ºnull,requiredNameä¸ä¸º&amp;#34;&amp;#34; å¯æ˜¯( requiredNameä¸ºnull æˆ–è€… ä¸¤è€…nameä¸åŒ¹é…)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">matchesTypeName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚,åœ¨åˆ¤æ–­nameçš„æ—¶å€™, requiredNameå¦‚æœç»™äº†&amp;quot;&amp;quot; è¿™ä¸ªå€¼,å°±ä¸ä¼šæ‹¿å»åˆ¤æ–­nameæ˜¯å¦åŒ¹é…&amp;hellip;ä¸çŸ¥è¿™æ˜¯ä½•ç”¨æ„&amp;hellip;&lt;/p>
&lt;/blockquote>
&lt;p>ä»listé‡Œé¢å–&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getGenericArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Class&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Set&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">usedValueHolders&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Iterator&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">genericArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">iterator&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è¿™é‡Œçš„4å±‚åµŒå¥—å¾ªç¯å’Œç–¯ç‹‚çš„||&amp;amp;&amp;amp;!æ›´æ˜¯ç®€ç›´äº†........ä»é‡Œå‘å¤–ä¸€å±‚å±‚çœ‹å§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="c1">//æœ€åçœ‹è¿™ä¸ªæœ€å¤–å±‚,å¦‚æœåŒæ—¶æ»¡è¶³ä¸‹åˆ—æ¡ä»¶,è¯´æ˜è¿™ä¸ªVHè¿˜ä¸æ˜¯æˆ‘ä»¬è¦çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 1.requiredTypeä¸æ˜¯null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 2.VHçš„Typeå´æ˜¯null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 3.VHçš„nameä¹Ÿæ˜¯null
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * 4.typeæ ¡éªŒé€šä¸è¿‡
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * (ç¬¬4æ­¥æ ¡éªŒè¦é€šè¿‡éœ€è¦æ»¡è¶³ä»¥ä¸‹æƒ…å†µä¹‹ä¸€
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * a. value==null ä¸” requiredTypeä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * b. valueä¸ç­‰äºnull ä¸” (valueClassç»§æ‰¿æˆ–å®ç°requiredType
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * æˆ–valueClassåŒ…è£…æˆ–è§£åŒ…è£…åèƒ½ç­‰äºrequiredType..)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="c1">//å†æ¬¡ çœ‹è¿™å±‚,å¦‚æœåŒ¹é…åˆ°ç±»å‹ç›¸åŒçš„,å°±è¯´æ˜æœ‰å¯èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å‚æ•°å•¦,è·³å‡ºæ¥åˆ°æœ€å¤–å±‚å†æ¥å—ä¸€æ¬¡æ ¡éªŒ.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸åŒ¹é…çš„è¯,ç»§ç»­æ‰§è¡Œé‡Œé¢çš„å¾ªç¯æ‰¾ä¸‹ä¸€ä¸ªVHå§.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="c1">//å…¶æ¬¡çœ‹è¿™å±‚å¾ªç¯,å¦‚æœVHæœ‰name,requiredNameä¸ä¸º&amp;#34;&amp;#34;,ä½†rqNameä¸ºnullæˆ–è€…ä¸¤è€…ä¸ç›¸ç­‰,è·³è¿‡æ­¤VH,è¿™è¯´æ˜VHæœ‰nameçš„è¯å°±å¾ˆå…³é”®,å¿…é¡»ç›¸åŒå•Š,é™¤érqName==&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">do&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="c1">//é¦–å…ˆçœ‹è¿™é‡Œçš„å¾ªç¯, å–ä¸‹ä¸€ä¸ªVH,å¦‚æœå–å®Œäº†,å°±è¿”å›null&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasNext&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ValueHolder&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">var4&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">next&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœsetä¸ä¸ºç©º,å¹¶ä¸”seté‡Œå·²ç»åŒ…å«è¿™ä¸ªVHäº†å°±è·³è¿‡æ­¤VH&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">usedValueHolders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">usedValueHolders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredName&lt;/span>&lt;span class="p">)));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">matchesTypeName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="p">()))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getType&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getName&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">ClassUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isAssignableValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">requiredType&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getValue&lt;/span>&lt;span class="p">()));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ€»è€Œè¨€ä¹‹,ä»listé‡Œé¢æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªå‚æ•°çœŸæ˜¯éå¸¸éº»çƒ¦,éœ€è¦è¿™ä¸ªVHæ»¡è¶³ä¸‹åˆ—æ¡ä»¶:&lt;/p>
&lt;ol>
&lt;li>ä¸åœ¨usedVHçš„é‚£ä¸ªseté‡Œ&lt;/li>
&lt;li>æœ‰nameä¸”rqNameä¸æ˜¯&amp;quot;&amp;quot; å°±å¿…é¡»nameåŒ¹é…&lt;/li>
&lt;li>æœ‰rqTypeçš„è¯,è¯´æ˜å¿…é¡»æ¥æ»¡è¶³è¿™ä¸ªtypeçš„åŒ¹é…,é‚£ä¹ˆtypeæ€ä¹ˆç¡®è®¤æ˜¯åŒ¹é…çš„å‘¢?
&lt;ol>
&lt;li>typeä¸æ˜¯null,é‚£å°±ç›´æ¥å»åŒ¹é…&lt;/li>
&lt;li>typeæ˜¯null,å¦‚æœnameä¹Ÿæ˜¯null,(è¯´æ˜ä¹‹å‰ç”¨ä¸å†™nameæ–¹å¼ç»•è¿‡äº†ä¸Šé¢çš„ç¬¬2æ­¥nameéªŒè¯,å¦‚æœä¸Šé¢ç¬¬äºŒæ­¥ç”¨çš„æ˜¯&amp;quot;&amp;ldquo;æ–¹å¼å°±ä¸ç”¨ç®¡äº†,ç›´æ¥ç®—é€šè¿‡), é‚£å°±å¿…é¡»è¦value.getClassèƒ½å»çœŸæ­£çš„å’ŒrqTypeè¿›è¡ŒåŒ¹é… (ç»§æ‰¿,å®ç°,åŒ…è£…,è§£åŒ…å„ç§æ–¹å¼èƒ½åŒ¹é…ä¸Šå°±OK)&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>è¿™é‡Œæ˜¯çœŸçš„éº»çƒ¦,å†æ¢ä¸ªè§’åº¦å†æ¢³ç†ä¸€é!&lt;/p>
&lt;ol>
&lt;li>å¦‚æœrqNameå†™äº†æ¯”å¦‚&amp;quot;age&amp;rdquo;,VHé‡Œnameä¹Ÿå†™äº†çš„è¯,é‚£å°±å¿…é¡»nameä¹Ÿæ˜¯&amp;quot;age&amp;quot;æ‰é€šè¿‡&lt;/li>
&lt;li>å¦‚æœrqNameå†™ä¸ª&amp;quot;&amp;quot;,é‚£å°±è¡¨ç¤ºnameå±æ€§å®Œå…¨ä¸ç®¡äº†,éƒ½ç®—é€šè¿‡&lt;/li>
&lt;li>å¦‚æœrqNameæ˜¯null,é‚£æœ‰nameçš„VHéƒ½ä¸è¡Œ, æ²¡nameçš„VHå¯ä»¥é€šè¿‡&lt;/li>
&lt;li>å¦‚æœrqTypeæ²¡å†™,é‚£å°±è¡¨ç¤ºtypeä¸ç®¡äº†,éƒ½ç®—é€šè¿‡(ä¼°è®¡å®é™…è°ƒç”¨ä¸ä¼šnameå’Œtypeå…¨éƒ¨ä¸ç®¡å§&amp;hellip;&amp;hellip;.)&lt;/li>
&lt;li>å¦‚æœrqTypeå†™äº†,é‚£å°±è¡¨ç¤ºè¦éªŒè¯typeå•¦,ä»ä¸Šé¢æ”¾è¡Œè¿‡æ¥çš„VHéœ€è¦æ ¡éªŒäº†
&lt;ol>
&lt;li>å¦‚æœVHtypeä¸ºnull,ä½†æ˜¯æœ‰name,è¯´æ˜é€šè¿‡1.2æ”¾è¿‡æ¥çš„,éƒ½ç®—ok (é‚£ä¸ª&amp;quot;&amp;ldquo;å°±å¾ˆå‘äº†,VHéšä¾¿å¡«ä¸ªname,ä¸å¡«typeå°±å¯èƒ½å…¨éƒ¨é€šè¿‡äº†)&lt;/li>
&lt;li>å¦‚æœVHtypeä¸ºnull,nameä¹Ÿæ˜¯null,é‚£å°±å»ClassUtils.isAssignableValueæ ¡éªŒVHvalueçš„æœ¬è´¨classèƒ½å¦å¯¹å¾—ä¸Š.&lt;/li>
&lt;li>å¦‚æœVHtypeä¸æ˜¯null,é‚£å°±å¿…é¡»typeä¹Ÿå®Œå…¨ä¸€è‡´&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>æˆ‘é¢„æµ‹æ­£å¸¸è°ƒç”¨æƒ…å†µåº”è¯¥æ˜¯rqNameå’ŒrqTypeéƒ½æœ‰æ˜ç¡®è¦æ±‚å§,é‚£ä¹ˆæ­£å¸¸æµç¨‹å°±åº”è¯¥æ˜¯&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>VHæœ‰nameæœ€å¥½,åŒ¹é…ä¸Šç›´æ¥é€šè¿‡!&lt;/li>
&lt;li>VHå¦‚æœæ²¡name,æœ‰type,é‚£å°±å»åŒ¹é…type!&lt;/li>
&lt;li>VHå¦‚æœå•¥éƒ½æ²¡æœ‰,é‚£å°±æ‹¿VHvalueçš„classå»è·ŸrqTypeåŒ¹é…,è¿™æ€»è·‘ä¸äº†äº†å§!&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>è¿™ä¸ªåœ°æ–¹ç›¯ç€çœ‹äº†å‡ ä¸ªå°æ—¶,ä¸çŸ¥é“ä½œè€…å†™è¿™ä¹ˆå¤æ‚æ˜¯ä½•å±…å¿ƒ,è°ƒç”¨çš„æ—¶å€™ä¹Ÿå‡†å¤‡åšè¿™ä¹ˆå¤æ‚ä¹ˆ?æ‹¿æ„é€ å™¨å‚æ•°çš„æ—¶å€™å°±ä¸èƒ½æŠŠrequiredNameå’ŒrequiredTypeéƒ½å¸¦è¿‡æ¥??? è¿˜æäº›åŒå¼•å·&amp;quot;&amp;ldquo;è¿™ç§æ€ªäº‹æƒ…???&lt;/p>
&lt;/blockquote></description></item><item><title>Springæºç ç¬”è®°-1.2 è·å–beanæµç¨‹ä¹‹beanæ ‡ç­¾çš„è§£æåŠæ³¨å†Œ</title><link>https://heeexy.com/p/spring_note_2/</link><pubDate>Tue, 12 Sep 2017 21:41:09 +0800</pubDate><guid>https://heeexy.com/p/spring_note_2/</guid><description>&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/spring_parseDefaultElement2.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="1è§£æbeandefinition">
&lt;a href="#1%e8%a7%a3%e6%9e%90beandefinition">#&lt;/a>
1.è§£æBeanDefinition
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bdHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitionElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½œç”¨å°±æ˜¯å°†elementå°è£…è¿›bdHolderé‡Œé¢.&lt;/p>
&lt;p>å…¶æºç å¾ˆé•¿,ä¸è´´äº†,ä½†åŠŸèƒ½æµç¨‹è¿˜å¾ˆæ¸…æ™°&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å¤„ç†id,name,aliases. å…³é”®æ˜¯éœ€è¦&lt;strong>beanName&lt;/strong> ,&lt;/p>
&lt;p>nameåˆ†éš”å¼€åšaliasesçš„list.&lt;/p>
&lt;p>beanName&lt;strong>ä¼˜å…ˆç”¨id&lt;/strong>,æ²¡idçš„è¯å°±ä»aliasesé‡Œ&lt;strong>remove(0&lt;/strong>)å‡ºæ¥ä¸€ä¸ª,&lt;/p>
&lt;p>å¦‚æœæœ‰beanNameäº†,æ ¡éªŒbeanNameå’Œaliaseså”¯ä¸€æ€§&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>â€‹ å¦‚æœè¿˜æ˜¯æ²¡beanName,ç­‰ä¼šå†ç»™å®ƒç”¨æ–¹æ³•ç”Ÿæˆä¸ª&lt;/p>
&lt;ol start="2">
&lt;li>å°†elementè§£æ,æ”¾å…¥GenericBeanDefinitioné‡Œé¢&lt;/li>
&lt;li>æŠŠä¸Šä¸€æ­¥æ‹¿åˆ°çš„bdè¿å¸¦ç€aliasesè½¬String[], beanNameä¸€èµ·å°è£…ä¸€ä¸‹æˆä¸ºBeanDefinitionHolderè¿”å›;å¦‚æœä¸Šä¸€æ­¥è¿”å›null,å°±ç›´æ¥è¿”å›null&lt;/li>
&lt;/ol>
&lt;p>è¿™é‡Œçš„å…³é”®æ­¥éª¤æ˜¾ç„¶æ˜¯ç¬¬äºŒæ­¥,elementè½¬beanDefinition&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">AbstractBeanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitionElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containingBean&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆé•¿,å¤§æ¦‚æ­¥éª¤æ˜¯&lt;/p>
&lt;ol>
&lt;li>this.parseState.push(new BeanEntry(beanName)) å¼€å¤´push,ç»“å°¾pop,ä¸æ˜ç™½æ˜¯åšä»€ä¹ˆ???&lt;/li>
&lt;li>è·å–ä¸‹classNameå’Œparent&lt;/li>
&lt;li>æ‹¿ç€classNameå’Œparentå»åˆ›å»ºä¸ªGenericBeanDefinition bd&lt;/li>
&lt;li>&lt;strong>æ‹¿ç€bdå’Œelementè¿›è¡Œä¸€ç³»åˆ—çš„è§£ææ­¥éª¤,æŠŠå„ç§å€¼å¡å…¥bd&lt;/strong>&lt;/li>
&lt;li>è¿”å›bd&lt;/li>
&lt;li>this.parseState.pop();&lt;/li>
&lt;/ol>
&lt;h4 id="è§£æå„ç§å±æ€§">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%90%84%e7%a7%8d%e5%b1%9e%e6%80%a7">#&lt;/a>
è§£æå„ç§å±æ€§
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitionAttributes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">containingBean&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bd&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>è¿™ä¸ªæ–¹æ³•çš„ä»£ç ä¸§å¿ƒç—…ç‹‚åœ°è¾¾åˆ°äº†70è¡Œ,ç›¸æ¯”äºç›®å‰è¯»åˆ°çš„å…¶å®ƒæºç ,ç¡®å®æ˜¯æœ€é•¿çš„ä¸€ä¸ª.&lt;/p>
&lt;p>ä½†æ˜¯é‡Œé¢çš„å†…å®¹å…¶å®å¹¶ä¸å¤æ‚,å°±æ˜¯ä¸€ä¸ªä¸ªåœ°ä»elementæ‹¿å±æ€§,å¡å±æ€§è¿›bd, å„ç§ get &amp;amp; set .æ„Ÿè§‰ç¡®å®ä¸å¤ªå¥½é‡æ„.&lt;/p>
&lt;/blockquote>
&lt;p>è§£æäº†å¾ˆå¤šå±æ€§,åŒ…æ‹¬scope,abstract,lazy-init,autowire&amp;hellip;&lt;/p>
&lt;h4 id="è§£æå­å…ƒç´ meta">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0meta">#&lt;/a>
è§£æå­å…ƒç´ meta
&lt;/h4>&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/spring_parseMeta.png"
loading="lazy"
>&lt;/p>
&lt;h4 id="è§£æå­å…ƒç´ lookup-method">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0lookup-method">#&lt;/a>
è§£æå­å…ƒç´ lookup-method
&lt;/h4>&lt;p>è§£ææ–¹æ³•å’Œmetaå·®åˆ«å¾ˆå°,è¿™é‡Œä¸»è¦æ˜¯å»äº†è§£ä¸‹lookup-methodçš„åŠŸèƒ½&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;bean&lt;/span> &lt;span class="na">class=&lt;/span>&lt;span class="s">&amp;#34;beanClass&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;lookup-method&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;method&amp;#34;&lt;/span> &lt;span class="na">bean=&lt;/span>&lt;span class="s">&amp;#34;non-singleton-bean&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/bean&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>methodæ˜¯beanClassä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼ŒbeanClasså’Œmethodæ˜¯ä¸æ˜¯æŠ½è±¡éƒ½æ— æ‰€è°“ï¼Œä¸ä¼šå½±å“CGLIBçš„åŠ¨æ€ä»£ç†ï¼Œæ ¹æ®é¡¹ç›®å®é™…éœ€æ±‚å»å®šä¹‰ã€‚non-singleton-beanæŒ‡çš„æ˜¯lookup-methodä¸­beanå±æ€§æŒ‡å‘çš„å¿…é¡»æ˜¯ä¸€ä¸ª&lt;strong>éå•ä¾‹æ¨¡å¼&lt;/strong>çš„beanï¼Œå½“ç„¶å¦‚æœä¸æ˜¯ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œåªæ˜¯æ¯æ¬¡å¾—åˆ°çš„éƒ½æ˜¯ç›¸åŒå¼•ç”¨çš„beanï¼ˆåŒä¸€ä¸ªå®ä¾‹ï¼‰ï¼Œè¿™æ ·ç”¨lookup-methodå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚&lt;/p>
&lt;p>å‚è€ƒ: &lt;a class="link" href="http://www.cnblogs.com/ViviChan/p/4981619.html" target="_blank" rel="noopener"
>Spring - lookup-methodæ–¹å¼å®ç°ä¾èµ–æ³¨å…¥&lt;/a>&lt;/p>
&lt;h4 id="è§£æå­å…ƒç´ replaced-method">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0replaced-method">#&lt;/a>
è§£æå­å…ƒç´ replaced-method
&lt;/h4>&lt;p>è¿™ä¸ªä¸ä»…å¯ä»¥åŠ¨æ€åœ°æ›¿æ¢è¿”å›å®ä½“bean,è€Œä¸”è¿˜èƒ½åŠ¨æ€åœ°æ›´æ”¹åŸæœ‰æ–¹æ³•çš„é€»è¾‘!!!&lt;/p>
&lt;h4 id="è§£æå­å…ƒç´ constructor-arg">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0constructor-arg">#&lt;/a>
è§£æå­å…ƒç´ constructor-arg
&lt;/h4>&lt;p>è¿™é‡Œæå–æ„é€ å‚æ•°çš„ä¸€äº›å±æ€§å€¼å°±ç›¸æ¯”ä¹‹å‰å¤æ‚å¤šäº†.&lt;/p>
&lt;ol>
&lt;li>æå–index,type,name,åˆ¤æ–­æ˜¯å¦æœ‰indexå±æ€§å€¼&lt;/li>
&lt;li>å¦‚æœæœ‰index:
&lt;ol>
&lt;li>æ„é€ Entryå‹å…¥parseStateæ ˆ&lt;/li>
&lt;li>è§£æconstructor-argçš„å­å…ƒç´ &lt;/li>
&lt;li>ä½¿ç”¨ConstructorArgumentValues.ValueHolderç±»å‹æ¥å°è£…è§£æå‡ºæ¥çš„å…ƒç´ &lt;/li>
&lt;li>å°†index,type,nameå±æ€§ä¸€å¹¶å°è£…åœ¨ValueHolderä¸­,&lt;/li>
&lt;li>éªŒè¯indexæ˜¯å¦ç”¨è¿‡äº†,ç”¨è¿‡åˆ™æŠ›é”™,è·³è¿‡æ­¤æ¡å‚æ•°&lt;/li>
&lt;li>ValueHolderæ·»åŠ è‡³å½“å‰BeanDefinitionçš„construArgumentValuesçš„&lt;strong>indexedArgurmentValues&lt;/strong>å±æ€§ä¸­.&lt;/li>
&lt;li>å¼¹å‡ºæ ˆ&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>å¦‚æœæ²¡æœ‰index:
&lt;ol>
&lt;li>åŒä¸Šå‹å…¥æ ˆ&lt;/li>
&lt;li>è§£æconstructor-argçš„å­å…ƒç´ &lt;/li>
&lt;li>ä½¿ç”¨ConstructorArgumentValues.ValueHolderç±»å‹æ¥å°è£…è§£æå‡ºæ¥çš„å…ƒç´ &lt;/li>
&lt;li>å°†index,type,nameå±æ€§ä¸€å¹¶å°è£…åœ¨ValueHolderä¸­,å¹¶ä¸”æ·»åŠ è‡³å½“å‰BeanDefinitionçš„construArgumentValuesçš„&lt;strong>genericArgurmentValues&lt;/strong>å±æ€§ä¸­.&lt;/li>
&lt;li>å¼¹å‡ºæ ˆ&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>å¯ä»¥çœ‹å‡º,æœ‰æ²¡æœ‰indexå…¶å®æµç¨‹æ²¡åŒºåˆ«,ä¸»è¦åœ¨äºåœ¨bdä¸­ä¿å­˜çš„ä½ç½®ä¸åŒ,å¦å¤–æœ‰indexçš„éœ€è¦éªŒè¯ä¸‹indexçš„å”¯ä¸€&lt;/p>
&lt;h5 id="parsepropertyvalue">
&lt;a href="#parsepropertyvalue">#&lt;/a>
parsePropertyValue
&lt;/h5>&lt;p>è§£æconstructor-argçš„å­å…ƒç´ &lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Object&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parsePropertyValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bd&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªæ–¹æ³•ä¹Ÿå¾ˆé•¿,é‡Œé¢çš„å…³é”®åœ¨äºæ­¤å¤„è§£æconstructor-argä¸‹é¢çš„å­å…ƒç´ æ—¶,ä¸‹é¢ä¸‰ç§æƒ…å†µ&lt;strong>å¿…é¡»&lt;/strong>ä¸”&lt;strong>åªèƒ½&lt;/strong>å ä¸€ç§&lt;/p>
&lt;ul>
&lt;li>æœ‰refå±æ€§&lt;/li>
&lt;li>æœ‰valueå±æ€§&lt;/li>
&lt;li>æœ‰å­å…ƒç´ (descriptionå’Œmetaé™¤å¤–,è¿™ä¸¤ç§ä¸ç”¨å¤„ç†),å­å…ƒç´ åªèƒ½åˆ—ä¸€ä¸ª&lt;/li>
&lt;/ul>
&lt;p>ä¸Šé¢ä¸‰ç§æƒ…å†µå¯¹åº”ä¸åŒçš„å¤„ç†æ–¹æ³•:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ref:&lt;/p>
&lt;p>æ ¡éªŒä¸‹refçš„å€¼ä¸èƒ½ä¸ºç©º,ç„¶å&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RuntimeBeanReference&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ref&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">RuntimeBeanReference&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">refName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ref&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">extractSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ref&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨RuntimeBeanReferenceå°è£…ä¸‹è¿™ä¸ªè¦å¼•ç”¨çš„beançš„beanName,å¡ä¸‹resource,è¿”å›&lt;/p>
&lt;blockquote>
&lt;p>æŸ¥çœ‹BeanReferenceæºç æ—¶æ³¨æ„åˆ°æœ‰RuntimeBeanReferenceå’ŒRuntimeBeanNameReferenceä¸¤ç§å®ç°,è²Œä¼¼åŒºåˆ«ä¸å¤§,RuntimeBeanReferenceå¤šä¸ªtoParentçš„booleanå±æ€§,æ­¤å¤„ç»™çš„ä¹Ÿæ˜¯falseå€¼.&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>value:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">TypedStringValue&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TypedStringValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">extractSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ele&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç”¨TypedStringValueå°è£…ä¸‹valueçš„å€¼ è¿”å›&lt;/p>
&lt;blockquote>
&lt;p>TypedStringValueå’ŒBeanReferenceéƒ½æ˜¯å®ç°BeanMetadataElementçš„,å®ç°äº†Object getSource();æ–¹æ³•&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;li>
&lt;p>å­å…ƒç´ &lt;strong>parsePropertySubElement&lt;/strong>: è¿™ä¸ªåˆå¤æ‚äº†,åˆ¤æ–­10+ç§æƒ…å†µ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚æœä¸æ˜¯é»˜è®¤å‘½åç©ºé—´,åˆ™æŒ‰å…¶è‡ªå®šä¹‰çš„æ–¹å¼å»è§£æ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>beanå…ƒç´ ,æŒ‰ç…§æœ¬æ–‡çš„æ–¹å¼è§£æ,æ‹¿åˆ°ä¸€ä¸ªBeanDefinitionHolder bdHolder,bdHolderä¸ä¸ºç©ºçš„è¯,å¯èƒ½è¿˜è¦è£…é¥°ä¸€ä¸‹(åœ¨è¿™ä¸ªå…ƒç´ çš„å±æ€§æˆ–å­å…ƒç´ èŠ‚ç‚¹å‘½åç©ºé—´ä¸ä¸ºé»˜è®¤æƒ…å†µä¸‹, ç”¨è‡ªå®šä¹‰æ–¹å¼è§£æåå»è£…é¥°),è¿”å›æœ€ç»ˆè§£æ+è£…é¥°çš„ç»“æœ bdHolder&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ref: ä¸»è¦è¿˜æ˜¯æ‹¿è¦å¼•ç”¨çš„beanName, å–å€¼é¡ºåºä¸ºå…¶å±æ€§ bean&amp;ndash;local&amp;ndash;parent,å’Œä¹‹å‰çš„refä¸€æ ·,ç”¨RuntimeBeanReferenceå°è£…ä¸‹è¿™ä¸ªè¦å¼•ç”¨çš„beançš„beanName,å¡ä¸‹resource,è¿”å›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>idref:å’Œrefå·®ä¸å¤š,å–å€¼é¡ºåºä¸ºbean&amp;ndash;local&lt;/p>
&lt;/li>
&lt;li>
&lt;p>value: æ‹¿æ–‡æœ¬å€¼,æ‹¿typeå€¼,æ²¡typeå°±ç”¨ä¼ æ¥çš„é»˜è®¤typeName,æ­¤å¤„ä¸ºnull,ç„¶åæ ¹æ®value,typeNameå’ŒBeanClassLoaderæ¥æ„é€ ä¸€ä¸ªTypedStringValue,è¿”å›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>null:ç”¨nullæ¥newä¸€ä¸ªTypedStringValue,è¿”å›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>array:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ‹¿value-typeå’Œå­èŠ‚ç‚¹list&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”¨typeå’Œå­èŠ‚ç‚¹sizeæ„å»ºä¸ªManagedArray&lt;/p>
&lt;blockquote>
&lt;p>ManagedArrayç»§æ‰¿ManagedList&lt;Object> ç»§æ‰¿ArrayList&lt;E> ,&lt;/p>
&lt;p>ManagedListå®ç°Mergeableå’ŒBeanMetadataElement ,å¯ä»¥æœ‰mergeå’ŒgetSource&lt;/p>
&lt;/blockquote>
&lt;p>ç„¶åè®¾ç½®sourceå’Œmergeå±æ€§ (æ­¤å¤„è¿˜å¤šä½™é‡å¤äº†ä¸€ésetElementTypeName(elementType);),&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶å this.parseCollectionElements(nl, target, bd, defaultElementType); å¯¹å…¶å­èŠ‚ç‚¹è¿›è¡Œä¸€ä¸ªä¸ªçš„å†è§£æå­å…ƒç´ ,è¿˜æ˜¯è°ƒç”¨&lt;strong>parsePropertySubElement&lt;/strong>æ–¹æ³•,åªæ˜¯å¸¦äº†ä¸ªé»˜è®¤ç±»å‹defaultElementType&lt;/p>
&lt;blockquote>
&lt;p>çœ‹åˆ°è¿™å·²ç»æœ‰ç‚¹æ™•äº†, æœ€åˆçš„é‚£ä¸ªbdéƒ½è·‘äº†å¤šå°‘è·¯äº†?? å­å…ƒç´ é‡Œçš„å±æ€§ä¹Ÿå¾€bdé‡Œç›´æ¥å¡,ä¸å°±ä¸¢å¤±çˆ¶å­ç»“æ„äº†ä¹ˆ???&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>list: å’Œarrayæ²¡ä»€ä¹ˆå·®åˆ«,ä»…æœ‰çš„åŒºåˆ«åœ¨äºç”¨ManagedList ,(ManagedArrayè¿˜æ˜¯ç»§æ‰¿è‡ªä»–çš„)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>set:åŒä¸Š,ä»…æœ‰çš„åŒºåˆ«åœ¨äºç”¨ManagedSet,ç»§æ‰¿è‡ªLinkedHashSet&lt;/p>
&lt;/li>
&lt;li>
&lt;p>map:è¿™ä¸ªæ–¹æ³•100è¡Œ,éå¸¸é•¿&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;constructor-arg&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;score&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;map&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;entry&lt;/span> &lt;span class="na">key=&lt;/span>&lt;span class="s">&amp;#34;math&amp;#34;&lt;/span> &lt;span class="na">value=&lt;/span>&lt;span class="s">&amp;#34;90&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;entry&lt;/span> &lt;span class="na">key=&lt;/span>&lt;span class="s">&amp;#34;english&amp;#34;&lt;/span> &lt;span class="na">value=&lt;/span>&lt;span class="s">&amp;#34;85&amp;#34;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/map&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/constructor-arg&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>
&lt;p>æ‹¿key-tpyeå’Œvalue-type,å­èŠ‚ç‚¹entryçš„list&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ„å»ºManagedMap,è®¾source,KeyTypeName,ValueTypeName,MergeEnable&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éå†entryèŠ‚ç‚¹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‹¿entryå†ä¸‹ä¸€å±‚çš„å­èŠ‚ç‚¹,éå†,å¦‚æœæ˜¯keyèŠ‚ç‚¹,åˆ™è®¾è¿™ä¸ªentryçš„keyEleä¸ºæ­¤,keyåªèƒ½æœ€å¤šå‡ºç°ä¸€é, ç„¶åå‰©ä¸‹çš„èŠ‚ç‚¹é™¤äº†descriptionä¹‹å¤–æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª,ä½œä¸ºvalueEle.æ‰€ä»¥æ­¤å¤„è¡¨æ˜è¿™é‡Œè²Œä¼¼å¯ä»¥è¿™ä¹ˆå†™???&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;constructor-arg&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#34;score&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;map&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;entry&lt;/span> &lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>å“ˆå“ˆ&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;vvvaaluue&amp;gt;&lt;/span>è¿™æ ·å†™value??&lt;span class="nt">&amp;lt;/vvvaaluue&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;description&amp;gt;&lt;/span>æè¿°éšä¾¿å†™,ç›¸å½“äºæ³¨é‡Š&lt;span class="nt">&amp;lt;/description&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;description&amp;gt;&lt;/span>æè¿°éšä¾¿å†™,ç›¸å½“äºæ³¨é‡Š&lt;span class="nt">&amp;lt;/description&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/entry&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/map&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/constructor-arg&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç„¶ååˆå’Œè§£æconstructor-argçš„å­å…ƒç´ ç±»ä¼¼çš„æƒ…å†µ,ä¸‰ç§æƒ…å†µ&lt;strong>å¿…é¡»&lt;/strong>ä¸”&lt;strong>åªèƒ½&lt;/strong>å‡ºç°ä¸€ç§:1.&amp;ldquo;key&amp;quot;å±æ€§;2.&amp;ldquo;key-ref&amp;quot;å±æ€§;3.&amp;ldquo;key&amp;quot;å­å…ƒç´ , ä¸‰ç§å¯¹åº”ä¸åŒçš„è§£æ&lt;/p>
&lt;p>key:TypedStringValueæ¥å°è£…&lt;/p>
&lt;p>key-ref:RuntimeBeanReferenceæ¥å°è£…&lt;/p>
&lt;p>keyå­å…ƒç´ : é‡Œé¢å¿…é¡»ä¸”åªèƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹,è¿›è¡ŒparsePropertySubElement,è¿™å’Œåœ¨arrayé‚£çœ‹åˆ°çš„ä¸€æ ·äº†&lt;/p>
&lt;p>ä¸‰ç§è§£æåè¿”å›çš„Objextèµ‹å€¼ç»™key&lt;/p>
&lt;p>ç„¶åè§£ævalue,å’Œä¸Šé¢è§£ækeyç±»ä¼¼,ä»¥ä¸‹ä¸‰ç§&lt;strong>å¿…é¡»&lt;/strong>ä¸”&lt;strong>åªèƒ½&lt;/strong>å‡ºç°ä¸€ç§:&lt;/p>
&lt;p>(æœ‰ç‚¹åŒºåˆ«åœ¨äºvalue-refå±æ€§å’Œvalue-typeå±æ€§ä¸èƒ½å¹¶å­˜,&lt;/p>
&lt;p>æœ‰value-typeæ—¶å°±å¿…é¡»è¦æœ‰valueå±æ€§æˆ–è€…valueå­èŠ‚ç‚¹)&lt;/p>
&lt;p>valueå±æ€§:æ‹¿value-type,æ²¡æœ‰å°±ç”¨é»˜è®¤çš„value-type(mapèŠ‚ç‚¹ä¸‹çš„,å½“ç„¶ä¹Ÿå¯èƒ½æ²¡æœ‰),æ„å»ºTypedStringValue&lt;/p>
&lt;p>value-refå±æ€§:æ„å»ºRuntimeBeanReference&lt;/p>
&lt;p>valueå­èŠ‚ç‚¹:è€æ ·å­,è¿˜æ˜¯parsePropertySubElementè¿™æ ·æ¥ç»§ç»­è§£æå­èŠ‚ç‚¹&lt;/p>
&lt;p>key,valueéƒ½æ‹¿åˆ°ä¹‹å,ä¼šå¡å…¥ManagedMap,æœ€ç»ˆè¿”å›ManagedMap&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>props&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;constructor-arg&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;props&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;prop&lt;/span> &lt;span class="na">key=&lt;/span>&lt;span class="s">&amp;#34;firstName&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Rob
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/prop&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;prop&lt;/span> &lt;span class="na">key=&lt;/span>&lt;span class="s">&amp;#34;secondName&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Harrop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/prop&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/props&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/constructor-arg&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªå°±ç®€å•äº†,æ— éå°±æ˜¯éå†propsä¸‹é¢çš„propå…ƒç´ ,æ‹¿keyå±æ€§,æ‹¿æ–‡æœ¬å€¼çš„trim(),å¡å…¥Propertieså¯¹è±¡,è¿”å›è¿™ä¸ªproperties&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>è‡³æ­¤,è§£æconstructor-argçš„å­å…ƒç´ ç®—æ˜¯å®Œæˆäº†, éƒ½å¿«å¿˜æ‰è¿™åªæ˜¯è§£æconstructor-argé‡Œçš„ç¬¬ä¸€æ­¥äº†&amp;hellip;&lt;/p>
&lt;p>æ€»ä¹‹è¿™ä¸€æ­¥è§£æå®Œå­å…ƒç´ ,è¿”å›Objectå¯¹è±¡å›æ¥,ä½œä¸ºvalue&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h5 id="valueholder">
&lt;a href="#valueholder">#&lt;/a>
ValueHolder
&lt;/h5>&lt;p>ç”¨ä¸Šä¸€æ­¥è¿”å›å›æ¥çš„value,æ„é€ ä¸ªValueHolder&lt;/p>
&lt;blockquote>
&lt;p>ValueHolderç±»åœ¨ConstructorArgumentValuesç±»é‡Œ,å®ç°äº†BeanMetadataElement,å±æ€§ä¸å¤š,å°±value,type,name,source,c&lt;strong>onverted&lt;/strong>,&lt;strong>convertedValue&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>ç„¶åconstructor-argæœ‰typeå±æ€§å°±ç»™vhå¡type,æœ‰nameå¡name, å¡source&lt;/p>
&lt;p>æ ¡éªŒå®Œindexå”¯ä¸€ä¹‹å&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">bd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getConstructorArgumentValues&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">addIndexedArgumentValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valueHolder&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ„é€ å™¨å‚æ•°å¡å…¥bdçš„constructorArgumentValues,åé¢æ— indexçš„å¤„ç†æ–¹å¼å’Œè¿™é‡Œæœ‰indexçš„ä¸»è¦åŒºåˆ«å°±æ˜¯åœ¨å¾€è¿™ä¸ªconstructorArgumentValuesé‡Œé¢å¡çš„ä½ç½®ä¸åŒ.&lt;/p>
&lt;p>BeanDefinitioné‡Œå®šä¹‰äº†&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getConstructorArgumentValues&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™ä¸ªæ¥å£,åœ¨AbstractBeanDefinitioné‡Œæœ‰&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ConstructorArgumentValues&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">constructorArgumentValues&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç›®æµ‹ä¸“é—¨å­˜æ”¾æ„é€ å™¨çš„å‚æ•°å€¼çš„&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¬æ¥ç†Ÿæ‚‰ä¸€ä¸‹ConstructorArgumentValuesè¿™ä¸ªç±»å§..&lt;/p>
&lt;p>(è¿™ä¸ªç±»å®åœ¨å¤ªéº»çƒ¦äº†,å†™ç€å†™ç€2000å¤šå­—,é‡å¼€ä¸€æ–‡äº†,&lt;a class="link" href="http://heeexy.com/2017/09/14/spring_note_3_ConstructorArgumentValues/" target="_blank" rel="noopener"
>å³ä¸‹ä¸€ç¯‡ç¬”è®°&lt;/a>)&lt;/p>
&lt;h4 id="è§£æå­å…ƒç´ property">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0property">#&lt;/a>
è§£æå­å…ƒç´ property
&lt;/h4>&lt;ol>
&lt;li>æ‹¿nameå±æ€§å¹¶ä¸”æ ¡éªŒ&lt;/li>
&lt;li>parseState.push()&lt;/li>
&lt;li>æ ¡éªŒnameåœ¨bd.getPropertyValues()é‡Œé¢å”¯ä¸€&lt;/li>
&lt;li>parsePropertyValue æå–å‡ºpropertyé‡Œé¢çš„å­å…ƒç´ æˆ–è€…refæˆ–è€…value,è¿™ä¸ªæ­¥éª¤å’Œä¹‹å‰çš„&lt;strong>è§£æå­å…ƒç´ constructor-arg&lt;/strong>é‡Œé¢çš„parsePropertyValueæ˜¯åŒä¸€ä¸ªæ–¹æ³•! åªæ˜¯è¿™é‡Œè°ƒç”¨å¸¦ä¸Šäº†propertyName,è¿™é‡Œçš„nameæ˜¯ä¸å¯èƒ½ä¸ºç©ºçš„ ,å› ä¸ºç¬¬ä¸€æ­¥æ ¡éªŒäº†&lt;/li>
&lt;li>æ‹¿ç¬¬4æ­¥çš„ç»“æœvalå’ŒpropertyNameå°è£…ä¸€ä¸ªPropertyValue ,è¿™ä¸ªä¹Ÿæ˜¯ç»§æ‰¿BeanMetadataAttributeAccessorçš„,&lt;/li>
&lt;li>ç„¶åå’Œä¹‹å‰çš„è§£æå­å…ƒç´ metaä¸€æ¨¡ä¸€æ ·æ¥è§£æè¿™é‡Œé¢çš„metaå­å…ƒç´ &lt;/li>
&lt;li>setSource&lt;/li>
&lt;li>propertyValueå¡å…¥bd&lt;/li>
&lt;li>parseState.pop()&lt;/li>
&lt;/ol>
&lt;h4 id="è§£æå­å…ƒç´ qualifier">
&lt;a href="#%e8%a7%a3%e6%9e%90%e5%ad%90%e5%85%83%e7%b4%a0qualifier">#&lt;/a>
è§£æå­å…ƒç´ Qualifier
&lt;/h4>&lt;p>Qualifieré€šå¸¸éƒ½æ˜¯ä»¥æ³¨è§£å½¢å¼ä½¿ç”¨çš„,ç”¨äºåœ¨æ³¨å…¥beanæ—¶æ˜ç¡®æŒ‡æ˜Beançš„åç§°&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æ‹¿typeå±æ€§å¹¶æ ¡éªŒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>parseState.push()&lt;/p>
&lt;/li>
&lt;li>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">AutowireCandidateQualifier&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">qualifier&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">AutowireCandidateQualifier&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>setSource&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ‹¿valueå±æ€§,å¦‚æœæœ‰çš„è¯å°±å¡å…¥qualifier&lt;/p>
&lt;/li>
&lt;li>
&lt;p>éå†å­èŠ‚ç‚¹,å–å…¶nameå’Œvalue(ä¸¤è€…éƒ½å¿…é¡»å­˜åœ¨),new BeanMetadataAttribute ,å¡å…¥qualifier&lt;/p>
&lt;/li>
&lt;li>
&lt;p>qualifierå¡å…¥bd&lt;/p>
&lt;/li>
&lt;li>
&lt;p>parseState.pop()&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="bdè®¾å¥½resourceå’Œsourceä½œä¸ºç»“æœæˆåŠŸè¿”å›">
&lt;a href="#bd%e8%ae%be%e5%a5%bdresource%e5%92%8csource%e4%bd%9c%e4%b8%ba%e7%bb%93%e6%9e%9c%e6%88%90%e5%8a%9f%e8%bf%94%e5%9b%9e">#&lt;/a>
bdè®¾å¥½resourceå’Œsource,ä½œä¸ºç»“æœæˆåŠŸè¿”å›.
&lt;/h4>&lt;h2 id="2ç”Ÿæˆbeanname">
&lt;a href="#2%e7%94%9f%e6%88%90beanname">#&lt;/a>
2.ç”ŸæˆbeanName
&lt;/h2>&lt;p>å¦‚æœè¿™ä¸ªbeanä¹‹å‰æ²¡æœ‰idæˆ–name,é‚£å°±ä¸ºå®ƒç”Ÿæˆä¸ªbeanName&lt;/p>
&lt;p>å…¶è§„åˆ™ä¹Ÿç•¥çƒ¦,ä¸è¿‡æ„Ÿè§‰ä¸é‡è¦,ç®€å•å¸¦è¿‡ä¸€ä¸‹,æœ‰ä¸€ç§ç”Ÿæˆè§„åˆ™å¦‚ä¸‹&lt;/p>
&lt;p>å‘½åä¸»è¦æ ¹æ®çš„å±æ€§æœ‰&lt;/p>
&lt;p>getBeanClassName&lt;/p>
&lt;p>çˆ¶beanå+$child&lt;/p>
&lt;p>å·¥å‚å+$created&lt;/p>
&lt;blockquote>
&lt;p>&amp;lsquo;class&amp;rsquo; nor &amp;lsquo;parent&amp;rsquo; nor &amp;lsquo;factory-bean&amp;rsquo;&lt;/p>
&lt;/blockquote>
&lt;p>åç¼€å†åŠ ä¸Š#&lt;/p>
&lt;p>å¦‚æœæ˜¯å†…éƒ¨beanå†å°±åŠ bdç”Ÿæˆçš„hexString&lt;/p>
&lt;p>å¦‚æœä¸æ˜¯,å°±å†åŠ registryé‡Œè¿™ç§beançš„åºå· ä»0å¼€å§‹&lt;/p>
&lt;h2 id="3è¿”å›beandefinitionholder">
&lt;a href="#3%e8%bf%94%e5%9b%9ebeandefinitionholder">#&lt;/a>
3.è¿”å›BeanDefinitionHolder
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliasesArray&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">aliases&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionHolder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">beanDefinition&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">beanName&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">aliasesArray&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Springæºç ç¬”è®°-1.1 è·å–beanæµç¨‹ä¹‹å®¹å™¨çš„åŸºæœ¬å®ç°</title><link>https://heeexy.com/p/spring_note_1/</link><pubDate>Mon, 11 Sep 2017 20:31:00 +0800</pubDate><guid>https://heeexy.com/p/spring_note_1/</guid><description>&lt;blockquote>
&lt;p>ä»¥é€šè¿‡BeanFactoryè·å–beanä¸ºä¾‹å­¦ä¹ ,å®é™…é¡¹ç›®ä¸­æ›´å¤šæ˜¯ä½¿ç”¨ApplicationContext&lt;/p>
&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/springGetBean.png"
loading="lazy"
alt="img"
>&lt;/p>
&lt;p>1.è¯»å–é…ç½®æ–‡ä»¶ beanFactoryTest.xml&lt;/p>
&lt;p>2.é€šè¿‡æ–‡ä»¶èµ„æºè·å–å·¥å‚&lt;/p>
&lt;p>3.ä»å·¥å‚ä¸­æ‹¿bean&lt;/p>
&lt;/blockquote>
&lt;h2 id="è¯»é…ç½®">
&lt;a href="#%e8%af%bb%e9%85%8d%e7%bd%ae">#&lt;/a>
è¯»é…ç½®
&lt;/h2>&lt;h4 id="é…ç½®æ–‡ä»¶å°è£…">
&lt;a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%b0%81%e8%a3%85">#&lt;/a>
é…ç½®æ–‡ä»¶å°è£…
&lt;/h4>&lt;p>ClassPathResourceç±» ç»§æ‰¿&amp;ndash;AbstractFileResolvingResource&lt;/p>
&lt;p>â€‹ ç»§æ‰¿&amp;ndash;AbstractResource&lt;/p>
&lt;p>â€‹ å®ç°&amp;ndash;Resource&lt;/p>
&lt;p>â€‹ ç»§æ‰¿&amp;ndash;InputStreamSourceæ¥å£ å”¯ä¸€æ–¹æ³•: &lt;strong>getInputStream()&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Resourceæ¥å£æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥å°è£…åº•å±‚èµ„æº&lt;/strong>,æ¯”å¦‚ exists() isReadable() getURL() getFile() getDescription() ç­‰ç­‰&lt;/p>
&lt;h2 id="xmlbeanfactoryçš„å®ä¾‹åŒ–">
&lt;a href="#xmlbeanfactory%e7%9a%84%e5%ae%9e%e4%be%8b%e5%8c%96">#&lt;/a>
XmlBeanFactoryçš„å®ä¾‹åŒ–
&lt;/h2>&lt;h3 id="å¤§æ¦‚æ­¥éª¤">
&lt;a href="#%e5%a4%a7%e6%a6%82%e6%ad%a5%e9%aa%a4">#&lt;/a>
å¤§æ¦‚æ­¥éª¤
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">XmlBeanFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Resource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanFactory&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeansException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">super&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">parentBeanFactory&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//1.è®¾ç½®çˆ¶å·¥å‚(null)...æœ¬ä¾‹æœªä½¿ç”¨åˆ°æ­¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">reader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">XmlBeanDefinitionReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//2.å®ä¾‹åŒ–XmlBeanDefinitionReader, æ³¨å†Œåˆ°æ­¤å·¥å‚&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">reader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">loadBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="c1">//3.é‡è¦éƒ¨åˆ†,é€šè¿‡resourceæ¥åŠ è½½beanDefinations,beançš„ä¸€äº›å®šä¹‰&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>loadBeanDefinitions(resource)æ–¹æ³•å°±æ˜¯ä¸‹é¢çš„ä¸»è¦è¦çœ‹çš„&lt;/p>
&lt;p>å®ƒåšäº†å‡ ä»¶äº‹:&lt;/p>
&lt;ol>
&lt;li>å°†resourceç”¨EncodedResourceåŒ…è£…ä¸€ä¸‹,ç¼–ç è¦ç”¨, æœ¬ä¾‹æ²¡ç‰¹å®šçš„charsetå’Œencodingå› æ­¤éƒ½æ˜¯null&lt;/li>
&lt;li>è·å–å½“å‰æ­£åœ¨åŠ è½½çš„èµ„æºé›† Set&lt;EncodedResource> currentResources ,å¦‚æœcurrentResources æ˜¯null å°±åˆå§‹åŒ–ä¸ª new HashSet(4), ç„¶åå°†æˆ‘ä»¬è¦è¯»çš„encodedResourceåŠ åˆ°è¿™ä¸ªseté‡Œé¢å»&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>å¦‚æœè¿”å›falseè¯´æ˜æ­£åœ¨åŠ è½½è¿™ä¸ªxmläº†,æŠ¥ä¸ªé”™,ä¸ç»§ç»­å¾€ä¸‹è¯»äº†&lt;/p>
&lt;p>å½“è¯»å®Œè¿™ä¸ªèµ„æºå,åœ¨finallyé‡Œé¢ä¼šä»seté‡Œç§»å‡ºè¿™ä¸ªencodedResource,å¦‚æœsetç©ºäº†,è¿˜ä¼šremoveè¿™ä¸ªcurrentResources,&lt;/p>
&lt;p>è¿™ä¸ªsetæ˜¯æ”¾ThreadLocalé‡Œé¢çš„,&lt;/p>
&lt;p>private final ThreadLocal&amp;lt;Set&lt;EncodedResource>&amp;gt; resourcesCurrentlyBeingLoaded;&lt;/p>
&lt;p>æ˜¯çº¿ç¨‹å®‰å…¨çš„,åŠŸèƒ½æ˜¯é˜²æ­¢åŒæ—¶&lt;strong>å¾ªç¯åŠ è½½&lt;/strong>åŒä¸€ä¸ªxmlæ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>ä»encodedResouceé‡Œå–å‡ºæ–‡ä»¶çš„inputStream æ‹¿å»åˆå§‹åŒ–ä¸ªInputSource(æœ‰encondingçš„è¯,ç»™inputSourceä¹Ÿè®¾ä¸ªç¼–ç ,æœ¬ä¾‹ä¸ºnull)ç„¶å inputSourceå’ŒencodedResouceé‡Œé¢çš„resouceä¸€èµ·æ‹¿å»æ‰§è¡ŒdoLoadBeanDefinitions(..)æ–¹æ³•,ç¨åé‡ç‚¹è®²&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">var5&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doLoadBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inputSource&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">encodedResource&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>å…³é—­èµ„æº, é‡Šæ”¾currentResources ç­‰&lt;/li>
&lt;/ol>
&lt;h3 id="å…³é”®doloadbeandefinitions">
&lt;a href="#%e5%85%b3%e9%94%aedoloadbeandefinitions">#&lt;/a>
&lt;strong>å…³é”®:doLoadBeanDefinitions&lt;/strong>
&lt;/h3>&lt;h4 id="å°†èµ„æºè½¬ä¸ºdocument">
&lt;a href="#%e5%b0%86%e8%b5%84%e6%ba%90%e8%bd%ac%e4%b8%badocument">#&lt;/a>
å°†èµ„æºè½¬ä¸ºDocument
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doLoadDocument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">inputSource&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>è·å–xmlçš„éªŒè¯æ¨¡å¼ , é‡Œé¢çš„æ ¸å¿ƒæ˜¯è‡ªåŠ¨æ£€æµ‹,è‡ªåŠ¨æ£€æµ‹çš„æ ¸å¿ƒæ˜¯æ‹¿ç€inputStreamè¯»,åˆ¤æ–­æ˜¯å¦å«æœ‰&amp;quot;DOCTYPE&amp;quot;,åŒ…å«å°±æ˜¯DTD,æ²¡æœ‰å°±æ˜¯XSD&lt;/li>
&lt;li>æ‹¿åˆ°EntityResolver , è¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥ç»™xmléªŒè¯æ—¶æ‰¾DTDæ–‡ä»¶è·å–è·¯å¾„æ‰¾å¾—å¿«çš„, ä¸ç”¨å…¨å»springç½‘ç«™æ‹¿dtd,ç•¥&lt;/li>
&lt;li>è§£ædocument, åˆ›å»ºDocumentBuilderFactory,é€šè¿‡æ­¤å·¥å‚åˆ›å»ºDocumentBuilder,è¿›è€Œè§£æinputSourceæ¥è¿”å›documentå¯¹è±¡. æ­¤ä¸ºé€šè¿‡SAX(Simple API for XML)æ¥è§£æçš„å¸¸è§æ–¹æ³•,ç•¥è¿‡&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>æ³¨æ„åˆ°æœ¬æ–¹æ³•çš„å‚æ•°ä¸­åˆç”¨åˆ°resource, æ˜æ˜inputSourceå°±æ˜¯ä»resourceé‡Œæ‹¿inputStreamç”Ÿæˆå‡ºæ¥çš„å•Š, ç›¸å½“äºinputSourceå°±æ˜¯å„¿å­, doLoadDocumentæ–¹æ³•è¯·äº†å„¿å­åˆå»è¯·çˆ¹,çƒ¦ä¸çƒ¦?&lt;/p>
&lt;p>å…¶å®ä¸»è¦æ˜¯ä¹‹å‰è®¾è®¡çš„æ—¶å€™, è·å–XMLéªŒè¯æ¨¡å¼çš„è‡ªåŠ¨æ£€æµ‹æ–¹æ³•,ç”¨çš„æ˜¯Resourceæ¥å£,isOpen()æ–¹æ³•å› æ­¤ä¸å¾—ä¸ç”¨&lt;/p>
&lt;p>isOpen()æ–¹æ³•æ˜¯Resourceæ¥å£çš„æ–¹æ³•,å…¶å®ç°è¿”å›false(æ¯”å¦‚AbstractResource),æœ‰çš„è¿”å›çš„æ˜¯true(InputStreamResource).&lt;/p>
&lt;/blockquote>
&lt;h4 id="æ³¨å†Œbean">
&lt;a href="#%e6%b3%a8%e5%86%8cbean">#&lt;/a>
æ³¨å†Œbean
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">registerBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…ˆèµ°æµç¨‹&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">registerBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Resource&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">throws&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionStoreException&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionDocumentReader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documentReader&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createBeanDefinitionDocumentReader&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">countBefore&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getRegistry&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getBeanDefinitionCount&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">documentReader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">registerBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createReaderContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resource&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getRegistry&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getBeanDefinitionCount&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">countBefore&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol>
&lt;li>åˆ›å»ºé˜…è¯»å™¨documentReader&lt;/li>
&lt;li>è®°å½•åŠ è½½BeanDefinitionçš„ä¸ªæ•°,&lt;/li>
&lt;li>documentReaderæ¥åŠ è½½æ³¨å†Œdocå’Œå°è£…resourceè€Œç”Ÿæˆçš„Context&lt;/li>
&lt;/ol>
&lt;p>ç»§ç»­èµ°æµç¨‹, åœ¨readerå†…è®¾ç½®context,æ‹¿åˆ°rootå…ƒç´ ,é‡ç‚¹åœ¨æœ€åè§£æroot&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">registerBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Document&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">XmlReaderContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">readerContext&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">readerContext&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">readerContext&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Loading bean definitions&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">doc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getDocumentElement&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doRegisterBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="å¼€å§‹æ ¸å¿ƒéƒ¨åˆ†-doregisterbeandefinitions">
&lt;a href="#%e5%bc%80%e5%a7%8b%e6%a0%b8%e5%bf%83%e9%83%a8%e5%88%86-doregisterbeandefinitions">#&lt;/a>
å¼€å§‹æ ¸å¿ƒéƒ¨åˆ† doRegisterBeanDefinitions
&lt;/h5>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">protected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">doRegisterBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Element&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> åŸºäºåŸæœ¬çš„detegate,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> åŠ ä¸Šè¿™é‡Œçš„contextå’Œroot(XMLå†…å®¹)ä¿®é¥°ä¸€é,ä½œä¸ºæ­¤å¤„è¦ç”¨çš„è§£æä»£ç†ParserDelegate
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> æ–¹æ³•ç»“æŸæ—¶,ä¼šæŠŠåŸæ¥çš„è§£æå™¨ç½®æ¢å›æ¥
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">BeanDefinitionParserDelegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">createDelegate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœå‘½åç©ºé—´ä¸ºç©ºæˆ–è€…ç­‰äº&amp;#34;http://www.springframework.org/schema/beans&amp;#34; å°±æ ¡éªŒé‡Œé¢çš„ä¸€äº›å±æ€§&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœæœ‰profileå±æ€§,å°±è¦å»ç¯å¢ƒå˜é‡ä¸­å»å¯»æ‰¾&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getAttribute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;profile&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">specifiedProfiles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">tokenizeToStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å¦‚æœä¸æ˜¯å½“å‰ç¯å¢ƒå˜é‡çš„å±æ€§å€¼,å°±è·³è¿‡è¿™ä¸ªxmlæ–‡ä»¶&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getEnvironment&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">acceptsProfiles&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">specifiedProfiles&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isInfoEnabled&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Skipped XML bean definition file due to specified profiles [&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;] not matching: &amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getReaderContext&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">getResource&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è§£æå‰çš„é¢„å¤„ç† é»˜è®¤å®ç°æ–¹æ³•æ˜¯ç©ºçš„..é¢„ç•™ç»™å­ç±»è¿›è¡Œæ”¹é€ çš„ä½ç½®~~~&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">preProcessXml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//æ ¸å¿ƒè§£æ &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">parseBeanDefinitions&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//è§£æåçš„å¤„ç† é»˜è®¤å®ç°æ–¹æ³•æ˜¯ç©ºçš„..é¢„ç•™ç»™å­ç±»è¿›è¡Œæ”¹é€ çš„ä½ç½®~~~&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">postProcessXml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">//å°†delegateæ¢å›å»&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">delegate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">parent&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>this.preProcessXml(root); this.postProcessXml(root);æ­¤å¤„çš„é¢„ç•™ &lt;strong>è®¾è®¡æ¨¡å¼&amp;mdash;æ¨¡æ¿æ–¹æ³•æ¨¡å¼&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>profile&lt;/strong>
&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/spring_profile.png"
loading="lazy"
>&lt;/p>
&lt;p>å…³äºprofileå±æ€§ä¹¦ä¸­è®²ç”¨é€”è®²çš„å¾ˆæ¸…æ¥š,ä»æºç ä¸­æˆ‘äº†è§£åˆ°&lt;/p>
&lt;ol>
&lt;li>
&lt;p>profileå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªå±æ€§,æ¯”å¦‚ &lt;beans profile="dev test"> åªéœ€å½“å‰ç¯å¢ƒå˜é‡é‡Œå€¼æ»¡è¶³å…¶ä¸­ä¸€ç§å°±OK&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šä¸ªå±æ€§å¯ä»¥æ”¯æŒå¤šç§åˆ†éš”ç¬¦ é€—å· åˆ†å· ç©ºæ ¼ æºç æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">specifiedProfiles&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">tokenizeToStringArray&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profileSpec&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;,; &amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>å¯ä»¥ç”¨ä¸€ä¸ªæ„Ÿå¹å·ä¿®é¥°å±æ€§ æ¯”å¦‚ &lt;beans profile="!prod"> è¡¨ç¤º&amp;quot;é&amp;quot; , ä¸å¯å¤šä¸ªæ„Ÿå¹å·&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è¯»å–å¹¶è®¾ç½®spring.profiles.activeå±æ€§æ—¶è¿˜åŠ äº†sychronized&lt;/p>
&lt;/li>
&lt;li>
&lt;p>spring.profiles.activeå±æ€§å€¼å¯ä»¥å¤šä¸ª ,ç”¨é€—å·éš”å¼€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åˆ¤æ–­è¿‡ç¨‹å…¶å®æ˜¯&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentActiveProfiles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profile&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currentActiveProfiles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEmpty&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">doGetDefaultProfiles&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">profile&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>spring.profiles.activeé‡ŒåŒ…å«è¿™ä¸ªå±æ€§, æˆ–è€…spring.profiles.activeä¸ºç©º,ä½†æ˜¯spring.profiles.defaulté‡ŒåŒ…å«è¿™ä¸ªå±æ€§&lt;/p>
&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>ps.è¿™ä¸ªå±æ€§çœ‹æ˜ç™½å¾ˆæœ‰æˆå°±æ„Ÿ,ä¹¦ä¸Šæ²¡è§£é‡Šæºç , çœ‹åˆ°è¿™æ®µä¹‹å‰å…ˆæ˜¯è‡ªå·±åŸ‹ç€å¤´è¿›å»é’»æºç ,è«åå…¶å¦™å¡äº†å¾ˆä¹…,å¹¶ä¸çŸ¥é“æ•´æ®µçš„åŠŸèƒ½æ˜¯å•¥,ç»§ç»­çœ‹ä¹¦çœ‹åˆ°æ­¤å¤„,äº†è§£äº†è¿™ä¸ªprofile çš„åŠŸèƒ½,å†å›å¤´ç»“åˆæºç ,å°±æç„¶å¤§æ‚Ÿ:)&lt;/p>
&lt;/blockquote>
&lt;p>&lt;strong>åˆ¤æ–­æ˜¯ä¸æ˜¯é»˜è®¤å‘½åç©ºé—´&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">StringUtils&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">hasLength&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">||&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;http://www.springframework.org/schema/beans&amp;#34;&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">equals&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">namespaceUri&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Node&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isDefaultNamespace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getNamespaceURI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>nodeè·å–å‘½åç©ºé—´æ–¹æ³• getNamespaceURI()ä¸»è¦åœ¨ rt.jaré‡Œæœ‰å¾ˆå¤šç§ä¸åŒçš„å®ç°,è¿”å›å­—ç¬¦ä¸²,å°±ä¸å†å»æ·±ç©¶äº†&lt;/p>
&lt;h5 id="å†æ·±ä¸€å±‚-parsebeandefinitions">
&lt;a href="#%e5%86%8d%e6%b7%b1%e4%b8%80%e5%b1%82-parsebeandefinitions">#&lt;/a>
å†æ·±ä¸€å±‚ parseBeanDefinitions
&lt;/h5>&lt;p>ä¸è´´æºç äº†,è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯å…ˆåˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯é»˜è®¤å‘½åç©ºé—´ ,ä¸æ˜¯å°±æŒ‰è‡ªå®šä¹‰çš„æ–¹å¼è§£æ,&lt;/p>
&lt;p>æ˜¯çš„è¯å°±éå†èŠ‚ç‚¹,è§£ææ¯ä¸ªèŠ‚ç‚¹.&lt;/p>
&lt;p>æ¯ä¸ªèŠ‚ç‚¹è§£æä¹‹å‰éƒ½è¿˜ä¼šå»åˆ¤æ–­ä¸€éæ˜¯å¦é»˜è®¤å‘½åç©ºé—´,&lt;/p>
&lt;p>å¦‚æœä¸æ˜¯å°±æŒ‰è‡ªå®šä¹‰æ–¹å¼è§£æ,å¦‚æœæ˜¯å°±æ‰æŒ‰é»˜è®¤æ–¹å¼è§£æ&lt;/p>
&lt;p>é»˜è®¤æ ‡ç­¾å¦‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;bean&lt;/span> &lt;span class="na">id=&lt;/span>&lt;span class="s">&amp;#34;test&amp;#34;&lt;/span> &lt;span class="na">class=&lt;/span>&lt;span class="s">&amp;#34;test.testBean&amp;#34;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è‡ªå®šä¹‰æ ‡ç­¾å¦‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;tx:annotation-driven/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¥½,ä¹¦çš„ç¬¬äºŒç« åˆ°æ­¤ä¸ºæ­¢,ç¬¬ä¸‰ç« å°†ç»§ç»­æ·±å…¥é»˜è®¤æ ‡ç­¾çš„è§£æ&lt;/p></description></item><item><title>Lanterné…ç½®</title><link>https://heeexy.com/p/lantern/</link><pubDate>Thu, 03 Aug 2017 13:45:14 +0800</pubDate><guid>https://heeexy.com/p/lantern/</guid><description>&lt;blockquote>
&lt;p>ç¬¬ä¸€æ­¥:é£è·ƒé•¿åŸ&lt;/p>
&lt;/blockquote>
&lt;h2 id="é¢„å¤‡å·¥ä½œ">
&lt;a href="#%e9%a2%84%e5%a4%87%e5%b7%a5%e4%bd%9c">#&lt;/a>
é¢„å¤‡å·¥ä½œ
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>ä¸‹è½½å®‰è£… chrome&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸‹è½½å®‰è£… &lt;a class="link" href="https://github.com/getlantern/forum/issues/833" target="_blank" rel="noopener"
>lantern&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸‹è½½å®‰è£… &lt;a class="link" href="https://switchyomega.com/download.html" target="_blank" rel="noopener"
>switchyOmega&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="é…ç½®ä»£ç†">
&lt;a href="#%e9%85%8d%e7%bd%ae%e4%bb%a3%e7%90%86">#&lt;/a>
é…ç½®ä»£ç†
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>å¯åŠ¨lantern.exe, å¦‚æœå·²å¯åŠ¨è¿‡,ä¹Ÿå¯ä»¥ä»å³ä¸‹è§’æ‰˜ç›˜ä¸­æ‰¾åˆ°lanternå›¾æ ‡,å³å‡»,æ˜¾ç¤ºè“ç¯,æ­¤æ—¶æµè§ˆå™¨ä¼šæ˜¾ç¤ºè“ç¯çš„é¡µé¢&lt;/p>
&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/20170803142554.png"
loading="lazy"
alt="lanternå›¾æ ‡"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ‰¾åˆ°æœ¬æœºè“ç¯çš„ç«¯å£&lt;/strong>,æŒ‰ä¸‹å›¾æ­¥éª¤æ‰¾åˆ°æ ‡æ³¨å‡ºçš„127.0.0.1:56939&lt;/p>
&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/20170803143107.png"
loading="lazy"
>&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;p>â€‹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å³å‡»chromeå³ä¸Šæ–¹å®‰è£…å¥½çš„switchyOmegaçš„æ’ä»¶å›¾æ ‡,ç‚¹å‡»&lt;strong>é€‰é¡¹&lt;/strong>&lt;/p>
&lt;p>&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/20170803141511.png"
loading="lazy"
>&lt;/p>
&lt;p>è¿›å…¥é…ç½®é¡µé¢.åœ¨å·¦ä¾§èœå•æ æ‰¾åˆ° æ–°å»ºæƒ…æ™¯æ¨¡å¼,æƒ…æ™¯æ¨¡å¼åç§°éšæ„å¡«å†™,æ¯”å¦‚å°±å«&lt;strong>è“ç¯&lt;/strong>,åˆ›å»º.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¼–è¾‘åˆšæ‰åˆ›å»ºçš„æƒ…æ™¯æ¨¡å¼,å¦‚ä¸‹å›¾é…ç½®&lt;/p>
&lt;p>ä»£ç†åè®®http&lt;/p>
&lt;p>ä»£ç†æœåŠ¡å™¨127.0.0.1&lt;/p>
&lt;p>ä»£ç†ç«¯å£ (å¡«å†™ä½ è‡ªå·±åœ¨ç¬¬2æ­¥æ‰¾åˆ°çš„ç«¯å£å·,æœ¬ä¾‹æ˜¯56939)&lt;/p>
&lt;/li>
&lt;/ol>
&lt;pre>&lt;code> ![](http://ots7yt7am.bkt.clouddn.com/blog/20170803144056.png)
&lt;/code>&lt;/pre>
&lt;ol start="5">
&lt;li>
&lt;pre>&lt;code>å±å¹•å·¦ä¸‹è§’**åº”ç”¨é€‰é¡¹** ,é…ç½®å®Œæˆ
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ol>
&lt;h2 id="æˆåŠŸç¿»å¢™">
&lt;a href="#%e6%88%90%e5%8a%9f%e7%bf%bb%e5%a2%99">#&lt;/a>
æˆåŠŸç¿»å¢™
&lt;/h2>&lt;p>æ‰“å¼€&lt;a class="link" href="https://www.google.com" target="_blank" rel="noopener"
>Google&lt;/a> é¡µé¢, å·¦å‡»&lt;img src="http://ots7yt7am.bkt.clouddn.com/blog/20170803141511.png"
loading="lazy"
> é€‰ä¸­æƒ…æ™¯æ¨¡å¼ä¸º&lt;strong>è“ç¯&lt;/strong> ,æ­¤æ—¶åº”è¯¥å·²ç»å¯ä»¥æˆåŠŸç¿»å¢™äº†!&lt;/p>
&lt;p>è“ç¯æ¨¡å¼é€‚ç”¨ç¿»å¢™,æµè§ˆå›½å†…ç½‘ç«™æ—¶å¯ä»¥æ”¹ä¸ºç›´æ¥è¿æ¥.&lt;/p>
&lt;blockquote>
&lt;p>å½“ç„¶æœ‰æ–¹ä¾¿çš„è‡ªåŠ¨åˆ‡æ¢ä»£ç†çš„åŠŸèƒ½å•¦!&lt;/p>
&lt;p>ä½†æ˜¯ä½ å·²ç»èº«åœ¨å¢™å¤–äº†,è‡ªå·±æœæœå§!&lt;/p>
&lt;/blockquote></description></item></channel></rss>