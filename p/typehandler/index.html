<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="# é—®é¢˜ å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JSONObject æ›¿ä»£ä¹ æƒ¯ä½¿ç”¨çš„ JavaBean ï¼Œè€Œä¹‹æ‰€ä»¥èƒ½ç”¨ JSONObject ä¸»è¦å°±æ˜¯å› ä¸ºå®ƒå®ç°äº† Map<String,Object> ã€‚ å®é™…ä½¿ç”¨æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒMyBatis ä½¿ç”¨JSONObje"><title>MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(ä¸€)TypeHandler</title>
<link rel=canonical href=https://heeexy.com/p/typehandler/><link rel=stylesheet href=/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css><meta property='og:title' content="MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(ä¸€)TypeHandler"><meta property='og:description' content="# é—®é¢˜ å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JSONObject æ›¿ä»£ä¹ æƒ¯ä½¿ç”¨çš„ JavaBean ï¼Œè€Œä¹‹æ‰€ä»¥èƒ½ç”¨ JSONObject ä¸»è¦å°±æ˜¯å› ä¸ºå®ƒå®ç°äº† Map<String,Object> ã€‚ å®é™…ä½¿ç”¨æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒMyBatis ä½¿ç”¨JSONObje"><meta property='og:url' content='https://heeexy.com/p/typehandler/'><meta property='og:site_name' content='è¡—ä¸Šçš„åŠ¨ç‰©å›­'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='MyBatis'><meta property='article:tag' content='JSONObject'><meta property='article:published_time' content='2018-01-02T22:35:52+08:00'><meta property='article:modified_time' content='2018-01-02T22:35:52+08:00'><meta name=twitter:title content="MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(ä¸€)TypeHandler"><meta name=twitter:description content="# é—®é¢˜ å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JSONObject æ›¿ä»£ä¹ æƒ¯ä½¿ç”¨çš„ JavaBean ï¼Œè€Œä¹‹æ‰€ä»¥èƒ½ç”¨ JSONObject ä¸»è¦å°±æ˜¯å› ä¸ºå®ƒå®ç°äº† Map<String,Object> ã€‚ å®é™…ä½¿ç”¨æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒMyBatis ä½¿ç”¨JSONObje"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=https://img.heeexy.com/avatar.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>è¡—ä¸Šçš„åŠ¨ç‰©å›­</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/tags><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li class=menu-bottom-section><ol class=menu></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#å…¥å‚ç±»å‹è§£æ>å…¥å‚ç±»å‹è§£æ</a></li><li><a href=#è¿”å›ç»“æœç±»å‹è§£æ>è¿”å›ç»“æœç±»å‹è§£æ</a><ol><li><a href=#jdbctype>JdbcType</a></li><li><a href=#javatype>javaType</a></li><li><a href=#å¥‡æ€ªçš„ç°è±¡>å¥‡æ€ªçš„ç°è±¡</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/typehandler/>MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(ä¸€)TypeHandler</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2018-01-02</time></div></footer></div></header><section class=article-content><h1 id=é—®é¢˜><a href=#%e9%97%ae%e9%a2%98>#</a>
é—®é¢˜</h1><p>å‰é¢è¯´åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ JSONObject æ›¿ä»£ä¹ æƒ¯ä½¿ç”¨çš„ JavaBean ï¼Œè€Œä¹‹æ‰€ä»¥èƒ½ç”¨ JSONObject ä¸»è¦å°±æ˜¯å› ä¸ºå®ƒå®ç°äº† <code>Map&lt;String,Object></code> ã€‚</p><p>å®é™…ä½¿ç”¨æˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒMyBatis ä½¿ç”¨JSONObject å°è£…è¿”å›ç»“æœçš„æ—¶å€™å¾ˆâ€œæ™ºèƒ½â€ï¼Œæ•°æ®åº“é‡Œå­—æ®µæ˜¯ varchar ç±»å‹ï¼ŒJSONObject ä¸­è¿”å›å€¼å°±æ˜¯ String ç±»å‹ï¼Œæ•°æ®åº“å­—æ®µæ˜¯ int/float ç±»å‹ï¼ŒJSONObject ä¸­è¿”å›å€¼å°±æ˜¯å¯¹åº”çš„æ•°å€¼ç±»å‹ã€‚ç”šè‡³é€šè¿‡ debug å‘ç°æ•°æ®åº“ä¸­ä¿å­˜äº†datetime ç±»å‹çš„æ•°æ®ï¼ŒJSONObject ä¸­ä¿å­˜çš„æ˜¯ <code>java.sql.timestamp</code> ç±»å‹ï¼Œè€Œ<code>timestamp</code> ç±»å‹ç»§æ‰¿äº†å¸¸è§çš„ <code>java.util.Date</code> ã€‚</p><p><img src=http://img.heeexy.com/DataType.png loading=lazy></p><p>ä¸ºä»€ä¹ˆ MyBatis å¯ä»¥ç”¨å¾—è¿™ä¹ˆçˆ½å‘¢ï¼Ÿæˆ‘ä»¬å®ç°å¯å®Œå…¨æ²¡å£°æ˜éœ€è¦æ­¤å­—æ®µçš„ javaType å‘¢ã€‚è€Œä¸”ç”¨å¾—çˆ½äº†ï¼Œç±»å‹è½¬æ¢ä¼šä¸ä¼šå¯¼è‡´ç¨‹åºæ€§èƒ½å¤§æ‰“æŠ˜æ‰£å‘¢ï¼Ÿ</p><p>ä»Šå¤©æˆ‘ä»¬å°±ä»æ·±å…¥æºç ï¼Œæ¢ç©¶ä¸€ç•ª MyBatis åˆ°åº•æ˜¯æ€æ ·åšåˆ°å¯¹æœªæ˜ç¡®å£°æ˜çš„å­—æ®µå¤„ç†è¿”å›ç±»å‹çš„ã€‚</p><h1 id=typehandler><a href=#typehandler>#</a>
TypeHandler</h1><p>MyBatis ç±»å‹è½¬æ¢çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªæ¥å£ï¼Œå®šä¹‰çš„æ–¹æ³•å¯ä»¥çœ‹åšå°±ä¸¤ç§ setParameter å’Œ getResult ,å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬ä¼ å‚å’Œæ¥æ”¶ sql ç»“æœæ—¶å°±è°ƒç”¨è¿™ä¸ªã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>TypeHandler</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>setParameter</span><span class=p>(</span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=n>parameter</span><span class=p>,</span><span class=w> </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>T</span><span class=w> </span><span class=nf>getResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>T</span><span class=w> </span><span class=nf>getResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>columnIndex</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>T</span><span class=w> </span><span class=nf>getResult</span><span class=p>(</span><span class=n>CallableStatement</span><span class=w> </span><span class=n>cs</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>columnIndex</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ½è±¡ç±» BaseTypeHandler éƒ¨åˆ†å®ç°äº† TypeHandler ,ä¸»è¦å®Œæˆäº†å¯¹ç©ºå€¼çš„å¤„ç†ã€‚ éç©ºå€¼çš„å¤„ç†å…¨éƒ¨äº¤ç»™äº†å­ç±»å®Œæˆã€‚</p><p>BaseTypeHandler å­ç±»éå¸¸å¤šï¼Œå¯¹åº”äº†æ•°æ®åº“çš„å„ç§æ•°æ®ç±»å‹ï¼Œå®ç°éƒ½å¾ˆç®€å•ï¼Œæ¯”å¦‚<code>SqlTimestampTypeHandler</code> å¤„ç† Timestamp ç±»å‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setNonNullParameter</span><span class=p>(</span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>Timestamp</span><span class=w> </span><span class=n>parameter</span><span class=p>,</span><span class=w> </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ps</span><span class=p>.</span><span class=na>setTimestamp</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>parameter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Timestamp</span><span class=w> </span><span class=nf>getNullableResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getTimestamp</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>éƒ½æ˜¯ç›´æ¥è°ƒç”¨äº† PreparedStatement å’Œ ResultSet å¤„ç†ç›¸åº”ç±»å‹å­—æ®µçš„æ–¹æ³•ã€‚</p><p>å¾ˆæ˜æ˜¾ï¼Œä¸€æ—¦æŒ‡æ˜äº†æˆ‘ä»¬éœ€è¦ MyBatis ç»™æˆ‘ä»¬è¿”å›çš„æ­¤å­—æ®µç±»å‹ï¼ŒMyBatis è‚¯å®šå°±å»æ‰¾åˆ°å¯¹åº”çš„ TypeHandler å®ç°ç±»å»å¤„ç†ã€‚è€Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šè¿”å›ç±»å‹çš„æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œå¯¹äº Object ç±»å‹æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p><h1 id=objecttypehandler><a href=#objecttypehandler>#</a>
ObjectTypeHandler</h1><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œçœ‹åå­—å°±ä¼šçŒœå¯èƒ½ä¼°è®¡æœªçŸ¥ç±»å‹å…¨é å®ƒäº†å§ã€‚æå‰é¢„å‘Šä¸‹ï¼Œå¹¶ä¸æ˜¯å“¦ï¼ŒgetNullableResult è¿˜ç®—ç»å¸¸ä½¿ç”¨ï¼Œå…¥å‚èµ‹å€¼å°±æ²¡è§ç”¨äº†ï¼Œæ¯•ç«Ÿå…¥å‚çš„ JavaType æˆ‘ä»¬é€šè¿‡åå°„è¿˜æ˜¯å¯ä»¥æ‰¾åˆ°çš„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setNonNullParameter</span><span class=p>(</span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>parameter</span><span class=p>,</span><span class=w> </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ps</span><span class=p>.</span><span class=na>setObject</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>parameter</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>getNullableResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getObject</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸€çœ‹è¿™å®ç°ï¼Œå±…ç„¶è¿˜æ˜¯è°ƒç”¨çš„ JDBC åº•å±‚çš„å¯¹åº”æ–¹æ³•ã€‚äº‹å®ä¸Š <code>com.mysql.jdbc</code> åœ¨å¤„ç†<code>Object</code> ç±»å‹æ˜¯ä¹Ÿæ˜¯é€šè¿‡å¤§é‡çš„ if-else æˆ– switch-case æ¥æ‰¾åˆ°æœ¬æ•°æ®çœŸæ­£çš„ç±»å‹çš„ã€‚å…¥å‚ç»‘å®šä¾æ® parameterObj instanceof å„ç§ç±»å‹ï¼Œè¿”å›ç»“æœç±»å‹ä¾æ® field.getSQLType çš„å„ç§ç±»å‹ã€‚</p><h1 id=unknowntypehandler><a href=#unknowntypehandler>#</a>
UnknownTypeHandler</h1><p>äº‹å®ä¸Šï¼ŒMyBatis åœ¨å¾ˆå¤šæˆ‘ä»¬æ²¡æœ‰æŒ‡æ˜å‚æ•°ç±»å‹çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ä½¿ç”¨ UnknownTypeHandler æ¥è§£å†³ç±»å‹è½¬æ¢çš„ã€‚UnknownTypeHandler ä¸­çš„æ ¸å¿ƒ<code>resolveTypeHandler</code> æ–¹æ³•ï¼Œå°±æ˜¯æŸ¥æ‰¾å¯¹åº”æ•°æ®çš„ç±»å‹è§£æå™¨ï¼ˆTypeHandler) ï¼Œ å†ç”¨è¿™ä¸ªåˆé€‚çš„ typeHandler è¿›è¡Œè§£æã€‚</p><p><code>resolveTypeHandler</code> æ–¹æ³•çš„é‡è½½æœ‰3ç§ï¼Œä¸»è¦çš„ä¸¤ç§å°±æ˜¯ä¸€ç§å¤„ç†å…¥å‚çš„ï¼Œä¸€ç§å¤„ç†è¿”å›ç»“æœçš„ã€‚</p><h3 id=å…¥å‚ç±»å‹è§£æ><a href=#%e5%85%a5%e5%8f%82%e7%b1%bb%e5%9e%8b%e8%a7%a3%e6%9e%90>#</a>
å…¥å‚ç±»å‹è§£æ</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>TypeHandler</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>resolveTypeHandler</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>parameter</span><span class=p>,</span><span class=w> </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>TypeHandler</span><span class=o>&lt;?</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>handler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>parameter</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OBJECT_TYPE_HANDLER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>typeHandlerRegistry</span><span class=p>.</span><span class=na>getTypeHandler</span><span class=p>(</span><span class=n>parameter</span><span class=p>.</span><span class=na>getClass</span><span class=p>(),</span><span class=w> </span><span class=n>jdbcType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// check if handler is null (issue #270)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>handler</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>handler</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>UnknownTypeHandler</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>OBJECT_TYPE_HANDLER</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>handler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨å…¥å‚ä¸º null æˆ–è€…å®åœ¨æ‰¾ä¸åˆ°è§£æå™¨çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šè¿”å›æˆ‘ä»¬ä¸Šé¢è®²çš„ ObjectTypeHandler ã€‚</p><p>è€Œè¿™é‡Œé¢å…³é”®çš„æ–¹æ³•å°±æ˜¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>typeHandlerRegistry</span><span class=p>.</span><span class=na>getTypeHandler</span><span class=p>(</span><span class=n>parameter</span><span class=p>.</span><span class=na>getClass</span><span class=p>(),</span><span class=w> </span><span class=n>jdbcType</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>typeHandlerRegistry å¯ä»¥ç†è§£ä¸ºå…¨å±€å…±ç”¨çš„å„ç§ç±»å‹ä¸è§£æå™¨å…³ç³»çš„æ³¨å†Œè¡¨ï¼Œåé¢çš„æ–‡ç« è¿˜ä¼šç»§ç»­æ·±å…¥è®²è§£ï¼Œæˆ‘ä»¬é¦–å…ˆæ³¨æ„è¿™ä¸ªæ–¹æ³•çš„å…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ‹¿åˆ°äº†å‚æ•°çš„ class , ç¬¬äºŒä¸ªå‚æ•°æ‹¿åˆ°äº† jdbcType ã€‚è¿™ä¸å°±ç›¸å½“äºjavaType å’Œ jdbcType éƒ½æœ‰äº†å—ï¼Ÿé‚£å³ä½¿è¿˜æ²¡ç ”ç©¶ typeHandlerRegistry åˆ°åº•å¹²äº†å•¥ï¼Œä½†æ˜¯æ¡ä»¶ç»™çš„è¿™ä¹ˆå……åˆ†äº†ï¼Œæ³¨å†Œè¡¨çš„ä»»åŠ¡ä¹Ÿå¤ªè½»æ¾äº†å§ï¼</p><p>ç­‰ç­‰ï¼Œæˆ‘ä»¬çš„ DAO å±‚ç»™å…¥å‚æ˜¯ JSONObject ç±»å‹,é‡Œé¢ username å­—æ®µæ˜¯ String ç±»å‹ï¼Œmoney å­—æ®µæ˜¯ float ç±»å‹ï¼Œè¿™äº›éƒ½èƒ½é€šè¿‡ getClass() è·å–åˆ°ç¡®å®æ²¡æ¯›ç—…ã€‚ä½†æ˜¯ jdbcType æ˜¯å“ªæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬ç°åœ¨å¯æ˜¯åœ¨å¤„ç† PreparedStatement å‘¢ï¼</p><p>é€šè¿‡ debug æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œçš„ jdbcType æˆ‘ä»¬æ²¡æœ‰æŒ‡æ˜çš„æƒ…å†µä¸‹ï¼Œç¡®å®éƒ½æ˜¯ null ã€‚è¯´æ˜ typeHandlerRegistry é‡Œä»…ä»…æ˜¯é€šè¿‡ javaType æ¥å¯»æ‰¾è§£æå™¨çš„ã€‚æ‰€ä»¥ typeHandlerRegistry è¿˜æ˜¯æœ‰å¾ˆå¤šé—¨é“ç­‰ç€æˆ‘ä»¬å»æ¢ç´¢å“¦ã€‚</p><h3 id=è¿”å›ç»“æœç±»å‹è§£æ><a href=#%e8%bf%94%e5%9b%9e%e7%bb%93%e6%9e%9c%e7%b1%bb%e5%9e%8b%e8%a7%a3%e6%9e%90>#</a>
è¿”å›ç»“æœç±»å‹è§£æ</h3><p>å¯¹ ResultSet çš„è§£ææœ‰ä¸¤ç§æ–¹å¼ï¼Œé¦–å…ˆæŸ¥çœ‹æ­¤ç»“æœå­—æ®µ&ndash;æ¯”å¦‚nickname&ndash;åœ¨ field ä¸­çš„åºå·ï¼Œå¦‚æœæ²¡åºå·ï¼Œåˆ™ç›´æ¥è¿”å› ObjectTypeHandler ã€‚å¦‚æœæœ‰åºå·ï¼Œåˆ™è¿›å…¥ä¸‹é¢çš„æ–¹æ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span><span class=w> </span><span class=n>TypeHandler</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>resolveTypeHandler</span><span class=p>(</span><span class=n>ResultSetMetaData</span><span class=w> </span><span class=n>rsmd</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>columnIndex</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>TypeHandler</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//é€šè¿‡ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•è·å–åˆ°jdbcTypeå’ŒjavaType</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>safeGetJdbcTypeForColumn</span><span class=p>(</span><span class=n>rsmd</span><span class=p>,</span><span class=w> </span><span class=n>columnIndex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>safeGetClassForColumn</span><span class=p>(</span><span class=n>rsmd</span><span class=p>,</span><span class=w> </span><span class=n>columnIndex</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>//åé¢çš„ä»»åŠ¡å°±è¿˜æ˜¯äº¤ç»™äº†typeHandlerRegistry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>javaType</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>jdbcType</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>typeHandlerRegistry</span><span class=p>.</span><span class=na>getTypeHandler</span><span class=p>(</span><span class=n>javaType</span><span class=p>,</span><span class=w> </span><span class=n>jdbcType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>javaType</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>typeHandlerRegistry</span><span class=p>.</span><span class=na>getTypeHandler</span><span class=p>(</span><span class=n>javaType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>jdbcType</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>handler</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>typeHandlerRegistry</span><span class=p>.</span><span class=na>getTypeHandler</span><span class=p>(</span><span class=n>jdbcType</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>handler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­çš„å…³é”®æ–¹æ³•è¿˜æ˜¯ä» rsmd ä¸­è·å– jdbcType å’Œ javaType ï¼Œç„¶åå†é€šè¿‡ typeHandlerRegistry å»æŸ¥æ‰¾å¯¹åº”çš„ handler ã€‚</p><p>debug å‘ç°å‡ ä¹æ¯æ¬¡ä» rsmd ä¸­è·å– jdbcType å’Œ javaType éƒ½è·å–åˆ°äº†ï¼Œçœ‹æ¥ç„æœºéƒ½åœ¨<code>safeGetJdbcTypeForColumn</code> å’Œ <code>safeGetClassForColumn</code> ä¸­äº†ã€‚</p><p>ä¸¤ä¸ªæ–¹æ³•çš„å…³é”®ä»£ç åˆ†åˆ«å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>return</span><span class=w> </span><span class=n>JdbcType</span><span class=p>.</span><span class=na>forCode</span><span class=p>(</span><span class=n>rsmd</span><span class=p>.</span><span class=na>getColumnType</span><span class=p>(</span><span class=n>columnIndex</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>classForName</span><span class=p>(</span><span class=n>rsmd</span><span class=p>.</span><span class=na>getColumnClassName</span><span class=p>(</span><span class=n>columnIndex</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=jdbctype><a href=#jdbctype>#</a>
JdbcType</h4><p><code>com.mysql.jdbc.ResultSetMetaData</code> å®ç°äº† <code>java.sql.ResultSetMetaData </code>æ¥å£ï¼Œæ­¤å¤„æˆ‘ä»¬è°ƒç”¨äº†å…¶ä¸­çš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getColumnType</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>column</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>column</span><span class=p>).</span><span class=na>getSQLType</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åºå·çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œæ ¹æ®åºå·æ‰¾åˆ°æ­¤ field ,å†æ‰¾å…¶ SQLType ï¼Œæ ¹æ® SQLType å»JdbcType ç±» (enumç±»å‹) å†…æŸ¥æ‰¾å¯¹åº”çš„ jdbcTypeã€‚</p><p>JdbcType ç±»å†…ç»´æŠ¤äº†ä¸€ä¸ª map ç±»å‹é™æ€å˜é‡ codeLookup ï¼Œç±»åŠ è½½æ—¶ä¸º codeLookup æ·»åŠ äº†39ä¸ªå…ƒç´ ï¼Œkey å€¼å…¶å®å°±æ˜¯ SQLType ï¼Œ int ç±»å‹ï¼Œvalue å°±æ˜¯æœ¬ jdbcType ã€‚</p><p>å› æ­¤æ ¹æ® SQLType åœ¨æ­¤å¤„å°±ç›´æ¥èƒ½æ¯«ä¸è´¹åŠ›åœ°æ‰¾å‡ºå¯¹åº”çš„ jdbcTypeã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>JdbcType</span><span class=w> </span><span class=n>type</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>JdbcType</span><span class=p>.</span><span class=na>values</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>codeLookup</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>TYPE_CODE</span><span class=p>,</span><span class=w> </span><span class=n>type</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=javatype><a href=#javatype>#</a>
javaType</h4><p>åŒæ ·éœ€è¦å…ˆæ‰¾åˆ° SQLType ï¼Œä»¥åŠfield å†…çš„å¦å¤–å‡ ä¸ªå±æ€§å€¼ï¼Œä¾‹å¦‚ isUnsigned ç­‰ä¸€èµ·è¿›å…¥ getClassNameForJavaType æ–¹æ³•æ‰¾åˆ°å¯¹åº”ç±»åã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getClassNameForJavaType</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>javaType</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isUnsigned</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>mysqlTypeIfKnown</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isBinaryOrBlob</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>isOpaqueBinary</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>treatYearAsDate</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>javaType</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=n>Types</span><span class=p>.</span><span class=na>BIT</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=n>Types</span><span class=p>.</span><span class=na>BOOLEAN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;java.lang.Boolean&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>case</span><span class=w> </span><span class=n>Types</span><span class=p>.</span><span class=na>TINYINT</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isUnsigned</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=s>&#34;java.lang.Integer&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;java.lang.Integer&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//......å¤§é‡ case</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=s>&#34;java.lang.Object&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è€Œè¿™é‡Œçš„å¤§é‡çš„ swtich-case ç»ˆäºç®—æ˜¯è§£é™¤äº†æˆ‘ä»¬ä¸€éƒ¨åˆ†çš„ç–‘æƒ‘äº†ï¼åº•å±‚ç»ˆå½’è¿˜æ˜¯é€šè¿‡ swtich-case è¿™ç§æœ€åŸå§‹çš„æ“ä½œæ¥æŠŠ jdbcType æ˜ å°„åˆ° java ç±»é‡Œå»çš„ï¼</p><h4 id=å¥‡æ€ªçš„ç°è±¡><a href=#%e5%a5%87%e6%80%aa%e7%9a%84%e7%8e%b0%e8%b1%a1>#</a>
å¥‡æ€ªçš„ç°è±¡</h4><p>ä¸Šé¢è¯´åˆ°ï¼Œå¦‚æœæ²¡åºå·ï¼Œåˆ™ç›´æ¥è¿”å› ObjectTypeHandlerã€‚</p><p>åºå·æ˜¯<code>getColumnType(int column)</code> ç”¨äºæ‰¾åˆ°åˆ°å¯¹åº”çš„ field çš„å…³é”®å±æ€§ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰å¯èƒ½ä¼šæ²¡æœ‰åºå·å‘¢ï¼Ÿ</p><p><img src=http://img.heeexy.com/debug-fields.png loading=lazy></p><p>é€šè¿‡ debug æˆ‘ä»¬å‘ç°ï¼Œæ˜æ˜ fields å†…æœ‰ 8 ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå­—æ®µçš„åŸå§‹åå’Œåˆ«åéƒ½æ¸…æ¸…æ¥šæ¥šï¼Œåˆ° columnIndexLookup é‡Œå±…ç„¶åªå‰©ä¸‹ 6 ä¸ªï¼Ÿ å¾ˆæ˜¾ç„¶ï¼Œé—®é¢˜å‡ºåœ¨äº†</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rsmd</span><span class=p>.</span><span class=na>getColumnName</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸­é—´æœ‰å‡ æ¬¡å–å‡ºäº†é‡å¤çš„ name ã€‚ä¸ºä»€ä¹ˆä¼šæœ‰é‡å¤çš„ name å‘¢ï¼Œæˆ‘ä»¬è¿›å…¥<code>getColumnName</code> ä¸€æ¢ç©¶ç«Ÿã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getColumnName</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>column</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>useOldAliasBehavior</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=c1>//å¦‚æœè®¾ç½®äº†ä½¿ç”¨åˆ«åçš„å±æ€§ï¼Œå°±è·å–æ­¤fieldçš„åˆ«åã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=k>return</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>column</span><span class=p>).</span><span class=na>getName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=c1>//è·å–æ­¤fieldçš„nameå±æ€§ï¼Œè€Œä¸æ˜¯åˆ«åã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>column</span><span class=p>).</span><span class=na>getNameNoAliases</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>name</span><span class=p>.</span><span class=na>length</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=c1>//å¦‚æœè¿åŸå§‹å­—æ®µåéƒ½æ‰¾ä¸åˆ°ï¼Œå°±è¿˜æ˜¯è·å–åˆ«å</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=k>return</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>column</span><span class=p>).</span><span class=na>getName</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å®é™…debugå‘ç°ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½æ˜¯é€šè¿‡ getNameNoAliases æ‰¾åˆ° name çš„ã€‚å†åº•å±‚çš„ä»£ç å°±ä¸éœ€è¦è´´äº†ï¼Œçœ‹åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ˜ç™½äº†ã€‚è¿™é‡Œçš„ name å…¶å®æ˜¯æ¯ä¸ªå­—æ®µçš„æ•°æ®åº“å†…çš„å­—æ®µåï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„åˆ«åï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°é‡å¤çš„æƒ…å†µï¼Œæ¯”å¦‚ user è¡¨æœ‰ id å­—æ®µï¼Œaddress è¡¨åŒæ ·ä¼šæœ‰ id å­—æ®µã€‚</p><h1 id=æ€»ç»“><a href=#%e6%80%bb%e7%bb%93>#</a>
æ€»ç»“</h1><p>ä»Šå¤©æˆ‘ä»¬åˆ†æå®Œäº†ç±»å‹è½¬æ¢å™¨ï¼Œå‘ç°å¯¹äºæœªçŸ¥çš„æ•°æ®ç±»å‹ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯é€šè¿‡ObjectTypeHandler è§£æï¼Œå…¶åº•å±‚çš„ç”¨äº†<code>com.mysql.jdbc.ResultSetImpl.getObject</code> å†…çš„ä¾æ® Field.SQLType çš„ swtich-case ã€‚</p><p>å¦ä¸€éƒ¨åˆ†åˆ™æ˜¯é€šè¿‡<code>UnknownTypeHandler</code> å»æŸ¥æ‰¾åˆé€‚çš„è§£æå™¨æ¥è§£æã€‚</p><p>å…³äºæŸ¥æ‰¾è§£æå™¨çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°†è¿›å…¥ä¸‹ä¸€å±‚çº§<code>TypeHandlerRegistry</code> æ¥ç»§ç»­å­¦ä¹ ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/mybatis/>MyBatis</a>
<a href=/tags/jsonobject/>JSONObject</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/typehandlerregistry/><div class=article-details><h2 class=article-title>MyBatis å¯¹æœªçŸ¥æ•°æ®ç±»å‹çš„è½¬æ¢(äºŒ)TypeHandlerRegistry</h2></div></a></article><article><a href=/p/one2many/><div class=article-details><h2 class=article-title>MyBatis ä¸­ä½¿ç”¨ JSONObject å¤„ç†ä¸€å¯¹å¤šç»“æœ</h2></div></a></article><article><a href=/p/jsonobject-in-mybatis/><div class=article-details><h2 class=article-title>MyBatis ä¸­ä½¿ç”¨ JSONObject æ›¿ä»£ JavaBean</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2017 -
2024 Heeexy</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>