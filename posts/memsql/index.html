<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MemSQL简介 | 网站标题</title>
<meta name=keywords content="MemSQL,大数据"><meta name=description content="为什么要看MemSQL 因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。
初体验结果 MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。
MemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。
特点 MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源 自带portal界面管理，MemSQL Studio，自带安装工具 完全支持mysql语法，jdbc，增删改查 支持 in-memory rowstore && on-disk columnstore 大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes) exactly-once aggregator节点运行sql，聚合结果；leaf节点存储&处理数据 数据导入 file , 指定分隔符 Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines MySQL (sql文件) 选择 shard key (类似ES的routing) Using a column or set of columns unique enough to minimize skew."><meta name=author content><link rel=canonical href=https://heeexy.com/posts/memsql/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://heeexy.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://heeexy.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://heeexy.com/favicon-32x32.png><link rel=apple-touch-icon href=https://heeexy.com/apple-touch-icon.png><link rel=mask-icon href=https://heeexy.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://heeexy.com/posts/memsql/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="MemSQL简介"><meta property="og:description" content="为什么要看MemSQL 因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。
初体验结果 MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。
MemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。
特点 MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源 自带portal界面管理，MemSQL Studio，自带安装工具 完全支持mysql语法，jdbc，增删改查 支持 in-memory rowstore && on-disk columnstore 大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes) exactly-once aggregator节点运行sql，聚合结果；leaf节点存储&处理数据 数据导入 file , 指定分隔符 Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines MySQL (sql文件) 选择 shard key (类似ES的routing) Using a column or set of columns unique enough to minimize skew."><meta property="og:type" content="article"><meta property="og:url" content="https://heeexy.com/posts/memsql/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="MemSQL简介"><meta name=twitter:description content="为什么要看MemSQL 因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。
初体验结果 MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。
MemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。
特点 MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源 自带portal界面管理，MemSQL Studio，自带安装工具 完全支持mysql语法，jdbc，增删改查 支持 in-memory rowstore && on-disk columnstore 大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes) exactly-once aggregator节点运行sql，聚合结果；leaf节点存储&处理数据 数据导入 file , 指定分隔符 Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines MySQL (sql文件) 选择 shard key (类似ES的routing) Using a column or set of columns unique enough to minimize skew."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://heeexy.com/posts/"},{"@type":"ListItem","position":2,"name":"MemSQL简介","item":"https://heeexy.com/posts/memsql/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MemSQL简介","name":"MemSQL简介","description":"为什么要看MemSQL 因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。\n初体验结果 MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。\nMemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。\n特点 MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源 自带portal界面管理，MemSQL Studio，自带安装工具 完全支持mysql语法，jdbc，增删改查 支持 in-memory rowstore \u0026amp;\u0026amp; on-disk columnstore 大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes) exactly-once aggregator节点运行sql，聚合结果；leaf节点存储\u0026amp;处理数据 数据导入 file , 指定分隔符 Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines MySQL (sql文件) 选择 shard key (类似ES的routing) Using a column or set of columns unique enough to minimize skew.","keywords":["MemSQL","大数据"],"articleBody":"为什么要看MemSQL 因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。\n初体验结果 MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。\nMemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。\n特点 MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源 自带portal界面管理，MemSQL Studio，自带安装工具 完全支持mysql语法，jdbc，增删改查 支持 in-memory rowstore \u0026\u0026 on-disk columnstore 大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes) exactly-once aggregator节点运行sql，聚合结果；leaf节点存储\u0026处理数据 数据导入 file , 指定分隔符 Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines MySQL (sql文件) 选择 shard key (类似ES的routing) Using a column or set of columns unique enough to minimize skew.\n独特的key，使数据均匀分布\nSharding on columns which you expect to filter or join on often. This allows the optimizer to minimize network traffic during the execution of the query (see [Distributed DML] for more details).\n使用你经常要join或过滤的字段，减小网络传输。比如订单相关，使用user_id\n查询调优 加index 优化过滤 groupby sort shard key : Gather partitions:all 优化为 Gather partitions:single Reference Tables 小表，不常更新 ，每个节点都有复制 表结构优化 Rowstore vs. Columnstore https://docs.memsql.com/tutorials/v6.8/optimizing-table-data-structures/\nRowstore : 查询指定列，并发更新。使用无锁索引，支持多索引。频繁更新的事务场景。unique constraints 。同样会往disk写一份 用于恢复。\nColumnstore： 顺序扫描，单索引。适用场景：聚合仅很少列（10列内）,扫描大量行，很少频繁单行删改，更新应该是大批量的修改\n分布式SQL DDL 每一个并行的查询都在每个leaf的每个partition上分开执行。 默认每个leaf的partition数量=cpu数量 每个partition都是个单独的库 reference tables在每个aggregator和leaf都有一份复制，适合小表 shard key 决定数据落到哪一partition 主键和unique key 需要包含shard key ，例如： CREATE TABLE clicks ( click_id BIGINT AUTO_INCREMENT, user_id INT, page_id INT, SHARD KEY (user_id), PRIMARY KEY (click_id, user_id) ); DML 分布式join 相同的shard key来join可以提升性能 分布式事务，等待每个partition都ready，再一起提交 引用表必须具有显式主键。 分布式表中的AUTO_INCREMENT列必须是BIGINT。 自动增量值在每个聚合器上单调递增，但在整个群集中不连续。 分片表不支持唯一键（除非唯一键是分片键的超集）。 分片表不支持修改分片键的UPDATE查询。 分片表不支持UPDATE … LIMIT。 遇到问题 mysql front连接不上\n换用其它客户端可以，比如idea\nhttps://docs.memsql.com/tutorials/v6.8/build-stock-trade-database/ 导入csv文件提示找不到文件\ndocker cp /home/hxy/download/companylist.csv 62b8df2d8761://usr/share\n性能体验 测试机器 AWS 8c32g\n测试数据 官方S3的数据，我们使用 columnstore 和 rowstore 各测一次sql查询。\nhttps://docs.memsql.com/guides/latest/load-data/pipelines/step-1/\ncolumnstore数据 rowstore 数据 由于150W行数据存disk 占1G，存memory需要占5G，发现机器内存不足，只导入了一张150W行和一张25行的表。\n执行sql耗时 select * from nation limit 20; columnstore 770ms\nrowstore 700ms\nselect l_returnflag, l_linestatus, sum(l_quantity) as sum_qty, sum(l_extendedprice) as sum_base_price, sum(l_extendedprice * (1 - l_discount)) as sum_disc_price, sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge, avg(l_quantity) as avg_qty, avg(l_extendedprice) as avg_price, avg(l_discount) as avg_disc, count(*) as count_order from lineitem where l_shipdate \u003c= date('1998-12-01' - interval '90' day) group by l_returnflag, l_linestatus order by l_returnflag, l_linestatus; columnstore 19s 5s 5s\nselect l_orderkey, sum(l_extendedprice * (1 - l_discount)) as revenue, o_orderdate, o_shippriority from customer, orders, lineitem where c_mktsegment = 'BUILDING' and c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate \u003c date('1995-03-15') and l_shipdate \u003e date('1995-03-15') group by l_orderkey, o_orderdate, o_shippriority order by revenue desc, o_orderdate limit 10; columnstore 10s 5s 5s\nselect c_custkey, c_name, sum(l_extendedprice * (1 - l_discount)) as revenue, c_acctbal, n_name, c_address, c_phone, c_comment from customer, orders, lineitem, nation where c_custkey = o_custkey and l_orderkey = o_orderkey and o_orderdate \u003e= date('1993-10-01') and o_orderdate \u003c date('1993-10-01') + interval '3' month and l_returnflag = 'R' and c_nationkey = n_nationkey group by c_custkey, c_name, c_acctbal, c_phone, n_name, c_address, c_comment order by revenue desc limit 20; columnstore 12s 9s 9s\nselect nation, o_year, sum(amount) as sum_profit from ( select n_name as nation, extract(year from o_orderdate) as o_year, l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount from part, supplier, lineitem, partsupp, orders, nation where s_suppkey = l_suppkey and ps_suppkey = l_suppkey and ps_partkey = l_partkey and p_partkey = l_partkey and o_orderkey = l_orderkey and s_nationkey = n_nationkey and p_name like '%green%' ) as profit group by nation, o_year order by nation, o_year desc; columnstore 32s 19s 19s\nselect * from customer c left join orders o on c.c_custkey = o.o_custkey left join nation n on c.c_nationkey = n.n_nationkey where c.c_custkey = '8367' limit 10; columnstore 32s 4s 4s\nselect * from customer c left join orders o on c.c_custkey = o.o_custkey and o_custkey = '2141' left join nation n on c.c_nationkey = n.n_nationkey where c.c_custkey = '2141' limit 10; columnstore 2s 1s 1s\nselect * from customer c where c.c_custkey = '2141' limit 10; rowstore 500ms\n","wordCount":"559","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://heeexy.com/posts/memsql/"},"publisher":{"@type":"Organization","name":"网站标题","logo":{"@type":"ImageObject","url":"https://heeexy.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://heeexy.com/ accesskey=h title="网站标题 (Alt + H)">网站标题</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">MemSQL简介</h1><div class=post-meta></div></header><div class=post-content><h2 id=为什么要看memsql>为什么要看MemSQL<a hidden class=anchor aria-hidden=true href=#为什么要看memsql>#</a></h2><p>因为 MemSQL 自称突出一个快！而我们团队的数据平台正需要一个ms级别查询的数据库，因此花了一点时间来调研 MemSQL 。</p><h2 id=初体验结果>初体验结果<a hidden class=anchor aria-hidden=true href=#初体验结果>#</a></h2><p>MemSQL与我们期望的ms级别查询相差甚远，最简单的查询也通常是500ms返回，并不能应对线上的高并发实时查询系统。秒级查询已经有presto等各种大数据组件，对于我们团队已经没有理由再来深入使用MemSQL。</p><p>MemSQL 其实有很多优点，有完善的文档，精致的页面管理工具，方便的安装，甚至一键导入大量数据来方便用户体验 （就差把sql的耗时贴出来了，要是贴出来就省了我调研的时间了），可惜在同一梯队还有太多免费、开源、有活跃社区的竞争对手。</p><h2 id=特点>特点<a hidden class=anchor aria-hidden=true href=#特点>#</a></h2><ul><li>MemSQL属于商业公司，免费4 units. (每8核32G 为1 unit)，不开源</li><li>自带portal界面管理，MemSQL Studio，自带安装工具</li><li>完全支持mysql语法，jdbc，增删改查</li><li>支持 in-memory rowstore && on-disk columnstore</li><li>大吞吐量数据写入(loading TPC-H SF100 (approximately 100 GBs of row files) will take around four minutes)</li><li>exactly-once</li><li>aggregator节点运行sql，聚合结果；leaf节点存储&处理数据</li></ul><h2 id=数据导入>数据导入<a hidden class=anchor aria-hidden=true href=#数据导入>#</a></h2><ol><li>file , 指定分隔符</li><li>Streaming (Kafka , S3 , Azure Blob , Filesystem) 通过Pipelines</li><li>MySQL (sql文件)</li></ol><h2 id=选择-shard-key---类似es的routing>选择 shard key (类似ES的routing)<a hidden class=anchor aria-hidden=true href=#选择-shard-key---类似es的routing>#</a></h2><ul><li><p>Using a column or set of columns unique enough to minimize skew.</p><p>独特的key，使数据均匀分布</p></li><li><p>Sharding on columns which you expect to filter or join on often. This allows the optimizer to minimize network traffic during the execution of the query (see [Distributed DML] for more details).</p><p>使用你经常要join或过滤的字段，减小网络传输。比如订单相关，使用user_id</p></li></ul><h2 id=查询调优>查询调优<a hidden class=anchor aria-hidden=true href=#查询调优>#</a></h2><ol><li>加index 优化过滤 groupby sort</li><li>shard key : Gather partitions:all 优化为 Gather partitions:single</li><li>Reference Tables 小表，不常更新 ，每个节点都有复制</li></ol><p><img loading=lazy src=http://img.heeexy.com/memsql-profile.png alt=profile></p><h2 id=表结构优化>表结构优化<a hidden class=anchor aria-hidden=true href=#表结构优化>#</a></h2><h3 id=rowstore-vs-columnstore>Rowstore vs. Columnstore<a hidden class=anchor aria-hidden=true href=#rowstore-vs-columnstore>#</a></h3><p><a href=https://docs.memsql.com/tutorials/v6.8/optimizing-table-data-structures/>https://docs.memsql.com/tutorials/v6.8/optimizing-table-data-structures/</a></p><p>Rowstore : 查询指定列，并发更新。使用无锁索引，支持多索引。频繁更新的事务场景。unique constraints 。同样会往disk写一份 用于恢复。</p><p>Columnstore： 顺序扫描，单索引。适用场景：聚合仅很少列（10列内）,扫描大量行，很少频繁单行删改，更新应该是大批量的修改</p><h2 id=分布式sql>分布式SQL<a hidden class=anchor aria-hidden=true href=#分布式sql>#</a></h2><h3 id=ddl>DDL<a hidden class=anchor aria-hidden=true href=#ddl>#</a></h3><ul><li>每一个并行的查询都在每个leaf的每个partition上分开执行。</li><li>默认每个leaf的partition数量=cpu数量</li><li>每个partition都是个单独的库</li><li>reference tables在每个aggregator和leaf都有一份复制，适合小表</li><li>shard key 决定数据落到哪一partition</li><li>主键和unique key 需要包含shard key ，例如：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> clicks (
</span></span><span style=display:flex><span>        click_id BIGINT AUTO_INCREMENT,
</span></span><span style=display:flex><span>        user_id INT,
</span></span><span style=display:flex><span>        page_id INT,
</span></span><span style=display:flex><span>        SHARD <span style=color:#66d9ef>KEY</span> (user_id),
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span> (click_id, user_id)
</span></span><span style=display:flex><span>    );
</span></span></code></pre></div><h3 id=dml>DML<a hidden class=anchor aria-hidden=true href=#dml>#</a></h3><ul><li>分布式join 相同的shard key来join可以提升性能</li><li>分布式事务，等待每个partition都ready，再一起提交</li><li>引用表必须具有显式主键。 分布式表中的AUTO_INCREMENT列必须是BIGINT。 自动增量值在每个聚合器上单调递增，但在整个群集中不连续。 分片表不支持唯一键（除非唯一键是分片键的超集）。 分片表不支持修改分片键的UPDATE查询。 分片表不支持UPDATE &mldr; LIMIT。</li></ul><h2 id=遇到问题>遇到问题<a hidden class=anchor aria-hidden=true href=#遇到问题>#</a></h2><ol><li><p>mysql front连接不上</p><p>换用其它客户端可以，比如idea</p></li><li><p><a href=https://docs.memsql.com/tutorials/v6.8/build-stock-trade-database/>https://docs.memsql.com/tutorials/v6.8/build-stock-trade-database/</a> 导入csv文件提示找不到文件</p><p>docker cp /home/hxy/download/companylist.csv 62b8df2d8761://usr/share</p></li></ol><h2 id=性能体验>性能体验<a hidden class=anchor aria-hidden=true href=#性能体验>#</a></h2><h3 id=测试机器>测试机器<a hidden class=anchor aria-hidden=true href=#测试机器>#</a></h3><p>AWS 8c32g</p><h3 id=测试数据>测试数据<a hidden class=anchor aria-hidden=true href=#测试数据>#</a></h3><p>官方S3的数据，我们使用 columnstore 和 rowstore 各测一次sql查询。</p><p><a href=https://docs.memsql.com/guides/latest/load-data/pipelines/step-1/>https://docs.memsql.com/guides/latest/load-data/pipelines/step-1/</a></p><h4 id=columnstore数据><strong>columnstore数据</strong><a hidden class=anchor aria-hidden=true href=#columnstore数据>#</a></h4><p><img loading=lazy src=http://img.heeexy.com/columnstore.png alt=columnstore.png></p><h4 id=rowstore-数据><strong>rowstore</strong> <strong>数据</strong><a hidden class=anchor aria-hidden=true href=#rowstore-数据>#</a></h4><p><img loading=lazy src=http://img.heeexy.com/rowstore.png alt=rowstore.png></p><p>由于150W行数据存disk 占1G，存memory需要占5G，发现机器内存不足，只导入了一张150W行和一张25行的表。</p><h4 id=执行sql耗时>执行sql耗时<a hidden class=anchor aria-hidden=true href=#执行sql耗时>#</a></h4><pre tabindex=0><code>select * from nation limit 20;
</code></pre><p><strong>columnstore</strong> 770ms</p><p><strong>rowstore</strong> 700ms</p><pre tabindex=0><code>select l_returnflag,
l_linestatus,
sum(l_quantity) as sum_qty,
sum(l_extendedprice) as sum_base_price,
sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,
sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,
avg(l_quantity) as avg_qty,
avg(l_extendedprice) as avg_price,
avg(l_discount) as avg_disc,
count(*) as count_order
from lineitem
where l_shipdate &lt;= date(&#39;1998-12-01&#39; - interval &#39;90&#39; day)
group by l_returnflag, l_linestatus
order by l_returnflag, l_linestatus;
</code></pre><p><strong>columnstore 19s 5s 5s</strong></p><pre tabindex=0><code>select
l_orderkey,
sum(l_extendedprice * (1 - l_discount)) as revenue,
o_orderdate,
o_shippriority
from
customer,
orders,
lineitem
where
c_mktsegment = &#39;BUILDING&#39;
and c_custkey = o_custkey
and l_orderkey = o_orderkey
and o_orderdate &lt; date(&#39;1995-03-15&#39;)
and l_shipdate &gt; date(&#39;1995-03-15&#39;)
group by
l_orderkey,
o_orderdate,
o_shippriority
order by
revenue desc,
o_orderdate
limit 10;
</code></pre><p><strong>columnstore</strong> 10s 5s 5s</p><pre tabindex=0><code>select
c_custkey,
c_name,
sum(l_extendedprice * (1 - l_discount)) as revenue,
c_acctbal,
n_name,
c_address,
c_phone,
c_comment
from
customer,
orders,
lineitem,
nation
where
c_custkey = o_custkey
and l_orderkey = o_orderkey
and o_orderdate &gt;= date(&#39;1993-10-01&#39;)
and o_orderdate &lt; date(&#39;1993-10-01&#39;) + interval &#39;3&#39; month
and l_returnflag = &#39;R&#39;
and c_nationkey = n_nationkey
group by
c_custkey,
c_name,
c_acctbal,
c_phone,
n_name,
c_address,
c_comment
order by
revenue desc
limit 20;
</code></pre><p><strong>columnstore</strong> 12s 9s 9s</p><pre tabindex=0><code>select
nation,
o_year,
sum(amount) as sum_profit
from
(
select
n_name as nation,
extract(year from o_orderdate) as o_year,
l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
from
part,
supplier,
lineitem,
partsupp,
orders,
nation
where
s_suppkey = l_suppkey
and ps_suppkey = l_suppkey
and ps_partkey = l_partkey
and p_partkey = l_partkey
and o_orderkey = l_orderkey
and s_nationkey = n_nationkey
and p_name like &#39;%green%&#39;
) as profit
group by
nation,
o_year
order by
nation,
o_year desc;
</code></pre><p><strong>columnstore</strong> 32s 19s 19s</p><pre tabindex=0><code>select *
from customer c
left join orders o on c.c_custkey = o.o_custkey
left join nation n on c.c_nationkey = n.n_nationkey
where c.c_custkey = &#39;8367&#39;
limit 10;
</code></pre><p><strong>columnstore</strong> 32s 4s 4s</p><pre tabindex=0><code>select *
from customer c
left join orders o on c.c_custkey = o.o_custkey and o_custkey = &#39;2141&#39;
left join nation n on c.c_nationkey = n.n_nationkey
where c.c_custkey = &#39;2141&#39;
limit 10;
</code></pre><p><strong>columnstore 2s 1s 1s</strong></p><pre tabindex=0><code>select *
from customer c
where c.c_custkey = &#39;2141&#39;
limit 10;
</code></pre><p><strong>rowstore</strong> 500ms</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://heeexy.com/tags/memsql/>MemSQL</a></li><li><a href=https://heeexy.com/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/>大数据</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://heeexy.com/>网站标题</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>